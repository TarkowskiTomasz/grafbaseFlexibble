(self.webpackChunkapp=self.webpackChunkapp||[]).push([[592],{9228:(E,D,l)=>{"use strict";l.d(D,{i:()=>g});var r=l(5e3),n=l(1062);let g=(()=>{class u{}return u.\u0275fac=function(t){return new(t||u)},u.\u0275cmp=r.Xpm({type:u,selectors:[["app-description-box"]],inputs:{header:"header",text:"text"},decls:7,vars:6,consts:[[1,"description-container"],[1,"description-container-title","text-line"],[1,"description-container-desc"]],template:function(t,s){1&t&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"div",2),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.qZA()),2&t&&(r.xp6(2),r.Oqu(r.lcZ(3,2,s.header)),r.xp6(3),r.Oqu(r.lcZ(6,4,s.text)))},pipes:[n.X$],styles:["@media (max-width: 640px){[_nghost-%COMP%]{display:none}}"]}),u})()},5268:(E,D,l)=>{"use strict";l.d(D,{D:()=>g});var r=l(5e3),n=l(520);let g=(()=>{class u{constructor(t){this.http=t}addDevice(t,s){return this.http.post("api/modbus-devices",{device:t,type:s})}saveDevice(t,s){return this.http.put("api/modbus-devices",{device:t,type:s})}removeDevice(t,s){return this.http.post("api/modbus-devices/remove",{objectId:t,type:s},{responseType:"text"})}saveDescriptor(t,s,d){return this.http.post("api/modbus-devices/descriptor",{registers:t,type:s,objectId:d},{responseType:"text"})}downloadDescriptor(t){return this.http.get("api/modbus-devices/descriptor/download",{params:{objectId:t},observe:"response",responseType:"blob"})}uploadDescriptor(t,s,d){return this.http.post("api/modbus-devices/descriptor/upload",{descriptor:t,type:s,objectId:d},{responseType:"text"})}getDevicesConfiguration(t){return this.http.get("api/modbus-devices/configuration",{params:{type:t}})}getDeviceDescriptor(t,s,d){return this.http.get("api/modbus-devices/descriptor",{params:{descriptor:t,type:s,readType:d}})}getHistoricalValues(t){return this.http.post("api/modbus-devices/history",t)}}return u.\u0275fac=function(t){return new(t||u)(r.LFG(n.eN))},u.\u0275prov=r.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},6801:(E,D,l)=>{"use strict";l.d(D,{P:()=>p});var r=l(5724),n=l(5e3),g=l(1062),u=l(9808),f=l(7003),t=l(2905),s=l(3075);function d(e,h){if(1&e){const c=n.EpF();n.TgZ(0,"div"),n.TgZ(1,"span",1),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"app-select",3),n.NdJ("modelChange",function(i){return n.CHM(c),n.oxw().resolution=i})("callbackChange",function(){return n.CHM(c),n.oxw().changeResolution()}),n.qZA(),n.qZA()}if(2&e){const c=n.oxw();n.xp6(2),n.Oqu(n.lcZ(3,3,"RESOLUTION")),n.xp6(2),n.Q6J("model",c.resolution)("options",c.resolutionsList)}}let p=(()=>{class e{constructor(c){this.translate=c,this.cl="app-pick-range",this.datesSaved=!1,this.resolutionsList=r._5,this.showResolutions=!1,this.periods=!0}ngOnInit(){const c=JSON.parse(localStorage.getItem(this.datesStorageKey)||"[]");this.resolution=localStorage.getItem(`${this.datesStorageKey}Resolution`)||"30s",this.checkPeriods(),setTimeout(()=>{c[0]&&c[1]?(this.dates=[new Date(c[0]),new Date(c[1])],this.datesSaved=!0,this.datesCopy=[...this.dates],this.callbackChange(this.dates[0],this.dates[1],this.resolution)):this.setDefaultDates()})}applyDate(c){this.datesCopy[0]===this.dates[0]&&this.datesCopy[1]===this.dates[1]||(void 0===c[0]||void 0===c[1]?(localStorage.removeItem(this.datesStorageKey),this.setDefaultDates()):(this.showResolutions&&this.checkDatesMaxRange("start"),localStorage.setItem(this.datesStorageKey,JSON.stringify(this.dates)),this.datesCopy=[...this.dates],this.callbackChange(this.dates[0],this.dates[1],this.resolution)))}applyRefresh(){this.datesCopy=[...this.dates],this.callbackChange(this.dates[0],this.dates[1],this.resolution)}setDefaultDates(){this.showResolutions?this.checkDatesMaxRange():(this.dates=[new Date,new Date],this.dates[0].setDate(this.dates[0].getDate()-1)),this.datesCopy=[...this.dates],this.callbackChange(this.dates[0],this.dates[1],this.resolution)}changeResolution(){localStorage.setItem(`${this.datesStorageKey}Resolution`,this.resolution),this.checkDatesMaxRange("end",!0),this.datesCopy=[...this.dates],this.callbackChange(this.dates[0],this.dates[1],this.resolution)}checkDatesMaxRange(c="end",a=!1){let i=this.resolutionsList.find(o=>o.id===this.resolution);if(i||(i=this.resolutionsList[0]),this.dates&&2===this.dates.length)(this.dates[1].valueOf()-this.dates[0].valueOf()>i.range||a)&&(this.dates="start"===c?[this.dates[0],new Date(this.dates[0].valueOf()+i.range)]:[new Date(this.dates[1].valueOf()-i.range),this.dates[1]]);else{const o=(new Date).valueOf();this.dates=[new Date(o-i.range),new Date(o)]}}checkPeriods(){if(this.periods){const c={};c[this.translate.instant("LAST_DAY")]=[(new Date).setDate((new Date).getDate()-1),new Date],c[this.translate.instant("LAST_WEEK")]=[(new Date).setDate((new Date).getDate()-7),new Date],c[this.translate.instant("LAST_MONTH")]=[(new Date).setMonth((new Date).getMonth()-1),new Date],this.ranges=c}}}return e.\u0275fac=function(c){return new(c||e)(n.Y36(g.sK))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-pick-range"]],hostVars:1,hostBindings:function(c,a){2&c&&n.uIk("class",a.cl)},inputs:{showResolutions:"showResolutions",periods:"periods",datesStorageKey:"datesStorageKey",callbackChange:"callbackChange"},decls:6,vars:7,consts:[[4,"ngIf"],[1,"label"],["id","date_range_picker","nzShowTime","","nzFormat","d.MM.yyyy HH:mm:ss",3,"ngModel","nzRanges","nzInputReadOnly","ngModelChange"],["inputClass","no-validate","inputId","resolution_select",3,"model","options","modelChange","callbackChange"]],template:function(c,a){1&c&&(n.YNc(0,d,5,5,"div",0),n.TgZ(1,"div"),n.TgZ(2,"span",1),n._uU(3),n.ALo(4,"translate"),n.qZA(),n.TgZ(5,"nz-range-picker",2),n.NdJ("ngModelChange",function(o){return a.dates=o})("ngModelChange",function(o){return a.applyDate(o)}),n.qZA(),n.qZA()),2&c&&(n.Q6J("ngIf",a.showResolutions),n.xp6(3),n.Oqu(n.lcZ(4,5,"PERIOD")),n.xp6(2),n.Q6J("ngModel",a.dates)("nzRanges",a.ranges)("nzInputReadOnly",!0))},directives:[u.O5,f.H,t.uw,t.wS,s.JJ,s.On],pipes:[g.X$],styles:["[_nghost-%COMP%]{display:flex}div[_ngcontent-%COMP%]{position:relative;margin-right:10px;padding:25px 0 0}"]}),e})()},9767:(E,D,l)=>{"use strict";l.d(D,{a:()=>g});var r=l(5e3);const n=["*"];let g=(()=>{class u{constructor(t,s){this.el=t,this.renderer=s,this.filters={},this.filtersModel={},this.selected=!1,this.indeterminate=!1,this.nrOfSelected=0,this.allowNzLeft=!0}set data(t){t&&(this._data=t.map(s=>Object.assign({selected:!1},s)),this.filterData())}ngOnInit(){this.activeSort=this.initSort||{key:"object_id",value:"descend"},this.filterData(),setTimeout(()=>{let t=124;this.el.nativeElement.querySelector(".table-buttons")&&(t+=72),this.el.nativeElement.querySelectorAll(".ant-pagination li").length&&(t+=58),this.tableInitialHeight=this.el.nativeElement.offsetHeight-t,this.tableHeight=this.el.nativeElement.offsetHeight-t+"px",this.el.nativeElement.offsetWidth<640&&(this.allowNzLeft=!1);const s=this.el.nativeElement.querySelector(".ant-table-wrapper");s&&this.renderer.setAttribute(s,"id","table_wrapper");const d=this.el.nativeElement.querySelector("table[nz-table-content]");d&&this.renderer.setAttribute(d,"id","table_container");const p=this.el.nativeElement.querySelector(".ant-table-thead tr:nth-child(1)");p&&this.renderer.setAttribute(p,"id","table_header_sort_row");const e=this.el.nativeElement.querySelectorAll("#table_container > tbody");e.forEach((i,o)=>{this.renderer.setAttribute(i,"id","table_body"+(1===e.length?"":"_"+o))});const h=this.el.nativeElement.querySelectorAll("#table_header_sort_row th");let c=0;for(let i=0;i<h.length;i++){const o=h[i],_=o.getAttribute("nzWidth")||o.style.minWidth;c+=_?parseInt(_,10):100}this.tableWidth=c+"px";const a=this.el.nativeElement.querySelector(".ant-table-thead tr:nth-child(2)");a&&this.renderer.setAttribute(a,"id","table_header_filter_row")})}sort(t){this.activeSort=t,this.filterData()}filter(t,s,d,p=0){null===t?delete this.filters[s]:this.filters[s]={type:d,value:"contains"===d?t.target.value:t.value||t,precision:p},this.filterData()}filterData(){let t;t=Object.keys(this.filters).length>0&&this.filters.constructor===Object?this._data.filter(s=>{let d=!0;return Object.keys(this.filters).forEach(p=>{let e=s[p];this.filters[p].precision&&"number"==typeof e&&(e=e.toFixed(this.filters[p].precision)),null==e&&(e="-"),("contains"===this.filters[p].type&&!String(e||"").toLocaleLowerCase().includes(this.filters[p].value.toLocaleLowerCase())||"equals"===this.filters[p].type&&e!==this.filters[p].value)&&(d=!1)}),!!d}):this._data,this.activeSort&&t.sort(this.sortData()),this.tableData=t}sortData(){return(t,s)=>{let d=t[this.activeSort.key],p=s[this.activeSort.key],e=null;if(null==d&&null!=p)e=1;else if(null!=d&&null==p)e=-1;else if(null==d&&null==p)e=0;else if("ip_address"===this.activeSort.key)e=Number(d.split(".").map(a=>`000${a}`.slice(-3)).join(""))-Number(p.split(".").map(a=>`000${a}`.slice(-3)).join(""));else if("phase_id"===this.activeSort.key){const h=[0,5,1,2,3,4];e=h.indexOf(d)<h.indexOf(p)?-1:h.indexOf(d)>h.indexOf(p)?1:0}else e="string"==typeof d&&"string"==typeof p?d.localeCompare(p):d<p?-1:d>p?1:0;return("ascend"===this.activeSort.value?1:-1)*e}}onItemSelected(t,s){t.selected=s,this.refreshSelectedStatus()}refreshSelectedStatus(){this.selected=this._data.every(s=>s.selected),this.indeterminate=this._data.some(s=>s.selected)&&!this.selected,this.updateSelected();let t=this.tableInitialHeight;(this.indeterminate||this.selected)&&(t-=60),this.tableHeight=t+"px"}onAllSelected(t){this._data.forEach(s=>s.selected=t),this.refreshSelectedStatus()}updateSelected(){this.nrOfSelected=this._data.filter(t=>t.selected).length}getIdentifier(t){return t}}return u.\u0275fac=function(t){return new(t||u)(r.Y36(r.SBq),r.Y36(r.Qsj))},u.\u0275cmp=r.Xpm({type:u,selectors:[["app-table"]],inputs:{initSort:"initSort",data:"data"},ngContentSelectors:n,decls:1,vars:0,template:function(t,s){1&t&&(r.F$t(),r.Hsn(0))},styles:[""]}),u})()},8397:(E,D,l)=>{"use strict";l.d(D,{z:()=>g});var r=l(5e3),n=l(1062);let g=(()=>{class u{constructor(t){this.translate=t}unloadNotification(t){this.appCanDeactivate()||(t.returnValue=!0)}}return u.\u0275fac=function(t){return new(t||u)(r.Y36(n.sK))},u.\u0275dir=r.lG2({type:u,selectors:[["","appCanDeactivate",""]],hostBindings:function(t,s){1&t&&r.NdJ("beforeunload",function(p){return s.unloadNotification(p)},!1,r.Jf7)},inputs:{appCanDeactivate:"appCanDeactivate"}}),u})()},97:(E,D,l)=>{"use strict";l.d(D,{p:()=>g});var r=l(5e3),n=l(520);let g=(()=>{class u{constructor(t){this.http=t}getCardCapacity(){return this.http.get("api/settings/card-capacity")}unmountCard(){return this.http.get("api/settings/unmount-card",{responseType:"text"})}restart(){return this.http.post("api/settings/reset",{},{responseType:"text"})}restore(){return this.http.post("api/settings/restore",{},{responseType:"text"})}restoreStatus(){return this.http.get("api/settings/restore/status")}shutdown(){return this.http.post("api/settings/shutdown",{},{responseType:"text"})}serverStatus(){return this.http.get("api/settings/serverStatus",{responseType:"text"})}}return u.\u0275fac=function(t){return new(t||u)(r.LFG(n.eN))},u.\u0275prov=r.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},6093:(E,D,l)=>{"use strict";l.d(D,{l:()=>c});var r=l(7579),n=l(930),g=l(8306),u=l(727),f=l(4707);const t={url:"",deserializer:a=>JSON.parse(a.data),serializer:a=>JSON.stringify(a)};class d extends r.u{constructor(i,o){if(super(),this._socket=null,i instanceof g.y)this.destination=o,this.source=i;else{const _=this._config=Object.assign({},t);if(this._output=new r.x,"string"==typeof i)_.url=i;else for(const S in i)i.hasOwnProperty(S)&&(_[S]=i[S]);if(!_.WebSocketCtor&&WebSocket)_.WebSocketCtor=WebSocket;else if(!_.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new f.t}}lift(i){const o=new d(this._config,this.destination);return o.operator=i,o.source=this,o}_resetState(){this._socket=null,this.source||(this.destination=new f.t),this._output=new r.x}multiplex(i,o,_){const S=this;return new g.y(b=>{try{S.next(i())}catch(m){b.error(m)}const v=S.subscribe(m=>{try{_(m)&&b.next(m)}catch(y){b.error(y)}},m=>b.error(m),()=>b.complete());return()=>{try{S.next(o())}catch(m){b.error(m)}v.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:i,protocol:o,url:_,binaryType:S}=this._config,b=this._output;let v=null;try{v=o?new i(_,o):new i(_),this._socket=v,S&&(this._socket.binaryType=S)}catch(y){return void b.error(y)}const m=new u.w0(()=>{this._socket=null,v&&1===v.readyState&&v.close()});v.onopen=y=>{const{_socket:w}=this;if(!w)return v.close(),void this._resetState();const{openObserver:k}=this._config;k&&k.next(y);const T=this.destination;this.destination=n.Lv.create(C=>{if(1===v.readyState)try{const{serializer:O}=this._config;v.send(O(C))}catch(O){this.destination.error(O)}},C=>{const{closingObserver:O}=this._config;O&&O.next(void 0),C&&C.code?v.close(C.code,C.reason):b.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:C}=this._config;C&&C.next(void 0),v.close(),this._resetState()}),T&&T instanceof f.t&&m.add(T.subscribe(this.destination))},v.onerror=y=>{this._resetState(),b.error(y)},v.onclose=y=>{this._resetState();const{closeObserver:w}=this._config;w&&w.next(y),y.wasClean?b.complete():b.error(y)},v.onmessage=y=>{try{const{deserializer:w}=this._config;b.next(w(y))}catch(w){b.error(w)}}}_subscribe(i){const{source:o}=this;return o?o.subscribe(i):(this._socket||this._connectSocket(),this._output.subscribe(i),i.add(()=>{const{_socket:_}=this;0===this._output.observers.length&&(_&&(1===_.readyState||0===_.readyState)&&_.close(),this._resetState())}),i)}unsubscribe(){const{_socket:i}=this;i&&(1===i.readyState||0===i.readyState)&&i.close(),this._resetState(),super.unsubscribe()}}var e=l(5e3),h=l(520);let c=(()=>{class a{constructor(o){this.http=o,this.socket$Observable=new r.x,this.tabVisible=!0,this.collectData={},this.isSocketConnected=!1,this.initializeWebSocket()}initializeWebSocket(o=!1){this.subject=function p(a){return new d(a)}("wss://"+window.location.host+"/websocket"),this.subject.subscribe(_=>{if(!_.connected)return this.tabVisible?this.socket$Observable.next(_):void 0;o?this.http.get("api/user",{responseType:"text"}).subscribe(()=>{this.isSocketConnected=!0}):this.isSocketConnected=!0},_=>{this.socket$Observable.next({disconnected:!0}),console.log(_),this.isSocketConnected=!1,this.subject.unsubscribe(),setTimeout(()=>{this.initializeWebSocket(!0),this.setCollectData(this.collectData),this.setCollectStatusesData(this.collectStatusesData)},1e4)})}destroyWebSocket(){this.subject&&this.subject.complete()}setCollectData(o={}){o.eventsCount=!0,o.alarmsCount=!0,this.subject.next(o),this.collectData=o}setCollectStatusesData(o=[]){this.subject.next({statuses:o}),this.collectStatusesData=o}addCollectStatusesData(o){this.collectStatusesData||(this.collectStatusesData=[]),this.collectStatusesData.includes(o)||this.collectStatusesData.push(o),this.subject.next({statuses:this.collectStatusesData})}removeCollectStatusesData(o){this.collectStatusesData=this.collectStatusesData.filter(_=>_!==o),this.subject.next({statuses:this.collectStatusesData})}addCollectData(o={}){o.events&&(this.collectData.events=!0),o.object_ids&&(this.collectData.object_ids=[...new Set([...this.collectData.object_ids||[],...o.object_ids])]),this.subject.next(this.collectData)}}return a.\u0275fac=function(o){return new(o||a)(e.LFG(h.eN))},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},7575:(E,D,l)=>{"use strict";l.d(D,{u:()=>u});var r=l(5e3),n=l(4521),g=l(9777);let u=(()=>{class f{constructor(s,d){this.router=s,this.appLoadService=d}canActivate(s,d){return!!this.appLoadService.user.noLock||(this.router.navigate(["/login"]),!1)}}return f.\u0275fac=function(s){return new(s||f)(r.LFG(n.F0),r.LFG(g.V))},f.\u0275prov=r.Yz7({token:f,factory:f.\u0275fac}),f})()},4327:function(E,D){var n;void 0!==(n=function(){"use strict";function u(e,h,c){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){p(a.response,h,c)},a.onerror=function(){console.error("could not download file")},a.send()}function f(e){var h=new XMLHttpRequest;h.open("HEAD",e,!1);try{h.send()}catch(c){}return 200<=h.status&&299>=h.status}function t(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(c){var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(h)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,d=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),p=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!d?function(e,h,c){var a=s.URL||s.webkitURL,i=document.createElement("a");i.download=h=h||e.name||"download",i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?t(i):f(i.href)?u(e,h,c):t(i,i.target="_blank")):(i.href=a.createObjectURL(e),setTimeout(function(){a.revokeObjectURL(i.href)},4e4),setTimeout(function(){t(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,h,c){if(h=h||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function g(e,h){return void 0===h?h={autoBom:!1}:"object"!=typeof h&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,c),h);else if(f(e))u(e,h,c);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout(function(){t(a)})}}:function(e,h,c,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return u(e,h,c);var i="application/octet-stream"===e.type,o=/constructor/i.test(s.HTMLElement)||s.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||i&&o||d)&&"undefined"!=typeof FileReader){var S=new FileReader;S.onloadend=function(){var m=S.result;m=_?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=m:location=m,a=null},S.readAsDataURL(e)}else{var b=s.URL||s.webkitURL,v=b.createObjectURL(e);a?a.location=v:location.href=v,a=null,setTimeout(function(){b.revokeObjectURL(v)},4e4)}});s.saveAs=p.saveAs=p,E.exports=p}.apply(D,[]))&&(E.exports=n)}}]);