"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[289],{8862:(se,Dt,q)=>{q.d(Dt,{t:()=>Ye});var z=q(7454),t=q(5e3),R=q(9808),pt=q(1656),B=q(1062);function at(L,zt){if(1&L&&(t._UZ(0,"div",3),t.ALo(1,"safeHtml")),2&L){const K=t.oxw();t.Udp("left",K.tooltipData?K.tooltipData.left:0,"px")("top",K.tooltipData?K.tooltipData.top:0,"px"),t.Q6J("innerHTML",K.tooltipData?t.lcZ(1,5,K.tooltipData.html):"",t.oJD)}}function Ct(L,zt){1&L&&(t.TgZ(0,"p",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&L&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_DATA_TO_DISPLAY")))}function ee(L,zt){1&L&&(t.O4$(),t._UZ(0,"svg"))}let Ye=(()=>{class L{constructor(K){this.el=K,this.cl="app-column-chart",this.isDrawn=!1,this.noData=!1,this.hideLegend=!0,this.margin={top:5,right:20,bottom:80,left:80},this.makeXAxisGrid=()=>z.Z.axisLeft(this.y).ticks(this.y.ticks().length).tickSize(-this.width).tickFormat(()=>"")}set chartData(K){if(K){if(this._chartData=K.filter(xt=>xt.visible||void 0===xt.visible),!this._chartData.length||!this._chartData.some(({value:xt})=>void 0!==xt))return void(this.noData=!0);this.noData=!1,this.isDrawn&&this.visibleNumber&&this.visibleNumber===this._chartData.length?this.svg&&this.redrawChart():setTimeout(()=>{this.drawChart()}),this.visibleNumber=this._chartData.length,this.isDrawn=!0}}min(K,xt){let D;if(void 0===xt)for(const lt of K)null!=lt&&(D>lt||void 0===D&&lt>=lt)&&(D=lt);else{let lt=-1;for(let mt of K)null!=(mt=xt(mt,++lt,K))&&(D>mt||void 0===D&&mt>=mt)&&(D=mt)}return D}max(K,xt){let D;if(void 0===xt)for(const lt of K)null!=lt&&(D<lt||void 0===D&&lt>=lt)&&(D=lt);else{let lt=-1;for(let mt of K)null!=(mt=xt(mt,++lt,K))&&(D<mt||void 0===D&&mt>=mt)&&(D=mt)}return D}drawChart(){this.isDashboard&&(this.margin={top:25,right:20,bottom:75,left:50}),this.svg=z.Z.selection.select(this.el.nativeElement).select("svg"),z.Z.selection.select(this.el.nativeElement).selectAll("svg > *").remove(),this.svg.selectAll(".chart-tooltip").remove(),this.width=parseInt(this.svg.style("width"),10)-this.margin.left-this.margin.right,this.height=parseInt(this.svg.style("height"),10)-this.margin.top-this.margin.bottom,this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),20*this._chartData.length>this.width&&(this.width=20*this._chartData.length,this.svg.style("width",this.width+50)),this.x=z.Z.scaleBand().range([0,(200*this._chartData.length>this.width?this.width:200*this._chartData.length)||0]).padding(.1),this.y=z.Z.scaleLinear().range([this.height||0,0]),this.x.domain(this._chartData.map((D,lt)=>lt+D.label));const K=this.min(this._chartData,D=>D.value)>0?0:this.min(this._chartData,D=>D.value),xt=this.max(this._chartData,D=>D.value)<0?0:this.max(this._chartData,D=>D.value);if(this.y.domain([K,xt]).nice(),this.xAxis=z.Z.axisBottom(this.x).tickFormat((D,lt)=>(D=D.slice(String(lt).length)).length<=10?D:D.substr(0,10)+"..."),this.chartContainer.append("g").attr("transform","translate(0,"+(this.height||0)+")").attr("class","grid-x-values").call(this.xAxis).selectAll("text").style("text-anchor","end").attr("font-size","12px").attr("transform","translate(-8,2) rotate(-45)"),this.chartContainer.append("g").attr("class","grid-y-values").call(z.Z.axisLeft(this.y)),this.chartContainer.append("g").attr("class","grid grid-y").call(this.makeXAxisGrid()),this.chartContainer.selectAll(".bar").data(this._chartData).enter().append("rect").attr("class","bar").attr("x",(D,lt)=>this.x(lt+D.label)||0).attr("width",this.x.bandwidth()||0).attr("y",this.y(0)).attr("height",0).attr("fill",D=>D.color?D.color:"#0088cc").interrupt().transition().duration(200).attr("y",D=>null!==D.value?this.y(D.value)<=this.y(0)?this.y(D.value):this.y(0):null).attr("height",D=>null!=D.value?Math.abs(this.height-this.y(0)>0?this.height-(this.height-this.y(0))-this.y(D.value):this.height-this.y(D.value)):null),this.isDashboard)this.chartContainer.selectAll(".text").data(this._chartData).enter().append("text").attr("class","text").attr("text-anchor","middle").attr("font-size","12px").attr("x",(D,lt)=>this.x(lt+D.label)+this.x.bandwidth()/2||0).attr("y",D=>Math.floor(this.y(D.value)-5||this.height-5)).text(D=>D.hasOwnProperty("unit")?(isNaN(D.value)||null===D.value?"-":D.value)+(D.unit?" ["+D.unit+"]":""):"");else{this.chartContainer.append("text").attr("class","axis-label axis-y").attr("id","chartYLabel").attr("text-anchor","middle").attr("transform","translate(-60,"+this.height/2+")rotate(-90)").text(this.labelY),z.Z.selection.select(".chart-tooltip").remove();const D=z.Z.selection.select(".chart-container").append("div").attr("class","chart-tooltip text-shadow").style("position","absolute").style("z-index","10").style("opacity","0");this.chartContainer.selectAll(".bar").on("mousemove",(lt,mt)=>{0!==mt.value&&(z.Z.selection.select(lt.currentTarget).style("fill-opacity",".6"),D.html(mt.unit||""===mt.unit?'<div class="value fs-14"><span class="label">'+mt.label+":</span>"+mt.value+" ["+mt.unit+"]</div>":'<div class="value fs-14"><span class="label">'+mt.label+":</span>"+lt.currentTarget.rescaleEnergyPipe.transform(mt.value)+" ["+lt.currentTarget.calculateUnitPipe.transform(mt.value)+"]</div>"),D.style("left",lt.layerX+10+"px").style("top",lt.layerY+10+"px"),D.style("opacity",.8))}),this.chartContainer.selectAll(".bar").on("mouseout",(lt,mt)=>{z.Z.selection.select(lt.currentTarget).style("fill-opacity","1"),D.style("opacity",0).on("end",function(){z.Z.selection.select(lt.currentTarget).html("")})}),this.chartContainer.selectAll(".grid-x-values .tick").append("svg:title").text((lt,mt)=>this.x.domain()[mt].slice(String(mt).length))}this.chartContainer.selectAll(".grid-x-values .tick").append("svg:title").text((D,lt)=>this.x.domain()[lt].slice(String(lt).length))}redrawChart(){const K=(z.Z.min(this._chartData,D=>D.value)||0)>0?0:z.Z.min(this._chartData,D=>D.value),xt=(z.Z.max(this._chartData,D=>D.value)||0)<0?0:z.Z.max(this._chartData,D=>D.value);this.y.domain([K,xt]).nice(),this.chartContainer.selectAll(".bar").data(this._chartData).interrupt().transition().duration(1e3).attr("y",D=>null!==D.value?this.y(D.value)<=this.y(0)?this.y(D.value):this.y(0):null).attr("height",D=>null!=D.value?Math.abs(this.height-this.y(0)>0?this.height-(this.height-this.y(0))-this.y(D.value):this.height-this.y(D.value)):null),this.isDashboard&&this.chartContainer.selectAll(".text").data(this._chartData).interrupt().transition().duration(1e3).attr("y",D=>Math.floor(this.y(D.value)-5||this.height-5)).text(D=>D.hasOwnProperty("unit")?(isNaN(D.value)||null===D.value?"-":D.value)+(D.unit?" ["+D.unit+"]":""):""),this.chartContainer.select(".grid-y").interrupt().transition().duration(1e3).call(this.makeXAxisGrid()),this.chartContainer.select(".grid-y-values").interrupt().transition().duration(1e3).call(z.Z.axisLeft(this.y))}}return L.\u0275fac=function(K){return new(K||L)(t.Y36(t.SBq))},L.\u0275cmp=t.Xpm({type:L,selectors:[["app-column-chart"]],hostVars:1,hostBindings:function(K,xt){2&K&&t.uIk("class",xt.cl)},inputs:{isDashboard:"isDashboard",labelY:"labelY",chartData:"chartData"},decls:3,vars:3,consts:[["class","chart-tooltip nowrap",3,"left","top","innerHTML",4,"ngIf"],["class","empty-text",4,"ngIf"],[4,"ngIf"],[1,"chart-tooltip","nowrap",3,"innerHTML"],[1,"empty-text"]],template:function(K,xt){1&K&&(t.YNc(0,at,2,7,"div",0),t.YNc(1,Ct,3,3,"p",1),t.YNc(2,ee,1,0,"svg",2)),2&K&&(t.Q6J("ngIf",xt.chartTooltip),t.xp6(1),t.Q6J("ngIf",xt.noData),t.xp6(1),t.Q6J("ngIf",!xt.noData))},directives:[R.O5],pipes:[pt.z,B.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),L})()},7454:(se,Dt,q)=>{q.d(Dt,{Z:()=>gh});var z={};q.r(z),q.d(z,{isoFormat:()=>cr,isoParse:()=>hr,timeFormat:()=>Ii,timeFormatDefaultLocale:()=>En,timeFormatLocale:()=>mn,timeParse:()=>Vn,utcFormat:()=>Di,utcParse:()=>Si});var t={};q.r(t),q.d(t,{create:()=>Tu,creator:()=>ai,local:()=>Wl,matcher:()=>l,namespace:()=>Ce,namespaces:()=>Fi,pointer:()=>Kt,pointers:()=>Cu,select:()=>Pt,selectAll:()=>Au,selection:()=>oi,selector:()=>si,selectorAll:()=>h,style:()=>ke,window:()=>vr});const R=Math.PI,pt=2*R,B=1e-6,at=pt-B;function Ct(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ee(){return new Ct}Ct.prototype=ee.prototype={constructor:Ct,moveTo:function(e,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+n)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,n){this._+="L"+(this._x1=+e)+","+(this._y1=+n)},quadraticCurveTo:function(e,n,o,r){this._+="Q"+ +e+","+ +n+","+(this._x1=+o)+","+(this._y1=+r)},bezierCurveTo:function(e,n,o,r,c,u){this._+="C"+ +e+","+ +n+","+ +o+","+ +r+","+(this._x1=+c)+","+(this._y1=+u)},arcTo:function(e,n,o,r,c){var u=this._x1,d=this._y1,_=(o=+o)-(e=+e),f=(r=+r)-(n=+n),g=u-e,m=d-n,x=g*g+m*m;if((c=+c)<0)throw new Error("negative radius: "+c);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=n);else if(x>B)if(Math.abs(m*_-f*g)>B&&c){var v=o-u,T=r-d,V=_*_+f*f,X=v*v+T*T,C=Math.sqrt(V),Z=Math.sqrt(x),W=c*Math.tan((R-Math.acos((V+x-X)/(2*C*Z)))/2),I=W/Z,E=W/C;Math.abs(I-1)>B&&(this._+="L"+(e+I*g)+","+(n+I*m)),this._+="A"+c+","+c+",0,0,"+ +(m*v>g*T)+","+(this._x1=e+E*_)+","+(this._y1=n+E*f)}else this._+="L"+(this._x1=e)+","+(this._y1=n)},arc:function(e,n,o,r,c,u){e=+e,n=+n,u=!!u;var d=(o=+o)*Math.cos(r),_=o*Math.sin(r),f=e+d,g=n+_,m=1^u,x=u?r-c:c-r;if(o<0)throw new Error("negative radius: "+o);null===this._x1?this._+="M"+f+","+g:(Math.abs(this._x1-f)>B||Math.abs(this._y1-g)>B)&&(this._+="L"+f+","+g),o&&(x<0&&(x=x%pt+pt),x>at?this._+="A"+o+","+o+",0,1,"+m+","+(e-d)+","+(n-_)+"A"+o+","+o+",0,1,"+m+","+(this._x1=f)+","+(this._y1=g):x>B&&(this._+="A"+o+","+o+",0,"+ +(x>=R)+","+m+","+(this._x1=e+o*Math.cos(c))+","+(this._y1=n+o*Math.sin(c))))},rect:function(e,n,o,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+n)+"h"+ +o+"v"+ +r+"h"+-o+"Z"},toString:function(){return this._}};const Ye=ee;function zt(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function K(e){return function(){return e}}function xt(e){this._context=e}function D(e){return new xt(e)}function lt(e){return e[0]}function mt(e){return e[1]}function qa(e,n){return n<e?-1:n>e?1:n>=e?0:NaN}function Ua(e){return e}xt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:this._context.lineTo(e,n)}}};const Bi=Math.abs,ft=Math.atan2,ie=Math.cos,ka=Math.max,F=Math.min,Qt=Math.sin,fe=Math.sqrt,Ot=1e-12,Ze=Math.PI,Pe=Ze/2,Qe=2*Ze;function La(e){return e>1?0:e<-1?Ze:Math.acos(e)}function Ki(e){return e>=1?Pe:e<=-1?-Pe:Math.asin(e)}function Pa(e){return e.innerRadius}function Qa(e){return e.outerRadius}function Ja(e){return e.startAngle}function Fa(e){return e.endAngle}function ja(e){return e&&e.padAngle}function Ra(e,n,o,r,c,u,d,_){var f=o-e,g=r-n,m=d-c,x=_-u,v=x*f-m*g;if(!(v*v<Ot))return[e+(v=(m*(n-u)-x*(e-c))/v)*f,n+v*g]}function Je(e,n,o,r,c,u,d){var _=e-o,f=n-r,g=(d?u:-u)/fe(_*_+f*f),m=g*f,x=-g*_,v=e+m,T=n+x,V=o+m,X=r+x,C=(v+V)/2,Z=(T+X)/2,W=V-v,I=X-T,E=W*W+I*I,k=c-u,O=v*X-V*T,tt=(I<0?-1:1)*fe(ka(0,k*k*E-O*O)),ot=(O*I-W*tt)/E,ut=(-O*W-I*tt)/E,nt=(O*I+W*tt)/E,Y=(-O*W+I*tt)/E,Q=ot-C,j=ut-Z,y=nt-C,U=Y-Z;return Q*Q+j*j>y*y+U*U&&(ot=nt,ut=Y),{cx:ot,cy:ut,x01:-m,y01:-x,x11:ot*(c/k-1),y11:ut*(c/k-1)}}function tn(e){return e<0?-1:1}function en(e,n,o){var r=e._x1-e._x0,c=n-e._x1,u=(e._y1-e._y0)/(r||c<0&&-0),d=(o-e._y1)/(c||r<0&&-0),_=(u*c+d*r)/(r+c);return(tn(u)+tn(d))*Math.min(Math.abs(u),Math.abs(d),.5*Math.abs(_))||0}function nn(e,n){var o=e._x1-e._x0;return o?(3*(e._y1-e._y0)/o-n)/2:n}function Vt(e,n,o){var r=e._x0,u=e._x1,d=e._y1,_=(u-r)/3;e._context.bezierCurveTo(r+_,e._y0+_*n,u-_,d-_*o,u,d)}function St(e){this._context=e}function an(e){this._context=e}function oe(e,n){return null==e||null==n?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Jt(e){let n=e,o=e,r=e;function c(_,f,g=0,m=_.length){if(g<m){if(0!==o(f,f))return m;do{const x=g+m>>>1;r(_[x],f)<0?g=x+1:m=x}while(g<m)}return g}return 2!==e.length&&(n=(_,f)=>e(_)-f,o=oe,r=(_,f)=>oe(e(_),f)),{left:c,center:function d(_,f,g=0,m=_.length){const x=c(_,f,g,m-1);return x>g&&n(_[x-1],f)>-n(_[x],f)?x-1:x},right:function u(_,f,g=0,m=_.length){if(g<m){if(0!==o(f,f))return m;do{const x=g+m>>>1;r(_[x],f)<=0?g=x+1:m=x}while(g<m)}return g}}}St.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Vt(this,this._t0,nn(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var o=NaN;if(n=+n,(e=+e)!==this._x1||n!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,Vt(this,nn(this,o=en(this,e,n)),o);break;default:Vt(this,this._t0,o=en(this,e,n))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=o}}},(function $(e){this._context=new an(e)}.prototype=Object.create(St.prototype)).point=function(e,n){St.prototype.point.call(this,n,e)},an.prototype={moveTo:function(e,n){this._context.moveTo(n,e)},closePath:function(){this._context.closePath()},lineTo:function(e,n){this._context.lineTo(n,e)},bezierCurveTo:function(e,n,o,r,c,u){this._context.bezierCurveTo(n,e,r,o,u,c)}};var Lt=Math.sqrt(50),di=Math.sqrt(10),hi=Math.sqrt(2);function sn(e,n,o){var r=(n-e)/Math.max(0,o),c=Math.floor(Math.log(r)/Math.LN10),u=r/Math.pow(10,c);return c>=0?(u>=Lt?10:u>=di?5:u>=hi?2:1)*Math.pow(10,c):-Math.pow(10,-c)/(u>=Lt?10:u>=di?5:u>=hi?2:1)}function _i(e,n,o){var r=Math.abs(n-e)/Math.max(0,o),c=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),u=r/c;return u>=Lt?c*=10:u>=di?c*=5:u>=hi&&(c*=2),n<e?-c:c}const $t=1e3,Yt=6e4,Xt=60*Yt,re=24*Xt,pi=7*re,on=30*re,fi=365*re;var gi=new Date,mi=new Date;function At(e,n,o,r){function c(u){return e(u=0===arguments.length?new Date:new Date(+u)),u}return c.floor=function(u){return e(u=new Date(+u)),u},c.ceil=function(u){return e(u=new Date(u-1)),n(u,1),e(u),u},c.round=function(u){var d=c(u),_=c.ceil(u);return u-d<_-u?d:_},c.offset=function(u,d){return n(u=new Date(+u),null==d?1:Math.floor(d)),u},c.range=function(u,d,_){var g,f=[];if(u=c.ceil(u),_=null==_?1:Math.floor(_),!(u<d&&_>0))return f;do{f.push(g=new Date(+u)),n(u,_),e(u)}while(g<u&&u<d);return f},c.filter=function(u){return At(function(d){if(d>=d)for(;e(d),!u(d);)d.setTime(d-1)},function(d,_){if(d>=d)if(_<0)for(;++_<=0;)for(;n(d,-1),!u(d););else for(;--_>=0;)for(;n(d,1),!u(d););})},o&&(c.count=function(u,d){return gi.setTime(+u),mi.setTime(+d),e(gi),e(mi),Math.floor(o(gi,mi))},c.every=function(u){return u=Math.floor(u),isFinite(u)&&u>0?u>1?c.filter(r?function(d){return r(d)%u==0}:function(d){return c.count(0,d)%u==0}):c:null}),c}var Fe=At(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});Fe.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?At(function(n){n.setTime(Math.floor(n/e)*e)},function(n,o){n.setTime(+n+o*e)},function(n,o){return(o-n)/e}):Fe:null};const $a=Fe;const ge=At(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*$t)},function(e,n){return(n-e)/$t},function(e){return e.getUTCSeconds()});const vi=At(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*$t)},function(e,n){e.setTime(+e+n*Yt)},function(e,n){return(n-e)/Yt},function(e){return e.getMinutes()});const xi=At(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*$t-e.getMinutes()*Yt)},function(e,n){e.setTime(+e+n*Xt)},function(e,n){return(n-e)/Xt},function(e){return e.getHours()});const Me=At(e=>e.setHours(0,0,0,0),(e,n)=>e.setDate(e.getDate()+n),(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Yt)/re,e=>e.getDate()-1);function le(e){return At(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,o){n.setDate(n.getDate()+7*o)},function(n,o){return(o-n-(o.getTimezoneOffset()-n.getTimezoneOffset())*Yt)/pi})}var Ie=le(0),je=le(1),me=(le(2),le(3),le(4));const bi=(le(5),le(6),At(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+12*(n.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}));var yi=At(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});yi.every=function(e){return isFinite(e=Math.floor(e))&&e>0?At(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,o){n.setFullYear(n.getFullYear()+o*e)}):null};const ne=yi;const es=At(function(e){e.setUTCSeconds(0,0)},function(e,n){e.setTime(+e+n*Yt)},function(e,n){return(n-e)/Yt},function(e){return e.getUTCMinutes()});const is=At(function(e){e.setUTCMinutes(0,0,0)},function(e,n){e.setTime(+e+n*Xt)},function(e,n){return(n-e)/Xt},function(e){return e.getUTCHours()});const Ti=At(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/re},function(e){return e.getUTCDate()-1});function ce(e){return At(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,o){n.setUTCDate(n.getUTCDate()+7*o)},function(n,o){return(o-n)/pi})}var wi=ce(0),Re=ce(1),ve=(ce(2),ce(3),ce(4));const rs=(ce(5),ce(6),At(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCMonth(e.getUTCMonth()+n)},function(e,n){return n.getUTCMonth()-e.getUTCMonth()+12*(n.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}));var Ci=At(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Ci.every=function(e){return isFinite(e=Math.floor(e))&&e>0?At(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,o){n.setUTCFullYear(n.getUTCFullYear()+o*e)}):null};const xe=Ci;function gn(e,n,o,r,c,u){const d=[[ge,1,$t],[ge,5,5e3],[ge,15,15e3],[ge,30,3e4],[u,1,Yt],[u,5,5*Yt],[u,15,15*Yt],[u,30,30*Yt],[c,1,Xt],[c,3,3*Xt],[c,6,6*Xt],[c,12,12*Xt],[r,1,re],[r,2,2*re],[o,1,pi],[n,1,on],[n,3,3*on],[e,1,fi]];function f(g,m,x){const v=Math.abs(m-g)/x,T=Jt(([,,C])=>C).right(d,v);if(T===d.length)return e.every(_i(g/fi,m/fi,x));if(0===T)return $a.every(Math.max(_i(g,m,x),1));const[V,X]=d[v/d[T-1][2]<d[T][2]/v?T-1:T];return V.every(X)}return[function _(g,m,x){const v=m<g;v&&([g,m]=[m,g]);const T=x&&"function"==typeof x.range?x:f(g,m,x),V=T?T.range(g,+m+1):[];return v?V.reverse():V},f]}const[hl,_l]=gn(xe,rs,wi,Ti,is,es),[ls,cs]=gn(ne,bi,Ie,Me,xi,vi);function Ai(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Zi(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function De(e,n,o){return{y:e,m:n,d:o,H:0,M:0,S:0,L:0}}function mn(e){var n=e.dateTime,o=e.date,r=e.time,c=e.periods,u=e.days,d=e.shortDays,_=e.months,f=e.shortMonths,g=Se(c),m=Oe(c),x=Se(u),v=Oe(u),T=Se(d),V=Oe(d),X=Se(_),C=Oe(_),Z=Se(f),W=Oe(f),I={a:function N(P){return d[P.getDay()]},A:function G(P){return u[P.getDay()]},b:function J(P){return f[P.getMonth()]},B:function H(P){return _[P.getMonth()]},c:null,d:wn,e:wn,f:Ws,g:Qs,G:Fs,H:Ds,I:Ss,j:Os,L:Cn,m:Ns,M:Vs,p:function et(P){return c[+(P.getHours()>=12)]},q:function st(P){return 1+~~(P.getMonth()/3)},Q:Wn,s:Nn,S:Es,u:qs,U:Us,V:ks,w:Ls,W:Ys,x:null,X:null,y:Ps,Y:Js,Z:js,"%":On},E={a:function Mt(P){return d[P.getUTCDay()]},A:function _t(P){return u[P.getUTCDay()]},b:function bt(P){return f[P.getUTCMonth()]},B:function It(P){return _[P.getUTCMonth()]},c:null,d:Zn,e:Zn,f:Hs,g:eo,G:no,H:Rs,I:zs,j:Gs,L:Mn,m:Mi,M:In,p:function gt(P){return c[+(P.getUTCHours()>=12)]},q:function wt(P){return 1+~~(P.getUTCMonth()/3)},Q:Wn,s:Nn,S:Dn,u:$s,U:Xs,V:Bs,w:ze,W:Ks,x:null,X:null,y:to,Y:io,Z:ao,"%":On},k={a:function nt(P,rt,dt){var S=T.exec(rt.slice(dt));return S?(P.w=V.get(S[0].toLowerCase()),dt+S[0].length):-1},A:function Y(P,rt,dt){var S=x.exec(rt.slice(dt));return S?(P.w=v.get(S[0].toLowerCase()),dt+S[0].length):-1},b:function Q(P,rt,dt){var S=Z.exec(rt.slice(dt));return S?(P.m=W.get(S[0].toLowerCase()),dt+S[0].length):-1},B:function j(P,rt,dt){var S=X.exec(rt.slice(dt));return S?(P.m=C.get(S[0].toLowerCase()),dt+S[0].length):-1},c:function y(P,rt,dt){return ot(P,n,rt,dt)},d:yn,e:yn,f:As,g:bn,G:xn,H:Tn,I:Tn,j:ys,L:Cs,m:bs,M:Ts,p:function ut(P,rt,dt){var S=g.exec(rt.slice(dt));return S?(P.p=m.get(S[0].toLowerCase()),dt+S[0].length):-1},q:xs,Q:Ms,s:Is,S:ws,u:ps,U:fs,V:gs,w:_s,W:ms,x:function U(P,rt,dt){return ot(P,o,rt,dt)},X:function M(P,rt,dt){return ot(P,r,rt,dt)},y:bn,Y:xn,Z:vs,"%":Zs};function O(P,rt){return function(dt){var kt,it,Tt,S=[],yt=-1,vt=0,Ut=P.length;for(dt instanceof Date||(dt=new Date(+dt));++yt<Ut;)37===P.charCodeAt(yt)&&(S.push(P.slice(vt,yt)),null!=(it=vn[kt=P.charAt(++yt)])?kt=P.charAt(++yt):it="e"===kt?" ":"0",(Tt=rt[kt])&&(kt=Tt(dt,it)),S.push(kt),vt=yt+1);return S.push(P.slice(vt,yt)),S.join("")}}function tt(P,rt){return function(dt){var vt,Ut,S=De(1900,void 0,1);if(ot(S,P,dt+="",0)!=dt.length)return null;if("Q"in S)return new Date(S.Q);if("s"in S)return new Date(1e3*S.s+("L"in S?S.L:0));if(rt&&!("Z"in S)&&(S.Z=0),"p"in S&&(S.H=S.H%12+12*S.p),void 0===S.m&&(S.m="q"in S?S.q:0),"V"in S){if(S.V<1||S.V>53)return null;"w"in S||(S.w=1),"Z"in S?(Ut=(vt=Zi(De(S.y,0,1))).getUTCDay(),vt=Ut>4||0===Ut?Re.ceil(vt):Re(vt),vt=Ti.offset(vt,7*(S.V-1)),S.y=vt.getUTCFullYear(),S.m=vt.getUTCMonth(),S.d=vt.getUTCDate()+(S.w+6)%7):(Ut=(vt=Ai(De(S.y,0,1))).getDay(),vt=Ut>4||0===Ut?je.ceil(vt):je(vt),vt=Me.offset(vt,7*(S.V-1)),S.y=vt.getFullYear(),S.m=vt.getMonth(),S.d=vt.getDate()+(S.w+6)%7)}else("W"in S||"U"in S)&&("w"in S||(S.w="u"in S?S.u%7:"W"in S?1:0),Ut="Z"in S?Zi(De(S.y,0,1)).getUTCDay():Ai(De(S.y,0,1)).getDay(),S.m=0,S.d="W"in S?(S.w+6)%7+7*S.W-(Ut+5)%7:S.w+7*S.U-(Ut+6)%7);return"Z"in S?(S.H+=S.Z/100|0,S.M+=S.Z%100,Zi(S)):Ai(S)}}function ot(P,rt,dt,S){for(var kt,it,yt=0,vt=rt.length,Ut=dt.length;yt<vt;){if(S>=Ut)return-1;if(37===(kt=rt.charCodeAt(yt++))){if(kt=rt.charAt(yt++),!(it=k[kt in vn?rt.charAt(yt++):kt])||(S=it(P,dt,S))<0)return-1}else if(kt!=dt.charCodeAt(S++))return-1}return S}return I.x=O(o,I),I.X=O(r,I),I.c=O(n,I),E.x=O(o,E),E.X=O(r,E),E.c=O(n,E),{format:function(P){var rt=O(P+="",I);return rt.toString=function(){return P},rt},parse:function(P){var rt=tt(P+="",!1);return rt.toString=function(){return P},rt},utcFormat:function(P){var rt=O(P+="",E);return rt.toString=function(){return P},rt},utcParse:function(P){var rt=tt(P+="",!0);return rt.toString=function(){return P},rt}}}var be,Ii,Vn,Di,Si,vn={"-":"",_:" ",0:"0"},Zt=/^\s*\d+/,us=/^%/,ds=/[\\^$*+?|[\]().{}]/g;function ht(e,n,o){var r=e<0?"-":"",c=(r?-e:e)+"",u=c.length;return r+(u<o?new Array(o-u+1).join(n)+c:c)}function hs(e){return e.replace(ds,"\\$&")}function Se(e){return new RegExp("^(?:"+e.map(hs).join("|")+")","i")}function Oe(e){return new Map(e.map((n,o)=>[n.toLowerCase(),o]))}function _s(e,n,o){var r=Zt.exec(n.slice(o,o+1));return r?(e.w=+r[0],o+r[0].length):-1}function ps(e,n,o){var r=Zt.exec(n.slice(o,o+1));return r?(e.u=+r[0],o+r[0].length):-1}function fs(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.U=+r[0],o+r[0].length):-1}function gs(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.V=+r[0],o+r[0].length):-1}function ms(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.W=+r[0],o+r[0].length):-1}function xn(e,n,o){var r=Zt.exec(n.slice(o,o+4));return r?(e.y=+r[0],o+r[0].length):-1}function bn(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),o+r[0].length):-1}function vs(e,n,o){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(o,o+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),o+r[0].length):-1}function xs(e,n,o){var r=Zt.exec(n.slice(o,o+1));return r?(e.q=3*r[0]-3,o+r[0].length):-1}function bs(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.m=r[0]-1,o+r[0].length):-1}function yn(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.d=+r[0],o+r[0].length):-1}function ys(e,n,o){var r=Zt.exec(n.slice(o,o+3));return r?(e.m=0,e.d=+r[0],o+r[0].length):-1}function Tn(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.H=+r[0],o+r[0].length):-1}function Ts(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.M=+r[0],o+r[0].length):-1}function ws(e,n,o){var r=Zt.exec(n.slice(o,o+2));return r?(e.S=+r[0],o+r[0].length):-1}function Cs(e,n,o){var r=Zt.exec(n.slice(o,o+3));return r?(e.L=+r[0],o+r[0].length):-1}function As(e,n,o){var r=Zt.exec(n.slice(o,o+6));return r?(e.L=Math.floor(r[0]/1e3),o+r[0].length):-1}function Zs(e,n,o){var r=us.exec(n.slice(o,o+1));return r?o+r[0].length:-1}function Ms(e,n,o){var r=Zt.exec(n.slice(o));return r?(e.Q=+r[0],o+r[0].length):-1}function Is(e,n,o){var r=Zt.exec(n.slice(o));return r?(e.s=+r[0],o+r[0].length):-1}function wn(e,n){return ht(e.getDate(),n,2)}function Ds(e,n){return ht(e.getHours(),n,2)}function Ss(e,n){return ht(e.getHours()%12||12,n,2)}function Os(e,n){return ht(1+Me.count(ne(e),e),n,3)}function Cn(e,n){return ht(e.getMilliseconds(),n,3)}function Ws(e,n){return Cn(e,n)+"000"}function Ns(e,n){return ht(e.getMonth()+1,n,2)}function Vs(e,n){return ht(e.getMinutes(),n,2)}function Es(e,n){return ht(e.getSeconds(),n,2)}function qs(e){var n=e.getDay();return 0===n?7:n}function Us(e,n){return ht(Ie.count(ne(e)-1,e),n,2)}function An(e){var n=e.getDay();return n>=4||0===n?me(e):me.ceil(e)}function ks(e,n){return e=An(e),ht(me.count(ne(e),e)+(4===ne(e).getDay()),n,2)}function Ls(e){return e.getDay()}function Ys(e,n){return ht(je.count(ne(e)-1,e),n,2)}function Ps(e,n){return ht(e.getFullYear()%100,n,2)}function Qs(e,n){return ht((e=An(e)).getFullYear()%100,n,2)}function Js(e,n){return ht(e.getFullYear()%1e4,n,4)}function Fs(e,n){var o=e.getDay();return ht((e=o>=4||0===o?me(e):me.ceil(e)).getFullYear()%1e4,n,4)}function js(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+ht(n/60|0,"0",2)+ht(n%60,"0",2)}function Zn(e,n){return ht(e.getUTCDate(),n,2)}function Rs(e,n){return ht(e.getUTCHours(),n,2)}function zs(e,n){return ht(e.getUTCHours()%12||12,n,2)}function Gs(e,n){return ht(1+Ti.count(xe(e),e),n,3)}function Mn(e,n){return ht(e.getUTCMilliseconds(),n,3)}function Hs(e,n){return Mn(e,n)+"000"}function Mi(e,n){return ht(e.getUTCMonth()+1,n,2)}function In(e,n){return ht(e.getUTCMinutes(),n,2)}function Dn(e,n){return ht(e.getUTCSeconds(),n,2)}function $s(e){var n=e.getUTCDay();return 0===n?7:n}function Xs(e,n){return ht(wi.count(xe(e)-1,e),n,2)}function Sn(e){var n=e.getUTCDay();return n>=4||0===n?ve(e):ve.ceil(e)}function Bs(e,n){return e=Sn(e),ht(ve.count(xe(e),e)+(4===xe(e).getUTCDay()),n,2)}function ze(e){return e.getUTCDay()}function Ks(e,n){return ht(Re.count(xe(e)-1,e),n,2)}function to(e,n){return ht(e.getUTCFullYear()%100,n,2)}function eo(e,n){return ht((e=Sn(e)).getUTCFullYear()%100,n,2)}function io(e,n){return ht(e.getUTCFullYear()%1e4,n,4)}function no(e,n){var o=e.getUTCDay();return ht((e=o>=4||0===o?ve(e):ve.ceil(e)).getUTCFullYear()%1e4,n,4)}function ao(){return"+0000"}function On(){return"%"}function Wn(e){return+e}function Nn(e){return Math.floor(+e/1e3)}function En(e){return be=mn(e),Ii=be.format,Vn=be.parse,Di=be.utcFormat,Si=be.utcParse,be}En({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const oo=Jt(oe).right,ro=(Jt(function so(e){return null===e?NaN:+e}),oo);function Oi(e,n,o){e.prototype=n.prototype=o,o.constructor=e}function Un(e,n){var o=Object.create(e.prototype);for(var r in n)o[r]=n[r];return o}function We(){}var Ge=1/.7,ye="\\s*([+-]?\\d+)\\s*",Ve="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lo=/^#([0-9a-f]{3,8})$/,co=new RegExp("^rgb\\("+[ye,ye,ye]+"\\)$"),uo=new RegExp("^rgb\\("+[Gt,Gt,Gt]+"\\)$"),ho=new RegExp("^rgba\\("+[ye,ye,ye,Ve]+"\\)$"),_o=new RegExp("^rgba\\("+[Gt,Gt,Gt,Ve]+"\\)$"),po=new RegExp("^hsl\\("+[Ve,Gt,Gt]+"\\)$"),fo=new RegExp("^hsla\\("+[Ve,Gt,Gt,Ve]+"\\)$"),kn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ln(){return this.rgb().formatHex()}function Yn(){return this.rgb().formatRgb()}function ue(e){var n,o;return e=(e+"").trim().toLowerCase(),(n=lo.exec(e))?(o=n[1].length,n=parseInt(n[1],16),6===o?Pn(n):3===o?new Et(n>>8&15|n>>4&240,n>>4&15|240&n,(15&n)<<4|15&n,1):8===o?He(n>>24&255,n>>16&255,n>>8&255,(255&n)/255):4===o?He(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|240&n,((15&n)<<4|15&n)/255):null):(n=co.exec(e))?new Et(n[1],n[2],n[3],1):(n=uo.exec(e))?new Et(255*n[1]/100,255*n[2]/100,255*n[3]/100,1):(n=ho.exec(e))?He(n[1],n[2],n[3],n[4]):(n=_o.exec(e))?He(255*n[1]/100,255*n[2]/100,255*n[3]/100,n[4]):(n=po.exec(e))?Fn(n[1],n[2]/100,n[3]/100,1):(n=fo.exec(e))?Fn(n[1],n[2]/100,n[3]/100,n[4]):kn.hasOwnProperty(e)?Pn(kn[e]):"transparent"===e?new Et(NaN,NaN,NaN,0):null}function Pn(e){return new Et(e>>16&255,e>>8&255,255&e,1)}function He(e,n,o,r){return r<=0&&(e=n=o=NaN),new Et(e,n,o,r)}function mo(e){return e instanceof We||(e=ue(e)),e?new Et((e=e.rgb()).r,e.g,e.b,e.opacity):new Et}function $e(e,n,o,r){return 1===arguments.length?mo(e):new Et(e,n,o,null==r?1:r)}function Et(e,n,o,r){this.r=+e,this.g=+n,this.b=+o,this.opacity=+r}function Qn(){return"#"+Wi(this.r)+Wi(this.g)+Wi(this.b)}function Jn(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Wi(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Fn(e,n,o,r){return r<=0?e=n=o=NaN:o<=0||o>=1?e=n=NaN:n<=0&&(e=NaN),new Ht(e,n,o,r)}function jn(e){if(e instanceof Ht)return new Ht(e.h,e.s,e.l,e.opacity);if(e instanceof We||(e=ue(e)),!e)return new Ht;if(e instanceof Ht)return e;var n=(e=e.rgb()).r/255,o=e.g/255,r=e.b/255,c=Math.min(n,o,r),u=Math.max(n,o,r),d=NaN,_=u-c,f=(u+c)/2;return _?(d=n===u?(o-r)/_+6*(o<r):o===u?(r-n)/_+2:(n-o)/_+4,_/=f<.5?u+c:2-u-c,d*=60):_=f>0&&f<1?0:d,new Ht(d,_,f,e.opacity)}function Ht(e,n,o,r){this.h=+e,this.s=+n,this.l=+o,this.opacity=+r}function Ni(e,n,o){return 255*(e<60?n+(o-n)*e/60:e<180?o:e<240?n+(o-n)*(240-e)/60:n)}function Rn(e,n,o,r,c){var u=e*e,d=u*e;return((1-3*e+3*u-d)*n+(4-6*u+3*d)*o+(1+3*e+3*u-3*d)*r+d*c)/6}Oi(We,ue,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Ln,formatHex:Ln,formatHsl:function go(){return jn(this).formatHsl()},formatRgb:Yn,toString:Yn}),Oi(Et,$e,Un(We,{brighter:function(e){return e=null==e?Ge:Math.pow(Ge,e),new Et(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Et(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Qn,formatHex:Qn,formatRgb:Jn,toString:Jn})),Oi(Ht,function vo(e,n,o,r){return 1===arguments.length?jn(e):new Ht(e,n,o,null==r?1:r)},Un(We,{brighter:function(e){return e=null==e?Ge:Math.pow(Ge,e),new Ht(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Ht(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),n=isNaN(e)||isNaN(this.s)?0:this.s,o=this.l,r=o+(o<.5?o:1-o)*n,c=2*o-r;return new Et(Ni(e>=240?e-240:e+120,c,r),Ni(e,c,r),Ni(e<120?e+240:e-120,c,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Vi=e=>()=>e;function Gn(e,n){var o=n-e;return o?function zn(e,n){return function(o){return e+o*n}}(e,o):Vi(isNaN(e)?n:e)}const Xe=function e(n){var o=function To(e){return 1==(e=+e)?Gn:function(n,o){return o-n?function yo(e,n,o){return e=Math.pow(e,o),n=Math.pow(n,o)-e,o=1/o,function(r){return Math.pow(e+r*n,o)}}(n,o,e):Vi(isNaN(n)?o:n)}}(n);function r(c,u){var d=o((c=$e(c)).r,(u=$e(u)).r),_=o(c.g,u.g),f=o(c.b,u.b),g=Gn(c.opacity,u.opacity);return function(m){return c.r=d(m),c.g=_(m),c.b=f(m),c.opacity=g(m),c+""}}return r.gamma=e,r}(1);function Hn(e){return function(n){var d,_,o=n.length,r=new Array(o),c=new Array(o),u=new Array(o);for(d=0;d<o;++d)_=$e(n[d]),r[d]=_.r||0,c[d]=_.g||0,u[d]=_.b||0;return r=e(r),c=e(c),u=e(u),_.opacity=1,function(f){return _.r=r(f),_.g=c(f),_.b=u(f),_+""}}}function $n(e,n){var d,o=n?n.length:0,r=e?Math.min(o,e.length):0,c=new Array(r),u=new Array(o);for(d=0;d<r;++d)c[d]=Ee(e[d],n[d]);for(;d<o;++d)u[d]=n[d];return function(_){for(d=0;d<r;++d)u[d]=c[d](_);return u}}function wo(e,n){var o=new Date;return e=+e,n=+n,function(r){return o.setTime(e*(1-r)+n*r),o}}function Ft(e,n){return e=+e,n=+n,function(o){return e*(1-o)+n*o}}function Co(e,n){var c,o={},r={};for(c in(null===e||"object"!=typeof e)&&(e={}),(null===n||"object"!=typeof n)&&(n={}),n)c in e?o[c]=Ee(e[c],n[c]):r[c]=n[c];return function(u){for(c in o)r[c]=o[c](u);return r}}Hn(function xo(e){var n=e.length-1;return function(o){var r=o<=0?o=0:o>=1?(o=1,n-1):Math.floor(o*n),c=e[r],u=e[r+1];return Rn((o-r/n)*n,r>0?e[r-1]:2*c-u,c,u,r<n-1?e[r+2]:2*u-c)}}),Hn(function bo(e){var n=e.length;return function(o){var r=Math.floor(((o%=1)<0?++o:o)*n);return Rn((o-r/n)*n,e[(r+n-1)%n],e[r%n],e[(r+1)%n],e[(r+2)%n])}});var Ei=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,qi=new RegExp(Ei.source,"g");function Xn(e,n){var r,c,u,o=Ei.lastIndex=qi.lastIndex=0,d=-1,_=[],f=[];for(e+="",n+="";(r=Ei.exec(e))&&(c=qi.exec(n));)(u=c.index)>o&&(u=n.slice(o,u),_[d]?_[d]+=u:_[++d]=u),(r=r[0])===(c=c[0])?_[d]?_[d]+=c:_[++d]=c:(_[++d]=null,f.push({i:d,x:Ft(r,c)})),o=qi.lastIndex;return o<n.length&&(u=n.slice(o),_[d]?_[d]+=u:_[++d]=u),_.length<2?f[0]?function Zo(e){return function(n){return e(n)+""}}(f[0].x):function Ao(e){return function(){return e}}(n):(n=f.length,function(g){for(var x,m=0;m<n;++m)_[(x=f[m]).i]=x.x(g);return _.join("")})}function Mo(e,n){n||(n=[]);var c,o=e?Math.min(n.length,e.length):0,r=n.slice();return function(u){for(c=0;c<o;++c)r[c]=e[c]*(1-u)+n[c]*u;return r}}function Ee(e,n){var r,o=typeof n;return null==n||"boolean"===o?Vi(n):("number"===o?Ft:"string"===o?(r=ue(n))?(n=r,Xe):Xn:n instanceof ue?Xe:n instanceof Date?wo:function Io(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(n)?Mo:Array.isArray(n)?$n:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?Co:Ft)(e,n)}function Do(e,n){return e=+e,n=+n,function(o){return Math.round(e*(1-o)+n*o)}}function Oo(e){return+e}var Bn=[0,1];function Te(e){return e}function Ui(e,n){return(n-=e=+e)?function(o){return(o-e)/n}:function So(e){return function(){return e}}(isNaN(n)?NaN:.5)}function No(e,n,o){var r=e[0],c=e[1],u=n[0],d=n[1];return c<r?(r=Ui(c,r),u=o(d,u)):(r=Ui(r,c),u=o(u,d)),function(_){return u(r(_))}}function Vo(e,n,o){var r=Math.min(e.length,n.length)-1,c=new Array(r),u=new Array(r),d=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++d<r;)c[d]=Ui(e[d],e[d+1]),u[d]=o(n[d],n[d+1]);return function(_){var f=ro(e,_,1,r)-1;return u[f](c[f](_))}}function Kn(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ta(){return function Eo(){var r,c,u,_,f,g,e=Bn,n=Bn,o=Ee,d=Te;function m(){var v=Math.min(e.length,n.length);return d!==Te&&(d=function Wo(e,n){var o;return e>n&&(o=e,e=n,n=o),function(r){return Math.max(e,Math.min(n,r))}}(e[0],e[v-1])),_=v>2?Vo:No,f=g=null,x}function x(v){return null==v||isNaN(v=+v)?u:(f||(f=_(e.map(r),n,o)))(r(d(v)))}return x.invert=function(v){return d(c((g||(g=_(n,e.map(r),Ft)))(v)))},x.domain=function(v){return arguments.length?(e=Array.from(v,Oo),m()):e.slice()},x.range=function(v){return arguments.length?(n=Array.from(v),m()):n.slice()},x.rangeRound=function(v){return n=Array.from(v),o=Do,m()},x.clamp=function(v){return arguments.length?(d=!!v||Te,m()):d!==Te},x.interpolate=function(v){return arguments.length?(o=v,m()):o},x.unknown=function(v){return arguments.length?(u=v,x):u},function(v,T){return r=v,c=T,m()}}()(Te,Te)}function Be(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e)}return this}function Uo(e){return new Date(e)}function ko(e){return e instanceof Date?+e:+new Date(+e)}function ea(e,n,o,r,c,u,d,_,f,g){var m=ta(),x=m.invert,v=m.domain,T=g(".%L"),V=g(":%S"),X=g("%I:%M"),C=g("%I %p"),Z=g("%a %d"),W=g("%b %d"),I=g("%B"),E=g("%Y");function k(O){return(f(O)<O?T:_(O)<O?V:d(O)<O?X:u(O)<O?C:r(O)<O?c(O)<O?Z:W:o(O)<O?I:E)(O)}return m.invert=function(O){return new Date(x(O))},m.domain=function(O){return arguments.length?v(Array.from(O,ko)):v().map(Uo)},m.ticks=function(O){var tt=v();return e(tt[0],tt[tt.length-1],null==O?10:O)},m.tickFormat=function(O,tt){return null==tt?k:g(tt)},m.nice=function(O){var tt=v();return(!O||"function"!=typeof O.range)&&(O=n(tt[0],tt[tt.length-1],null==O?10:O)),O?v(function qo(e,n){var d,o=0,r=(e=e.slice()).length-1,c=e[o],u=e[r];return u<c&&(d=o,o=r,r=d,d=c,c=u,u=d),e[o]=n.floor(c),e[r]=n.ceil(u),e}(tt,O)):m},m.copy=function(){return Kn(m,ea(e,n,o,r,c,u,d,_,f,g))},m}var ia,Yo=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ke(e){if(!(n=Yo.exec(e)))throw new Error("invalid format: "+e);var n;return new ki({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}function ki(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function jt(e,n){if((o=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var o,r=e.slice(0,o);return[r.length>1?r[0]+r.slice(2):r,+e.slice(o+1)]}function we(e){return(e=jt(Math.abs(e)))?e[1]:NaN}function na(e,n){var o=jt(e,n);if(!o)return e+"";var r=o[0],c=o[1];return c<0?"0."+new Array(-c).join("0")+r:r.length>c+1?r.slice(0,c+1)+"."+r.slice(c+1):r+new Array(c-r.length+2).join("0")}Ke.prototype=ki.prototype,ki.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const aa={"%":(e,n)=>(100*e).toFixed(n),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function Po(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,n)=>e.toExponential(n),f:(e,n)=>e.toFixed(n),g:(e,n)=>e.toPrecision(n),o:e=>Math.round(e).toString(8),p:(e,n)=>na(100*e,n),r:na,s:function Ro(e,n){var o=jt(e,n);if(!o)return e+"";var r=o[0],c=o[1],u=c-(ia=3*Math.max(-8,Math.min(8,Math.floor(c/3))))+1,d=r.length;return u===d?r:u>d?r+new Array(u-d+1).join("0"):u>0?r.slice(0,u)+"."+r.slice(u):"0."+new Array(1-u).join("0")+jt(e,Math.max(0,n+u-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function sa(e){return e}var ti,la,ca,oa=Array.prototype.map,ra=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Bo(e){var n=e.domain;return e.ticks=function(o){var r=n();return function Ha(e,n,o){var r,u,d,_,c=-1;if(o=+o,(e=+e)==(n=+n)&&o>0)return[e];if((r=n<e)&&(u=e,e=n,n=u),0===(_=sn(e,n,o))||!isFinite(_))return[];if(_>0){let f=Math.round(e/_),g=Math.round(n/_);for(f*_<e&&++f,g*_>n&&--g,d=new Array(u=g-f+1);++c<u;)d[c]=(f+c)*_}else{_=-_;let f=Math.round(e*_),g=Math.round(n*_);for(f/_<e&&++f,g/_>n&&--g,d=new Array(u=g-f+1);++c<u;)d[c]=(f+c)/_}return r&&d.reverse(),d}(r[0],r[r.length-1],null==o?10:o)},e.tickFormat=function(o,r){var c=n();return function Xo(e,n,o,r){var u,c=_i(e,n,o);switch((r=Ke(null==r?",f":r)).type){case"s":var d=Math.max(Math.abs(e),Math.abs(n));return null==r.precision&&!isNaN(u=function Qo(e,n){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(we(n)/3)))-we(Math.abs(e)))}(c,d))&&(r.precision=u),ca(r,d);case"":case"e":case"g":case"p":case"r":null==r.precision&&!isNaN(u=function Ho(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,we(n)-we(e))+1}(c,Math.max(Math.abs(e),Math.abs(n))))&&(r.precision=u-("e"===r.type));break;case"f":case"%":null==r.precision&&!isNaN(u=function $o(e){return Math.max(0,-we(Math.abs(e)))}(c))&&(r.precision=u-2*("%"===r.type))}return la(r)}(c[0],c[c.length-1],null==o?10:o,r)},e.nice=function(o){null==o&&(o=10);var f,g,r=n(),c=0,u=r.length-1,d=r[c],_=r[u],m=10;for(_<d&&(g=d,d=_,_=g,g=c,c=u,u=g);m-- >0;){if((g=sn(d,_,o))===f)return r[c]=d,r[u]=_,n(r);if(g>0)d=Math.floor(d/g)*g,_=Math.ceil(_/g)*g;else{if(!(g<0))break;d=Math.ceil(d*g)/g,_=Math.floor(_*g)/g}f=g}return e},e}function Ko(e,n,o){e=+e,n=+n,o=(c=arguments.length)<2?(n=e,e=0,1):c<3?1:+o;for(var r=-1,c=0|Math.max(0,Math.ceil((n-e)/o)),u=new Array(c);++r<c;)u[r]=e+r*o;return u}!function Go(e){ti=function zo(e){var n=void 0===e.grouping||void 0===e.thousands?sa:function Jo(e,n){return function(o,r){for(var c=o.length,u=[],d=0,_=e[0],f=0;c>0&&_>0&&(f+_+1>r&&(_=Math.max(1,r-f)),u.push(o.substring(c-=_,c+_)),!((f+=_+1)>r));)_=e[d=(d+1)%e.length];return u.reverse().join(n)}}(oa.call(e.grouping,Number),e.thousands+""),o=void 0===e.currency?"":e.currency[0]+"",r=void 0===e.currency?"":e.currency[1]+"",c=void 0===e.decimal?".":e.decimal+"",u=void 0===e.numerals?sa:function Fo(e){return function(n){return n.replace(/[0-9]/g,function(o){return e[+o]})}}(oa.call(e.numerals,String)),d=void 0===e.percent?"%":e.percent+"",_=void 0===e.minus?"\u2212":e.minus+"",f=void 0===e.nan?"NaN":e.nan+"";function g(x){var v=(x=Ke(x)).fill,T=x.align,V=x.sign,X=x.symbol,C=x.zero,Z=x.width,W=x.comma,I=x.precision,E=x.trim,k=x.type;"n"===k?(W=!0,k="g"):aa[k]||(void 0===I&&(I=12),E=!0,k="g"),(C||"0"===v&&"="===T)&&(C=!0,v="0",T="=");var O="$"===X?o:"#"===X&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",tt="$"===X?r:/[%p]/.test(k)?d:"",ot=aa[k],ut=/[defgprs%]/.test(k);function nt(Y){var y,U,M,Q=O,j=tt;if("c"===k)j=ot(Y)+j,Y="";else{var N=(Y=+Y)<0||1/Y<0;if(Y=isNaN(Y)?f:ot(Math.abs(Y),I),E&&(Y=function jo(e){t:for(var c,n=e.length,o=1,r=-1;o<n;++o)switch(e[o]){case".":r=c=o;break;case"0":0===r&&(r=o),c=o;break;default:if(!+e[o])break t;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(c+1):e}(Y)),N&&0==+Y&&"+"!==V&&(N=!1),Q=(N?"("===V?V:_:"-"===V||"("===V?"":V)+Q,j=("s"===k?ra[8+ia/3]:"")+j+(N&&"("===V?")":""),ut)for(y=-1,U=Y.length;++y<U;)if(48>(M=Y.charCodeAt(y))||M>57){j=(46===M?c+Y.slice(y+1):Y.slice(y))+j,Y=Y.slice(0,y);break}}W&&!C&&(Y=n(Y,1/0));var G=Q.length+Y.length+j.length,J=G<Z?new Array(Z-G+1).join(v):"";switch(W&&C&&(Y=n(J+Y,J.length?Z-j.length:1/0),J=""),T){case"<":Y=Q+Y+j+J;break;case"=":Y=Q+J+Y+j;break;case"^":Y=J.slice(0,G=J.length>>1)+Q+Y+j+J.slice(G);break;default:Y=J+Q+Y+j}return u(Y)}return I=void 0===I?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,I)):Math.max(0,Math.min(20,I)),nt.toString=function(){return x+""},nt}return{format:g,formatPrefix:function m(x,v){var T=g(((x=Ke(x)).type="f",x)),V=3*Math.max(-8,Math.min(8,Math.floor(we(v)/3))),X=Math.pow(10,-V),C=ra[8+V/3];return function(Z){return T(X*Z)+C}}}}(e),la=ti.format,ca=ti.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});class da extends Map{constructor(n,o=pa){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:o}}),null!=n)for(const[r,c]of n)this.set(r,c)}get(n){return super.get(Li(this,n))}has(n){return super.has(Li(this,n))}set(n,o){return super.set(function ha({_intern:e,_key:n},o){const r=n(o);return e.has(r)?e.get(r):(e.set(r,o),o)}(this,n),o)}delete(n){return super.delete(function _a({_intern:e,_key:n},o){const r=n(o);return e.has(r)&&(o=e.get(r),e.delete(r)),o}(this,n))}}function Li({_intern:e,_key:n},o){const r=n(o);return e.has(r)?e.get(r):o}function pa(e){return null!==e&&"object"==typeof e?e.valueOf():e}Set;const Yi=Symbol("implicit");function fa(){var e=new da,n=[],o=[],r=Yi;function c(u){let d=e.get(u);if(void 0===d){if(r!==Yi)return r;e.set(u,d=n.push(u)-1)}return o[d%o.length]}return c.domain=function(u){if(!arguments.length)return n.slice();n=[],e=new da;for(const d of u)e.has(d)||e.set(d,n.push(d)-1);return c},c.range=function(u){return arguments.length?(o=Array.from(u),c):o.slice()},c.unknown=function(u){return arguments.length?(r=u,c):r},c.copy=function(){return fa(n,o).unknown(r)},Be.apply(c,arguments),c}function tr(e){return e}function er(e){return"translate("+e+",0)"}function ir(e){return"translate(0,"+e+")"}function nr(e){return n=>+e(n)}function ar(e,n){return n=Math.max(0,e.bandwidth()-2*n)/2,e.round()&&(n=Math.round(n)),o=>+e(o)+n}function Bt(){return!this.__axis}function ni(e,n){var o=[],r=null,c=null,u=6,d=6,_=3,f="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,g=1===e||4===e?-1:1,m=4===e||2===e?"x":"y",x=1===e||3===e?er:ir;function v(T){var V=null==r?n.ticks?n.ticks.apply(n,o):n.domain():r,X=null==c?n.tickFormat?n.tickFormat.apply(n,o):tr:c,C=Math.max(u,0)+_,Z=n.range(),W=+Z[0]+f,I=+Z[Z.length-1]+f,E=(n.bandwidth?ar:nr)(n.copy(),f),k=T.selection?T.selection():T,O=k.selectAll(".domain").data([null]),tt=k.selectAll(".tick").data(V,n).order(),ot=tt.exit(),ut=tt.enter().append("g").attr("class","tick"),nt=tt.select("line"),Y=tt.select("text");O=O.merge(O.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),tt=tt.merge(ut),nt=nt.merge(ut.append("line").attr("stroke","currentColor").attr(m+"2",g*u)),Y=Y.merge(ut.append("text").attr("fill","currentColor").attr(m,g*C).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),T!==k&&(O=O.transition(T),tt=tt.transition(T),nt=nt.transition(T),Y=Y.transition(T),ot=ot.transition(T).attr("opacity",1e-6).attr("transform",function(Q){return isFinite(Q=E(Q))?x(Q+f):this.getAttribute("transform")}),ut.attr("opacity",1e-6).attr("transform",function(Q){var j=this.parentNode.__axis;return x((j&&isFinite(j=j(Q))?j:E(Q))+f)})),ot.remove(),O.attr("d",4===e||2===e?d?"M"+g*d+","+W+"H"+f+"V"+I+"H"+g*d:"M"+f+","+W+"V"+I:d?"M"+W+","+g*d+"V"+f+"H"+I+"V"+g*d:"M"+W+","+f+"H"+I),tt.attr("opacity",1).attr("transform",function(Q){return x(E(Q)+f)}),nt.attr(m+"2",g*u),Y.attr(m,g*C).text(X),k.filter(Bt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),k.each(function(){this.__axis=E})}return v.scale=function(T){return arguments.length?(n=T,v):n},v.ticks=function(){return o=Array.from(arguments),v},v.tickArguments=function(T){return arguments.length?(o=null==T?[]:Array.from(T),v):o.slice()},v.tickValues=function(T){return arguments.length?(r=null==T?null:Array.from(T),v):r&&r.slice()},v.tickFormat=function(T){return arguments.length?(c=T,v):c},v.tickSize=function(T){return arguments.length?(u=d=+T,v):u},v.tickSizeInner=function(T){return arguments.length?(u=+T,v):u},v.tickSizeOuter=function(T){return arguments.length?(d=+T,v):d},v.tickPadding=function(T){return arguments.length?(_=+T,v):_},v.offset=function(T){return arguments.length?(f=+T,v):f},v}var va="%Y-%m-%dT%H:%M:%S.%LZ";const cr=Date.prototype.toISOString?function lr(e){return e.toISOString()}:Di(va),hr=+new Date("2000-01-01T00:00:00.000Z")?function ur(e){var n=new Date(e);return isNaN(n)?null:n}:Si(va);var Ji="http://www.w3.org/1999/xhtml";const Fi={svg:"http://www.w3.org/2000/svg",xhtml:Ji,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ce(e){var n=e+="",o=n.indexOf(":");return o>=0&&"xmlns"!==(n=e.slice(0,o))&&(e=e.slice(o+1)),Fi.hasOwnProperty(n)?{space:Fi[n],local:e}:e}function _r(e){return function(){var n=this.ownerDocument,o=this.namespaceURI;return o===Ji&&n.documentElement.namespaceURI===Ji?n.createElement(e):n.createElementNS(o,e)}}function pr(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ai(e){var n=Ce(e);return(n.local?pr:_r)(n)}function fr(){}function si(e){return null==e?fr:function(){return this.querySelector(e)}}function ba(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function a(){return[]}function h(e){return null==e?a:function(){return this.querySelectorAll(e)}}function l(e){return function(){return this.matches(e)}}function p(e){return function(n){return n.matches(e)}}var b=Array.prototype.find;function A(){return this.firstElementChild}var Rt=Array.prototype.filter;function Ue(){return Array.from(this.children)}function Al(e){return new Array(e.length)}function ya(e,n){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=n}function lc(e){return function(){return e}}function cc(e,n,o,r,c,u){for(var _,d=0,f=n.length,g=u.length;d<g;++d)(_=n[d])?(_.__data__=u[d],r[d]=_):o[d]=new ya(e,u[d]);for(;d<f;++d)(_=n[d])&&(c[d]=_)}function uc(e,n,o,r,c,u,d){var _,f,T,g=new Map,m=n.length,x=u.length,v=new Array(m);for(_=0;_<m;++_)(f=n[_])&&(v[_]=T=d.call(f,f.__data__,_,n)+"",g.has(T)?c[_]=f:g.set(T,f));for(_=0;_<x;++_)T=d.call(e,u[_],_,u)+"",(f=g.get(T))?(r[_]=f,f.__data__=u[_],g.delete(T)):o[_]=new ya(e,u[_]);for(_=0;_<m;++_)(f=n[_])&&g.get(v[_])===f&&(c[_]=f)}function dc(e){return e.__data__}function _c(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function xc(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function Zc(e){return function(){this.removeAttribute(e)}}function Mc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ic(e,n){return function(){this.setAttribute(e,n)}}function Dc(e,n){return function(){this.setAttributeNS(e.space,e.local,n)}}function Sc(e,n){return function(){var o=n.apply(this,arguments);null==o?this.removeAttribute(e):this.setAttribute(e,o)}}function Oc(e,n){return function(){var o=n.apply(this,arguments);null==o?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,o)}}function vr(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Nc(e){return function(){this.style.removeProperty(e)}}function Vc(e,n,o){return function(){this.style.setProperty(e,n,o)}}function Ec(e,n,o){return function(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,o)}}function ke(e,n){return e.style.getPropertyValue(n)||vr(e).getComputedStyle(e,null).getPropertyValue(n)}function Uc(e){return function(){delete this[e]}}function kc(e,n){return function(){this[e]=n}}function Lc(e,n){return function(){var o=n.apply(this,arguments);null==o?delete this[e]:this[e]=o}}function Zl(e){return e.trim().split(/^|\s+/)}function xr(e){return e.classList||new Ml(e)}function Ml(e){this._node=e,this._names=Zl(e.getAttribute("class")||"")}function Il(e,n){for(var o=xr(e),r=-1,c=n.length;++r<c;)o.add(n[r])}function Dl(e,n){for(var o=xr(e),r=-1,c=n.length;++r<c;)o.remove(n[r])}function Pc(e){return function(){Il(this,e)}}function Qc(e){return function(){Dl(this,e)}}function Jc(e,n){return function(){(n.apply(this,arguments)?Il:Dl)(this,e)}}function jc(){this.textContent=""}function Rc(e){return function(){this.textContent=e}}function zc(e){return function(){var n=e.apply(this,arguments);this.textContent=null==n?"":n}}function Hc(){this.innerHTML=""}function $c(e){return function(){this.innerHTML=e}}function Xc(e){return function(){var n=e.apply(this,arguments);this.innerHTML=null==n?"":n}}function Kc(){this.nextSibling&&this.parentNode.appendChild(this)}function eu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function au(){return null}function ou(){var e=this.parentNode;e&&e.removeChild(this)}function lu(){var e=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function cu(){var e=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function _u(e){return e.trim().split(/^|\s+/).map(function(n){var o="",r=n.indexOf(".");return r>=0&&(o=n.slice(r+1),n=n.slice(0,r)),{type:n,name:o}})}function pu(e){return function(){var n=this.__on;if(n){for(var u,o=0,r=-1,c=n.length;o<c;++o)u=n[o],e.type&&u.type!==e.type||u.name!==e.name?n[++r]=u:this.removeEventListener(u.type,u.listener,u.options);++r?n.length=r:delete this.__on}}}function fu(e,n,o){return function(){var c,r=this.__on,u=function hu(e){return function(n){e.call(this,n,this.__data__)}}(n);if(r)for(var d=0,_=r.length;d<_;++d)if((c=r[d]).type===e.type&&c.name===e.name)return this.removeEventListener(c.type,c.listener,c.options),this.addEventListener(c.type,c.listener=u,c.options=o),void(c.value=n);this.addEventListener(e.type,u,o),c={type:e.type,name:e.name,value:n,listener:u,options:o},r?r.push(c):this.__on=[c]}}function Sl(e,n,o){var r=vr(e),c=r.CustomEvent;"function"==typeof c?c=new c(n,o):(c=r.document.createEvent("Event"),o?(c.initEvent(n,o.bubbles,o.cancelable),c.detail=o.detail):c.initEvent(n,!1,!1)),e.dispatchEvent(c)}function mu(e,n){return function(){return Sl(this,e,n)}}function vu(e,n){return function(){return Sl(this,e,n.apply(this,arguments))}}ya.prototype={constructor:ya,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,n){return this._parent.insertBefore(e,n)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Ml.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var n=this._names.indexOf(e);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var br=[null];function qt(e,n){this._groups=e,this._parents=n}function Ol(){return new qt([[document.documentElement]],br)}qt.prototype=Ol.prototype={constructor:qt,select:function gr(e){"function"!=typeof e&&(e=si(e));for(var n=this._groups,o=n.length,r=new Array(o),c=0;c<o;++c)for(var f,g,u=n[c],d=u.length,_=r[c]=new Array(d),m=0;m<d;++m)(f=u[m])&&(g=e.call(f,f.__data__,m,u))&&("__data__"in f&&(g.__data__=f.__data__),_[m]=g);return new qt(r,this._parents)},selectAll:function s(e){e="function"==typeof e?function i(e){return function(){return ba(e.apply(this,arguments))}}(e):h(e);for(var n=this._groups,o=n.length,r=[],c=[],u=0;u<o;++u)for(var f,d=n[u],_=d.length,g=0;g<_;++g)(f=d[g])&&(r.push(e.call(f,f.__data__,g,d)),c.push(f));return new qt(r,c)},selectChild:function ct(e){return this.select(null==e?A:function w(e){return function(){return b.call(this.children,e)}}("function"==typeof e?e:p(e)))},selectChildren:function sc(e){return this.selectAll(null==e?Ue:function mr(e){return function(){return Rt.call(this.children,e)}}("function"==typeof e?e:p(e)))},filter:function oc(e){"function"!=typeof e&&(e=l(e));for(var n=this._groups,o=n.length,r=new Array(o),c=0;c<o;++c)for(var f,u=n[c],d=u.length,_=r[c]=[],g=0;g<d;++g)(f=u[g])&&e.call(f,f.__data__,g,u)&&_.push(f);return new qt(r,this._parents)},data:function hc(e,n){if(!arguments.length)return Array.from(this,dc);var o=n?uc:cc,r=this._parents,c=this._groups;"function"!=typeof e&&(e=lc(e));for(var u=c.length,d=new Array(u),_=new Array(u),f=new Array(u),g=0;g<u;++g){var m=r[g],x=c[g],v=x.length,T=_c(e.call(m,m&&m.__data__,g,r)),V=T.length,X=_[g]=new Array(V),C=d[g]=new Array(V),Z=f[g]=new Array(v);o(m,x,X,C,Z,T,n);for(var E,k,W=0,I=0;W<V;++W)if(E=X[W]){for(W>=I&&(I=W+1);!(k=C[I])&&++I<V;);E._next=k||null}}return(d=new qt(d,r))._enter=_,d._exit=f,d},enter:function rc(){return new qt(this._enter||this._groups.map(Al),this._parents)},exit:function pc(){return new qt(this._exit||this._groups.map(Al),this._parents)},join:function fc(e,n,o){var r=this.enter(),c=this,u=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=n&&(c=n(c))&&(c=c.selection()),null==o?u.remove():o(u),r&&c?r.merge(c).order():c},merge:function gc(e){for(var n=e.selection?e.selection():e,o=this._groups,r=n._groups,c=o.length,d=Math.min(c,r.length),_=new Array(c),f=0;f<d;++f)for(var T,g=o[f],m=r[f],x=g.length,v=_[f]=new Array(x),V=0;V<x;++V)(T=g[V]||m[V])&&(v[V]=T);for(;f<c;++f)_[f]=o[f];return new qt(_,this._parents)},selection:function yu(){return this},order:function mc(){for(var e=this._groups,n=-1,o=e.length;++n<o;)for(var d,r=e[n],c=r.length-1,u=r[c];--c>=0;)(d=r[c])&&(u&&4^d.compareDocumentPosition(u)&&u.parentNode.insertBefore(d,u),u=d);return this},sort:function vc(e){function n(x,v){return x&&v?e(x.__data__,v.__data__):!x-!v}e||(e=xc);for(var o=this._groups,r=o.length,c=new Array(r),u=0;u<r;++u){for(var g,d=o[u],_=d.length,f=c[u]=new Array(_),m=0;m<_;++m)(g=d[m])&&(f[m]=g);f.sort(n)}return new qt(c,this._parents).order()},call:function bc(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function yc(){return Array.from(this)},node:function Tc(){for(var e=this._groups,n=0,o=e.length;n<o;++n)for(var r=e[n],c=0,u=r.length;c<u;++c){var d=r[c];if(d)return d}return null},size:function wc(){let e=0;for(const n of this)++e;return e},empty:function Cc(){return!this.node()},each:function Ac(e){for(var n=this._groups,o=0,r=n.length;o<r;++o)for(var _,c=n[o],u=0,d=c.length;u<d;++u)(_=c[u])&&e.call(_,_.__data__,u,c);return this},attr:function Wc(e,n){var o=Ce(e);if(arguments.length<2){var r=this.node();return o.local?r.getAttributeNS(o.space,o.local):r.getAttribute(o)}return this.each((null==n?o.local?Mc:Zc:"function"==typeof n?o.local?Oc:Sc:o.local?Dc:Ic)(o,n))},style:function qc(e,n,o){return arguments.length>1?this.each((null==n?Nc:"function"==typeof n?Ec:Vc)(e,n,null==o?"":o)):ke(this.node(),e)},property:function Yc(e,n){return arguments.length>1?this.each((null==n?Uc:"function"==typeof n?Lc:kc)(e,n)):this.node()[e]},classed:function Fc(e,n){var o=Zl(e+"");if(arguments.length<2){for(var r=xr(this.node()),c=-1,u=o.length;++c<u;)if(!r.contains(o[c]))return!1;return!0}return this.each(("function"==typeof n?Jc:n?Pc:Qc)(o,n))},text:function Gc(e){return arguments.length?this.each(null==e?jc:("function"==typeof e?zc:Rc)(e)):this.node().textContent},html:function Bc(e){return arguments.length?this.each(null==e?Hc:("function"==typeof e?Xc:$c)(e)):this.node().innerHTML},raise:function tu(){return this.each(Kc)},lower:function iu(){return this.each(eu)},append:function nu(e){var n="function"==typeof e?e:ai(e);return this.select(function(){return this.appendChild(n.apply(this,arguments))})},insert:function su(e,n){var o="function"==typeof e?e:ai(e),r=null==n?au:"function"==typeof n?n:si(n);return this.select(function(){return this.insertBefore(o.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function ru(){return this.each(ou)},clone:function uu(e){return this.select(e?cu:lu)},datum:function du(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function gu(e,n,o){var c,d,r=_u(e+""),u=r.length;if(!(arguments.length<2)){for(_=n?fu:pu,c=0;c<u;++c)this.each(_(r[c],n,o));return this}var _=this.node().__on;if(_)for(var m,f=0,g=_.length;f<g;++f)for(c=0,m=_[f];c<u;++c)if((d=r[c]).type===m.type&&d.name===m.name)return m.value},dispatch:function xu(e,n){return this.each(("function"==typeof n?vu:mu)(e,n))},[Symbol.iterator]:function*bu(){for(var e=this._groups,n=0,o=e.length;n<o;++n)for(var d,r=e[n],c=0,u=r.length;c<u;++c)(d=r[c])&&(yield d)}};const oi=Ol;function Pt(e){return"string"==typeof e?new qt([[document.querySelector(e)]],[document.documentElement]):new qt([[e]],br)}function Tu(e){return Pt(ai(e).call(document.documentElement))}var wu=0;function Wl(){return new yr}function yr(){this._="@"+(++wu).toString(36)}function Nl(e){let n;for(;n=e.sourceEvent;)e=n;return e}function Kt(e,n){if(e=Nl(e),void 0===n&&(n=e.currentTarget),n){var o=n.ownerSVGElement||n;if(o.createSVGPoint){var r=o.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(n.getScreenCTM().inverse())).x,r.y]}if(n.getBoundingClientRect){var c=n.getBoundingClientRect();return[e.clientX-c.left-n.clientLeft,e.clientY-c.top-n.clientTop]}}return[e.pageX,e.pageY]}function Cu(e,n){return e.target&&(e=Nl(e),void 0===n&&(n=e.currentTarget),e=e.touches||[e]),Array.from(e,o=>Kt(o,n))}function Au(e){return"string"==typeof e?new qt([document.querySelectorAll(e)],[document.documentElement]):new qt([ba(e)],br)}yr.prototype=Wl.prototype={constructor:yr,get:function(e){for(var n=this._;!(n in e);)if(!(e=e.parentNode))return;return e[n]},set:function(e,n){return e[this._]=n},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var Iu={value:()=>{}};function Vl(){for(var r,e=0,n=arguments.length,o={};e<n;++e){if(!(r=arguments[e]+"")||r in o||/[\s.]/.test(r))throw new Error("illegal type: "+r);o[r]=[]}return new Ta(o)}function Ta(e){this._=e}function Du(e,n){return e.trim().split(/^|\s+/).map(function(o){var r="",c=o.indexOf(".");if(c>=0&&(r=o.slice(c+1),o=o.slice(0,c)),o&&!n.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:r}})}function Su(e,n){for(var c,o=0,r=e.length;o<r;++o)if((c=e[o]).name===n)return c.value}function El(e,n,o){for(var r=0,c=e.length;r<c;++r)if(e[r].name===n){e[r]=Iu,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=o&&e.push({name:n,value:o}),e}Ta.prototype=Vl.prototype={constructor:Ta,on:function(e,n){var c,o=this._,r=Du(e+"",o),u=-1,d=r.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++u<d;)if(c=(e=r[u]).type)o[c]=El(o[c],e.name,n);else if(null==n)for(c in o)o[c]=El(o[c],e.name,null);return this}for(;++u<d;)if((c=(e=r[u]).type)&&(c=Su(o[c],e.name)))return c},copy:function(){var e={},n=this._;for(var o in n)e[o]=n[o].slice();return new Ta(e)},call:function(e,n){if((c=arguments.length-2)>0)for(var c,u,o=new Array(c),r=0;r<c;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,c=(u=this._[e]).length;r<c;++r)u[r].value.apply(n,o)},apply:function(e,n,o){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],c=0,u=r.length;c<u;++c)r[c].value.apply(n,o)}};const Tr=Vl,wr={capture:!0,passive:!1};function Cr(e){e.preventDefault(),e.stopImmediatePropagation()}function ql(e){var n=e.document.documentElement,o=Pt(e).on("dragstart.drag",Cr,wr);"onselectstart"in n?o.on("selectstart.drag",Cr,wr):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function Ul(e,n){var o=e.document.documentElement,r=Pt(e).on("dragstart.drag",null);n&&(r.on("click.drag",Cr,wr),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in o?r.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}function kl(e){return((e=Math.exp(e))+1/e)/2}const Vu=function e(n,o,r){function c(u,d){var C,Z,_=u[0],f=u[1],g=u[2],v=d[2],T=d[0]-_,V=d[1]-f,X=T*T+V*V;if(X<1e-12)Z=Math.log(v/g)/n,C=function(tt){return[_+tt*T,f+tt*V,g*Math.exp(n*tt*Z)]};else{var W=Math.sqrt(X),I=(v*v-g*g+r*X)/(2*g*o*W),E=(v*v-g*g-r*X)/(2*v*o*W),k=Math.log(Math.sqrt(I*I+1)-I),O=Math.log(Math.sqrt(E*E+1)-E);Z=(O-k)/n,C=function(tt){var ot=tt*Z,ut=kl(k),nt=g/(o*W)*(ut*function Nu(e){return((e=Math.exp(2*e))-1)/(e+1)}(n*ot+k)-function Wu(e){return((e=Math.exp(e))-1/e)/2}(k));return[_+nt*T,f+nt*V,g*ut/kl(n*ot+k)]}}return C.duration=1e3*Z*n/Math.SQRT2,C}return c.rho=function(u){var d=Math.max(.001,+u),_=d*d;return e(d,_,_*_)},c}(Math.SQRT2,2,4);var wa,zi,ri=0,ji=0,Ri=0,Ca=0,Le=0,Aa=0,Gi="object"==typeof performance&&performance.now?performance:Date,Yl="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ar(){return Le||(Yl(Eu),Le=Gi.now()+Aa)}function Eu(){Le=0}function Za(){this._call=this._time=this._next=null}function Pl(e,n,o){var r=new Za;return r.restart(e,n,o),r}function Ql(){Le=(Ca=Gi.now())+Aa,ri=ji=0;try{!function qu(){Ar(),++ri;for(var n,e=wa;e;)(n=Le-e._time)>=0&&e._call.call(void 0,n),e=e._next;--ri}()}finally{ri=0,function ku(){for(var e,o,n=wa,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(o=n._next,n._next=null,n=e?e._next=o:wa=o);zi=e,Zr(r)}(),Le=0}}function Uu(){var e=Gi.now(),n=e-Ca;n>1e3&&(Aa-=n,Ca=e)}function Zr(e){ri||(ji&&(ji=clearTimeout(ji)),e-Le>24?(e<1/0&&(ji=setTimeout(Ql,e-Gi.now()-Aa)),Ri&&(Ri=clearInterval(Ri))):(Ri||(Ca=Gi.now(),Ri=setInterval(Uu,1e3)),ri=1,Yl(Ql)))}function Jl(e,n,o){var r=new Za;return r.restart(c=>{r.stop(),e(c+n)},n=null==n?0:+n,o),r}Za.prototype=Pl.prototype={constructor:Za,restart:function(e,n,o){if("function"!=typeof e)throw new TypeError("callback is not a function");o=(null==o?Ar():+o)+(null==n?0:+n),!this._next&&zi!==this&&(zi?zi._next=this:wa=this,zi=this),this._call=e,this._time=o,Zr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zr())}};var Lu=Tr("start","end","cancel","interrupt"),Yu=[];function Da(e,n,o,r,c,u){var d=e.__transition;if(d){if(o in d)return}else e.__transition={};!function Pu(e,n,o){var c,r=e.__transition;function d(g){var m,x,v,T;if(1!==o.state)return f();for(m in r)if((T=r[m]).name===o.name){if(3===T.state)return Jl(d);4===T.state?(T.state=6,T.timer.stop(),T.on.call("interrupt",e,e.__data__,T.index,T.group),delete r[m]):+m<n&&(T.state=6,T.timer.stop(),T.on.call("cancel",e,e.__data__,T.index,T.group),delete r[m])}if(Jl(function(){3===o.state&&(o.state=4,o.timer.restart(_,o.delay,o.time),_(g))}),o.state=2,o.on.call("start",e,e.__data__,o.index,o.group),2===o.state){for(o.state=3,c=new Array(v=o.tween.length),m=0,x=-1;m<v;++m)(T=o.tween[m].value.call(e,e.__data__,o.index,o.group))&&(c[++x]=T);c.length=x+1}}function _(g){for(var m=g<o.duration?o.ease.call(null,g/o.duration):(o.timer.restart(f),o.state=5,1),x=-1,v=c.length;++x<v;)c[x].call(e,m);5===o.state&&(o.on.call("end",e,e.__data__,o.index,o.group),f())}function f(){for(var g in o.state=6,o.timer.stop(),delete r[n],r)return;delete e.__transition}r[n]=o,o.timer=Pl(function u(g){o.state=1,o.timer.restart(d,o.delay,o.time),o.delay<=g&&d(g-o.delay)},0,o.time)}(e,o,{name:n,index:r,group:c,on:Lu,tween:Yu,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:0})}function Dr(e,n){var o=te(e,n);if(o.state>0)throw new Error("too late; already scheduled");return o}function ae(e,n){var o=te(e,n);if(o.state>3)throw new Error("too late; already running");return o}function te(e,n){var o=e.__transition;if(!o||!(o=o[n]))throw new Error("transition not found");return o}function li(e,n){var r,c,d,o=e.__transition,u=!0;if(o){for(d in n=null==n?null:n+"",o)(r=o[d]).name===n?(c=r.state>2&&r.state<5,r.state=6,r.timer.stop(),r.on.call(c?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete o[d]):u=!1;u&&delete e.__transition}}var Sa,zl=180/Math.PI,Sr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Gl(e,n,o,r,c,u){var d,_,f;return(d=Math.sqrt(e*e+n*n))&&(e/=d,n/=d),(f=e*o+n*r)&&(o-=e*f,r-=n*f),(_=Math.sqrt(o*o+r*r))&&(o/=_,r/=_,f/=_),e*r<n*o&&(e=-e,n=-n,f=-f,d=-d),{translateX:c,translateY:u,rotate:Math.atan2(n,e)*zl,skewX:Math.atan(f)*zl,scaleX:d,scaleY:_}}function Hl(e,n,o,r){function c(g){return g.length?g.pop()+" ":""}return function(g,m){var x=[],v=[];return g=e(g),m=e(m),function u(g,m,x,v,T,V){if(g!==x||m!==v){var X=T.push("translate(",null,n,null,o);V.push({i:X-4,x:Ft(g,x)},{i:X-2,x:Ft(m,v)})}else(x||v)&&T.push("translate("+x+n+v+o)}(g.translateX,g.translateY,m.translateX,m.translateY,x,v),function d(g,m,x,v){g!==m?(g-m>180?m+=360:m-g>180&&(g+=360),v.push({i:x.push(c(x)+"rotate(",null,r)-2,x:Ft(g,m)})):m&&x.push(c(x)+"rotate("+m+r)}(g.rotate,m.rotate,x,v),function _(g,m,x,v){g!==m?v.push({i:x.push(c(x)+"skewX(",null,r)-2,x:Ft(g,m)}):m&&x.push(c(x)+"skewX("+m+r)}(g.skewX,m.skewX,x,v),function f(g,m,x,v,T,V){if(g!==x||m!==v){var X=T.push(c(T)+"scale(",null,",",null,")");V.push({i:X-4,x:Ft(g,x)},{i:X-2,x:Ft(m,v)})}else(1!==x||1!==v)&&T.push(c(T)+"scale("+x+","+v+")")}(g.scaleX,g.scaleY,m.scaleX,m.scaleY,x,v),g=m=null,function(T){for(var C,V=-1,X=v.length;++V<X;)x[(C=v[V]).i]=C.x(T);return x.join("")}}}var ju=Hl(function Ju(e){const n=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return n.isIdentity?Sr:Gl(n.a,n.b,n.c,n.d,n.e,n.f)},"px, ","px)","deg)"),Ru=Hl(function Fu(e){return null!=e&&(Sa||(Sa=document.createElementNS("http://www.w3.org/2000/svg","g")),Sa.setAttribute("transform",e),e=Sa.transform.baseVal.consolidate())?Gl((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Sr},", ",")",")");function zu(e,n){var o,r;return function(){var c=ae(this,e),u=c.tween;if(u!==o)for(var d=0,_=(r=o=u).length;d<_;++d)if(r[d].name===n){(r=r.slice()).splice(d,1);break}c.tween=r}}function Gu(e,n,o){var r,c;if("function"!=typeof o)throw new Error;return function(){var u=ae(this,e),d=u.tween;if(d!==r){c=(r=d).slice();for(var _={name:n,value:o},f=0,g=c.length;f<g;++f)if(c[f].name===n){c[f]=_;break}f===g&&c.push(_)}u.tween=c}}function Or(e,n,o){var r=e._id;return e.each(function(){var c=ae(this,r);(c.value||(c.value={}))[n]=o.apply(this,arguments)}),function(c){return te(c,r).value[n]}}function $l(e,n){var o;return("number"==typeof n?Ft:n instanceof ue?Xe:(o=ue(n))?(n=o,Xe):Xn)(e,n)}function $u(e){return function(){this.removeAttribute(e)}}function Xu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Bu(e,n,o){var r,u,c=o+"";return function(){var d=this.getAttribute(e);return d===c?null:d===r?u:u=n(r=d,o)}}function Ku(e,n,o){var r,u,c=o+"";return function(){var d=this.getAttributeNS(e.space,e.local);return d===c?null:d===r?u:u=n(r=d,o)}}function td(e,n,o){var r,c,u;return function(){var d,f,_=o(this);return null==_?void this.removeAttribute(e):(d=this.getAttribute(e))===(f=_+"")?null:d===r&&f===c?u:(c=f,u=n(r=d,_))}}function ed(e,n,o){var r,c,u;return function(){var d,f,_=o(this);return null==_?void this.removeAttributeNS(e.space,e.local):(d=this.getAttributeNS(e.space,e.local))===(f=_+"")?null:d===r&&f===c?u:(c=f,u=n(r=d,_))}}function nd(e,n){return function(o){this.setAttribute(e,n.call(this,o))}}function ad(e,n){return function(o){this.setAttributeNS(e.space,e.local,n.call(this,o))}}function sd(e,n){var o,r;function c(){var u=n.apply(this,arguments);return u!==r&&(o=(r=u)&&ad(e,u)),o}return c._value=n,c}function od(e,n){var o,r;function c(){var u=n.apply(this,arguments);return u!==r&&(o=(r=u)&&nd(e,u)),o}return c._value=n,c}function ld(e,n){return function(){Dr(this,e).delay=+n.apply(this,arguments)}}function cd(e,n){return n=+n,function(){Dr(this,e).delay=n}}function dd(e,n){return function(){ae(this,e).duration=+n.apply(this,arguments)}}function hd(e,n){return n=+n,function(){ae(this,e).duration=n}}function pd(e,n){if("function"!=typeof n)throw new Error;return function(){ae(this,e).ease=n}}function yd(e,n,o){var r,c,u=function bd(e){return(e+"").trim().split(/^|\s+/).every(function(n){var o=n.indexOf(".");return o>=0&&(n=n.slice(0,o)),!n||"start"===n})}(n)?Dr:ae;return function(){var d=u(this,e),_=d.on;_!==r&&(c=(r=_).copy()).on(n,o),d.on=c}}var Md=oi.prototype.constructor;function Xl(e){return function(){this.style.removeProperty(e)}}function Vd(e,n,o){return function(r){this.style.setProperty(e,n.call(this,r),o)}}function Ed(e,n,o){var r,c;function u(){var d=n.apply(this,arguments);return d!==c&&(r=(c=d)&&Vd(e,d,o)),r}return u._value=n,u}function Yd(e){return function(n){this.textContent=e.call(this,n)}}function Pd(e){var n,o;function r(){var c=e.apply(this,arguments);return c!==o&&(n=(o=c)&&Yd(c)),n}return r._value=e,r}var jd=0;function de(e,n,o,r){this._groups=e,this._parents=n,this._name=o,this._id=r}function Bl(){return++jd}var he=oi.prototype;de.prototype=function Rd(e){return oi().transition(e)}.prototype={constructor:de,select:function Ad(e){var n=this._name,o=this._id;"function"!=typeof e&&(e=si(e));for(var r=this._groups,c=r.length,u=new Array(c),d=0;d<c;++d)for(var m,x,_=r[d],f=_.length,g=u[d]=new Array(f),v=0;v<f;++v)(m=_[v])&&(x=e.call(m,m.__data__,v,_))&&("__data__"in m&&(x.__data__=m.__data__),g[v]=x,Da(g[v],n,o,v,g,te(m,o)));return new de(u,this._parents,n,o)},selectAll:function Zd(e){var n=this._name,o=this._id;"function"!=typeof e&&(e=h(e));for(var r=this._groups,c=r.length,u=[],d=[],_=0;_<c;++_)for(var m,f=r[_],g=f.length,x=0;x<g;++x)if(m=f[x]){for(var T,v=e.call(m,m.__data__,x,f),V=te(m,o),X=0,C=v.length;X<C;++X)(T=v[X])&&Da(T,n,o,X,v,V);u.push(v),d.push(m)}return new de(u,d,n,o)},selectChild:he.selectChild,selectChildren:he.selectChildren,filter:function vd(e){"function"!=typeof e&&(e=l(e));for(var n=this._groups,o=n.length,r=new Array(o),c=0;c<o;++c)for(var f,u=n[c],d=u.length,_=r[c]=[],g=0;g<d;++g)(f=u[g])&&e.call(f,f.__data__,g,u)&&_.push(f);return new de(r,this._parents,this._name,this._id)},merge:function xd(e){if(e._id!==this._id)throw new Error;for(var n=this._groups,o=e._groups,r=n.length,u=Math.min(r,o.length),d=new Array(r),_=0;_<u;++_)for(var v,f=n[_],g=o[_],m=f.length,x=d[_]=new Array(m),T=0;T<m;++T)(v=f[T]||g[T])&&(x[T]=v);for(;_<r;++_)d[_]=n[_];return new de(d,this._parents,this._name,this._id)},selection:function Id(){return new Md(this._groups,this._parents)},transition:function Jd(){for(var e=this._name,n=this._id,o=Bl(),r=this._groups,c=r.length,u=0;u<c;++u)for(var f,d=r[u],_=d.length,g=0;g<_;++g)if(f=d[g]){var m=te(f,n);Da(f,e,o,g,d,{time:m.time+m.delay+m.duration,delay:0,duration:m.duration,ease:m.ease})}return new de(r,this._parents,e,o)},call:he.call,nodes:he.nodes,node:he.node,size:he.size,empty:he.empty,each:he.each,on:function Td(e,n){var o=this._id;return arguments.length<2?te(this.node(),o).on.on(e):this.each(yd(o,e,n))},attr:function id(e,n){var o=Ce(e),r="transform"===o?Ru:$l;return this.attrTween(e,"function"==typeof n?(o.local?ed:td)(o,r,Or(this,"attr."+e,n)):null==n?(o.local?Xu:$u)(o):(o.local?Ku:Bu)(o,r,n))},attrTween:function rd(e,n){var o="attr."+e;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(null==n)return this.tween(o,null);if("function"!=typeof n)throw new Error;var r=Ce(e);return this.tween(o,(r.local?sd:od)(r,n))},style:function Nd(e,n,o){var r="transform"==(e+="")?ju:$l;return null==n?this.styleTween(e,function Dd(e,n){var o,r,c;return function(){var u=ke(this,e),d=(this.style.removeProperty(e),ke(this,e));return u===d?null:u===o&&d===r?c:c=n(o=u,r=d)}}(e,r)).on("end.style."+e,Xl(e)):"function"==typeof n?this.styleTween(e,function Od(e,n,o){var r,c,u;return function(){var d=ke(this,e),_=o(this),f=_+"";return null==_&&(this.style.removeProperty(e),f=_=ke(this,e)),d===f?null:d===r&&f===c?u:(c=f,u=n(r=d,_))}}(e,r,Or(this,"style."+e,n))).each(function Wd(e,n){var o,r,c,_,u="style."+n,d="end."+u;return function(){var f=ae(this,e),g=f.on,m=null==f.value[u]?_||(_=Xl(n)):void 0;(g!==o||c!==m)&&(r=(o=g).copy()).on(d,c=m),f.on=r}}(this._id,e)):this.styleTween(e,function Sd(e,n,o){var r,u,c=o+"";return function(){var d=ke(this,e);return d===c?null:d===r?u:u=n(r=d,o)}}(e,r,n),o).on("end.style."+e,null)},styleTween:function qd(e,n,o){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==n)return this.tween(r,null);if("function"!=typeof n)throw new Error;return this.tween(r,Ed(e,n,null==o?"":o))},text:function Ld(e){return this.tween("text","function"==typeof e?function kd(e){return function(){var n=e(this);this.textContent=null==n?"":n}}(Or(this,"text",e)):function Ud(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function Qd(e){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,Pd(e))},remove:function Cd(){return this.on("end.remove",function wd(e){return function(){var n=this.parentNode;for(var o in this.__transition)if(+o!==e)return;n&&n.removeChild(this)}}(this._id))},tween:function Hu(e,n){var o=this._id;if(e+="",arguments.length<2){for(var d,r=te(this.node(),o).tween,c=0,u=r.length;c<u;++c)if((d=r[c]).name===e)return d.value;return null}return this.each((null==n?zu:Gu)(o,e,n))},delay:function ud(e){var n=this._id;return arguments.length?this.each(("function"==typeof e?ld:cd)(n,e)):te(this.node(),n).delay},duration:function _d(e){var n=this._id;return arguments.length?this.each(("function"==typeof e?dd:hd)(n,e)):te(this.node(),n).duration},ease:function fd(e){var n=this._id;return arguments.length?this.each(pd(n,e)):te(this.node(),n).ease},easeVarying:function md(e){if("function"!=typeof e)throw new Error;return this.each(function gd(e,n){return function(){var o=n.apply(this,arguments);if("function"!=typeof o)throw new Error;ae(this,e).ease=o}}(this._id,e))},end:function Fd(){var e,n,o=this,r=o._id,c=o.size();return new Promise(function(u,d){var _={value:d},f={value:function(){0==--c&&u()}};o.each(function(){var g=ae(this,r),m=g.on;m!==e&&((n=(e=m).copy())._.cancel.push(_),n._.interrupt.push(_),n._.end.push(f)),g.on=n}),0===c&&u()})},[Symbol.iterator]:he[Symbol.iterator]};var Gd={time:null,delay:0,duration:250,ease:function zd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Hd(e,n){for(var o;!(o=e.__transition)||!(o=o[n]);)if(!(e=e.parentNode))throw new Error(`transition ${n} not found`);return o}oi.prototype.interrupt=function Qu(e){return this.each(function(){li(this,e)})},oi.prototype.transition=function $d(e){var n,o;e instanceof de?(n=e._id,e=e._name):(n=Bl(),(o=Gd).time=Ar(),e=null==e?null:e+"");for(var r=this._groups,c=r.length,u=0;u<c;++u)for(var f,d=r[u],_=d.length,g=0;g<_;++g)(f=d[g])&&Da(f,e,n,g,d,o||Hd(f,n));return new de(r,this._parents,e,n)};const Oa=e=>()=>e;function Xd(e,{sourceEvent:n,target:o,transform:r,dispatch:c}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:c}})}function _e(e,n,o){this.k=e,this.x=n,this.y=o}_e.prototype={constructor:_e,scale:function(e){return 1===e?this:new _e(this.k*e,this.x,this.y)},translate:function(e,n){return 0===e&0===n?this:new _e(this.k,this.x+this.k*e,this.y+this.k*n)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Wa=new _e(1,0,0);function Wr(e){e.stopImmediatePropagation()}function Hi(e){e.preventDefault(),e.stopImmediatePropagation()}function Kd(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function th(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Kl(){return this.__zoom||Wa}function eh(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function ih(){return navigator.maxTouchPoints||"ontouchstart"in this}function nh(e,n,o){var r=e.invertX(n[0][0])-o[0][0],c=e.invertX(n[1][0])-o[1][0],u=e.invertY(n[0][1])-o[0][1],d=e.invertY(n[1][1])-o[1][1];return e.translate(c>r?(r+c)/2:Math.min(0,r)||Math.max(0,c),d>u?(u+d)/2:Math.min(0,u)||Math.max(0,d))}const Nr=e=>()=>e;function sh(e,{sourceEvent:n,target:o,selection:r,mode:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function oh(e){e.stopImmediatePropagation()}function Vr(e){e.preventDefault(),e.stopImmediatePropagation()}var tc={name:"drag"},Er={name:"space"},ci={name:"handle"},ui={name:"center"};const{abs:ec,max:Wt,min:Nt}=Math;function ic(e){return[+e[0],+e[1]]}function qr(e){return[ic(e[0]),ic(e[1])]}var Na={name:"x",handles:["w","e"].map($i),input:function(e,n){return null==e?null:[[+e[0],n[0][1]],[+e[1],n[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},Va={name:"y",handles:["n","s"].map($i),input:function(e,n){return null==e?null:[[n[0][0],+e[0]],[n[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},pe=(["n","w","e","s","nw","ne","sw","se"].map($i),{overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"}),nc={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},ac={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},lh={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},ch={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function $i(e){return{type:e}}function uh(e){return!e.ctrlKey&&!e.button}function dh(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function hh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ur(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function _h(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}const gh={line:function Ea(e,n){var o=K(!0),r=null,c=D,u=null;function d(_){var f,m,v,g=(_=zt(_)).length,x=!1;for(null==r&&(u=c(v=Ye())),f=0;f<=g;++f)!(f<g&&o(m=_[f],f,_))===x&&((x=!x)?u.lineStart():u.lineEnd()),x&&u.point(+e(m,f,_),+n(m,f,_));if(v)return u=null,v+""||null}return e="function"==typeof e?e:void 0===e?lt:K(e),n="function"==typeof n?n:void 0===n?mt:K(n),d.x=function(_){return arguments.length?(e="function"==typeof _?_:K(+_),d):e},d.y=function(_){return arguments.length?(n="function"==typeof _?_:K(+_),d):n},d.defined=function(_){return arguments.length?(o="function"==typeof _?_:K(!!_),d):o},d.curve=function(_){return arguments.length?(c=_,null!=r&&(u=c(r)),d):c},d.context=function(_){return arguments.length?(null==_?r=u=null:u=c(r=_),d):r},d},pie:function Ya(){var e=Ua,n=qa,o=null,r=K(0),c=K(Qe),u=K(0);function d(_){var f,m,x,Z,E,g=(_=zt(_)).length,v=0,T=new Array(g),V=new Array(g),X=+r.apply(this,arguments),C=Math.min(Qe,Math.max(-Qe,c.apply(this,arguments)-X)),W=Math.min(Math.abs(C)/g,u.apply(this,arguments)),I=W*(C<0?-1:1);for(f=0;f<g;++f)(E=V[T[f]=f]=+e(_[f],f,_))>0&&(v+=E);for(null!=n?T.sort(function(k,O){return n(V[k],V[O])}):null!=o&&T.sort(function(k,O){return o(_[k],_[O])}),f=0,x=v?(C-g*I)/v:0;f<g;++f,X=Z)V[m=T[f]]={data:_[m],index:f,value:E=V[m],startAngle:X,endAngle:Z=X+(E>0?E*x:0)+I,padAngle:W};return V}return d.value=function(_){return arguments.length?(e="function"==typeof _?_:K(+_),d):e},d.sortValues=function(_){return arguments.length?(n=_,o=null,d):n},d.sort=function(_){return arguments.length?(o=_,n=null,d):o},d.startAngle=function(_){return arguments.length?(r="function"==typeof _?_:K(+_),d):r},d.endAngle=function(_){return arguments.length?(c="function"==typeof _?_:K(+_),d):c},d.padAngle=function(_){return arguments.length?(u="function"==typeof _?_:K(+_),d):u},d},arc:function za(){var e=Pa,n=Qa,o=K(0),r=null,c=Ja,u=Fa,d=ja,_=null;function f(){var g,m,x=+e.apply(this,arguments),v=+n.apply(this,arguments),T=c.apply(this,arguments)-Pe,V=u.apply(this,arguments)-Pe,X=Bi(V-T),C=V>T;if(_||(_=g=Ye()),v<x&&(m=v,v=x,x=m),v>Ot)if(X>Qe-Ot)_.moveTo(v*ie(T),v*Qt(T)),_.arc(0,0,v,T,V,!C),x>Ot&&(_.moveTo(x*ie(V),x*Qt(V)),_.arc(0,0,x,V,T,C));else{var Q,j,Z=T,W=V,I=T,E=V,k=X,O=X,tt=d.apply(this,arguments)/2,ot=tt>Ot&&(r?+r.apply(this,arguments):fe(x*x+v*v)),ut=F(Bi(v-x)/2,+o.apply(this,arguments)),nt=ut,Y=ut;if(ot>Ot){var y=Ki(ot/x*Qt(tt)),U=Ki(ot/v*Qt(tt));(k-=2*y)>Ot?(I+=y*=C?1:-1,E-=y):(k=0,I=E=(T+V)/2),(O-=2*U)>Ot?(Z+=U*=C?1:-1,W-=U):(O=0,Z=W=(T+V)/2)}var M=v*ie(Z),N=v*Qt(Z),G=x*ie(E),J=x*Qt(E);if(ut>Ot){var _t,H=v*ie(W),et=v*Qt(W),st=x*ie(I),Mt=x*Qt(I);if(X<Ze&&(_t=Ra(M,N,st,Mt,H,et,G,J))){var bt=M-_t[0],It=N-_t[1],gt=H-_t[0],wt=et-_t[1],P=1/Qt(La((bt*gt+It*wt)/(fe(bt*bt+It*It)*fe(gt*gt+wt*wt)))/2),rt=fe(_t[0]*_t[0]+_t[1]*_t[1]);nt=F(ut,(x-rt)/(P-1)),Y=F(ut,(v-rt)/(P+1))}}O>Ot?Y>Ot?(Q=Je(st,Mt,M,N,v,Y,C),j=Je(H,et,G,J,v,Y,C),_.moveTo(Q.cx+Q.x01,Q.cy+Q.y01),Y<ut?_.arc(Q.cx,Q.cy,Y,ft(Q.y01,Q.x01),ft(j.y01,j.x01),!C):(_.arc(Q.cx,Q.cy,Y,ft(Q.y01,Q.x01),ft(Q.y11,Q.x11),!C),_.arc(0,0,v,ft(Q.cy+Q.y11,Q.cx+Q.x11),ft(j.cy+j.y11,j.cx+j.x11),!C),_.arc(j.cx,j.cy,Y,ft(j.y11,j.x11),ft(j.y01,j.x01),!C))):(_.moveTo(M,N),_.arc(0,0,v,Z,W,!C)):_.moveTo(M,N),x>Ot&&k>Ot?nt>Ot?(Q=Je(G,J,H,et,x,-nt,C),j=Je(M,N,st,Mt,x,-nt,C),_.lineTo(Q.cx+Q.x01,Q.cy+Q.y01),nt<ut?_.arc(Q.cx,Q.cy,nt,ft(Q.y01,Q.x01),ft(j.y01,j.x01),!C):(_.arc(Q.cx,Q.cy,nt,ft(Q.y01,Q.x01),ft(Q.y11,Q.x11),!C),_.arc(0,0,x,ft(Q.cy+Q.y11,Q.cx+Q.x11),ft(j.cy+j.y11,j.cx+j.x11),C),_.arc(j.cx,j.cy,nt,ft(j.y11,j.x11),ft(j.y01,j.x01),!C))):_.arc(0,0,x,E,I,C):_.lineTo(G,J)}else _.moveTo(0,0);if(_.closePath(),g)return _=null,g+""||null}return f.centroid=function(){var g=(+e.apply(this,arguments)+ +n.apply(this,arguments))/2,m=(+c.apply(this,arguments)+ +u.apply(this,arguments))/2-Ze/2;return[ie(m)*g,Qt(m)*g]},f.innerRadius=function(g){return arguments.length?(e="function"==typeof g?g:K(+g),f):e},f.outerRadius=function(g){return arguments.length?(n="function"==typeof g?g:K(+g),f):n},f.cornerRadius=function(g){return arguments.length?(o="function"==typeof g?g:K(+g),f):o},f.padRadius=function(g){return arguments.length?(r=null==g?null:"function"==typeof g?g:K(+g),f):r},f.startAngle=function(g){return arguments.length?(c="function"==typeof g?g:K(+g),f):c},f.endAngle=function(g){return arguments.length?(u="function"==typeof g?g:K(+g),f):u},f.padAngle=function(g){return arguments.length?(d="function"==typeof g?g:K(+g),f):d},f.context=function(g){return arguments.length?(_=null==g?null:g,f):_},f},curveMonotoneX:function Ga(e){return new St(e)},scaleTime:function Lo(){return Be.apply(ea(ls,cs,ne,bi,Ie,Me,xi,vi,ge,Ii).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},scaleLinear:function ua(){var e=ta();return e.copy=function(){return Kn(e,ua())},Be.apply(e,arguments),Bo(e)},scaleBand:function Pi(){var u,d,e=fa().unknown(void 0),n=e.domain,o=e.range,r=0,c=1,_=!1,f=0,g=0,m=.5;function x(){var v=n().length,T=c<r,V=T?c:r,X=T?r:c;u=(X-V)/Math.max(1,v-f+2*g),_&&(u=Math.floor(u)),V+=(X-V-u*(v-f))*m,d=u*(1-f),_&&(V=Math.round(V),d=Math.round(d));var C=Ko(v).map(function(Z){return V+u*Z});return o(T?C.reverse():C)}return delete e.unknown,e.domain=function(v){return arguments.length?(n(v),x()):n()},e.range=function(v){return arguments.length?([r,c]=v,r=+r,c=+c,x()):[r,c]},e.rangeRound=function(v){return[r,c]=v,r=+r,c=+c,_=!0,x()},e.bandwidth=function(){return d},e.step=function(){return u},e.round=function(v){return arguments.length?(_=!!v,x()):_},e.padding=function(v){return arguments.length?(f=Math.min(1,g=+v),x()):f},e.paddingInner=function(v){return arguments.length?(f=Math.min(1,v),x()):f},e.paddingOuter=function(v){return arguments.length?(g=+v,x()):g},e.align=function(v){return arguments.length?(m=Math.max(0,Math.min(1,v)),x()):m},e.copy=function(){return Pi(n(),[r,c]).round(_).paddingInner(f).paddingOuter(g).align(m)},Be.apply(x(),arguments)},axisBottom:function or(e){return ni(3,e)},axisLeft:function rr(e){return ni(4,e)},axisRight:function sr(e){return ni(2,e)},time:z,timeSecond:ge,timeMinute:vi,timeHour:xi,timeDay:Me,timeWeek:Ie,timeMonth:bi,timeYear:ne,selection:t,max:function Zu(e,n){let o;if(void 0===n)for(const r of e)null!=r&&(o<r||void 0===o&&r>=r)&&(o=r);else{let r=-1;for(let c of e)null!=(c=n(c,++r,e))&&(o<c||void 0===o&&c>=c)&&(o=c)}return o},min:function Mu(e,n){let o;if(void 0===n)for(const r of e)null!=r&&(o>r||void 0===o&&r>=r)&&(o=r);else{let r=-1;for(let c of e)null!=(c=n(c,++r,e))&&(o>c||void 0===o&&c>=c)&&(o=c)}return o},bisector:Jt,interpolate:Ee,zoom:function ah(){var m,x,v,e=Kd,n=th,o=nh,r=eh,c=ih,u=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],_=250,f=Vu,g=Tr("start","zoom","end"),T=500,X=0,C=10;function Z(y){y.property("__zoom",Kl).on("wheel.zoom",ot,{passive:!1}).on("mousedown.zoom",ut).on("dblclick.zoom",nt).filter(c).on("touchstart.zoom",Y).on("touchmove.zoom",Q).on("touchend.zoom touchcancel.zoom",j).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function W(y,U){return(U=Math.max(u[0],Math.min(u[1],U)))===y.k?y:new _e(U,y.x,y.y)}function I(y,U,M){var N=U[0]-M[0]*y.k,G=U[1]-M[1]*y.k;return N===y.x&&G===y.y?y:new _e(y.k,N,G)}function E(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function k(y,U,M,N){y.on("start.zoom",function(){O(this,arguments).event(N).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(N).end()}).tween("zoom",function(){var G=this,J=arguments,H=O(G,J).event(N),et=n.apply(G,J),st=null==M?E(et):"function"==typeof M?M.apply(G,J):M,Mt=Math.max(et[1][0]-et[0][0],et[1][1]-et[0][1]),_t=G.__zoom,bt="function"==typeof U?U.apply(G,J):U,It=f(_t.invert(st).concat(Mt/_t.k),bt.invert(st).concat(Mt/bt.k));return function(gt){if(1===gt)gt=bt;else{var wt=It(gt),P=Mt/wt[2];gt=new _e(P,st[0]-wt[0]*P,st[1]-wt[1]*P)}H.zoom(null,gt)}})}function O(y,U,M){return!M&&y.__zooming||new tt(y,U)}function tt(y,U){this.that=y,this.args=U,this.active=0,this.sourceEvent=null,this.extent=n.apply(y,U),this.taps=0}function ot(y,...U){if(e.apply(this,arguments)){var M=O(this,U).event(y),N=this.__zoom,G=Math.max(u[0],Math.min(u[1],N.k*Math.pow(2,r.apply(this,arguments)))),J=Kt(y);if(M.wheel)(M.mouse[0][0]!==J[0]||M.mouse[0][1]!==J[1])&&(M.mouse[1]=N.invert(M.mouse[0]=J)),clearTimeout(M.wheel);else{if(N.k===G)return;M.mouse=[J,N.invert(J)],li(this),M.start()}Hi(y),M.wheel=setTimeout(H,150),M.zoom("mouse",o(I(W(N,G),M.mouse[0],M.mouse[1]),M.extent,d))}function H(){M.wheel=null,M.end()}}function ut(y,...U){if(!v&&e.apply(this,arguments)){var M=y.currentTarget,N=O(this,U,!0).event(y),G=Pt(y.view).on("mousemove.zoom",st,!0).on("mouseup.zoom",Mt,!0),J=Kt(y,M),H=y.clientX,et=y.clientY;ql(y.view),Wr(y),N.mouse=[J,this.__zoom.invert(J)],li(this),N.start()}function st(_t){if(Hi(_t),!N.moved){var bt=_t.clientX-H,It=_t.clientY-et;N.moved=bt*bt+It*It>X}N.event(_t).zoom("mouse",o(I(N.that.__zoom,N.mouse[0]=Kt(_t,M),N.mouse[1]),N.extent,d))}function Mt(_t){G.on("mousemove.zoom mouseup.zoom",null),Ul(_t.view,N.moved),Hi(_t),N.event(_t).end()}}function nt(y,...U){if(e.apply(this,arguments)){var M=this.__zoom,N=Kt(y.changedTouches?y.changedTouches[0]:y,this),G=M.invert(N),J=M.k*(y.shiftKey?.5:2),H=o(I(W(M,J),N,G),n.apply(this,U),d);Hi(y),_>0?Pt(this).transition().duration(_).call(k,H,N,y):Pt(this).call(Z.transform,H,N,y)}}function Y(y,...U){if(e.apply(this,arguments)){var J,H,et,st,M=y.touches,N=M.length,G=O(this,U,y.changedTouches.length===N).event(y);for(Wr(y),H=0;H<N;++H)st=[st=Kt(et=M[H],this),this.__zoom.invert(st),et.identifier],G.touch0?!G.touch1&&G.touch0[2]!==st[2]&&(G.touch1=st,G.taps=0):(G.touch0=st,J=!0,G.taps=1+!!m);m&&(m=clearTimeout(m)),J&&(G.taps<2&&(x=st[0],m=setTimeout(function(){m=null},T)),li(this),G.start())}}function Q(y,...U){if(this.__zooming){var J,H,et,st,M=O(this,U).event(y),N=y.changedTouches,G=N.length;for(Hi(y),J=0;J<G;++J)et=Kt(H=N[J],this),M.touch0&&M.touch0[2]===H.identifier?M.touch0[0]=et:M.touch1&&M.touch1[2]===H.identifier&&(M.touch1[0]=et);if(H=M.that.__zoom,M.touch1){var Mt=M.touch0[0],_t=M.touch0[1],bt=M.touch1[0],It=M.touch1[1],gt=(gt=bt[0]-Mt[0])*gt+(gt=bt[1]-Mt[1])*gt,wt=(wt=It[0]-_t[0])*wt+(wt=It[1]-_t[1])*wt;H=W(H,Math.sqrt(gt/wt)),et=[(Mt[0]+bt[0])/2,(Mt[1]+bt[1])/2],st=[(_t[0]+It[0])/2,(_t[1]+It[1])/2]}else{if(!M.touch0)return;et=M.touch0[0],st=M.touch0[1]}M.zoom("touch",o(I(H,et,st),M.extent,d))}}function j(y,...U){if(this.__zooming){var J,H,M=O(this,U).event(y),N=y.changedTouches,G=N.length;for(Wr(y),v&&clearTimeout(v),v=setTimeout(function(){v=null},T),J=0;J<G;++J)H=N[J],M.touch0&&M.touch0[2]===H.identifier?delete M.touch0:M.touch1&&M.touch1[2]===H.identifier&&delete M.touch1;if(M.touch1&&!M.touch0&&(M.touch0=M.touch1,delete M.touch1),M.touch0)M.touch0[1]=this.__zoom.invert(M.touch0[0]);else if(M.end(),2===M.taps&&(H=Kt(H,this),Math.hypot(x[0]-H[0],x[1]-H[1])<C)){var et=Pt(this).on("dblclick.zoom");et&&et.apply(this,arguments)}}}return Z.transform=function(y,U,M,N){var G=y.selection?y.selection():y;G.property("__zoom",Kl),y!==G?k(y,U,M,N):G.interrupt().each(function(){O(this,arguments).event(N).start().zoom(null,"function"==typeof U?U.apply(this,arguments):U).end()})},Z.scaleBy=function(y,U,M,N){Z.scaleTo(y,function(){var G=this.__zoom.k,J="function"==typeof U?U.apply(this,arguments):U;return G*J},M,N)},Z.scaleTo=function(y,U,M,N){Z.transform(y,function(){var G=n.apply(this,arguments),J=this.__zoom,H=null==M?E(G):"function"==typeof M?M.apply(this,arguments):M,et=J.invert(H),st="function"==typeof U?U.apply(this,arguments):U;return o(I(W(J,st),H,et),G,d)},M,N)},Z.translateBy=function(y,U,M,N){Z.transform(y,function(){return o(this.__zoom.translate("function"==typeof U?U.apply(this,arguments):U,"function"==typeof M?M.apply(this,arguments):M),n.apply(this,arguments),d)},null,N)},Z.translateTo=function(y,U,M,N,G){Z.transform(y,function(){var J=n.apply(this,arguments),H=this.__zoom,et=null==N?E(J):"function"==typeof N?N.apply(this,arguments):N;return o(Wa.translate(et[0],et[1]).scale(H.k).translate("function"==typeof U?-U.apply(this,arguments):-U,"function"==typeof M?-M.apply(this,arguments):-M),J,d)},N,G)},tt.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,U){return this.mouse&&"mouse"!==y&&(this.mouse[1]=U.invert(this.mouse[0])),this.touch0&&"touch"!==y&&(this.touch0[1]=U.invert(this.touch0[0])),this.touch1&&"touch"!==y&&(this.touch1[1]=U.invert(this.touch1[0])),this.that.__zoom=U,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var U=Pt(this.that).datum();g.call(y,this.that,new Xd(y,{sourceEvent:this.sourceEvent,target:Z,type:y,transform:this.that.__zoom,dispatch:g}),U)}},Z.wheelDelta=function(y){return arguments.length?(r="function"==typeof y?y:Oa(+y),Z):r},Z.filter=function(y){return arguments.length?(e="function"==typeof y?y:Oa(!!y),Z):e},Z.touchable=function(y){return arguments.length?(c="function"==typeof y?y:Oa(!!y),Z):c},Z.extent=function(y){return arguments.length?(n="function"==typeof y?y:Oa([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),Z):n},Z.scaleExtent=function(y){return arguments.length?(u[0]=+y[0],u[1]=+y[1],Z):[u[0],u[1]]},Z.translateExtent=function(y){return arguments.length?(d[0][0]=+y[0][0],d[1][0]=+y[1][0],d[0][1]=+y[0][1],d[1][1]=+y[1][1],Z):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},Z.constrain=function(y){return arguments.length?(o=y,Z):o},Z.duration=function(y){return arguments.length?(_=+y,Z):_},Z.interpolate=function(y){return arguments.length?(f=y,Z):f},Z.on=function(){var y=g.on.apply(g,arguments);return y===g?Z:y},Z.clickDistance=function(y){return arguments.length?(X=(y=+y)*y,Z):Math.sqrt(X)},Z.tapDistance=function(y){return arguments.length?(C=+y,Z):C},Z},zoomIdentity:Wa,brushX:function fh(){return function kr(e){var _,n=dh,o=uh,r=hh,c=!0,u=Tr("start","brush","end"),d=6;function f(C){var Z=C.property("__brush",X).selectAll(".overlay").data([$i("overlay")]);Z.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",pe.overlay).merge(Z).each(function(){var I=Ur(this).extent;Pt(this).attr("x",I[0][0]).attr("y",I[0][1]).attr("width",I[1][0]-I[0][0]).attr("height",I[1][1]-I[0][1])}),C.selectAll(".selection").data([$i("selection")]).enter().append("rect").attr("class","selection").attr("cursor",pe.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var W=C.selectAll(".handle").data(e.handles,function(I){return I.type});W.exit().remove(),W.enter().append("rect").attr("class",function(I){return"handle handle--"+I.type}).attr("cursor",function(I){return pe[I.type]}),C.each(g).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",v).filter(r).on("touchstart.brush",v).on("touchmove.brush",T).on("touchend.brush touchcancel.brush",V).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(){var C=Pt(this),Z=Ur(this).selection;Z?(C.selectAll(".selection").style("display",null).attr("x",Z[0][0]).attr("y",Z[0][1]).attr("width",Z[1][0]-Z[0][0]).attr("height",Z[1][1]-Z[0][1]),C.selectAll(".handle").style("display",null).attr("x",function(W){return"e"===W.type[W.type.length-1]?Z[1][0]-d/2:Z[0][0]-d/2}).attr("y",function(W){return"s"===W.type[0]?Z[1][1]-d/2:Z[0][1]-d/2}).attr("width",function(W){return"n"===W.type||"s"===W.type?Z[1][0]-Z[0][0]+d:d}).attr("height",function(W){return"e"===W.type||"w"===W.type?Z[1][1]-Z[0][1]+d:d})):C.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function m(C,Z,W){var I=C.__brush.emitter;return!I||W&&I.clean?new x(C,Z,W):I}function x(C,Z,W){this.that=C,this.args=Z,this.state=C.__brush,this.active=0,this.clean=W}function v(C){if((!_||C.touches)&&o.apply(this,arguments)){var nt,Y,j,y,M,N,J,H,Mt,bt,It,Z=this,W=C.target.__data__.type,I="selection"===(c&&C.metaKey?W="overlay":W)?tc:c&&C.altKey?ui:ci,E=e===Va?null:lh[W],k=e===Na?null:ch[W],O=Ur(Z),tt=O.extent,ot=O.selection,ut=tt[0][0],Q=tt[0][1],U=tt[1][0],G=tt[1][1],et=0,st=0,_t=E&&k&&c&&C.shiftKey,gt=Array.from(C.touches||[C],it=>{const Tt=it.identifier;return(it=Kt(it,Z)).point0=it.slice(),it.identifier=Tt,it});li(Z);var wt=m(Z,arguments,!0).beforestart();if("overlay"===W){ot&&(Mt=!0);const it=[gt[0],gt[1]||gt[0]];O.selection=ot=[[nt=e===Va?ut:Nt(it[0][0],it[1][0]),j=e===Na?Q:Nt(it[0][1],it[1][1])],[M=e===Va?U:Wt(it[0][0],it[1][0]),J=e===Na?G:Wt(it[0][1],it[1][1])]],gt.length>1&&yt(C)}else nt=ot[0][0],j=ot[0][1],M=ot[1][0],J=ot[1][1];Y=nt,y=j,N=M,H=J;var P=Pt(Z).attr("pointer-events","none"),rt=P.selectAll(".overlay").attr("cursor",pe[W]);if(C.touches)wt.moved=S,wt.ended=vt;else{var dt=Pt(C.view).on("mousemove.brush",S,!0).on("mouseup.brush",vt,!0);c&&dt.on("keydown.brush",Ut,!0).on("keyup.brush",kt,!0),ql(C.view)}g.call(Z),wt.start(C,I.name)}function S(it){for(const Tt of it.changedTouches||[it])for(const Xi of gt)Xi.identifier===Tt.identifier&&(Xi.cur=Kt(Tt,Z));if(_t&&!bt&&!It&&1===gt.length){const Tt=gt[0];ec(Tt.cur[0]-Tt[0])>ec(Tt.cur[1]-Tt[1])?It=!0:bt=!0}for(const Tt of gt)Tt.cur&&(Tt[0]=Tt.cur[0],Tt[1]=Tt.cur[1]);Mt=!0,Vr(it),yt(it)}function yt(it){const Tt=gt[0],Xi=Tt.point0;var Ae;switch(et=Tt[0]-Xi[0],st=Tt[1]-Xi[1],I){case Er:case tc:E&&(et=Wt(ut-nt,Nt(U-M,et)),Y=nt+et,N=M+et),k&&(st=Wt(Q-j,Nt(G-J,st)),y=j+st,H=J+st);break;case ci:gt[1]?(E&&(Y=Wt(ut,Nt(U,gt[0][0])),N=Wt(ut,Nt(U,gt[1][0])),E=1),k&&(y=Wt(Q,Nt(G,gt[0][1])),H=Wt(Q,Nt(G,gt[1][1])),k=1)):(E<0?(et=Wt(ut-nt,Nt(U-nt,et)),Y=nt+et,N=M):E>0&&(et=Wt(ut-M,Nt(U-M,et)),Y=nt,N=M+et),k<0?(st=Wt(Q-j,Nt(G-j,st)),y=j+st,H=J):k>0&&(st=Wt(Q-J,Nt(G-J,st)),y=j,H=J+st));break;case ui:E&&(Y=Wt(ut,Nt(U,nt-et*E)),N=Wt(ut,Nt(U,M+et*E))),k&&(y=Wt(Q,Nt(G,j-st*k)),H=Wt(Q,Nt(G,J+st*k)))}N<Y&&(E*=-1,Ae=nt,nt=M,M=Ae,Ae=Y,Y=N,N=Ae,W in nc&&rt.attr("cursor",pe[W=nc[W]])),H<y&&(k*=-1,Ae=j,j=J,J=Ae,Ae=y,y=H,H=Ae,W in ac&&rt.attr("cursor",pe[W=ac[W]])),O.selection&&(ot=O.selection),bt&&(Y=ot[0][0],N=ot[1][0]),It&&(y=ot[0][1],H=ot[1][1]),(ot[0][0]!==Y||ot[0][1]!==y||ot[1][0]!==N||ot[1][1]!==H)&&(O.selection=[[Y,y],[N,H]],g.call(Z),wt.brush(it,I.name))}function vt(it){if(oh(it),it.touches){if(it.touches.length)return;_&&clearTimeout(_),_=setTimeout(function(){_=null},500)}else Ul(it.view,Mt),dt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);P.attr("pointer-events","all"),rt.attr("cursor",pe.overlay),O.selection&&(ot=O.selection),_h(ot)&&(O.selection=null,g.call(Z)),wt.end(it,I.name)}function Ut(it){switch(it.keyCode){case 16:_t=E&&k;break;case 18:I===ci&&(E&&(M=N-et*E,nt=Y+et*E),k&&(J=H-st*k,j=y+st*k),I=ui,yt(it));break;case 32:(I===ci||I===ui)&&(E<0?M=N-et:E>0&&(nt=Y-et),k<0?J=H-st:k>0&&(j=y-st),I=Er,rt.attr("cursor",pe.selection),yt(it));break;default:return}Vr(it)}function kt(it){switch(it.keyCode){case 16:_t&&(bt=It=_t=!1,yt(it));break;case 18:I===ui&&(E<0?M=N:E>0&&(nt=Y),k<0?J=H:k>0&&(j=y),I=ci,yt(it));break;case 32:I===Er&&(it.altKey?(E&&(M=N-et*E,nt=Y+et*E),k&&(J=H-st*k,j=y+st*k),I=ui):(E<0?M=N:E>0&&(nt=Y),k<0?J=H:k>0&&(j=y),I=ci),rt.attr("cursor",pe[W]),yt(it));break;default:return}Vr(it)}}function T(C){m(this,arguments).moved(C)}function V(C){m(this,arguments).ended(C)}function X(){var C=this.__brush||{selection:null};return C.extent=qr(n.apply(this,arguments)),C.dim=e,C}return f.move=function(C,Z,W){C.tween?C.on("start.brush",function(I){m(this,arguments).beforestart().start(I)}).on("interrupt.brush end.brush",function(I){m(this,arguments).end(I)}).tween("brush",function(){var I=this,E=I.__brush,k=m(I,arguments),O=E.selection,tt=e.input("function"==typeof Z?Z.apply(this,arguments):Z,E.extent),ot=Ee(O,tt);function ut(nt){E.selection=1===nt&&null===tt?null:ot(nt),g.call(I),k.brush()}return null!==O&&null!==tt?ut:ut(1)}):C.each(function(){var I=this,E=arguments,k=I.__brush,O=e.input("function"==typeof Z?Z.apply(I,E):Z,k.extent),tt=m(I,E).beforestart();li(I),k.selection=null===O?null:O,g.call(I),tt.start(W).brush(W).end(W)})},f.clear=function(C,Z){f.move(C,null,Z)},x.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(C,Z){return this.starting?(this.starting=!1,this.emit("start",C,Z)):this.emit("brush",C),this},brush:function(C,Z){return this.emit("brush",C,Z),this},end:function(C,Z){return 0==--this.active&&(delete this.state.emitter,this.emit("end",C,Z)),this},emit:function(C,Z,W){var I=Pt(this.that).datum();u.call(C,this.that,new sh(C,{sourceEvent:Z,target:f,selection:e.output(this.state.selection),mode:W,dispatch:u}),I)}},f.extent=function(C){return arguments.length?(n="function"==typeof C?C:Nr(qr(C)),f):n},f.filter=function(C){return arguments.length?(o="function"==typeof C?C:Nr(!!C),f):o},f.touchable=function(C){return arguments.length?(r="function"==typeof C?C:Nr(!!C),f):r},f.handleSize=function(C){return arguments.length?(d=+C,f):d},f.keyModifiers=function(C){return arguments.length?(c=!!C,f):c},f.on=function(){var C=u.on.apply(u,arguments);return C===u?f:C},f}(Na)},brushSelection:function ph(e){var n=e.__brush;return n?n.dim.output(n.selection):null}}},1562:(se,Dt,q)=>{q.d(Dt,{M:()=>ba});var z=q(5724),t=q(5e3),R=q(1062),pt=q(520);let B=(()=>{class a{constructor(i){this.http=i}getDashboardConfiguration(i){return this.http.get("api/dashboard/configuration",{params:{type:i}})}setDashboardConfiguration(i){return this.http.put("/api/dashboard/configuration",i,{responseType:"text"})}}return a.\u0275fac=function(i){return new(i||a)(t.LFG(pt.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var at=q(6093),Ct=q(4063),ee=q(408),Ye=q(2966),L=q(9808),zt=q(3677),K=q(4219),xt=q(2683),D=q(5963),lt=q(8505);let mt=(()=>{class a{constructor(i){this.http=i}getTimeVersion(){return this.http.get("api/widgets/time-version")}}return a.\u0275fac=function(i){return new(i||a)(t.LFG(pt.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function Ea(a,h){if(1&a&&(t.TgZ(0,"div",1),t.TgZ(1,"div"),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t._uU(5),t.qZA(),t.TgZ(6,"div"),t.TgZ(7,"span"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._uU(10),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(3),t.hij("",t.lcZ(4,4,"DEVICE_TIME"),":"),t.xp6(2),t.hij(" ",i.deviceTime,""),t.xp6(3),t.hij("",t.lcZ(9,6,"FIRMWARE_VERSION"),":"),t.xp6(2),t.hij(" ",i.version,"")}}let qa=(()=>{class a{constructor(i){this.timeVersionService=i}ngOnInit(){this.timeVersionService.getTimeVersion().subscribe(i=>{this.version=i.version,this.time=i.time,this.deviceTime=new Date(this.time).toLocaleString()}),this.updateDeviceTime()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}updateDeviceTime(){this.subscription=(0,D.H)(1e3,1e3).pipe((0,lt.b)(()=>{this.time+=1e3,this.deviceTime=new Date(this.time).toLocaleString()})).subscribe()}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(mt))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-time-version"]],decls:1,vars:1,consts:[["class","device-info",4,"ngIf"],[1,"device-info"]],template:function(i,s){1&i&&t.YNc(0,Ea,11,8,"div",0),2&i&&t.Q6J("ngIf",s.deviceTime&&s.version)},directives:[L.O5],pipes:[R.X$],styles:[""]}),a})();var Ua=q(6042),Bi=q(2643),ft=q(8868),ie=q(3748);let ka=(()=>{class a{constructor(i){this.http=i}getOnlineEvents(i){return this.http.get("api/widgets/online-events",{params:{nrOfEvents:i}})}}return a.\u0275fac=function(i){return new(i||a)(t.LFG(pt.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var F=q(2364),Qt=q(442),fe=q(283);function Ot(a,h){1&a&&t._UZ(0,"app-loader")}function Ze(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NAME")))}function Pe(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DEVICE")))}function Qe(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MEASURE")))}function La(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TYPE")))}function Ki(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"VALUE")))}function Ya(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DATE_AND_TIME")))}function Pa(a,h){if(1&a&&(t.TgZ(0,"tr",6),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.uIk("colspan",i.item.columns.length),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_EVENTS"))}}function Qa(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.name)}}function Ja(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.hij("",8!==i.event_type&&9!==i.event_type?i.device_name:"-"," ")}}function Fa(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(0!==i.event_type&&4!==i.event_type&&5!==i.event_type&&8!==i.event_type&&9!==i.event_type?t.lcZ(2,1,i.variable):"-")}}function ja(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"valueFromId"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.Dn7(2,1,i.event_type,s.types,"text"))}}function Ra(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(4!==i.event_type&&5!==i.event_type&&8!==i.event_type&&9!==i.event_type?i.value:"-")}}function Je(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toLocaleString"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.timestamp))}}const za=function(a){return{blink:a}};function tn(a,h){if(1&a&&(t.TgZ(0,"tr",7),t.YNc(1,Qa,2,1,"td",1),t.YNc(2,Ja,2,1,"td",1),t.YNc(3,Fa,3,3,"td",1),t.YNc(4,ja,3,5,"td",1),t.YNc(5,Ra,2,1,"td",1),t.YNc(6,Je,3,3,"td",1),t.qZA()),2&a){const i=h.$implicit,s=t.oxw(2);t.Q6J("ngClass",t.VKq(7,za,i.blink)),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("device")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("measure")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("type")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("date"))}}function en(a,h){if(1&a&&(t.TgZ(0,"table",3),t.TgZ(1,"thead"),t.TgZ(2,"tr"),t.YNc(3,Ze,3,3,"th",1),t.YNc(4,Pe,3,3,"th",1),t.YNc(5,Qe,3,3,"th",1),t.YNc(6,La,3,3,"th",1),t.YNc(7,Ki,3,3,"th",1),t.YNc(8,Ya,3,3,"th",1),t.qZA(),t.qZA(),t.TgZ(9,"tbody"),t.YNc(10,Pa,4,4,"tr",4),t.YNc(11,tn,7,9,"tr",5),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("device")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("measure")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("type")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("date")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}let nn=(()=>{class a{constructor(i,s){this.webSocketService=i,this.widgetsService=s,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.types=z.uS,this.widgetsService.getOnlineEvents(this.item.nrOfEvents).subscribe(i=>{this.item.data=i.sort((s,l)=>l.timestamp===s.timestamp?l.id-s.id:l.timestamp-s.timestamp),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({events:!0}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.event&&(this.item.data.push(Object.assign({blink:!0},i.event)),this.item.data=[...this.item.data.sort((s,l)=>l.timestamp===s.timestamp?l.id-s.id:l.timestamp-s.timestamp).slice(0,this.item.nrOfEvents)],this.lastUpdate[i.resolution]=i.timestamp)})}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(ka))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-online-events"]],inputs:{item:"item"},decls:4,vars:5,consts:[[1,"widget-online-events","gridster-item-content"],[4,"ngIf"],["class","widget-table",4,"ngIf"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"empty-row"],[3,"ngClass"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.YNc(2,Ot,1,0,"app-loader",1),t.YNc(3,en,12,8,"table",2),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,3,s.lastUpdate)),t.xp6(2),t.Q6J("ngIf",!s.item.data),t.xp6(1),t.Q6J("ngIf",s.item.data))},directives:[L.O5,ft.R,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg,L.mk],pipes:[L.Ts,R.X$,Qt.h,fe.U],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}"]}),a})(),Vt=(()=>{class a{constructor(i){this.http=i}getValues(i){return this.http.get("api/online-values",{params:{objectIds:i}})}}return a.\u0275fac=function(i){return new(i||a)(t.LFG(pt.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var St=q(7003),$=q(7454);const an=function(a){return{backgroundColor:a}};function Ga(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"span",3),t.NdJ("click",function(){const p=t.CHM(i).$implicit;return t.oxw(2).hide(p)})("mouseenter",function(){const p=t.CHM(i).$implicit;return t.oxw(2).highlight(p)})("mouseleave",function(){const p=t.CHM(i).$implicit;return t.oxw(2).highlight(p,!1)}),t._UZ(1,"span",4),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"translate"),t.ALo(5,"translate"),t.qZA()}if(2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(8,an,i.visible?i.color:null)),t.xp6(1),t.Oqu(t.lcZ(3,2,i.label).length<=30?t.lcZ(4,4,i.label):t.lcZ(5,6,i.label).substr(0,30)+"...")}}function Lr(a,h){if(1&a&&(t.TgZ(0,"div",1),t.YNc(1,Ga,6,10,"span",2),t.qZA()),2&a){const i=t.oxw();t.xp6(1),t.Q6J("ngForOf",i._chartData)}}let oe=(()=>{class a{constructor(i){this.el=i,this.isDashboard=!1,this.hideLegend=!1,this.yAxisMin=null,this.yAxisMax=null,this.chartTooltip=!1,this.isDrawn=!1,this.currentHighlight=null,this.margin={top:5,right:20,bottom:20,left:80},this.setDomains=()=>{if(this.x&&this.y){const s=$.Z.min(this._chartData,w=>$.Z.min(w.data,A=>A.timestamp)),l=$.Z.max(this._chartData,w=>$.Z.max(w.data,A=>A.timestamp));let p,b;this.x.domain([s,l]),this.isDashboard&&null!==this.yAxisMin&&null!==this.yAxisMax?(p=this.yAxisMin,b=this.yAxisMax,p===b&&(b=p+1)):(p=$.Z.min(this._chartData.filter(w=>w.visible),w=>$.Z.min(w.data,A=>A.value)),b=$.Z.max(this._chartData.filter(w=>w.visible),w=>$.Z.max(w.data,A=>A.value))),this.y.domain([p,b]).nice(),isNaN(this.y.domain()[0])&&this.y.domain([0,0])}},this.makeXAxis=()=>$.Z.axisBottom(this.x).ticks(this.maxTicks).tickFormat(s=>$.Z.time.timeFormat("%H:%M:%S")(s)),this.makeYAxis=()=>$.Z.axisLeft(this.y),this.makeXAxisGrid=()=>$.Z.axisBottom(this.x).ticks(this.x.ticks().length).tickSize(-this.height).tickFormat(()=>""),this.makeYAxisGrid=()=>$.Z.axisLeft(this.y).ticks(this.y.ticks().length).tickSize(-this.width).tickFormat(()=>""),this.appendDots=()=>this.lineChartCircles.selectAll(".dot").data(this._chartData).enter().append("g").attr("class","dot").style("opacity",s=>+s.visible).attr("select",s=>"circle_"+s.color).selectAll(".circle").data(s=>s.data.filter(l=>null!==l.value).map(l=>(l.color=s.color,l))).enter().append("circle").style("stroke",s=>s.color).style("fill",s=>s.color).attr("cx",s=>this.x(s.timestamp)).attr("cy",s=>this.y(s.value)).attr("r",4)}set chartData(i){i&&(i.forEach(s=>{s.data.length>10&&(s.data=s.data.slice(-10)),void 0===s.visible&&(s.visible=!0),s.data.forEach(l=>{"-"===l.value&&(l.value=null)})}),this._chartData=i,this.isDrawn?this.svg&&this.redrawChart():setTimeout(()=>{this.drawChart()}),this.isDrawn=!0)}set labelY(i){i=i.length<=30?i:i.substr(0,30)+"...",this.initLabelY=i,this.svg&&this.svg.select(".axis-label").text(i)}get isClassDashboard(){return this.isDashboard}drawChart(){this.isDashboard&&(this.margin={top:20,right:35,bottom:30,left:80}),this.svg=$.Z.selection.select(this.el.nativeElement).select("svg"),this.width=parseInt(this.svg.style("width"),10)-this.margin.left-this.margin.right||0,this.height=parseInt(this.svg.style("height"),10)-this.margin.top-this.margin.bottom||0,this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.maxTicks=this.width<500?Math.floor(this.width/60):10,this.x=$.Z.scaleTime().range([0,this.width]),this.y=$.Z.scaleLinear().range([this.height,0]),this.line=$.Z.line().defined(l=>null!==l.value).curve($.Z.curveMonotoneX).x(l=>this.x(l.timestamp)).y(l=>this.y(l.value));const i=Date.now();this.svg.append("defs").append("clipPath").attr("id","clip"+i).append("rect").attr("width",this.width).attr("height",this.height+5).attr("y",-5),this.svg.append("defs").append("clipPath").attr("id","clipCircle"+i).append("rect").attr("width",this.width+10).attr("height",this.height+20).attr("x",-5).attr("y",-10),this.lineChart=this.svg.append("g").attr("class","chart").attr("transform","translate("+this.margin.left+","+this.margin.top+")").attr("clip-path","url("+window.location.href+"#clip"+i+")"),this.lineChartCircles=this.svg.append("g").attr("class","chart").attr("transform","translate("+this.margin.left+","+this.margin.top+")").attr("clip-path","url("+window.location.href+"#clipCircle"+i+")"),this.setDomains(),this.chartContainer.append("g").attr("class","grid grid-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxisGrid()),this.chartContainer.append("g").attr("class","grid grid-y").call(this.makeYAxisGrid()),this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxis()),this.chartContainer.append("g").attr("class","axis axis-y").call(this.makeYAxis()),this.lineChart.selectAll(".line").data(this._chartData).enter().append("path").attr("class","line").attr("select",l=>"line_"+l.color).attr("d",l=>this.line(l.data)).style("stroke",l=>l.color).style("stroke-width",l=>this.currentHighlight===l.color?2.5:1.5).style("opacity",l=>+l.visible),this.appendDots();let s=-60;this.isDashboard&&(s=-50),this.chartContainer.append("text").attr("class","axis-label").attr("id",`chartYLabel_${this.yAxisId}`).attr("text-anchor","middle").attr("transform","translate("+s+","+this.height/2+")rotate(-90)").text(this.initLabelY)}redrawChart(){this.setDomains(),this.lineChart.selectAll(".line").data(this._chartData).style("stroke",i=>i.color).style("opacity",i=>+i.visible).attr("d",i=>this.line(i.data)),this.lineChartCircles.selectAll(".dot").remove(),this.appendDots(),this.chartContainer.select(".axis-x").call(this.makeXAxis()),this.chartContainer.select(".axis-y").call(this.makeYAxis()),this.chartContainer.select(".grid-x").call(this.makeXAxisGrid()),this.chartContainer.select(".grid-y").call(this.makeYAxisGrid())}hide(i){(!i.visible||i.visible&&this._chartData.filter(s=>s.visible).length>1)&&(i.visible=!i.visible,this.lineChart.selectAll('[select="line_'+i.color+'"]').interrupt().transition().duration(200).style("opacity",+i.visible),this.lineChartCircles.selectAll('[select="circle_'+i.color+'"]').interrupt().transition().duration(200).style("opacity",+i.visible))}highlight(i,s=!0){this.currentHighlight=s?i.color:null,i.visible&&this.lineChart.selectAll('[select="line_'+i.color+'"]').interrupt().transition().duration(200).style("stroke-width",s?2.5:1.5).style("opacity",+i.visible)}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(t.SBq))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-live-line-chart"]],hostVars:2,hostBindings:function(i,s){2&i&&t.ekj("dashboard",s.isClassDashboard)},inputs:{isDashboard:"isDashboard",hideLegend:"hideLegend",yAxisMin:"yAxisMin",yAxisMax:"yAxisMax",yAxisId:"yAxisId",chartData:"chartData",labelY:"labelY"},decls:2,vars:1,consts:[["class","chart-legend",4,"ngIf"],[1,"chart-legend"],[3,"click","mouseenter","mouseleave",4,"ngFor","ngForOf"],[3,"click","mouseenter","mouseleave"],[3,"ngStyle"]],template:function(i,s){1&i&&(t.YNc(0,Lr,2,1,"div",0),t.O4$(),t._UZ(1,"svg")),2&i&&t.Q6J("ngIf",!s.isDashboard&&!s.hideLegend)},directives:[L.O5,L.sg,L.PC],pipes:[R.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),a})();var Jt=q(83),Lt=q(5893);function di(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"app-select",2),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA()}if(2&a){const i=t.oxw();t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function hi(a,h){1&a&&t._UZ(0,"app-loader")}function Ha(a,h){if(1&a&&(t._UZ(0,"app-live-line-chart",13),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("yAxisId",i.widgetId)("chartData",i.item.data)("labelY",t.lcZ(1,6,i.labelY.text)+" "+t.lcZ(2,8,i.labelY.unit))("isDashboard",!0)("yAxisMin","manual"===i.item.yAxis?i.item.yAxisMin:null)("yAxisMax","manual"===i.item.yAxis?i.item.yAxisMax:null)}}const sn=function(a){return{backgroundColor:a}};function _i(a,h){if(1&a&&(t.TgZ(0,"span"),t._UZ(1,"span",14),t._uU(2),t.qZA()),2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,sn,i.color)),t.xp6(1),t.Oqu(i.label)}}function $t(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,Ha,3,10,"app-live-line-chart",10),t.qZA(),t.TgZ(3,"div",11),t.YNc(4,_i,3,4,"span",12),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing),t.xp6(2),t.Q6J("ngForOf",i.item.data)}}function Yt(a,h){1&a&&t._UZ(0,"th")}function Xt(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L1")))}function re(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L2")))}function pi(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L3")))}function on(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"N")))}function fi(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function gi(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function mi(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"toUnit"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,i.key)," ",t.lcZ(3,4,i.unit),"")}}function At(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l1],i.precision))}}function Fe(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l2],i.precision))}}function $a(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l3],i.precision))}}function Yr(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.n],i.precision))}}function rn(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.total],i.precision))}}function ge(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,mi,4,6,"td",4),t.YNc(2,At,3,4,"td",4),t.YNc(3,Fe,3,4,"td",4),t.YNc(4,$a,3,4,"td",4),t.YNc(5,Yr,3,4,"td",4),t.YNc(6,rn,3,4,"td",4),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("n")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total"))}}function Pr(a,h){if(1&a&&(t.TgZ(0,"div",15),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,Yt,1,0,"th",4),t.YNc(5,Xt,3,3,"th",4),t.YNc(6,re,3,3,"th",4),t.YNc(7,pi,3,3,"th",4),t.YNc(8,on,3,3,"th",4),t.YNc(9,fi,3,3,"th",4),t.qZA(),t.qZA(),t.TgZ(10,"tbody"),t.YNc(11,gi,4,4,"tr",16),t.YNc(12,ge,7,6,"tr",12),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("n")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function ln(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let vi=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.translate=l,this.lastUpdate={},this.lastSample={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices()}getInitialSamples(){this.lastSample={},delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{"linear"===this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&("linear"===this.item.display?(this.addDataToChart(i),this.item.data=[...this.item.data]):this.lastSample=Object.assign("Group"!==this.item.device_type?Object.assign({},this.lastSample):{},i.data),this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s=[];i.forEach(A=>s=[...s,...A.samples]);const l=z.dQ["Instantaneous Values"].find(A=>A.key===this.item.value);if(!l)return;const p=this.devices.find(A=>A.object_id===this.item.object_id);let b,w;p&&(b=p.variables.find(A=>[l.l1,l.l2,l.l3].includes(A.variable))),b?(this.item.data=[{label:this.translate.instant("L1"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.l1)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.l1]}))},{label:this.translate.instant("L2"),color:"rgb(203, 103, 69)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.l2)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.l2]}))},{label:this.translate.instant("L3"),color:"rgb(85, 55, 134)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.l3)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.l3]}))}],l.hasOwnProperty("n")&&this.item.data.push({label:this.translate.instant("N"),color:"rgb(50, 154, 93)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.n)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.n]}))})):this.item.data=[{label:this.translate.instant("TOTAL"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.total)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.total]}))}],p&&(w=p.variables.find(A=>[l.l1,l.l2,l.l3,l.n,l.total].includes(A.variable))),this.labelY={text:l?l.key:null,unit:w?w.unit:null}}addDataToChart(i){const s=z.dQ["Instantaneous Values"].find(b=>b.key===this.item.value);if(!s)return;const l=this.devices.find(b=>b.object_id===this.item.object_id);let p;l&&(p=l.variables.find(b=>[s.l1,s.l2,s.l3].includes(b.variable))),p?("-"===i.data[s.l1]&&(i.data[s.l1]=null),"-"===i.data[s.l2]&&(i.data[s.l2]=null),"-"===i.data[s.l3]&&(i.data[s.l3]=null),"-"===i.data[s.n]&&(i.data[s.n]=null),isNaN(i.data[s.l1])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l1]}),isNaN(i.data[s.l2])||this.item.data[1].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l2]}),isNaN(i.data[s.l3])||this.item.data[2].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l3]}),isNaN(i.data[s.n])||this.item.data[3].data.push({timestamp:1e3*i.timestamp,value:i.data[s.n]})):("-"===i.data[s.total]&&(i.data[s.total]=null),isNaN(i.data[s.total])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[s.total]}))}checkWidgetDevices(){const i=[this.item.device_type];"ThirdPartyRTU"===this.item.device_type&&i.push("MeterABB"),this.widgetDevices=this.devices.filter(s=>i.includes(s.device_type)).map(s=>({id:s.object_id,name:s.name})),"linear"===this.item.display?this.checkVariables():this.getInitialSamples()}checkVariables(){this.widgetValues=[];const i=this.devices.find(l=>l.object_id===this.item.object_id);i&&z.dQ["Instantaneous Values"].forEach(l=>{i.variables.find(b=>[l.l1,l.l2,l.l3,l.n,l.total].includes(b.variable))&&this.widgetValues.push({id:l.key,text:l.key})}),this.widgetValues.find(l=>l.id===this.item.value)||(this.item.value=this.widgetValues.length?this.widgetValues[0].id:null),this.getInitialSamples()}deviceChanged(){"linear"===this.item.display?this.checkVariables():this.getInitialSamples()}createTableData(i){this.item.data=[],this.item.value.forEach(s=>{const l=z.dQ["Instantaneous Values"].find(p=>p.key===s);if(l){const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3,l.n,l.total].includes(w.variable))),b&&this.item.data.push(Object.assign(Object.assign({},l),{unit:b.unit||null,precision:b.precision||2}))}}),i.length?i.forEach(s=>{this.lastSample=Object.assign(Object.assign({},this.lastSample),s.samples[s.samples.length-1].data)}):this.lastSample={}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-instantaneous-values-modbus-device"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:9,vars:13,consts:[[1,"widget-instantaneous-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax",4,"ngIf"],[1,"chart-legend-dashboard"],[4,"ngFor","ngForOf"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax"],[3,"ngStyle"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.YNc(4,di,1,5,"app-select",3),t.qZA(),t.YNc(5,hi,1,0,"app-loader",4),t.YNc(6,$t,5,2,"div",5),t.YNc(7,Pr,13,8,"div",6),t.YNc(8,ln,3,3,"div",7),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,11,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("small",!0)("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf","linear"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[St.H,L.O5,ft.R,oe,L.sg,L.PC,F.Om,F.$Z,F.Uo,F._C,F.p0],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();function Qr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",6),t.TgZ(1,"app-select",7),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw();t.xp6(1),t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function cn(a,h){1&a&&t._UZ(0,"app-loader")}function xi(a,h){if(1&a&&(t._UZ(0,"app-live-line-chart",13),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("yAxisId",i.widgetId)("chartData",i.item.data)("labelY",t.lcZ(1,6,i.labelY.text)+" "+t.lcZ(2,8,i.labelY.unit))("isDashboard",!0)("yAxisMin","manual"===i.item.yAxis?i.item.yAxisMin:null)("yAxisMax","manual"===i.item.yAxis?i.item.yAxisMax:null)}}const Jr=function(a){return{backgroundColor:a}};function un(a,h){if(1&a&&(t.TgZ(0,"span"),t._UZ(1,"span",14),t._uU(2),t.qZA()),2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,Jr,i.color)),t.xp6(1),t.Oqu(i.label)}}function Me(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,xi,3,10,"app-live-line-chart",10),t.qZA(),t.TgZ(3,"div",11),t.YNc(4,un,3,4,"span",12),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing),t.xp6(2),t.Q6J("ngForOf",i.item.data)}}function Fr(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MODBUS_ID")))}function le(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NAME")))}function Ie(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij("",t.lcZ(2,1,"AC")," [A]"))}function je(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij("",t.lcZ(2,1,"DC")," [A]"))}function Xa(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij("",t.lcZ(2,1,"TRMS")," [A]"))}function Ba(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij("",t.lcZ(2,1,"ACTIVE_POWER")," [W]"))}function me(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_CURRENT_SENSORS")))}function Ka(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.modbus_id||"-")}}function ts(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.name)}}function jr(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.ac))}}function Rr(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.dc))}}function zr(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.trms))}}function Gr(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.activePowerTotal))}}function Hr(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,Ka,2,1,"td",2),t.YNc(2,ts,2,1,"td",2),t.YNc(3,jr,3,3,"td",2),t.YNc(4,Rr,3,3,"td",2),t.YNc(5,zr,3,3,"td",2),t.YNc(6,Gr,3,3,"td",2),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("modbus_id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("ac")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("dc")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("trms")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("active_power"))}}function $r(a,h){if(1&a&&(t.TgZ(0,"table",15),t.TgZ(1,"thead"),t.TgZ(2,"tr"),t.YNc(3,Fr,3,3,"th",2),t.YNc(4,le,3,3,"th",2),t.YNc(5,Ie,3,3,"th",2),t.YNc(6,je,3,3,"th",2),t.YNc(7,Xa,3,3,"th",2),t.YNc(8,Ba,3,3,"th",2),t.qZA(),t.qZA(),t.TgZ(9,"tbody"),t.YNc(10,me,4,4,"tr",16),t.YNc(11,Hr,7,6,"tr",12),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.item.columns.includes("modbus_id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("ac")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("dc")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("trms")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("active_power")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function Xr(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let dn=(()=>{class a{constructor(i,s){this.webSocketService=i,this.onlineValuesService=s,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.widgetValues=[{id:"currentTrms",text:"TRMS"},{id:"currentAc",text:"AC"},{id:"currentDc",text:"DC"},{id:"activePowerTotal",text:"ACTIVE_POWER"}],this.getInitialSamples()}getInitialSamples(){delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues(this.item.object_id).subscribe(i=>{"linear"===this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:this.item.object_id}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&this.item.object_id.includes(i.object_id)&&("linear"===this.item.display?this.addDataToChart(i):this.updateTableData(i),this.item.data=[...this.item.data],this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s={};i.forEach(l=>s[l.object_id]=[...s[l.object_id]||[],...l.samples]),this.item.data=this.devices.filter(({object_id:l})=>this.item.object_id.indexOf(l)>-1).map(l=>({color:z.vK[l.modbus_id-1],object_id:l.object_id,label:l.name,data:s[l.object_id]?s[l.object_id].filter(p=>p.data.hasOwnProperty(this.item.value)).map(p=>({timestamp:1e3*p.timestamp,value:p.data[this.item.value]})):[]})),this.labelY={text:"activePowerTotal"===this.item.value?"ACTIVE_POWER":this.item.value,unit:"activePowerTotal"===this.item.value?"W":"A"}}addDataToChart(i){if("-"===i.data[this.item.value]&&(i.data[this.item.value]=null),!isNaN(i.data[this.item.value])){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&s.data.push({timestamp:1e3*i.timestamp,value:i.data[this.item.value]})}}createTableData(i){this.item.data=this.devices.filter(({object_id:s})=>this.item.object_id.indexOf(s)>-1).map(s=>({modbus_id:s.modbus_id,object_id:s.object_id,name:s.name})),i.forEach(s=>{this.updateTableData(Object.assign({object_id:s.object_id},s.samples[s.samples.length-1]))})}updateTableData(i){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&(s.ac=i.data.currentAc,s.dc=i.data.currentDc,s.trms=i.data.currentTrms,s.activePowerTotal=i.data.activePowerTotal),this.item.data=[...this.item.data]}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-instantaneous-values-current-sensor"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:7,vars:8,consts:[[1,"widget-instantaneous-values","gridster-item-content"],["class","widget-header-select",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax",4,"ngIf"],[1,"chart-legend-dashboard"],[4,"ngFor","ngForOf"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax"],[3,"ngStyle"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.YNc(2,Qr,2,5,"div",1),t.YNc(3,cn,1,0,"app-loader",2),t.YNc(4,Me,5,2,"div",3),t.YNc(5,$r,12,8,"table",4),t.YNc(6,Xr,3,3,"div",5),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,6,s.lastUpdate)),t.xp6(2),t.Q6J("ngIf","linear"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"linear"===s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[L.O5,St.H,ft.R,oe,L.sg,L.PC,F.Om,F.$Z,F.Uo,F._C,F.p0],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}"]}),a})();var bi=q(6625);function Br(a,h){1&a&&t._UZ(0,"app-loader")}function yi(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MODBUS_ID")))}function ne(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"PORT")))}function Kr(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"PORT_NAME")))}function hn(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DEVICE_TYPE")))}function es(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"ACCESSORY_TYPE")))}function tl(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"STATUS")))}function _n(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"COUNTER")))}function is(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"PULSE_VALUE")))}function el(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"PULSE_UNIT")))}function pn(a,h){1&a&&(t.TgZ(0,"tr",5),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",9),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_IO_MODULES")))}function Ti(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw(2).$implicit;t.xp6(1),t.Oqu(i.modbus_id||"-")}}function il(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.port)}}function ce(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.name)}}function wi(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"valueFromId"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(3);t.xp6(1),t.Oqu(t.xi3(2,1,i.connected_device_type,s.deviceTypes))}}function Re(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"valueFromId"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(3);t.xp6(1),t.Oqu(t.xi3(2,1,i.connected_accessory_type,s.accessoryTypes))}}function ns(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"OPEN")))}function as(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"CLOSE")))}function ve(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1,"-"),t.qZA())}function ss(a,h){if(1&a&&(t.TgZ(0,"td"),t.YNc(1,ns,3,3,"span",1),t.YNc(2,as,3,3,"span",1),t.YNc(3,ve,2,0,"span",1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",0===i.status),t.xp6(1),t.Q6J("ngIf",1===i.status),t.xp6(1),t.Q6J("ngIf","-"===i.status)}}function os(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.counter)}}function nl(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.pulse_value)}}function al(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"valueFromId"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(3);t.xp6(1),t.Oqu(t.xi3(2,1,i.pulse_unit_id,s.pulseUnits))}}const sl=function(a){return{blink:a}};function ol(a,h){if(1&a&&(t.TgZ(0,"tr",7),t.YNc(1,Ti,2,1,"td",1),t.YNc(2,il,2,1,"td",1),t.YNc(3,ce,2,1,"td",1),t.YNc(4,wi,3,4,"td",1),t.YNc(5,Re,3,4,"td",1),t.YNc(6,ss,4,3,"td",1),t.YNc(7,os,2,1,"td",1),t.YNc(8,nl,2,1,"td",1),t.YNc(9,al,3,4,"td",1),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.Q6J("ngClass",t.VKq(10,sl,i.blink)),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("modbus_id")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("port")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("port_name")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("device_type")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("accessory_type")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("status")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("counter")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("pulse_value")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("pulse_unit"))}}function rl(a,h){if(1&a&&(t.ynx(0),t.YNc(1,ol,10,12,"tr",6),t.BQk()),2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngForOf",i.ports)}}function ll(a,h){if(1&a&&(t.TgZ(0,"div"),t.TgZ(1,"table",2),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,yi,3,3,"th",1),t.YNc(5,ne,3,3,"th",1),t.YNc(6,Kr,3,3,"th",1),t.YNc(7,hn,3,3,"th",1),t.YNc(8,es,3,3,"th",1),t.YNc(9,tl,3,3,"th",1),t.YNc(10,_n,3,3,"th",1),t.YNc(11,is,3,3,"th",1),t.YNc(12,el,3,3,"th",1),t.qZA(),t.qZA(),t._UZ(13,"tbody"),t.TgZ(14,"tbody"),t.YNc(15,pn,4,4,"tr",3),t.YNc(16,rl,2,1,"ng-container",4),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("modbus_id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("port")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("port_name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("device_type")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("accessory_type")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("status")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("counter")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("pulse_value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("pulse_unit")),t.xp6(3),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}let cl=(()=>{class a{constructor(i,s){this.webSocketService=i,this.ioModulesService=s,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.getIoModulesConfiguration()}initLiveSamples(){this.webSocketService.addCollectData({object_ids:this.item.object_id}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&this.item.object_id.includes(i.object_id)&&(this.updateTableData(i),this.lastUpdate[i.resolution]=i.timestamp)})}getIoModulesConfiguration(){this.ioModulesService.getIoModulesConfiguration().subscribe(i=>{this.item.data=i.ioModules.filter(s=>this.item.object_id.includes(s.object_id)),this.deviceTypes=i.deviceTypes,this.accessoryTypes=i.accessoryTypes,this.pulseUnits=i.pulseUnits,this.initLiveSamples()},()=>{})}updateTableData(i){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&s.ports.forEach(l=>{l.status=i.data["port"+l.port+"State"],l.counter=5===l.connected_device_type?i.data["port"+l.port+"PulseCounterAccumulated"]:i.data["port"+l.port+"StatusChangeCounter"],l.pulse_value=i.data["port"+l.port+"PulseCounterAccumulatedValue"]})}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(bi.W))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-instantaneous-values-io-module"]],inputs:{item:"item"},decls:4,vars:5,consts:[[1,"widget-instantaneous-values","gridster-item-content"],[4,"ngIf"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"empty-row"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.YNc(2,Br,1,0,"app-loader",1),t.YNc(3,ll,17,11,"div",1),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,3,s.lastUpdate)),t.xp6(2),t.Q6J("ngIf",!s.item.data),t.xp6(1),t.Q6J("ngIf",s.item.data))},directives:[L.O5,ft.R,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg,L.mk],pipes:[L.Ts,R.X$,Qt.h],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}"]}),a})();function fn(a,h){1&a&&t._UZ(0,"app-loader")}function rs(a,h){1&a&&t._UZ(0,"th")}function ul(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function Ci(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.title)}}function xe(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",i.switch?i.value||"-":t.lcZ(2,2,i.value)," ",i.unit,"")}}function dl(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,Ci,2,1,"td",3),t.YNc(2,xe,3,4,"td",3),t.qZA()),2&a){const i=h.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("value")&&i.visible),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("total")&&i.visible)}}function gn(a,h){if(1&a&&(t.TgZ(0,"div",5),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,rs,1,0,"th",3),t.YNc(5,ul,3,3,"th",3),t.qZA(),t.qZA(),t.TgZ(6,"tbody"),t.YNc(7,dl,3,2,"tr",6),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngForOf",i.tabValues)}}let hl=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.translate=s,this.onlineValuesService=l,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices(),this.getInitialSamples()}checkWidgetDevices(){this.widgetDevices=this.devices.filter(i=>i.device_type===this.item.device_type).map(i=>({id:i.object_id,name:i.name})),this.getInitialSamples()}deviceChanged(){this.tabValues=null,this.getInitialSamples()}getInitialSamples(){delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&(this.updateTableData(i),this.lastUpdate[i.resolution]=i.timestamp)})}createTableData(i){this.tabValues=[{title:this.translate.instant("INPUT_VOLTAGE"),variable:"inputVoltage",visible:this.item.value.includes("inputVoltage"),unit:"[V]"},{title:this.translate.instant("SWITCH")+" 1",variable:"switch1",visible:this.item.value.includes("switch1"),switch:!0},{title:this.translate.instant("SWITCH")+" 2",variable:"switch2",visible:this.item.value.includes("switch2"),switch:!0},{title:this.translate.instant("TEMPERATURE")+" 1",variable:"temperature1",visible:this.item.value.includes("temperature1"),unit:"[\xb0C]"},{title:this.translate.instant("TEMPERATURE")+" 2",variable:"temperature2",visible:this.item.value.includes("temperature2"),unit:"[\xb0C]"},{title:this.translate.instant("TEMPERATURE")+" 3",variable:"temperature3",visible:this.item.value.includes("temperature3"),unit:"[\xb0C]"},{title:this.translate.instant("TEMPERATURE")+" 4",variable:"temperature4",visible:this.item.value.includes("temperature4"),unit:"[\xb0C]"}],i.forEach(s=>{this.updateTableData(Object.assign({},s.samples[s.samples.length-1]))})}updateTableData(i){this.tabValues.forEach(s=>{s.value=["switch1","switch2"].includes(s.variable)?this.translate.instant(1===i.data[s.variable]?"OPEN":"CLOSED"):i.data[s.variable]})}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(R.sK),t.Y36(Vt))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-instantaneous-values-ssd-module"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:6,vars:9,consts:[[1,"widget-instantaneous-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"model","showSearch","options","inputId","modelChange","callbackChange"],[4,"ngIf"],["class","widget-table",4,"ngIf"],[1,"widget-table"],[4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.qZA(),t.YNc(4,fn,1,0,"app-loader",3),t.YNc(5,gn,8,3,"div",4),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,7,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf",!s.tabValues),t.xp6(1),t.Q6J("ngIf",s.tabValues))},directives:[St.H,L.O5,ft.R,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}"]}),a})();var _l=q(7484),ls=q(6695);function cs(a,h){1&a&&t._UZ(0,"app-loader")}function Ai(a,h){if(1&a&&(t._UZ(0,"i",19),t.ALo(1,"translate")),2&a){const i=t.oxw(3);t.Q6J("nzTooltipTitle",t.lcZ(1,2,i.circuitBreakerStateTooltip))("ngClass",0===i.item.data[0].circuitBreakerState?"on":"off")}}function Zi(a,h){1&a&&(t.TgZ(0,"div",14),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"MOD_LOCKOUT_STATE")))}function De(a,h){1&a&&(t.TgZ(0,"div",14),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"MOD_DEAD_TIME_STANDBY")))}function mn(a,h){1&a&&(t.TgZ(0,"div",14),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"MOD_MOTOR_FAULT_CONDITION")))}function vn(a,h){1&a&&(t.TgZ(0,"div",14),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"MOD_DEVICE_FAULT_CONDITION")))}function Zt(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1,"-"),t.qZA())}function us(a,h){if(1&a&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&a){const i=t.oxw(4);t.xp6(1),t.Oqu(i.item.data[0].lastTripDateTime)}}function ds(a,h){if(1&a&&(t.TgZ(0,"div",20),t.TgZ(1,"span",21),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,us,2,1,"p",3),t.qZA()),2&a){const i=t.oxw(3);t.xp6(1),t.Q6J("nzTooltipTitle",i.item.data[0].lastTripDateTime),t.xp6(1),t.Oqu(t.lcZ(3,3,"TRIPPED")),t.xp6(2),t.Q6J("ngIf",i.item.data[0].lastTripDateTime)}}function ht(a,h){1&a&&(t.TgZ(0,"div"),t.TgZ(1,"span",22),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"NOT_TRIPPED")))}function hs(a,h){if(1&a&&(t.TgZ(0,"div"),t.TgZ(1,"div",8),t.TgZ(2,"div",9),t.TgZ(3,"span",10),t._uU(4),t.qZA(),t.YNc(5,Ai,2,4,"i",11),t.qZA(),t.TgZ(6,"div",12),t.TgZ(7,"div",13),t.TgZ(8,"p"),t.TgZ(9,"b"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.qZA(),t.TgZ(12,"div",14),t.TgZ(13,"p"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"translate"),t.ALo(19,"translate"),t.qZA(),t.qZA(),t.YNc(20,Zi,4,3,"div",15),t.YNc(21,De,4,3,"div",15),t.YNc(22,mn,4,3,"div",15),t.YNc(23,vn,4,3,"div",15),t.qZA(),t.TgZ(24,"div",16),t.TgZ(25,"p"),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"span"),t._uU(29),t.qZA(),t.qZA(),t.TgZ(30,"div",16),t.TgZ(31,"p"),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"span"),t._uU(35),t.ALo(36,"translate"),t.ALo(37,"translate"),t.qZA(),t.qZA(),t.TgZ(38,"div",16),t.TgZ(39,"p"),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"span"),t._uU(43),t.qZA(),t.qZA(),t.TgZ(44,"div",16),t.TgZ(45,"p"),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.TgZ(48,"span"),t._uU(49),t.qZA(),t.qZA(),t.TgZ(50,"div",16),t.TgZ(51,"p"),t._uU(52),t.ALo(53,"translate"),t.qZA(),t.TgZ(54,"span"),t._uU(55),t.ALo(56,"translate"),t.ALo(57,"translate"),t.ALo(58,"translate"),t.qZA(),t.qZA(),t.TgZ(59,"div",16),t.TgZ(60,"p",17),t.ALo(61,"translate"),t._uU(62),t.ALo(63,"translate"),t.qZA(),t.YNc(64,Zt,2,0,"span",3),t.YNc(65,ds,5,5,"div",18),t.YNc(66,ht,4,3,"div",3),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw(2);t.xp6(4),t.Oqu(i.item.data[0].name),t.xp6(1),t.Q6J("ngIf","-"!==i.item.data[0].circuitBreakerState),t.xp6(5),t.hij("",t.lcZ(11,24,"MOD_DIAGNOSTIC"),":"),t.xp6(4),t.hij("",t.lcZ(15,26,"DEVICE_STATUS"),":"),t.xp6(3),t.Oqu(1===i.item.data[0].deviceStatusActive?t.lcZ(18,28,"ACTIVE"):"-"!==i.item.data[0].deviceStatusActive?t.lcZ(19,30,"INACTIVE"):"-"),t.xp6(3),t.Q6J("ngIf",1===i.item.data[0].deviceInLockoutState),t.xp6(1),t.Q6J("ngIf",1===i.item.data[0].deadTimeDuringStandby),t.xp6(1),t.Q6J("ngIf",1===i.item.data[0].motorFaultCondition),t.xp6(1),t.Q6J("ngIf",1===i.item.data[0].deadTimeDuringStandby),t.xp6(3),t.hij("",t.lcZ(27,32,"POWER_FAIL"),":"),t.xp6(3),t.Oqu(i.item.data[0].powerFailDateTime),t.xp6(3),t.hij("",t.lcZ(33,34,"MOD_INTERNAL_COMMUNICATION"),":"),t.xp6(3),t.hij(" ",0===i.item.data[0].internalCommunicationFailure?t.lcZ(36,36,"NOT_DETECTED"):"-"!==i.item.data[0].internalCommunicationFailure?t.lcZ(37,38,"DETECTED"):"-",""),t.xp6(5),t.hij("",t.lcZ(41,40,"MOD_TOTAL_OPERATION"),":"),t.xp6(3),t.hij(" ",i.item.data[0].totalOperationsNumber,""),t.xp6(3),t.hij("",t.lcZ(47,42,"MOD_CLOSE_OPERATION"),":"),t.xp6(3),t.hij(" ",i.item.data[0].closeOperationsNumber,""),t.xp6(3),t.hij("",t.lcZ(53,44,"MOD_LAST_DEMANDED"),":"),t.xp6(3),t.hij(" ",42405===i.item.data[0].lastCommandIncompletedDueToPowerfail?t.lcZ(56,46,"NONE"):65280===i.item.data[0].lastCommandIncompletedDueToPowerfail?t.lcZ(57,48,"CLOSE"):"-"!==i.item.data[0].lastCommandIncompletedDueToPowerfail?t.lcZ(58,50,"OPENING"):"-",""),t.xp6(5),t.Q6J("nzTooltipTitle",t.lcZ(61,52,"LAST_TRIP_DATE_TIME")),t.xp6(2),t.hij("",t.lcZ(63,54,"TRIP"),":"),t.xp6(2),t.Q6J("ngIf","-"===i.item.data[0].tripped),t.xp6(1),t.Q6J("ngIf",0!==i.item.data[0].tripped&&"-"!==i.item.data[0].tripped),t.xp6(1),t.Q6J("ngIf",0===i.item.data[0].tripped)}}function Se(a,h){1&a&&(t.TgZ(0,"div",23),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"MOD_COMMUNICATION_FAILURE_DETECTED")))}function Oe(a,h){1&a&&(t.TgZ(0,"div",23),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"NO_VALUES")))}function _s(a,h){if(1&a&&(t.TgZ(0,"nz-card",6),t.YNc(1,hs,67,56,"div",3),t.YNc(2,Se,4,3,"div",7),t.YNc(3,Oe,4,3,"div",7),t.qZA()),2&a){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",65280!==i.item.data[0].internalCommunicationFailure&&i.gotSample&&!i.modRemoved),t.xp6(1),t.Q6J("ngIf",i.isFakeMod||65280===i.item.data[0].internalCommunicationFailure||!i.gotSample),t.xp6(1),t.Q6J("ngIf",i.modRemoved)}}let ps=(()=>{class a{constructor(i,s){this.webSocketService=i,this.onlineValuesService=s,this.lastUpdate={},this.clearTable=!1,this.lastSample={}}ngOnInit(){this.gotSample=!1,delete this.item.data,this.checkWidgetDevices(),this.getInitialSamples()}checkWidgetDevices(){this.widgetDevices=this.devices.filter(i=>i.device_type===this.item.device_type).map(i=>({id:i.object_id,name:i.name})),"table"!==this.item.display||this.getInitialSamples()}deviceChanged(){this.clearTable=!1,this.gotSample=!1,this.modRemoved=!1,this.getInitialSamples()}getInitialSamples(){delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.widgetDevices.find(i=>i.id===this.item.object_id)||(this.modRemoved=!0),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&(this.updateTableData(i),"table"!==this.item.display?this.item.data=[...this.item.data]:this.lastSample=Object.assign(Object.assign({},this.lastSample),i.data),this.lastUpdate[i.resolution]=i.timestamp)})}createTableData(i){this.item.data=this.devices.filter(({object_id:s})=>this.item.object_id===s).map(s=>({modbus_id:s.modbus_id,object_id:s.object_id,name:s.name})),this.isFakeMod=!this.item.data.some(s=>s.modbus_id),i.length?i.forEach(s=>{this.updateTableData(Object.assign({object_id:s.object_id,resolution:s.resolution},s.samples[s.samples.length-1]))}):this.clearTableData()}clearTableData(){this.clearTable=!0}getDate(i){let s;try{const l=i.toString(16);s=12!==l.length||"ffffffffffff"===l?"-":new Date(parseInt(String(20)+String(parseInt(l.slice(0,2),10))),parseInt(l.slice(2,4),10)-1,parseInt(l.slice(4,6),10),parseInt(l.slice(6,8),10),parseInt(l.slice(8,10),10),parseInt(l.slice(10,12),10)).toLocaleString()}catch(l){s="-"}return s}updateTableData(i){if(this.gotSample=!0,1===i.resolution){const s=this.item.data.find(p=>p.object_id===i.object_id),l=this.devices.filter(p=>p.object_id===this.item.object_id)[0];s&&(s.modType=l.productTypeIdModAriArh,s.name=l.name,s.deviceStatusActive=i.data.deviceStatusActive,s.enableCommunicationCommands=i.data.internalCommunicationFailure,s.internalCommunicationFailure=i.data.internalCommunicationFailure,s.deviceInLockoutState=i.data.deviceInLockoutState,s.deviceFaultCondition=i.data.deviceFaultCondition,s.motorFaultCondition=i.data.motorFaultCondition,s.deadTimeDuringStandby=i.data.deadTimeDuringStandby,s.powerFailDateTime=this.getDate(i.data.powerFailDateTime),s.totalOperationsNumber=i.data.totalOperationsNumber,s.closeOperationsNumber=i.data.closeOperationsNumber,s.lastCommandIncompletedDueToPowerfail=i.data.lastCommandIncompletedDueToPowerfail,s.lastTripDateTime=this.getDate(i.data.lastTripDateTime),s.circuitBreakerState=i.data.circuitBreakerState,s.tripped=i.data.tripped,this.circuitBreakerStateTooltip=0===s.circuitBreakerState?"CIRCUIT_BREAKER_OPEN":"CIRCUIT_BREAKER_CLOSE"),this.item.data=[...this.item.data.filter(p=>p.object_id===this.item.object_id)]}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-mod-values-module"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:8,vars:9,consts:[[1,"widget-mod-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"model","showSearch","options","inputId","modelChange","callbackChange"],[4,"ngIf"],[1,"nz-container"],["style","width:60%",4,"ngIf"],[2,"width","60%"],["class","dashboard-empty-text",4,"ngIf"],[1,"card-container"],[1,"status"],[1,"name-header"],["nzTooltipPlacement","bottomRight","nz-tooltip","","class","icon_abb_32 icon-abb_power-on-off_32",3,"nzTooltipTitle","ngClass",4,"ngIf"],[1,"infos"],[1,"mod-info-status"],[1,"mod-info-status-item"],["class","mod-info-status-item",4,"ngIf"],[1,"mod-info"],["nzTooltipPlacement","bottomLeft","nz-tooltip","","type","button","nz-button","","nzType","primary",3,"nzTooltipTitle"],["style","display:flex;flex-direction:row;gap:5px; justify-content: center; align-items:center",4,"ngIf"],["nzTooltipPlacement","bottomRight","nz-tooltip","",1,"icon_abb_32","icon-abb_power-on-off_32",3,"nzTooltipTitle","ngClass"],[2,"display","flex","flex-direction","row","gap","5px","justify-content","center","align-items","center"],["nzTooltipPlacement","bottomRight","nz-tooltip","","type","button",1,"trip",2,"background-color","red",3,"nzTooltipTitle"],["type","button",1,"trip",2,"background-color","rgb(12, 169, 25)"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.qZA(),t.YNc(4,cs,1,0,"app-loader",3),t.TgZ(5,"div",4),t.YNc(6,_s,4,3,"nz-card",5),t._UZ(7,"div"),t.qZA(),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,7,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf",!s.item.data),t.xp6(2),t.Q6J("ngIf",!s.isFakeMod&&s.item.data))},directives:[St.H,L.O5,ft.R,_l.bd,ls.SY,L.mk,xt.w],pipes:[L.Ts,R.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}[_nghost-%COMP%]   .dashboard-empty-text[_ngcontent-%COMP%]{position:absolute;left:0;right:0;bottom:0;top:0;margin:0 auto;display:flex;align-items:center;justify-content:center;text-align:center;height:100%}[_nghost-%COMP%]   .nz-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]{position:relative;color:#f03040;display:flex;border-radius:5px;min-width:350px;max-width:350px}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-width:300px}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .on[_ngcontent-%COMP%]{color:#0ca919;font-size:50px}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .off[_ngcontent-%COMP%]{color:#f03040;font-size:50px}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{align-self:end;display:flex;width:100%;justify-content:space-between}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .name-header[_ngcontent-%COMP%]{font-size:30px;font-weight:500}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .trip[_ngcontent-%COMP%]{padding:2px;color:#fff;text-align:center;border:1px solid white;font-size:10px}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .trip.tripped[_ngcontent-%COMP%]{background-color:#f03040}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .trip.not-tripped[_ngcontent-%COMP%]{background-color:#0ca919}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .infos[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:auto}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .infos[_ngcontent-%COMP%]   .mod-info-status[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .infos[_ngcontent-%COMP%]   .mod-info-status[_ngcontent-%COMP%]   .mod-info-status-item[_ngcontent-%COMP%]{display:flex;gap:5px}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .infos[_ngcontent-%COMP%]   .mod-info-status[_ngcontent-%COMP%]   .mod-info-status-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .infos[_ngcontent-%COMP%]   .mod-info[_ngcontent-%COMP%]{padding:7px 5px;display:flex;align-items:center;justify-content:center;border-bottom:1px solid #bababa;justify-content:space-between}[_nghost-%COMP%]   nz-card[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .infos[_ngcontent-%COMP%]   .mod-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:700;margin:0}"]}),a})();function fs(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"app-select",2),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA()}if(2&a){const i=t.oxw();t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function gs(a,h){1&a&&t._UZ(0,"app-loader")}function ms(a,h){if(1&a&&(t._UZ(0,"app-live-line-chart",13),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("chartData",i.item.data)("labelY",t.lcZ(1,5,i.labelY.text)+" "+t.lcZ(2,7,i.labelY.unit))("isDashboard",!0)("yAxisMin","manual"===i.item.yAxis?i.item.yAxisMin:null)("yAxisMax","manual"===i.item.yAxis?i.item.yAxisMax:null)}}const xn=function(a){return{backgroundColor:a}};function bn(a,h){if(1&a&&(t.TgZ(0,"span"),t._UZ(1,"span",14),t._uU(2),t.qZA()),2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,xn,i.color)),t.xp6(1),t.Oqu(i.label)}}function vs(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,ms,3,9,"app-live-line-chart",10),t.qZA(),t.TgZ(3,"div",11),t.YNc(4,bn,3,4,"span",12),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing),t.xp6(2),t.Q6J("ngForOf",i.item.data)}}function xs(a,h){1&a&&t._UZ(0,"th")}function bs(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L1")))}function yn(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L2")))}function ys(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L3")))}function Tn(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function Ts(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function ws(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"toUnit"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,i.key)," ",t.lcZ(3,4,i.unit),"")}}function Cs(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l1],i.precision))}}function As(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l2],i.precision))}}function Zs(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l3],i.precision))}}function Ms(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.total],i.precision))}}function Is(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,ws,4,6,"td",4),t.YNc(2,Cs,3,4,"td",4),t.YNc(3,As,3,4,"td",4),t.YNc(4,Zs,3,4,"td",4),t.YNc(5,Ms,3,4,"td",4),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total"))}}function wn(a,h){if(1&a&&(t.TgZ(0,"div",15),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,xs,1,0,"th",4),t.YNc(5,bs,3,3,"th",4),t.YNc(6,yn,3,3,"th",4),t.YNc(7,ys,3,3,"th",4),t.YNc(8,Tn,3,3,"th",4),t.qZA(),t.qZA(),t.TgZ(9,"tbody"),t.YNc(10,Ts,4,4,"tr",16),t.YNc(11,Is,6,5,"tr",12),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function Ds(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let Ss=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.translate=l,this.lastUpdate={},this.lastSample={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices()}getInitialSamples(){this.lastSample={},delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{"linear"===this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&("linear"===this.item.display?(this.addDataToChart(i),this.item.data=[...this.item.data]):this.lastSample=Object.assign(Object.assign({},this.lastSample),i.data),this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s=[];i.forEach(A=>s=[...s,...A.samples]);const l=z.dQ["Instantaneous Values"].find(A=>A.key===this.item.value);if(!l)return;const p=this.devices.find(A=>A.object_id===this.item.object_id);let b,w;p&&(b=p.variables.find(A=>[l.l1,l.l2,l.l3].includes(A.variable))),this.item.data=b?[{label:this.translate.instant("L1"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.l1)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.l1]}))},{label:this.translate.instant("L2"),color:"rgb(203, 103, 69)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.l2)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.l2]}))},{label:this.translate.instant("L3"),color:"rgb(85, 55, 134)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.l3)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.l3]}))}]:[{label:this.translate.instant("TOTAL"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(A=>A.data.hasOwnProperty(l.total)).map(A=>({timestamp:1e3*A.timestamp,value:A.data[l.total]}))}],p&&(w=p.variables.find(A=>[l.l1,l.l2,l.l3,l.total].includes(A.variable))),this.labelY={text:l?l.key:null,unit:w?w.unit:null}}addDataToChart(i){const s=z.dQ["Instantaneous Values"].find(b=>b.key===this.item.value);if(!s)return;const l=this.devices.find(b=>b.object_id===this.item.object_id);let p;l&&(p=l.variables.find(b=>[s.l1,s.l2,s.l3].includes(b.variable))),p?("-"===i.data[s.l1]&&(i.data[s.l1]=null),"-"===i.data[s.l2]&&(i.data[s.l2]=null),"-"===i.data[s.l3]&&(i.data[s.l3]=null),isNaN(i.data[s.l1])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l1]}),isNaN(i.data[s.l2])||this.item.data[1].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l2]}),isNaN(i.data[s.l3])||this.item.data[2].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l3]})):("-"===i.data[s.total]&&(i.data[s.total]=null),isNaN(i.data[s.total])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[s.total]}))}checkWidgetDevices(){this.widgetDevices=this.devices.filter(i=>i.device_type===this.item.device_type).map(i=>({id:i.object_id,name:i.name})),"linear"===this.item.display?this.checkVariables():this.getInitialSamples()}checkVariables(){this.widgetValues=[];const i=this.devices.find(l=>l.object_id===this.item.object_id);i&&z.dQ["Instantaneous Values"].forEach(l=>{i.variables.find(b=>[l.l1,l.l2,l.l3,l.total].includes(b.variable))&&this.widgetValues.push({id:l.key,text:l.key})}),this.widgetValues.find(l=>l.id===this.item.value)||(this.item.value=this.widgetValues.length?this.widgetValues[0].id:null),this.getInitialSamples()}deviceChanged(){"linear"===this.item.display?this.checkVariables():this.getInitialSamples()}createTableData(i){this.item.data=[],this.item.value.forEach(s=>{const l=z.dQ["Instantaneous Values"].find(p=>p.key===s);if(l){const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3,l.total].includes(w.variable))),this.item.data.push(Object.assign(Object.assign({},l),{unit:b?b.unit:null,precision:b?b.precision:2}))}}),i.length?i.forEach(s=>{this.lastSample=Object.assign(Object.assign({},this.lastSample),s.samples[s.samples.length-1].data)}):this.lastSample={}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-instantaneous-values-wireless-mbus-meters"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:9,vars:13,consts:[[1,"widget-instantaneous-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"chartData","labelY","isDashboard","yAxisMin","yAxisMax",4,"ngIf"],[1,"chart-legend-dashboard"],[4,"ngFor","ngForOf"],[3,"chartData","labelY","isDashboard","yAxisMin","yAxisMax"],[3,"ngStyle"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.YNc(4,fs,1,5,"app-select",3),t.qZA(),t.YNc(5,gs,1,0,"app-loader",4),t.YNc(6,vs,5,2,"div",5),t.YNc(7,wn,12,7,"div",6),t.YNc(8,Ds,3,3,"div",7),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,11,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("small",!0)("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf","linear"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[St.H,L.O5,ft.R,oe,L.sg,L.PC,F.Om,F.$Z,F.Uo,F._C,F.p0],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();function Os(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"app-select",2),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA()}if(2&a){const i=t.oxw();t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function Cn(a,h){1&a&&t._UZ(0,"app-loader")}function Ws(a,h){if(1&a&&(t._UZ(0,"app-live-line-chart",13),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("yAxisId",i.widgetId)("chartData",i.item.data)("labelY",t.lcZ(1,6,i.labelY.text)+" "+t.lcZ(2,8,i.labelY.unit))("isDashboard",!0)("yAxisMin","manual"===i.item.yAxis?i.item.yAxisMin:null)("yAxisMax","manual"===i.item.yAxis?i.item.yAxisMax:null)}}const Ns=function(a){return{backgroundColor:a}};function Vs(a,h){if(1&a&&(t.TgZ(0,"span"),t._UZ(1,"span",14),t._uU(2),t.qZA()),2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,Ns,i.color)),t.xp6(1),t.Oqu(i.label)}}function Es(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,Ws,3,10,"app-live-line-chart",10),t.qZA(),t.TgZ(3,"div",11),t.YNc(4,Vs,3,4,"span",12),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing),t.xp6(2),t.Q6J("ngForOf",i.item.data)}}function qs(a,h){1&a&&t._UZ(0,"th")}function Us(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L1")))}function An(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L2")))}function ks(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L3")))}function Ls(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"N")))}function Ys(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function Ps(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function Qs(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"toUnit"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,i.key)," ",t.lcZ(3,4,i.unit),"")}}function Js(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l1],i.precision))}}function Fs(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l2],i.precision))}}function js(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l3],i.precision))}}function Zn(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.n],i.precision))}}function Rs(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.total],i.precision))}}function zs(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,Qs,4,6,"td",4),t.YNc(2,Js,3,4,"td",4),t.YNc(3,Fs,3,4,"td",4),t.YNc(4,js,3,4,"td",4),t.YNc(5,Zn,3,4,"td",4),t.YNc(6,Rs,3,4,"td",4),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("n")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total"))}}function Gs(a,h){if(1&a&&(t.TgZ(0,"div",15),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,qs,1,0,"th",4),t.YNc(5,Us,3,3,"th",4),t.YNc(6,An,3,3,"th",4),t.YNc(7,ks,3,3,"th",4),t.YNc(8,Ls,3,3,"th",4),t.YNc(9,Ys,3,3,"th",4),t.qZA(),t.qZA(),t.TgZ(10,"tbody"),t.YNc(11,Ps,4,4,"tr",16),t.YNc(12,zs,7,6,"tr",12),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("n")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function Mn(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let Hs=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.translate=l,this.lastUpdate={},this.lastSample={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices()}getInitialSamples(){this.lastSample={},delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{"linear"===this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&("linear"===this.item.display?(this.addDataToChart(i),this.item.data=[...this.item.data]):this.lastSample=Object.assign(Object.assign({},this.lastSample),i.data),this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s=[];i.forEach(w=>s=[...s,...w.samples]);const l=z.dQ["Power Quality Values"].find(w=>w.key===this.item.value);if(!l)return;l.l1||l.l2||l.l3||l.n||!l.total?(this.item.data=[{label:this.translate.instant("L1"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(w=>w.data.hasOwnProperty(l.l1)).map(w=>({timestamp:1e3*w.timestamp,value:w.data[l.l1]}))},{label:this.translate.instant("L2"),color:"rgb(203, 103, 69)",visible:!0,data:s.filter(w=>w.data.hasOwnProperty(l.l2)).map(w=>({timestamp:1e3*w.timestamp,value:w.data[l.l2]}))},{label:this.translate.instant("L3"),color:"rgb(85, 55, 134)",visible:!0,data:s.filter(w=>w.data.hasOwnProperty(l.l3)).map(w=>({timestamp:1e3*w.timestamp,value:w.data[l.l3]}))}],l.hasOwnProperty("n")&&this.item.data.push({label:this.translate.instant("N"),color:"rgb(50, 154, 93)",visible:!0,data:s.filter(w=>w.data.hasOwnProperty(l.n)).map(w=>({timestamp:1e3*w.timestamp,value:w.data[l.n]}))})):this.item.data=[{label:this.translate.instant("TOTAL"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(w=>w.data.hasOwnProperty(l.total)).map(w=>({timestamp:1e3*w.timestamp,value:w.data[l.total]}))}];const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3,l.n,l.total].includes(w.variable))),this.labelY={text:l?l.key:null,unit:b?b.unit:null}}addDataToChart(i){const s=z.dQ["Power Quality Values"].find(l=>l.key===this.item.value);!s||("-"===i.data[s.l1]&&(i.data[s.l1]=null),"-"===i.data[s.l2]&&(i.data[s.l2]=null),"-"===i.data[s.l3]&&(i.data[s.l3]=null),"-"===i.data[s.n]&&(i.data[s.n]=null),isNaN(i.data[s.l1])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l1]}),isNaN(i.data[s.l2])||this.item.data[1].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l2]}),isNaN(i.data[s.l3])||this.item.data[2].data.push({timestamp:1e3*i.timestamp,value:i.data[s.l3]}),isNaN(i.data[s.n])||this.item.data[3].data.push({timestamp:1e3*i.timestamp,value:i.data[s.n]}),!s.l1&&!s.l2&&!s.l3&&!s.n&&s.total&&("-"===i.data[s.total]&&(i.data[s.total]=null),isNaN(i.data[s.total])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[s.total]})))}checkWidgetDevices(){const i=[this.item.device_type];"ThirdPartyRTU"===this.item.device_type&&i.push("MeterABB"),this.widgetDevices=this.devices.filter(s=>i.includes(s.device_type)).map(s=>({id:s.object_id,name:s.name})),"linear"===this.item.display?this.checkVariables():this.getInitialSamples()}checkVariables(){this.widgetValues=[];const i=this.devices.find(l=>l.object_id===this.item.object_id);i&&z.dQ["Power Quality Values"].forEach(l=>{i.variables.find(b=>[l.l1,l.l2,l.l3,l.n,l.total].includes(b.variable))&&this.widgetValues.push({id:l.key,text:l.key})}),this.widgetValues.find(l=>l.id===this.item.value)||(this.item.value=this.widgetValues.length?this.widgetValues[0].id:null),this.getInitialSamples()}deviceChanged(){"linear"===this.item.display?this.checkVariables():this.getInitialSamples()}createTableData(i){this.item.data=[],this.item.value.forEach(s=>{const l=z.dQ["Power Quality Values"].find(p=>p.key===s);if(l){const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3,l.n,l.total].includes(w.variable))),b&&this.item.data.push(Object.assign(Object.assign({},l),{unit:b.unit||null,precision:b.precision||2}))}}),i.length?i.forEach(s=>{this.lastSample=Object.assign(Object.assign({},this.lastSample),s.samples[s.samples.length-1].data)}):this.lastSample={}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-power-quality-values-modbus-device"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:9,vars:13,consts:[[1,"widget-power-quality-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax",4,"ngIf"],[1,"chart-legend-dashboard"],[4,"ngFor","ngForOf"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax"],[3,"ngStyle"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.YNc(4,Os,1,5,"app-select",3),t.qZA(),t.YNc(5,Cn,1,0,"app-loader",4),t.YNc(6,Es,5,2,"div",5),t.YNc(7,Gs,13,8,"div",6),t.YNc(8,Mn,3,3,"div",7),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,11,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("small",!0)("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf","linear"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[St.H,L.O5,ft.R,oe,L.sg,L.PC,F.Om,F.$Z,F.Uo,F._C,F.p0],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();var Mi=q(8862),In=q(9137),Dn=q(6531),$s=q(1656);function Xs(a,h){if(1&a&&(t._UZ(0,"div",3),t.ALo(1,"safeHtml")),2&a){const i=t.oxw();t.Udp("left",i.tooltipData?i.tooltipData.left:0,"px")("top",i.tooltipData?i.tooltipData.top:0,"px"),t.Q6J("innerHTML",i.tooltipData?t.lcZ(1,5,i.tooltipData.html):"",t.oJD)}}function Sn(a,h){1&a&&(t.TgZ(0,"p",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_DATA_TO_DISPLAY")))}function Bs(a,h){1&a&&(t.O4$(),t._UZ(0,"svg"))}let ze=(()=>{class a{constructor(i,s,l){this.el=i,this.rescaleEnergyPipe=s,this.calculateUnitPipe=l,this.chartTooltip=!1,this.noData=!1,this.isDrawn=!1,this.animationFinished=!1,this.hideLegend=!0,this.margin={top:0,right:20,bottom:40,left:20},this.midAngle=p=>p.startAngle+(p.endAngle-p.startAngle)/2}set chartData(i){if(i){if(this._chartData=i.filter(({value:s})=>this.isDashboard||s>0),!this._chartData.length||!this._chartData.some(({value:s})=>s>0))return void(this.noData=!0);this.noData=!1,this.isDrawn?this.svg&&this.redrawChart():setTimeout(()=>{this.drawChart()}),this.isDrawn=!0}}set label(i){setTimeout(()=>{this.initLabel=i,$.Z.selection.select(".axis-label").text(i)})}get isClassDashboard(){return this.isDashboard}drawChart(){this.isDashboard&&(this.margin={top:25,right:50,bottom:25,left:50}),this.svg=$.Z.selection.select(this.el.nativeElement).select("svg"),this.width=parseInt(this.svg.style("width"),10)-this.margin.left-this.margin.right;const i=parseInt(this.svg.style("height"),10)-this.margin.top-this.margin.bottom;if(!this.width)return;this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate("+(this.width/2+this.margin.left)+","+(i/2+this.margin.top)+")"),this.labelsContainer=this.svg.append("g").attr("class","labelsContainer").attr("transform","translate("+(this.width/2+this.margin.left)+","+(i/2+this.margin.top)+")"),this.outerRadius=Math.min(this.width,i)/2,this.arc=$.Z.arc().outerRadius(this.outerRadius).innerRadius(.5*this.outerRadius).padAngle(.03),this.outerArc=$.Z.arc().outerRadius(.9*this.outerRadius).innerRadius(.9*this.outerRadius),this.pie=$.Z.pie().value(p=>p.value).sort(null),this.chartContainer.selectAll("path").data(this.pie(this._chartData)).enter().append("path").attr("class","slice").attr("fill",p=>p.data.color).each(function(p){this._current=p}).attr("d",this.arc).interrupt().transition().duration(1e3).attrTween("d",p=>{const b=$.Z.interpolate({startAngle:0,endAngle:0},p);return w=>this.arc(b(w))}).on("end",()=>{this.animationFinished=!0});const s=[],l=this;this.labelsContainer.selectAll("polyline").data(this.pie(this._chartData)).enter().append("polyline").attr("select",p=>"polyline_"+p.data.label).attr("points",function(p,b){const w=l.outerArc.centroid(p);w[0]=l.outerRadius*(l.midAngle(p)>.7853981634&&l.midAngle(p)<Math.PI+.7853981634?1:-1);const A=Math.floor(w[1]);return s.forEach((ct,Rt)=>{A>ct-10&&A<ct+10&&Rt!==b&&(w[1]=A<ct?ct-10:ct+10)}),s[b]=Math.floor(w[1]),[[l.arc.centroid(p)[0],l.arc.centroid(p)[1]],[l.outerArc.centroid(p)[0],s[b]],w]}).each(function(p){180*(p.endAngle-p.startAngle)/Math.PI<1&&$.Z.selection.select(this).attr("display","none")}),this.labelsContainer.selectAll("text").data(this.pie(this._chartData)).enter().append("text").attr("dy",".35em").attr("font-size","12px").attr("transform",function(p,b){const w=l.outerArc.centroid(p);return w[0]=(l.outerRadius+4)*(l.midAngle(p)>.7853981634&&l.midAngle(p)<Math.PI+.7853981634?1:-1),p.transformX=w[0],w[1]=s[b],"translate("+w+")"}).style("text-anchor",p=>this.midAngle(p)>.7853981634&&this.midAngle(p)<Math.PI+.7853981634?"start":"end").each(function(p){180*(p.endAngle-p.startAngle)/Math.PI<1&&$.Z.selection.select(this).attr("display","none")}).text(p=>p.data.hasOwnProperty("unit")?p.data.label+": "+p.value+(p.data.unit?" ["+p.data.unit+"]":""):p.data.label+": "+this.rescaleEnergyPipe.transform(p.value)+" ["+this.calculateUnitPipe.transform(p.value)+"]"),this.labelsContainer.selectAll("text").interrupt().transition().duration(1e3).each(function(p){const b=$.Z.selection.select(this).node().getBoundingClientRect();p.width=b.width,Math}).attr("x",p=>{if(p.transformX>0){const b=p.transformX+p.width,w=(l.width+l.margin.left+l.margin.right-10)/2;if(b>w)return this.labelsContainer.select('[select="polyline_'+p.data.label+'"]').attr("points",function(A){const ct=l.outerArc.centroid(A);return ct[0]=l.outerRadius*(l.midAngle(A)>.7853981634&&l.midAngle(A)<Math.PI+.7853981634?1:-1)-(b-w),[l.arc.centroid(A),l.outerArc.centroid(A),ct]}),-(b-w)}else if(p.transformX<0){const b=p.transformX-p.width,w=(l.width+l.margin.left+l.margin.right-10)/2;if(-b>w)return this.labelsContainer.select('[select="polyline_'+p.data.label+'"]').attr("points",function(A){const ct=l.outerArc.centroid(A);return ct[0]=l.outerRadius*(l.midAngle(A)>.7853981634&&l.midAngle(A)<Math.PI+.7853981634?1:-1)+(-b-w),[l.arc.centroid(A),l.outerArc.centroid(A),ct]}),-b-w}return 0})}redrawChart(){const i=this,s=[];this.animationFinished&&this.chartContainer.selectAll("path.slice").data(this.pie(this._chartData)).attr("fill",l=>l.data.color).interrupt().transition().duration(600).attrTween("d",function(l){this._current=this._current||l;const p=$.Z.interpolate(this._current,l);return this._current=p(0),b=>i.arc(p(b))}),this.labelsContainer.selectAll("polyline").data(this.pie(this._chartData)).interrupt().transition().duration(0).attrTween("points",function(l,p){this._current=this._current||l;const b=$.Z.interpolate(this._current,l);return this._current=b(0),w=>{const A=b(w),ct=i.outerArc.centroid(A);ct[0]=i.outerRadius*(i.midAngle(A)>.7853981634&&i.midAngle(A)<Math.PI+.7853981634?1:-1);const Rt=Math.floor(ct[1]);return s.forEach((Ue,mr)=>{Rt>Ue-10&&Rt<Ue+10&&mr!==p&&(ct[1]=Rt<Ue?Ue-10:Ue+10)}),s[p]=Math.floor(ct[1]),[[i.arc.centroid(A)[0],i.arc.centroid(A)[1]],[i.outerArc.centroid(A)[0],s[p]],ct]}}).each(function(l){const p=$.Z.selection.select(this).node().getBoundingClientRect();l.width=p.width,180*(l.endAngle-l.startAngle)/Math.PI<1?$.Z.selection.select(this).attr("display","none"):$.Z.selection.select(this).attr("display","inline-block")}),this.labelsContainer.selectAll("text").data(this.pie(this._chartData)).interrupt().transition().duration(0).attrTween("transform",function(l,p){this._current=this._current||l;const b=$.Z.interpolate(this._current,l);return this._current=b(0),w=>{const A=b(w),ct=i.outerArc.centroid(A);return ct[0]=(i.outerRadius+4)*(i.midAngle(A)>.7853981634&&i.midAngle(A)<Math.PI+.7853981634?1:-1),ct[1]=s[p],l.labelPosition=s[p],l.transformX=ct[0],!!l.transformX&&"translate("+ct+")"}}).each(function(l){180*(l.endAngle-l.startAngle)/Math.PI<1?$.Z.selection.select(this).attr("display","none"):$.Z.selection.select(this).attr("display","inline-block")}).style("text-anchor",l=>this.midAngle(l)>=.7853981634&&this.midAngle(l)<=Math.PI+.7853981634?"start":"end").text(l=>l.data.hasOwnProperty("unit")?l.data.label+": "+l.value+(l.data.unit?" ["+l.data.unit+"]":""):l.data.label+": "+this.rescaleEnergyPipe.transform(l.value)+" ["+this.calculateUnitPipe.transform(l.value)+"]").on("end",function(l){180*(l.endAngle-l.startAngle)/Math.PI<1?$.Z.selection.select(this).attr("opacity",0):$.Z.selection.select(this).attr("opacity",1);const b=$.Z.selection.select(this).node().getBoundingClientRect();if(l.width=b.width,l.transformX>0){const w=l.transformX+l.width,A=(i.width+i.margin.left+i.margin.right-10)/2;w>A&&i.svg&&(i.labelsContainer.select('[select="polyline_'+l.data.label+'"]').attr("points",function(ct){const Rt=i.outerArc.centroid(ct);return Rt[0]=i.outerRadius*(i.midAngle(ct)>.7853981634&&i.midAngle(ct)<Math.PI+.7853981634?1:-1)-(w-A),[[i.arc.centroid(ct)[0],i.arc.centroid(ct)[1]],[i.outerArc.centroid(ct)[0],l.labelPosition],[Rt[0],l.labelPosition]]}),$.Z.selection.select(this).attr("x",-(w-A)))}else if(l.transformX<0){const w=l.transformX-l.width,A=(i.width+i.margin.left+i.margin.right-10)/2;-w>A&&i.svg&&(i.labelsContainer.select('[select="polyline_'+l.data.label+'"]').attr("points",function(ct){const Rt=i.outerArc.centroid(ct);return Rt[0]=i.outerRadius*(i.midAngle(ct)>.7853981634&&i.midAngle(ct)<Math.PI+.7853981634?1:-1)+(-w-A),[[i.arc.centroid(ct)[0],i.arc.centroid(ct)[1]],[i.outerArc.centroid(ct)[0],l.labelPosition],[Rt[0],l.labelPosition]]}),$.Z.selection.select(this).attr("x",-w-A))}})}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(t.SBq),t.Y36(In._),t.Y36(Dn.L))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-donut-chart"]],hostVars:2,hostBindings:function(i,s){2&i&&t.ekj("dashboard",s.isClassDashboard)},inputs:{isDashboard:"isDashboard",chartData:"chartData",label:"label"},features:[t._Bn([In._,Dn.L])],decls:3,vars:3,consts:[["class","chart-tooltip nowrap",3,"left","top","innerHTML",4,"ngIf"],["class","empty-text",4,"ngIf"],[4,"ngIf"],[1,"chart-tooltip","nowrap",3,"innerHTML"],[1,"empty-text"]],template:function(i,s){1&i&&(t.YNc(0,Xs,2,7,"div",0),t.YNc(1,Sn,3,3,"p",1),t.YNc(2,Bs,1,0,"svg",2)),2&i&&(t.Q6J("ngIf",s.chartTooltip),t.xp6(1),t.Q6J("ngIf",s.noData),t.xp6(1),t.Q6J("ngIf",!s.noData))},directives:[L.O5],pipes:[$s.z,R.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),a})();function Ks(a,h){1&a&&t._UZ(0,"app-loader")}function to(a,h){if(1&a&&t._UZ(0,"app-column-chart",7),2&a){const i=t.oxw(2);t.Q6J("isDashboard",!0)("chartData",i.item.data)}}function eo(a,h){if(1&a&&t._UZ(0,"app-donut-chart",7),2&a){const i=t.oxw(2);t.Q6J("isDashboard",!0)("chartData",i.item.data)}}function io(a,h){if(1&a&&(t.TgZ(0,"div",4),t.TgZ(1,"div",5),t.YNc(2,to,1,2,"app-column-chart",6),t.YNc(3,eo,1,2,"app-donut-chart",6),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing&&"column"===i.item.display),t.xp6(1),t.Q6J("ngIf",!i.item.resizing&&"donut"===i.item.display)}}function no(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MODBUS_ID")))}function ao(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NAME")))}function On(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"span",11),t._uU(4,"[kWh]"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.hij("",t.lcZ(2,1,"ENERGY")," "))}function Wn(a,h){1&a&&(t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",3),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_CURRENT_SENSORS")))}function Nn(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.modbus_id||"-")}}function be(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.name)}}function Ii(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.activeEnergyImportTotal))}}function Vn(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,Nn,2,1,"td",1),t.YNc(2,be,2,1,"td",1),t.YNc(3,Ii,3,3,"td",1),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("modbus_id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("energy"))}}function Di(a,h){if(1&a&&(t.TgZ(0,"table",8),t.TgZ(1,"thead"),t.TgZ(2,"tr"),t.YNc(3,no,3,3,"th",1),t.YNc(4,ao,3,3,"th",1),t.YNc(5,On,5,3,"th",1),t.qZA(),t.qZA(),t.TgZ(6,"tbody"),t.YNc(7,Wn,4,4,"tr",9),t.YNc(8,Vn,4,3,"tr",10),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.item.columns.includes("modbus_id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("energy")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}let Si=(()=>{class a{constructor(i,s){this.webSocketService=i,this.onlineValuesService=s,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.getInitialSamples()}getInitialSamples(){delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues(this.item.object_id).subscribe(i=>{"table"!==this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:this.item.object_id}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&this.item.object_id.includes(i.object_id)&&("table"!==this.item.display?this.addDataToChart(i):this.updateTableData(i),this.item.data=[...this.item.data],this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s={};i.forEach(l=>s[l.object_id]=Object.assign(Object.assign({},s[l.object_id]),l.samples[l.samples.length-1].data)),this.item.data=this.devices.filter(({object_id:l})=>this.item.object_id.indexOf(l)>-1).map(l=>({color:z.vK[l.modbus_id-1],object_id:l.object_id,label:l.name,value:s[l.object_id]&&"-"!==s[l.object_id].activeEnergyImportTotal?s[l.object_id].activeEnergyImportTotal:null,unit:"kWh"}))}addDataToChart(i){if("-"===i.data[this.item.value]&&(i.data[this.item.value]=null),!isNaN(i.data.activeEnergyImportTotal)){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&(s.value=i.data.activeEnergyImportTotal)}}createTableData(i){this.item.data=this.devices.filter(({object_id:s})=>this.item.object_id.indexOf(s)>-1).map(s=>({modbus_id:s.modbus_id,object_id:s.object_id,name:s.name})),i.forEach(s=>{this.updateTableData(Object.assign({object_id:s.object_id},s.samples[s.samples.length-1]))})}updateTableData(i){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&(s.activeEnergyImportTotal=i.data.activeEnergyImportTotal),this.item.data=[...this.item.data]}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-energy-values-current-sensor"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:5,vars:6,consts:[[1,"widget-energy-values","gridster-item-content"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"isDashboard","chartData",4,"ngIf"],[3,"isDashboard","chartData"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"no-transform"],[1,"empty-row"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.YNc(2,Ks,1,0,"app-loader",1),t.YNc(3,io,4,2,"div",2),t.YNc(4,Di,9,5,"table",3),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,4,s.lastUpdate)),t.xp6(2),t.Q6J("ngIf",!s.item.data),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display))},directives:[L.O5,ft.R,Mi.t,ze,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}"]}),a})();function En(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"app-select",2),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA()}if(2&a){const i=t.oxw();t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function so(a,h){1&a&&t._UZ(0,"app-loader")}function pl(a,h){if(1&a&&(t._UZ(0,"app-column-chart",12),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("isDashboard",!0)("labelY",t.lcZ(1,3,i.labelY.text)+" "+t.lcZ(2,5,i.labelY.unit))("chartData",i.item.data)}}function qn(a,h){if(1&a&&t._UZ(0,"app-donut-chart",13),2&a){const i=t.oxw(2);t.Q6J("isDashboard",!0)("chartData",i.item.data)}}function oo(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,pl,3,7,"app-column-chart",10),t.YNc(3,qn,1,2,"app-donut-chart",11),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing&&"column"===i.item.display),t.xp6(1),t.Q6J("ngIf",!i.item.resizing&&"donut"===i.item.display)}}function fl(a,h){1&a&&t._UZ(0,"th")}function gl(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L1")))}function ro(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L2")))}function Oi(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"L3")))}function Un(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function We(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function Ne(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"toUnit"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,i.key)," ",t.lcZ(3,4,i.unit),"")}}function Ge(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l1],i.precision))}}function ye(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l2],i.precision))}}function Ve(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.l3],i.precision))}}function Gt(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.total],i.precision))}}function lo(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,Ne,4,6,"td",4),t.YNc(2,Ge,3,4,"td",4),t.YNc(3,ye,3,4,"td",4),t.YNc(4,Ve,3,4,"td",4),t.YNc(5,Gt,3,4,"td",4),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total"))}}function co(a,h){if(1&a&&(t.TgZ(0,"div",14),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,fl,1,0,"th",4),t.YNc(5,gl,3,3,"th",4),t.YNc(6,ro,3,3,"th",4),t.YNc(7,Oi,3,3,"th",4),t.YNc(8,Un,3,3,"th",4),t.qZA(),t.qZA(),t.TgZ(9,"tbody"),t.YNc(10,We,4,4,"tr",15),t.YNc(11,lo,6,5,"tr",16),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l1")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l2")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("l3")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function uo(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let ho=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.translate=l,this.lastUpdate={},this.lastSample={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices()}getInitialSamples(){this.lastSample={},delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{"table"!==this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&("table"!==this.item.display?(this.addDataToChart(i),this.item.data=[...this.item.data]):this.lastSample=Object.assign("Group"!==this.item.device_type?Object.assign({},this.lastSample):{},i.data),this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s={};i.forEach(w=>s=Object.assign(Object.assign({},s),w.samples[w.samples.length-1].data));const l=z.dQ["Energy Values"].find(w=>w.key===this.item.value);if(!l)return;const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3].includes(w.variable))),this.item.data=[{label:this.translate.instant("L1"),color:"rgb(12, 116, 218)",value:s[l.l1],unit:b?b.unit:null},{label:this.translate.instant("L2"),color:"rgb(203, 103, 69)",value:s[l.l2],unit:b?b.unit:null},{label:this.translate.instant("L3"),color:"rgb(85, 55, 134)",value:s[l.l3],unit:b?b.unit:null}],this.labelY={text:l?l.key:null,unit:b?b.unit:null}}addDataToChart(i){const s=z.dQ["Energy Values"].find(l=>l.key===this.item.value);!s||(isNaN(i.data[s.l1])||(this.item.data[0].value=i.data[s.l1]),isNaN(i.data[s.l2])||(this.item.data[1].value=i.data[s.l2]),isNaN(i.data[s.l3])||(this.item.data[2].value=i.data[s.l3]))}checkWidgetDevices(){const i=[this.item.device_type];"ThirdPartyRTU"===this.item.device_type&&i.push("MeterABB"),this.widgetDevices=this.devices.filter(s=>i.includes(s.device_type)).map(s=>({id:s.object_id,name:s.name})),"table"!==this.item.display?this.checkVariables():this.getInitialSamples()}checkVariables(){this.widgetValues=[];const i=this.devices.find(l=>l.object_id===this.item.object_id);i&&z.dQ["Energy Values"].forEach(l=>{i.variables.find(b=>[l.l1,l.l2,l.l3,l.total].includes(b.variable))&&this.widgetValues.push({id:l.key,text:l.key})}),this.widgetValues.find(l=>l.id===this.item.value)||(this.item.value=this.widgetValues.length?this.widgetValues[0].id:null),this.getInitialSamples()}deviceChanged(){"table"!==this.item.display?this.checkVariables():this.getInitialSamples()}createTableData(i){this.item.data=[],this.item.value.forEach(s=>{const l=z.dQ["Energy Values"].find(p=>p.key===s);if(l){const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3,l.total].includes(w.variable))),b&&this.item.data.push(Object.assign(Object.assign({},l),{unit:b.unit||null,precision:b.precision||2}))}}),i.length?i.forEach(s=>{this.lastSample=Object.assign(Object.assign({},this.lastSample),s.samples[s.samples.length-1].data)}):this.lastSample={}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-energy-values-modbus-device"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:9,vars:13,consts:[[1,"widget-energy-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"isDashboard","labelY","chartData",4,"ngIf"],[3,"isDashboard","chartData",4,"ngIf"],[3,"isDashboard","labelY","chartData"],[3,"isDashboard","chartData"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.YNc(4,En,1,5,"app-select",3),t.qZA(),t.YNc(5,so,1,0,"app-loader",4),t.YNc(6,oo,4,2,"div",5),t.YNc(7,co,12,7,"div",6),t.YNc(8,uo,3,3,"div",7),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,11,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("small",!0)("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf","table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[St.H,L.O5,ft.R,Mi.t,ze,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();function _o(a,h){1&a&&t._UZ(0,"app-loader")}function po(a,h){1&a&&t._UZ(0,"th")}function fo(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function kn(a,h){1&a&&(t.TgZ(0,"tr",9),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",2),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function Ln(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"toUnit"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,i.key)," ",t.lcZ(3,4,i.unit),"")}}function go(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.total],i.precision))}}function Yn(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,Ln,4,6,"td",3),t.YNc(2,go,3,4,"td",3),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total"))}}function ue(a,h){if(1&a&&(t.TgZ(0,"div",6),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,po,1,0,"th",3),t.YNc(5,fo,3,3,"th",3),t.qZA(),t.qZA(),t.TgZ(6,"tbody"),t.YNc(7,kn,4,4,"tr",7),t.YNc(8,Yn,3,2,"tr",8),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function Pn(a,h){1&a&&(t.TgZ(0,"div",10),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let He=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.translate=l,this.lastUpdate={},this.lastSample={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices()}getInitialSamples(){this.lastSample={},delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&(this.lastSample=Object.assign(Object.assign({},this.lastSample),i.data),this.lastUpdate[i.resolution]=i.timestamp)})}checkWidgetDevices(){this.widgetDevices=this.devices.filter(i=>i.device_type===this.item.device_type).map(i=>({id:i.object_id,name:i.name})),this.getInitialSamples()}deviceChanged(){this.getInitialSamples()}createTableData(i){this.item.data=[],this.item.value.forEach(s=>{const l=z.dQ["Energy Values"].find(p=>p.key===s);if(l){const p=this.devices.find(w=>w.object_id===this.item.object_id);let b;p&&(b=p.variables.find(w=>[l.l1,l.l2,l.l3,l.total].includes(w.variable))),this.item.data.push(Object.assign(Object.assign({},l),{unit:b?b.unit:null,precision:b?b.precision:2}))}}),i.length?i.forEach(s=>{this.lastSample=Object.assign(Object.assign({},this.lastSample),s.samples[s.samples.length-1].data)}):this.lastSample={}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-energy-values-wireless-mbus-meters"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:7,vars:11,consts:[[1,"widget-energy-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],[4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.qZA(),t.YNc(4,_o,1,0,"app-loader",3),t.YNc(5,ue,9,4,"div",4),t.YNc(6,Pn,3,3,"div",5),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,9,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("small",!0)("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[St.H,L.O5,ft.R,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();const mo=function(a){return{backgroundColor:a}};function $e(a,h){if(1&a&&(t.TgZ(0,"span"),t._UZ(1,"span",3),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"translate"),t.ALo(5,"translate"),t.qZA()),2&a){const i=h.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(8,mo,i.visible?i.color:null)),t.xp6(1),t.Oqu(t.lcZ(3,2,i.label).length<=30?t.lcZ(4,4,i.label):t.lcZ(5,6,i.label).substr(0,30)+"...")}}function Et(a,h){if(1&a&&(t.TgZ(0,"div",1),t.YNc(1,$e,6,10,"span",2),t.qZA()),2&a){const i=t.oxw();t.xp6(1),t.Q6J("ngForOf",i._chartData)}}let Qn=(()=>{class a{constructor(i){this.el=i,this.isDrawn=!1,this.chartTooltip=!1,this.isDifference=!1,this.hideLegend=!1,this.resolution=9e5,this.margin={top:5,right:20,bottom:20,left:80},this.setDomains=()=>{if(this.x&&this.y){const s=$.Z.max(this._chartData,p=>$.Z.max(p.data,b=>b.timestamp)),l=$.Z.min(this._chartData,p=>$.Z.min(p.data,b=>b.timestamp));this.x.domain([l,s]),this.y.domain([$.Z.min(this._chartData,p=>$.Z.min(p.data,b=>b.value)),$.Z.max(this._chartData,p=>$.Z.max(p.data,b=>b.value))]).nice(),isNaN(this.y.domain()[0])&&this.y.domain([0,0])}},this.makeXAxis=()=>$.Z.axisBottom(this.x).ticks(this.maxTicks).tickFormat(s=>$.Z.time.timeFormat("%H:%M:%S")(s)),this.makeYAxis=()=>$.Z.axisLeft(this.y),this.makeXAxisGrid=()=>$.Z.axisBottom(this.x).ticks(this.x.ticks().length).tickSize(-this.height).tickFormat(()=>""),this.makeYAxisGrid=()=>$.Z.axisLeft(this.y).ticks(this.y.ticks().length).tickSize(-this.width).tickFormat(()=>"")}set chartData(i){i&&(i.forEach(s=>{if(s.data.length>10&&(s.data=s.data.slice(-10)),s.data.forEach(l=>{"-"===l.value&&(l.value=null)}),this.isDifference){const l=[];let p;s.data.forEach((b,w)=>{b.hasOwnProperty("initialValue")||(b.initialValue=b.value),w>0&&l.push(Object.assign(Object.assign({},b),{value:b.initialValue-p})),null!==b.value&&(p=b.initialValue)}),s.data=l}}),this._chartData=i,this.isDrawn?this.svg&&this.redrawChart():setTimeout(()=>{this.drawChart()}),this.isDrawn=!0)}set labelY(i){i=i.length<=30?i:i.substr(0,30)+"...",this.initLabelY=i,this.svg&&this.svg.select(".axis-label").text(i)}drawChart(){this.svg=$.Z.selection.select(this.el.nativeElement).select("svg"),this.width=parseInt(this.svg.style("width"),10)-this.margin.left-this.margin.right||0,this.height=parseInt(this.svg.style("height"),10)-this.margin.top-this.margin.bottom||0,this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.maxTicks=this.width<500?Math.floor(this.width/60):10,this.x=$.Z.scaleTime().range([0,this.width]),this.y=$.Z.scaleLinear().range([this.height,0]);const i=Date.now();this.svg.append("defs").append("clipPath").attr("id","clip"+i).append("rect").attr("width",this.width).attr("height",this.height+5).attr("y",-5),this.columnChart=this.svg.append("g").attr("class","chart").attr("transform","translate("+this.margin.left+","+this.margin.top+")").attr("clip-path","url("+window.location.href+"#clip"+i+")"),this.setDomains(),this.chartContainer.append("g").attr("class","grid grid-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxisGrid()),this.chartContainer.append("g").attr("class","grid grid-y").call(this.makeYAxisGrid()),this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxis()),this.chartContainer.append("g").attr("class","axis axis-y").call(this.makeYAxis());const s=this.x.domain()[1].valueOf()-this.x.domain()[0].valueOf()+this.resolution,l=Math.floor(this.width/(s/this.resolution))||1;this.columnChart.selectAll(".bar").data(this._chartData[0].data).enter().append("rect").attr("class","bar").attr("fill","#0088cc").attr("x",b=>this.x(b.timestamp)-l/2||0).attr("width",l).attr("y",b=>null!==b.value?this.y(b.value)<=this.y(0)?this.y(b.value):this.y(0):null).attr("height",b=>null!==b.value?Math.abs(this.height-this.y(0)>0?this.height-(this.height-this.y(0))-this.y(b.value):this.height-this.y(b.value)):null),this.chartContainer.append("text").attr("class","axis-label").attr("id","chartYLabel").attr("text-anchor","middle").attr("transform","translate(-60,"+this.height/2+")rotate(-90)").text(this.initLabelY)}redrawChart(){this.setDomains();const i=this.x.domain()[1].valueOf()-this.x.domain()[0].valueOf()+this.resolution,s=Math.floor(this.width/(i/this.resolution))||1;this.columnChart.selectAll(".bar").data(this._chartData[0].data).attr("x",l=>this.x(l.timestamp)-s/2||0).attr("width",s).attr("y",l=>null!==l.value?this.y(l.value)<=this.y(0)?this.y(l.value):this.y(0):null).attr("height",l=>null!==l.value?Math.abs(this.height-this.y(0)>0?this.height-(this.height-this.y(0))-this.y(l.value):this.height-this.y(l.value)):null),this.chartContainer.select(".axis-x").call(this.makeXAxis()),this.chartContainer.select(".axis-y").call(this.makeYAxis()),this.chartContainer.select(".grid-x").call(this.makeXAxisGrid()),this.chartContainer.select(".grid-y").call(this.makeYAxisGrid())}highlight(){}hide(){}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(t.SBq))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-live-column-chart"]],inputs:{isDifference:"isDifference",isDashboard:"isDashboard",hideLegend:"hideLegend",resolution:"resolution",chartData:"chartData",labelY:"labelY"},decls:2,vars:1,consts:[["class","chart-legend",4,"ngIf"],[1,"chart-legend"],[4,"ngFor","ngForOf"],[3,"ngStyle"]],template:function(i,s){1&i&&(t.YNc(0,Et,2,1,"div",0),t.O4$(),t._UZ(1,"svg")),2&i&&t.Q6J("ngIf",!s.isDashboard&&!s.hideLegend)},directives:[L.O5,L.sg,L.PC],pipes:[R.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),a})();function Jn(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"app-select",2),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA()}if(2&a){const i=t.oxw();t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function Wi(a,h){1&a&&t._UZ(0,"app-loader")}function Fn(a,h){if(1&a&&(t._UZ(0,"app-live-line-chart",12),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("yAxisId",i.widgetId)("chartData",i.item.data)("labelY",t.lcZ(1,6,i.labelY.text)+" "+t.lcZ(2,8,i.labelY.unit))("isDashboard",!0)("yAxisMin","manual"===i.item.yAxis?i.item.yAxisMin:null)("yAxisMax","manual"===i.item.yAxis?i.item.yAxisMax:null)}}function jn(a,h){if(1&a&&t._UZ(0,"app-live-column-chart",13),2&a){const i=t.oxw(2);t.Q6J("resolution",i.resolution)("isDifference",!0)("chartData",i.item.data)("isDashboard",!0)}}function vo(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,Fn,3,10,"app-live-line-chart",10),t.YNc(3,jn,1,4,"app-live-column-chart",11),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing&&"linear"===i.item.display),t.xp6(1),t.Q6J("ngIf",!i.item.resizing&&"column"===i.item.display)}}function Ht(a,h){1&a&&t._UZ(0,"th")}function Ni(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"TOTAL")))}function Rn(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",2),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function xo(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"toUnit"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,i.key)," ",t.lcZ(3,4,i.unit),"")}}function bo(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,s.lastSample[i.total],i.precision))}}function Vi(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit,s=t.oxw(2);t.xp6(1),t.Oqu(s.lastSample[i.key])}}function zn(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,xo,4,6,"td",4),t.YNc(2,bo,3,4,"td",4),t.YNc(3,Vi,2,1,"td",4),t.qZA()),2&a){const i=h.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("total")&&"string"!==i.dataType),t.xp6(1),t.Q6J("ngIf",s.item.columns.includes("total")&&"string"===i.dataType)}}function yo(a,h){if(1&a&&(t.TgZ(0,"div",14),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.YNc(4,Ht,1,0,"th",4),t.YNc(5,Ni,3,3,"th",4),t.qZA(),t.qZA(),t.TgZ(6,"tbody"),t.YNc(7,Rn,4,4,"tr",15),t.YNc(8,zn,4,3,"tr",16),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(4),t.Q6J("ngIf",i.item.columns.includes("value")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("total")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function ml(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let To=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.translate=l,this.lastUpdate={},this.lastSample={}}ngOnInit(){delete this.item.data,this.checkWidgetDevices()}getInitialSamples(){this.lastSample={},delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues([this.item.object_id]).subscribe(i=>{"table"!==this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:[this.item.object_id]}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&i.object_id===this.item.object_id&&("table"!==this.item.display?(this.addDataToChart(i),this.item.data=[...this.item.data]):this.lastSample=Object.assign(Object.assign({},this.lastSample),i.data),this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s=[];i.forEach(b=>s=[...s,...b.samples]);const l=this.devices.find(b=>b.object_id===this.item.object_id);if(!l)return;const p=l.variables.find(b=>b.variable===this.item.value);!p||(this.item.data=[{label:this.translate.instant("TOTAL"),color:"rgb(12, 116, 218)",visible:!0,data:s.filter(b=>b.data.hasOwnProperty(p.variable)).map(b=>({timestamp:1e3*b.timestamp,value:b.data[p.variable]}))}],this.labelY={text:p?p.variable:null,unit:p?p.unit:null},"linear"===this.item.display&&1===p.cumulative?this.item.display="column":"column"===this.item.display&&0===p.cumulative&&(this.item.display="linear"),"column"===this.item.display&&(this.resolution=1e3*p.readInterval))}addDataToChart(i){const s=this.devices.find(p=>p.object_id===this.item.object_id);if(!s)return;const l=s.variables.find(p=>p.variable===this.item.value);!l||("-"===i.data[l.variable]&&(i.data[l.variable]=null),isNaN(i.data[l.variable])||this.item.data[0].data.push({timestamp:1e3*i.timestamp,value:i.data[l.variable]}))}checkWidgetDevices(){this.widgetDevices=this.devices.filter(i=>i.device_type===this.item.device_type).map(i=>({id:i.object_id,name:i.name})),"table"!==this.item.display?this.checkVariables():this.getInitialSamples()}checkVariables(){this.widgetValues=[];const i=this.devices.find(l=>l.object_id===this.item.object_id);i&&i.variables.forEach(l=>{["Energy Values","Instantaneous Values","Power Quality Values","Maximum Values","Unbalances"].includes(l.category)||this.widgetValues.push({id:l.variable,text:l.variable})}),this.widgetValues.find(l=>l.id===this.item.value)||(this.item.value=this.widgetValues.length?this.widgetValues[0].id:null),this.getInitialSamples()}deviceChanged(){"table"!==this.item.display?this.checkVariables():this.getInitialSamples()}createTableData(i){this.item.data=[],Array.isArray(this.item.value)||(this.item.value=[this.item.value]),this.item.value.forEach(s=>{const l=this.devices.find(b=>b.object_id===this.item.object_id);if(!l)return;const p=l.variables.find(b=>b.variable===s);p&&this.item.data.push({key:p.variable,unit:p.unit,total:p.variable,precision:p.precision,dataType:p.dataType})}),i.length?i.forEach(s=>{this.lastSample=Object.assign(Object.assign({},this.lastSample),s.samples[s.samples.length-1].data)}):this.lastSample={}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-custom-values-modbus-device"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:9,vars:13,consts:[[1,"widget-custom-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax",4,"ngIf"],[3,"resolution","isDifference","chartData","isDashboard",4,"ngIf"],[3,"yAxisId","chartData","labelY","isDashboard","yAxisMin","yAxisMax"],[3,"resolution","isDifference","chartData","isDashboard"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.TgZ(2,"div",1),t.TgZ(3,"app-select",2),t.NdJ("modelChange",function(p){return s.item.object_id=p})("callbackChange",function(){return s.deviceChanged()}),t.qZA(),t.YNc(4,Jn,1,5,"app-select",3),t.qZA(),t.YNc(5,Wi,1,0,"app-loader",4),t.YNc(6,vo,4,2,"div",5),t.YNc(7,yo,9,4,"div",6),t.YNc(8,ml,3,3,"div",7),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,11,s.lastUpdate)),t.xp6(3),t.MGl("inputId","device_select_",s.widgetId,""),t.Q6J("small",!0)("model",s.item.object_id)("showSearch",!1)("options",s.widgetDevices),t.xp6(1),t.Q6J("ngIf","table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[St.H,L.O5,ft.R,oe,Qn,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();var Gn=q(9059);function Xe(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",6),t.TgZ(1,"app-select",7),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.value=l})("callbackChange",function(){return t.CHM(i),t.oxw().getInitialSamples()}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw();t.xp6(1),t.MGl("inputId","value_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.value)("showSearch",!1)("options",i.widgetValues)}}function Hn(a,h){1&a&&t._UZ(0,"app-loader")}function vl(a,h){if(1&a&&(t._UZ(0,"app-column-chart",12),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&a){const i=t.oxw(2);t.Q6J("isDashboard",!0)("labelY",t.lcZ(1,3,i.labelY.text)+" "+t.lcZ(2,5,i.labelY.unit))("chartData",i.item.data)}}function xl(a,h){if(1&a&&t._UZ(0,"app-donut-chart",13),2&a){const i=t.oxw(2);t.Q6J("isDashboard",!0)("chartData",i.item.data)}}function bl(a,h){if(1&a&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.YNc(2,vl,3,7,"app-column-chart",10),t.YNc(3,xl,1,2,"app-donut-chart",11),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!i.item.resizing&&"column"===i.item.display),t.xp6(1),t.Q6J("ngIf",!i.item.resizing&&"donut"===i.item.display)}}function $n(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"ID")))}function wo(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NAME")))}function Ft(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"GAS_M3")))}function Co(a,h){1&a&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"WATER_M3")))}function Ei(a,h){1&a&&(t.TgZ(0,"tr",17),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",4),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_GROUPS")))}function qi(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.object_id)}}function Ao(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.name)}}function Zo(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.gas))}}function Xn(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"toFixed"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,i.water))}}function Mo(a,h){if(1&a&&(t.TgZ(0,"tr"),t.YNc(1,qi,2,1,"td",2),t.YNc(2,Ao,2,1,"td",2),t.YNc(3,Zo,3,3,"td",2),t.YNc(4,Xn,3,3,"td",2),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("gasFlow")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("waterFlow"))}}function Io(a,h){if(1&a&&(t.TgZ(0,"table",14),t.TgZ(1,"thead"),t.TgZ(2,"tr"),t.YNc(3,$n,3,3,"th",2),t.YNc(4,wo,3,3,"th",2),t.YNc(5,Ft,3,3,"th",2),t.YNc(6,Co,3,3,"th",2),t.qZA(),t.qZA(),t.TgZ(7,"tbody"),t.YNc(8,Ei,4,4,"tr",15),t.YNc(9,Mo,5,4,"tr",16),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.item.columns.includes("id")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("name")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("gasFlow")),t.xp6(1),t.Q6J("ngIf",i.item.columns.includes("waterFlow")),t.xp6(2),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data)}}function Ee(a,h){1&a&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_VALUES")," "))}let Do=(()=>{class a{constructor(i,s,l){this.webSocketService=i,this.onlineValuesService=s,this.currentSensorsService=l,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.widgetValues=[{id:"gasFlow",text:"GAS"},{id:"waterFlow",text:"WATER"}],this.getInitialSamples()}getInitialSamples(){delete this.item.data,this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.onlineValuesService.getValues(this.item.object_id).subscribe(i=>{"table"!==this.item.display?this.createChartData(i):this.createTableData(i),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:this.item.object_id}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&this.item.object_id.includes(i.object_id)&&("table"!==this.item.display?this.addDataToChart(i):this.updateTableData(i),this.item.data=[...this.item.data],this.lastUpdate[i.resolution]=i.timestamp)})}createChartData(i){let s={};i.forEach(l=>s[l.object_id]=Object.assign(Object.assign({},s[l.object_id]||[]),l.samples[l.samples.length-1].data)),this.item.data=this.devices.filter(({object_id:l})=>this.item.object_id.indexOf(l)>-1).map((l,p)=>({color:z.vK[p-1],object_id:l.object_id,label:l.name,unit:"m3",value:s[l.object_id]?s[l.object_id][this.item.value]:null})),this.labelY={text:"gasFlow"===this.item.value?"GAS":"WATER",unit:"m3"}}addDataToChart(i){if("-"===i.data[this.item.value]&&(i.data[this.item.value]=null),!isNaN(i.data[this.item.value])){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&(s.value=i.data[this.item.value])}}createTableData(i){this.item.data=this.devices.filter(({object_id:s})=>this.item.object_id.indexOf(s)>-1).map(s=>({object_id:s.object_id,name:s.name})),i.forEach(s=>{this.updateTableData(Object.assign({object_id:s.object_id},s.samples[s.samples.length-1]))})}updateTableData(i){const s=this.item.data.find(l=>l.object_id===i.object_id);s&&(s.water=i.data.waterFlow,s.gas=i.data.gasFlow),this.item.data=[...this.item.data]}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(at.l),t.Y36(Vt),t.Y36(Gn.C))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-gas-water-values-group"]],inputs:{widgetId:"widgetId",item:"item",devices:"devices"},decls:7,vars:8,consts:[[1,"widget-gas-water-values","gridster-item-content"],["class","widget-header-select",4,"ngIf"],[4,"ngIf"],["class","chart-container-dashboard",4,"ngIf"],["class","widget-table",4,"ngIf"],["class","dashboard-empty-text",4,"ngIf"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],[1,"chart-container-dashboard"],[1,"chart-dashboard"],[3,"isDashboard","labelY","chartData",4,"ngIf"],[3,"isDashboard","chartData",4,"ngIf"],[3,"isDashboard","labelY","chartData"],[3,"isDashboard","chartData"],[1,"widget-table"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"empty-row"],[1,"dashboard-empty-text"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.ALo(1,"json"),t.YNc(2,Xe,2,5,"div",1),t.YNc(3,Hn,1,0,"app-loader",2),t.YNc(4,bl,4,2,"div",3),t.YNc(5,Io,10,6,"table",4),t.YNc(6,Ee,3,3,"div",5),t.qZA()),2&i&&(t.uIk("data-lastupdate",t.lcZ(1,6,s.lastUpdate)),t.xp6(2),t.Q6J("ngIf","linear"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&s.item.value),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"!==s.item.display),t.xp6(1),t.Q6J("ngIf",s.item.data&&"table"===s.item.display),t.xp6(1),t.Q6J("ngIf",!s.item.data&&!s.item.value))},directives:[L.O5,St.H,ft.R,Mi.t,ze,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$,Jt.Z,Lt.A],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%;display:flex;flex-direction:column}"]}),a})();var So=q(8520),Oo=q(9777);function Bn(a,h){1&a&&t._UZ(0,"app-loader")}function Te(a,h){if(1&a&&(t.TgZ(0,"div",10),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"app-donut-chart",11),t.qZA()),2&a){const i=t.oxw(3);t.xp6(2),t.hij("",t.lcZ(3,3,"TARIFF_DIVIDED_COST"),":"),t.xp6(2),t.Q6J("isDashboard",!0)("chartData",i.contractsChartData)}}function Ui(a,h){1&a&&(t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",2),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function Wo(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw(4);t.xp6(1),t.AsE("",i.contract.total," ",i.currency.symbol,"")}}function No(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.value)}}function Vo(a,h){1&a&&(t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",2),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function Kn(a,h){if(1&a&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.qZA()),2&a){const i=h.$implicit,s=t.oxw(5);t.xp6(2),t.Oqu(i.name),t.xp6(2),t.AsE("",i.cost," ",s.currency.symbol,""),t.xp6(2),t.AsE("",i.usage," ",i.unit_name,"")}}function Eo(a,h){if(1&a&&(t.TgZ(0,"td"),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.TgZ(4,"th"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"th"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"th"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(13,"tbody"),t.YNc(14,Vo,4,4,"tr",8),t.YNc(15,Kn,7,5,"tr",9),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw(4);t.xp6(5),t.Oqu(t.lcZ(6,5,"NAME")),t.xp6(3),t.Oqu(t.lcZ(9,7,"COST")),t.xp6(3),t.Oqu(t.lcZ(12,9,"USAGE")),t.xp6(3),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.item.data.tariffs)}}function ta(a,h){if(1&a&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"b"),t._uU(3),t.qZA(),t.qZA(),t.YNc(4,Wo,2,2,"td",4),t.YNc(5,No,2,1,"td",4),t.YNc(6,Eo,16,11,"td",4),t.qZA()),2&a){const i=h.$implicit;t.xp6(3),t.Oqu(i.title),t.xp6(1),t.Q6J("ngIf",!i.tariffs&&i.total),t.xp6(1),t.Q6J("ngIf",!i.tariffs&&!i.total),t.xp6(1),t.Q6J("ngIf",i.tariffs)}}function Be(a,h){if(1&a&&(t.TgZ(0,"div",6),t.YNc(1,Te,5,5,"div",7),t.TgZ(2,"table"),t.TgZ(3,"thead"),t.TgZ(4,"tr"),t._UZ(5,"th"),t._UZ(6,"th"),t.qZA(),t.qZA(),t.TgZ(7,"tbody"),t.YNc(8,Ui,4,4,"tr",8),t.YNc(9,ta,7,4,"tr",9),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.contractsChartData),t.xp6(7),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.tabValues)}}function yl(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",1),t.ALo(1,"json"),t.TgZ(2,"div",2),t.TgZ(3,"app-select",3),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.id=l})("callbackChange",function(){return t.CHM(i),t.oxw().itemChange()}),t.qZA(),t.qZA(),t.YNc(4,Bn,1,0,"app-loader",4),t.YNc(5,Be,10,3,"div",5),t.qZA()}if(2&a){const i=t.oxw();t.uIk("data-lastupdate",t.lcZ(1,8,i.lastUpdate)),t.xp6(3),t.MGl("inputId","contract_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.id)("showSearch",!1)("options",i.contracts),t.xp6(1),t.Q6J("ngIf",!i.item.data),t.xp6(1),t.Q6J("ngIf",i.item.data)}}function qo(a,h){1&a&&t._UZ(0,"app-loader")}function Uo(a,h){1&a&&(t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(1),t.uIk("colspan",2),t.xp6(1),t.Oqu(t.lcZ(3,2,"NO_VALUES")))}function ko(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw(4);t.xp6(1),t.AsE("",i.tariff.cost," ",i.currency.symbol,"")}}function ea(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw(4);t.xp6(1),t.AsE("",i.tariff.usage," ",i.tariff.unit_name,"")}}function Lo(a,h){if(1&a&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.value)}}function Yo(a,h){if(1&a&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"b"),t._uU(3),t.qZA(),t.qZA(),t.YNc(4,ko,2,2,"td",4),t.YNc(5,ea,2,2,"td",4),t.YNc(6,Lo,2,1,"td",4),t.qZA()),2&a){const i=h.$implicit;t.xp6(3),t.Oqu(i.title),t.xp6(1),t.Q6J("ngIf",i.cost),t.xp6(1),t.Q6J("ngIf",i.usage),t.xp6(1),t.Q6J("ngIf",!i.cost&&!i.usage)}}function Ke(a,h){if(1&a&&(t.TgZ(0,"div",6),t.TgZ(1,"table"),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t._UZ(4,"th"),t._UZ(5,"th"),t.qZA(),t.qZA(),t.TgZ(6,"tbody"),t.YNc(7,Uo,4,4,"tr",8),t.YNc(8,Yo,7,4,"tr",9),t.qZA(),t.qZA(),t.qZA()),2&a){const i=t.oxw(2);t.xp6(7),t.Q6J("ngIf",0===i.item.data.length),t.xp6(1),t.Q6J("ngForOf",i.tabValues)}}function ki(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",1),t.ALo(1,"json"),t.TgZ(2,"div",2),t.TgZ(3,"app-select",3),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw().item.id=l})("callbackChange",function(){return t.CHM(i),t.oxw().itemChange()}),t.qZA(),t.qZA(),t.YNc(4,qo,1,0,"app-loader",4),t.YNc(5,Ke,9,2,"div",5),t.qZA()}if(2&a){const i=t.oxw();t.uIk("data-lastupdate",t.lcZ(1,8,i.lastUpdate)),t.xp6(3),t.MGl("inputId","tariff_select_",i.widgetId,""),t.Q6J("small",!0)("model",i.item.id)("showSearch",!1)("options",i.tariffs),t.xp6(1),t.Q6J("ngIf",!i.item.data),t.xp6(1),t.Q6J("ngIf",i.item.data)}}let Po=(()=>{class a{constructor(i,s,l,p){this.tarifsService=i,this.webSocketService=s,this.appLoadService=l,this.translate=p,this.lastUpdate={}}ngOnInit(){delete this.item.data,this.currency=this.appLoadService.currency.value,this.dashboardType=this.item.contractWidgetType,this.getData()}getData(){"Contract"===this.dashboardType?this.getContract():this.getTariff()}getTariff(){this.tarifsService.getTariff(this.item.id).subscribe(i=>{i.tariff||(this.item.data=[]),this.tariff=i.tariff,this.lastSamples=i.lastSamples,this.calculateCosts(),this.createTableData(),this.initLiveSamples()})}getContract(){this.tarifsService.getContract(this.item.id).subscribe(i=>{i.contract||(this.item.data=[]),this.contract=i.contract,this.lastSamples=i.lastSamples,this.calculateCosts(),this.createTableData(),this.initLiveSamples()})}initLiveSamples(){this.webSocketService.addCollectData({object_ids:"Contract"===this.dashboardType?this.contract.deviceIds:this.tariff.deviceIds}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.object_id&&("Contract"===this.dashboardType?this.contract.deviceIds.includes(i.object_id):this.tariff.deviceIds.includes(i.object_id))&&(this.lastSamples[i.object_id]=Object.assign(Object.assign({},this.lastSamples[i.object_id]),i.data),this.calculateCosts(),this.lastUpdate[i.resolution]=i.timestamp)})}itemChange(){delete this.item.data,this.lastSamples={},"Contract"===this.dashboardType?this.getContract():this.getTariff()}createTableData(){this.updateTableData(),this.item.data="Contract"===this.dashboardType?{name:this.contract.name,id:this.contract.id,type:this.contract.contract_type,deviceNames:this.contract.deviceNames,tariffs:this.contract.tariffs}:{name:this.tariff.name,id:this.tariff.id,tags:this.tariff.tags}}updateTableData(i){this.tabValues="Contract"===this.item.contractWidgetType?[{title:this.translate.instant("NAME"),value:this.contract.name},{title:this.translate.instant("TYPE"),value:this.translate.instant(0===this.contract.contract_type?"VIRTUAL_TARIFF":"METER_MANAGED_TARIFF")},{title:this.translate.instant("DEVICES"),value:this.contract.devices.join(", ")},{title:this.translate.instant("TOTAL_COST"),total:!0},{title:this.translate.instant("TARIFFS"),tariffs:!0}]:[{title:this.translate.instant("NAME"),value:this.tariff.name},{title:this.translate.instant("TYPE"),value:this.translate.instant(0===this.contract.contract_type?"VIRTUAL_TARIFF":"METER_MANAGED_TARIFF")},{title:this.translate.instant("DEVICES"),value:this.tariff.devices},{title:this.translate.instant("COST"),value:this.tariff.cost,cost:!0},{title:this.translate.instant("USAGE"),value:this.tariff.usage,usage:!0}]}calculateCosts(){var i;if("Contract"===this.item.contractWidgetType)this.contract.tariffs.forEach(s=>{s.cost=0,s.usage=0}),this.contract.deviceIds.forEach(s=>{this.contract.tariffs.forEach(l=>{l.tags.forEach(p=>{const b=`cost${p[0].toUpperCase()+p.slice(1)}`;this.lastSamples[s]&&this.lastSamples[s][p]&&(l.usage=parseFloat((l.usage+("-"!==this.lastSamples[s][p]?this.lastSamples[s][p]:0)).toFixed(2)),l.cost=parseFloat((l.cost+("-"!==this.lastSamples[s][b]?this.lastSamples[s][b]:0)).toFixed(2)))})})}),this.contract.total=this.contract.tariffs.reduce((s,l)=>parseFloat((s+l.cost).toFixed(2)),0),this.contractsChartData=null===(i=this.contract.tariffs)||void 0===i?void 0:i.map((s,l)=>({label:s.name,color:z.vK[l],value:s.cost,unit:this.currency.symbol}));else{let s=0,l=0;this.tariff.deviceIds.forEach(p=>{this.tariff.tags.forEach(b=>{const w=`cost${b[0].toUpperCase()+b.slice(1)}`;this.lastSamples[p]&&this.lastSamples[p][b]&&(s=parseFloat((s+("-"!==this.lastSamples[p][w]?this.lastSamples[p][w]:0)).toFixed(2)),l=parseFloat((l+("-"!==this.lastSamples[p][b]?this.lastSamples[p][b]:0)).toFixed(2)))})}),this.tariff.cost=s,this.tariff.usage=l}}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(So.M),t.Y36(at.l),t.Y36(Oo.V),t.Y36(R.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-widget-contracts-tariffs-module"]],inputs:{widgetId:"widgetId",item:"item",contracts:"contracts",tariffs:"tariffs"},decls:2,vars:2,consts:[["class","widget-contract-tariffs-values gridster-item-content",4,"ngIf"],[1,"widget-contract-tariffs-values","gridster-item-content"],[1,"widget-header-select"],["inputClass","no-validate",3,"small","model","showSearch","options","inputId","modelChange","callbackChange"],[4,"ngIf"],["class","widget-table",4,"ngIf"],[1,"widget-table"],["class","contractsChart",4,"ngIf"],["class","empty-row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"contractsChart"],[3,"isDashboard","chartData"],[1,"empty-row"]],template:function(i,s){1&i&&(t.YNc(0,yl,6,10,"div",0),t.YNc(1,ki,6,10,"div",0)),2&i&&(t.Q6J("ngIf","Contract"===s.item.contractWidgetType),t.xp6(1),t.Q6J("ngIf","Tariff"===s.item.contractWidgetType))},directives:[L.O5,St.H,ft.R,ze,F.Om,F.$Z,F.Uo,F._C,F.p0,L.sg],pipes:[L.Ts,R.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 1 auto;overflow:auto;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{overflow:auto;height:100%;width:100%}.contractsChart[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:0 10px}.contractsChart[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:800}"]}),a})();var jt=q(3075),we=q(2374),Qo=q(656),Jo=q(7815);const Fo=["addDashboardDrawer"],jo=["addWidgetDrawer"];function ia(a,h){if(1&a&&(t.TgZ(0,"div",19),t._UZ(1,"i",20),t.TgZ(2,"span"),t._uU(3),t._UZ(4,"i",21),t.qZA(),t.qZA()),2&a){t.oxw();const i=t.MAs(7),s=t.oxw();t.Q6J("nzDropdownMenu",i),t.xp6(3),t.hij("",s.dashboard.name," ")}}function Ro(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"i",27),t.NdJ("click",function(l){t.CHM(i);const p=t.oxw().$implicit;return t.oxw(2).removeDashboard(p),l.preventDefault(),l.stopPropagation()}),t.qZA()}if(2&a){const i=t.oxw().index;t.MGl("id","remove_dashboard_button_",i,"")}}const na=function(a){return{active:a}};function aa(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"li",22),t.NdJ("click",function(){const p=t.CHM(i).$implicit;return t.oxw(2).setActiveDashboard(p)}),t._UZ(1,"i",23),t._uU(2),t.TgZ(3,"span",24),t.TgZ(4,"i",25),t.NdJ("click",function(l){const p=t.CHM(i),b=p.$implicit,w=p.index;return t.oxw(2).openDashboardDrawer(b,w),l.preventDefault(),l.stopPropagation()}),t.qZA(),t.YNc(5,Ro,1,1,"i",26),t.qZA(),t.qZA()}if(2&a){const i=h.$implicit,s=h.index,l=t.oxw(2);t.Q6J("ngClass",t.VKq(4,na,i.active)),t.xp6(2),t.hij(" ",i.name," "),t.xp6(2),t.MGl("id","edit_dashboard_button_",s,""),t.xp6(1),t.Q6J("ngIf",l.dashboards.length>1)}}function sa(a,h){1&a&&(t.TgZ(0,"div",28),t._UZ(1,"i",29),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.qZA()),2&a&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"ASSET_OVERVIEW")))}function oa(a,h){1&a&&t._UZ(0,"app-time-version")}function ra(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).openDashboardDrawer()}),t._UZ(1,"i",17),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&a&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"CREATE_NEW_DASBOARD")," "))}function zo(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",6),t.TgZ(1,"div",7),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",8),t.YNc(5,ia,5,2,"div",9),t.TgZ(6,"nz-dropdown-menu",null,10),t.TgZ(8,"div",11),t.TgZ(9,"div",12),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"ul",13),t.YNc(13,aa,6,6,"li",14),t.qZA(),t.qZA(),t.qZA(),t.YNc(14,sa,5,3,"div",15),t.YNc(15,oa,1,0,"app-time-version",2),t.TgZ(16,"button",16),t.NdJ("click",function(){return t.CHM(i),t.oxw().openWidgetDrawer()}),t._UZ(17,"i",17),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.qZA(),t.YNc(20,ra,4,3,"button",18),t.qZA()}if(2&a){const i=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,8,"homepage"===i.type?"HOMEPAGE":"ENERGY_MONITORING")),t.xp6(3),t.Q6J("ngIf",!i.loadingData&&"homepage"===i.type),t.xp6(5),t.hij(" ",t.lcZ(11,10,"MY_DASHBOARD")," "),t.xp6(3),t.Q6J("ngForOf",i.dashboards),t.xp6(1),t.Q6J("ngIf","homepage"!==i.type),t.xp6(1),t.Q6J("ngIf","homepage"===i.type),t.xp6(3),t.hij(" ",t.lcZ(19,12,"ADD_WIDGET")," "),t.xp6(2),t.Q6J("ngIf","homepage"===i.type)}}function ti(a,h){1&a&&t._UZ(0,"app-loader")}function la(a,h){if(1&a&&(t.TgZ(0,"div",44),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(2),t.Oqu(i.title)}}function ca(a,h){if(1&a&&t._UZ(0,"app-widget-online-events",45),2&a){const i=t.oxw(),l=i.$implicit;t.MGl("id","widget_",i.index,""),t.Q6J("item",l)}}function Go(a,h){if(1&a&&t._UZ(0,"app-widget-instantaneous-values-modbus-device",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function Ho(a,h){if(1&a&&t._UZ(0,"app-widget-instantaneous-values-current-sensor",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function $o(a,h){if(1&a&&t._UZ(0,"app-widget-instantaneous-values-io-module",45),2&a){const i=t.oxw(),l=i.$implicit;t.MGl("id","widget_",i.index,""),t.Q6J("item",l)}}function Xo(a,h){if(1&a&&t._UZ(0,"app-widget-instantaneous-values-ssd-module",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function Bo(a,h){if(1&a&&t._UZ(0,"app-widget-mod-values-module",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function ua(a,h){if(1&a&&t._UZ(0,"app-widget-instantaneous-values-wireless-mbus-meters",47),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function Ko(a,h){if(1&a&&t._UZ(0,"app-widget-power-quality-values-modbus-device",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function da(a,h){if(1&a&&t._UZ(0,"app-widget-energy-values-current-sensor",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function Tl(a,h){if(1&a&&t._UZ(0,"app-widget-energy-values-modbus-device",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function Li(a,h){if(1&a&&t._UZ(0,"app-widget-energy-values-wireless-mbus-meters",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function ha(a,h){if(1&a&&t._UZ(0,"app-widget-custom-values-modbus-device",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function _a(a,h){if(1&a&&t._UZ(0,"app-widget-gas-water-values-group",46),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("widgetId","widget_",s,""),t.MGl("id","widget_",s,""),t.Q6J("item",l)("devices",p.devices)}}function pa(a,h){if(1&a&&t._UZ(0,"app-widget-contracts-tariffs-module",48),2&a){const i=t.oxw(),s=i.index,l=i.$implicit,p=t.oxw(2);t.MGl("id","widget_",s,""),t.Q6J("item",l)("contracts",p.widgetContracts)("tariffs",p.widgetTariffs)}}const Yi=function(){return["MeterABB","ThirdPartyRTU","ThirdPartyTCP","Group"]},fa=function(){return["ThirdPartyRTU","ThirdPartyTCP"]};function Pi(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"gridster-item",34),t.TgZ(1,"div",35),t.TgZ(2,"div",36),t.TgZ(3,"span",37),t.NdJ("click",function(){const p=t.CHM(i).$implicit;return t.oxw(2).openWidgetDrawer(p)}),t.qZA(),t.TgZ(4,"span",38),t.NdJ("click",function(){const p=t.CHM(i).$implicit;return t.oxw(2).removeWidget(p)}),t.qZA(),t.qZA(),t.YNc(5,la,3,1,"div",39),t.YNc(6,ca,1,2,"app-widget-online-events",40),t.YNc(7,Go,1,4,"app-widget-instantaneous-values-modbus-device",41),t.YNc(8,Ho,1,4,"app-widget-instantaneous-values-current-sensor",41),t.YNc(9,$o,1,2,"app-widget-instantaneous-values-io-module",40),t.YNc(10,Xo,1,4,"app-widget-instantaneous-values-ssd-module",41),t.YNc(11,Bo,1,4,"app-widget-mod-values-module",41),t.YNc(12,ua,1,3,"app-widget-instantaneous-values-wireless-mbus-meters",42),t.YNc(13,Ko,1,4,"app-widget-power-quality-values-modbus-device",41),t.YNc(14,da,1,4,"app-widget-energy-values-current-sensor",41),t.YNc(15,Tl,1,4,"app-widget-energy-values-modbus-device",41),t.YNc(16,Li,1,4,"app-widget-energy-values-wireless-mbus-meters",41),t.YNc(17,ha,1,4,"app-widget-custom-values-modbus-device",41),t.YNc(18,_a,1,4,"app-widget-gas-water-values-group",41),t.YNc(19,pa,1,4,"app-widget-contracts-tariffs-module",43),t.qZA(),t.qZA()}if(2&a){const i=h.$implicit,s=h.index;t.Q6J("item",i),t.xp6(3),t.MGl("id","edit_widget_button_",s,""),t.xp6(1),t.MGl("id","remove_widget_button_",s,""),t.xp6(1),t.Q6J("ngIf",i.title),t.xp6(1),t.Q6J("ngIf","onlineEvents"===i.widget),t.xp6(1),t.Q6J("ngIf","instantaneousValues"===i.widget&&t.DdM(18,Yi).includes(i.device_type)),t.xp6(1),t.Q6J("ngIf","instantaneousValues"===i.widget&&"CurrentSensor"===i.device_type),t.xp6(1),t.Q6J("ngIf","instantaneousValues"===i.widget&&"IoModule"===i.device_type),t.xp6(1),t.Q6J("ngIf","instantaneousValues"===i.widget&&"AuxiliaryContact"===i.device_type),t.xp6(1),t.Q6J("ngIf","modValues"===i.widget&&"ModAriArh"===i.device_type),t.xp6(1),t.Q6J("ngIf","instantaneousValues"===i.widget&&"MeterWMbus"===i.device_type),t.xp6(1),t.Q6J("ngIf","powerQualityValues"===i.widget),t.xp6(1),t.Q6J("ngIf","energyValues"===i.widget&&"CurrentSensor"===i.device_type),t.xp6(1),t.Q6J("ngIf","energyValues"===i.widget&&t.DdM(19,Yi).includes(i.device_type)),t.xp6(1),t.Q6J("ngIf","energyValues"===i.widget&&"MeterWMbus"===i.device_type),t.xp6(1),t.Q6J("ngIf","customValues"===i.widget&&t.DdM(20,fa).includes(i.device_type)),t.xp6(1),t.Q6J("ngIf","gasWater"===i.widget&&"Group"===i.device_type),t.xp6(1),t.Q6J("ngIf","contractsTariffs"===i.widget)}}function ga(a,h){if(1&a&&(t.TgZ(0,"div",31),t.TgZ(1,"gridster",32),t.YNc(2,Pi,20,21,"gridster-item",33),t.qZA(),t.qZA()),2&a){const i=t.oxw();t.xp6(1),t.Q6J("options",i.options),t.xp6(1),t.Q6J("ngForOf",i.dashboard.items)}}const wl=function(a){return{selected:a}};function tr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",57),t.NdJ("click",function(){const p=t.CHM(i).$implicit;return t.oxw(3).selectWidget(p.widget)}),t.TgZ(1,"div"),t._UZ(2,"i"),t.qZA(),t.TgZ(3,"div",58),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",59),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.qZA()}if(2&a){const i=h.$implicit,s=t.oxw(3);t.Q6J("id",i.id)("ngClass",t.VKq(11,wl,s.editWidget.widget===i.widget)),t.xp6(2),t.Tol(i.icon),t.xp6(2),t.Oqu(t.lcZ(5,7,i.title)),t.xp6(3),t.Oqu(t.lcZ(8,9,i.desc))}}function ei(a,h){if(1&a&&(t.TgZ(0,"div",53),t.TgZ(1,"div",54),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",55),t.YNc(5,tr,9,13,"div",56),t.qZA(),t.qZA()),2&a){const i=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"WIDGET_SELECTION")," "),t.xp6(3),t.Q6J("ngForOf",i.widgetsConfiguration)}}function ii(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"INSTANTANEOUS_VALUES")))}function Qi(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"ENERGY_VALUES")))}function qe(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"POWER_QUALITY_VALUES")))}function ma(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"CUSTOM_VALUES")))}function er(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"MOD_AND_AR_VALUES")))}function ir(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"ONLINE_EVENTS")))}function nr(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"GAS_WATER")))}function ar(a,h){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"COTRACTS_AND_TARIFFS")))}const Bt=function(){return{required:!0}};function ni(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",72),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.contractWidgetType=l}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,4,"TYPE")),t.xp6(2),t.Q6J("model",i.editWidget.contractWidgetType)("options",i.tariffContractsOptions)("validators",t.DdM(6,Bt))}}function Cl(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",73),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.id=l}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,4,"CONTRACT")),t.xp6(2),t.Q6J("model",i.editWidget.id)("options",i.widgetContracts)("validators",t.DdM(6,Bt))}}function sr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",74),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.id=l}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,4,"TARIFF")),t.xp6(2),t.Q6J("model",i.editWidget.id)("options",i.widgetTariffs)("validators",t.DdM(6,Bt))}}function or(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-validate",67),t.TgZ(5,"nz-input-number",75,76),t.NdJ("ngModelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.nrOfEvents=l}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const i=t.MAs(6),s=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,6,"NR_FO_EVENTS")),t.xp6(2),t.Q6J("field",i),t.xp6(1),t.Q6J("ngModel",s.editWidget.nrOfEvents)("nzMin",1)("nzMax",20)("required",!0)}}function rr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",77),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.device_type=l})("callbackChange",function(){return t.CHM(i),t.oxw(3).deviceTypeChanged(!0)}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,4,"DEVICE_TYPE")),t.xp6(2),t.Q6J("model",i.editWidget.device_type)("options",i.widgetDeviceTypes)("validators",t.DdM(6,Bt))}}const va=function(){return["IoModule","CurrentSensor","modValues"]};function lr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",78),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.object_id=l})("callbackChange",function(){return t.CHM(i),t.oxw(3).deviceChanged()}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,5,"DEVICE")),t.xp6(2),t.Q6J("model",i.editWidget.object_id)("multiple",t.DdM(7,va).includes(i.editWidget.device_type)||"gasWater"===i.editWidget.widget)("options",i.widgetDevices)("validators",t.DdM(8,Bt))}}const xa=function(){return["MeterABB","ThirdPartyRTU","ThirdPartyTCP","AuxiliaryContact","MeterWMbus","Group"]};function cr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",79),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.value=l})("callbackChange",function(){return t.CHM(i),t.oxw(3).checkDeviceTypes()}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,5,"VALUE")),t.xp6(2),t.Q6J("model",i.editWidget.value)("multiple","table"===i.editWidget.display&&t.DdM(7,xa).includes(i.editWidget.device_type))("options",i.widgetValues)("validators",t.DdM(8,Bt))}}function ur(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",80),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.display=l})("callbackChange",function(){return t.CHM(i),t.oxw(3).displayChanged()}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,4,"DISPLAY")),t.xp6(2),t.Q6J("model",i.editWidget.display)("options",i.widgetDisplay)("validators",t.DdM(6,Bt))}}function dr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",81),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.columns=l}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,5,"COLUMNS")),t.xp6(2),t.Q6J("model",i.editWidget.columns)("multiple",!0)("options",i.widgetColumns)("validators",t.DdM(7,Bt))}}function hr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",82),t.NdJ("modelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.yAxis=l}),t.qZA(),t.qZA()}if(2&a){const i=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,4,"Y_AXIS")),t.xp6(2),t.Q6J("model",i.editWidget.yAxis)("options",i.yAxisSelect)("validators",t.DdM(6,Bt))}}function Ji(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-validate",67),t.TgZ(5,"nz-input-number",83,84),t.NdJ("ngModelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.yAxisMin=l}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const i=t.MAs(6),s=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,6,"MIN")),t.xp6(2),t.Q6J("field",i),t.xp6(1),t.Q6J("ngModel",s.editWidget.yAxisMin)("nzMin",-9999999)("nzMax",9999999)("required",!0)}}function Fi(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",65),t.TgZ(1,"label",66),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-validate",67),t.TgZ(5,"nz-input-number",85,86),t.NdJ("ngModelChange",function(l){return t.CHM(i),t.oxw(3).editWidget.yAxisMax=l}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const i=t.MAs(6),s=t.oxw(3);t.xp6(2),t.Oqu(t.lcZ(3,6,"MAX")),t.xp6(2),t.Q6J("field",i),t.xp6(1),t.Q6J("ngModel",s.editWidget.yAxisMax)("nzMin",-9999999)("nzMax",9999999)("required",!0)}}const Ce=function(){return["instantaneousValues","energyValues","powerQualityValues","customValues","gasWater"]},_r=function(){return["instantaneousValues","energyValues","powerQualityValues","customValues","gasWater","modValues"]},pr=function(){return["instantaneousValues","powerQualityValues","customValues","gasWater"]},ai=function(){return["modValues"]};function fr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"div",53),t.TgZ(1,"span",60),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).goToStep(0)}),t._UZ(2,"i",61),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",62),t.YNc(6,ii,3,3,"span",2),t.YNc(7,Qi,3,3,"span",2),t.YNc(8,qe,3,3,"span",2),t.YNc(9,ma,3,3,"span",2),t.YNc(10,er,3,3,"span",2),t.YNc(11,ir,3,3,"span",2),t.YNc(12,nr,3,3,"span",2),t.YNc(13,ar,3,3,"span",2),t.qZA(),t.TgZ(14,"div",63),t.TgZ(15,"form",null,64),t.TgZ(17,"div",65),t.TgZ(18,"label",66),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"app-validate",67),t.TgZ(22,"input",68,69),t.NdJ("ngModelChange",function(l){return t.CHM(i),t.oxw(2).editWidget.title=l}),t.qZA(),t.qZA(),t.qZA(),t.YNc(24,ni,5,7,"div",70),t.YNc(25,Cl,5,7,"div",70),t.YNc(26,sr,5,7,"div",70),t.YNc(27,or,7,8,"div",70),t.YNc(28,rr,5,7,"div",70),t.YNc(29,lr,5,9,"div",70),t.YNc(30,cr,5,9,"div",70),t.YNc(31,ur,5,7,"div",70),t.YNc(32,dr,5,8,"div",70),t.YNc(33,hr,5,7,"div",70),t.YNc(34,Ji,7,8,"div",70),t.YNc(35,Fi,7,8,"div",70),t.TgZ(36,"button",71),t.NdJ("appFormButtonClick",function(){return t.CHM(i),t.oxw(2).saveWidget()}),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&a){const i=t.MAs(16),s=t.MAs(23),l=t.oxw(2);t.xp6(3),t.hij(" ",t.lcZ(4,26,"WIDGET_SELECTION"),""),t.xp6(3),t.Q6J("ngIf","instantaneousValues"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","energyValues"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","powerQualityValues"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","customValues"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","modValues"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","onlineEvents"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","gasWater"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","contractsTariffs"===l.editWidget.widget),t.xp6(6),t.Oqu(t.lcZ(20,28,"TITLE")),t.xp6(2),t.Q6J("field",s),t.xp6(1),t.Q6J("ngModel",l.editWidget.title),t.xp6(2),t.Q6J("ngIf","contractsTariffs"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf","contractsTariffs"===l.editWidget.widget&&"Contract"===l.editWidget.contractWidgetType),t.xp6(1),t.Q6J("ngIf","contractsTariffs"===l.editWidget.widget&&"Tariff"===l.editWidget.contractWidgetType),t.xp6(1),t.Q6J("ngIf","onlineEvents"===l.editWidget.widget),t.xp6(1),t.Q6J("ngIf",t.DdM(32,Ce).includes(l.editWidget.widget)),t.xp6(1),t.Q6J("ngIf",t.DdM(33,_r).includes(l.editWidget.widget)),t.xp6(1),t.Q6J("ngIf",(t.DdM(34,pr).includes(l.editWidget.widget)||"energyValues"===l.editWidget.widget&&"CurrentSensor"!==l.editWidget.device_type)&&("table"!==l.editWidget.display||"table"===l.editWidget.display&&t.DdM(35,xa).includes(l.editWidget.device_type)&&"gasWater"!==l.editWidget.widget)&&"IoModule"!==l.editWidget.device_type),t.xp6(1),t.Q6J("ngIf",t.DdM(36,Ce).includes(l.editWidget.widget)&&"IoModule"!==l.editWidget.device_type),t.xp6(1),t.Q6J("ngIf","table"===l.editWidget.display&&!t.DdM(37,ai).includes(l.editWidget.widget)),t.xp6(1),t.Q6J("ngIf","linear"===l.editWidget.display),t.xp6(1),t.Q6J("ngIf","linear"===l.editWidget.display&&"manual"===l.editWidget.yAxis&&"IoModule"!==l.editWidget.device_type),t.xp6(1),t.Q6J("ngIf","linear"===l.editWidget.display&&"manual"===l.editWidget.yAxis&&"IoModule"!==l.editWidget.device_type),t.xp6(1),t.Q6J("form",i),t.xp6(1),t.Oqu(t.lcZ(38,30,l.editWidget.isEdit?"SAVE_WDIGET":"ADD_WIDGET"))}}function si(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"button",49),t.NdJ("click",function(){return t.CHM(i),t.oxw().closeDrawer()}),t._UZ(1,"i",50),t.qZA(),t.TgZ(2,"div",51),t.YNc(3,ei,6,4,"div",52),t.YNc(4,fr,39,38,"div",52),t.qZA()}if(2&a){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",0===i.current),t.xp6(1),t.Q6J("ngIf",1===i.current)}}function gr(a,h){if(1&a){const i=t.EpF();t.TgZ(0,"button",87),t.NdJ("click",function(){return t.CHM(i),t.oxw().closeDrawer()}),t._UZ(1,"i",50),t.qZA(),t.TgZ(2,"div",51),t.TgZ(3,"div",53),t.TgZ(4,"div",88),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",63),t.TgZ(8,"form",null,64),t.TgZ(10,"div",65),t.TgZ(11,"label",66),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"app-validate",67),t.TgZ(15,"input",89,90),t.NdJ("ngModelChange",function(l){return t.CHM(i),t.oxw().editDashboard.name=l}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"button",91),t.NdJ("appFormButtonClick",function(){return t.CHM(i),t.oxw().saveDashboard()}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&a){const i=t.MAs(9),s=t.MAs(16),l=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,6,"DASHBOARD_CONFIGURATION")," "),t.xp6(7),t.Oqu(t.lcZ(13,8,"NAME")),t.xp6(2),t.Q6J("field",s),t.xp6(1),t.Q6J("ngModel",l.editDashboard.name),t.xp6(2),t.Q6J("form",i),t.xp6(1),t.Oqu(t.lcZ(19,10,l.editDashboard.isEdit?"SAVE_DASHBOARD":"ADD_DASHBOARD"))}}let ba=(()=>{class a{constructor(i,s,l,p,b,w){this.translate=i,this.dashboardService=s,this.webSocketService=l,this.modalService=p,this.drawerService=b,this.toastr=w,this.cl="app-dashboard",this.loadingData=!0,this.current=0,this.itemsChanged=!1,this.widgetsConfiguration=[{widget:"instantaneousValues",icon:"icon_abb_32 icon-abb_bar-chart_32",title:"INSTANTANEOUS_VALUES",desc:"INSTANTANEOUS_VALUES_DESC",minSize:[3,3],id:"instantaneous_values"},{widget:"energyValues",icon:"icon_abb_32 icon-abb_bar-chart_32",title:"ENERGY_VALUES",desc:"ENERGY_VALUES_DESC",minSize:[3,3],id:"energy_values"},{widget:"powerQualityValues",icon:"icon_abb_32 icon-abb_bar-chart_32",title:"POWER_QUALITY_VALUES",desc:"POWER_QUALITY_VALUES_DESC",minSize:[3,3],id:"power_quality_values"},{widget:"customValues",icon:"icon_abb_32 icon-abb_bar-chart_32",title:"CUSTOM_VALUES",desc:"CUSTOM_VALUES_DESC",minSize:[3,3],id:"custom_values"},{widget:"gasWater",icon:"icon_abb_32 icon-abb_bar-chart_32",title:"GAS_WATER",desc:"GAS_WATER_DESC",minSize:[4,2],id:"gas_water"},{widget:"modValues",icon:"icon_abb_32 icon-abb_bar-chart_32",title:"MOD_AND_AR_VALUES",desc:"MOD_AND_AR_VALUES_DESC",minSize:[3,3],id:"mod_values"},{widget:"onlineEvents",icon:"icon_abb_32 icon-abb_event_32",title:"ONLINE_EVENTS",desc:"ONLINE_EVENTS_DESC",minSize:[4,2],id:"online_events"},{widget:"contractsTariffs",icon:"icon_abb_32 icon-abb_dollar_32",title:"COTRACTS_AND_TARIFFS",desc:"COTRACTS_AND_TARIFFS_DESC",minSize:[4,2],id:"contracts_tariffs"}],this.watchTabVisible=()=>{this.webSocketService.tabVisible=!document.hidden}}ngOnInit(){this.getData(),this.options={itemChangeCallback:()=>this.itemChanged(),itemResizeCallback:i=>this.itemResized(i),draggable:{enabled:!0},resizable:{enabled:!0},outerMarginTop:20,outerMarginRight:20,outerMarginBottom:20,outerMarginLeft:20,margin:20,minCols:8,minRows:5,gridType:"verticalFixed",fixedColWidth:125,fixedRowHeight:125},this.dashboards=[{name:"homepage"===this.type?"Homepage":"Asset overview",active:!0,size:"auto",items:[]}],this.deviceTypes=[{id:"CurrentSensor",text:"CURRENT_SENSORS"},{id:"IoModule",text:"IO_MODULES"},{id:"ThirdPartyRTU",text:"MODBUS_RTU_DEVICES"},{id:"ThirdPartyTCP",text:"MODBUS_TCP_DEVICES"},{id:"MeterWMbus",text:"WIRELESS_MBUS_METERS"},{id:"AuxiliaryContact",text:"SSD"},{id:"Group",text:"GROUPS"},{id:"ModAriArh",text:"MOD"}],this.yAxisSelect=[{id:"autoscalling",text:"AUTOSCALING"},{id:"manual",text:"MANUAL"}],this.displays=[{id:"linear",text:"CHART_LINEAR"},{id:"donut",text:"CHART_DONUT"},{id:"column",text:"CHART_COLUMN"},{id:"table",text:"TABLE"}],this.tariffContractsOptions=[{id:"Contract",text:"CONTRACT"},{id:"Tariff",text:"TARIFF"}],document.addEventListener("visibilitychange",this.watchTabVisible)}ngOnDestroy(){document.removeEventListener("visibilitychange",this.watchTabVisible),this.clearCollectData()}getData(){this.dashboardService.getDashboardConfiguration(this.type).subscribe(i=>{if(this.loadingData=!1,i.dashboard_configuration&&i.dashboard_configuration.dashboards&&Array.isArray(i.dashboard_configuration.dashboards)){const s=i.dashboard_configuration.dashboards.find(({active:l})=>l);s?(this.dashboards=i.dashboard_configuration.dashboards,this.setActiveDashboard(s,!1)):this.dashboard=this.dashboards[0]}else this.dashboard=this.dashboards[0];this.devices=i.devices,this.properties=i.properties,this.widgetContracts=i.contracts.map(s=>({id:s.id,text:s.name})),this.widgetTariffs=i.tariffs.map(s=>({id:s.id,text:s.name}))})}saveChanges(i=!0){this.toastr.clear();const l={dashboards:this.dashboards.map(p=>({name:p.name,active:p.active,items:p.items.map(b=>{const w=Object.assign({},b);return delete w.data,delete w.unit,w})}))};this.dashboardService.setDashboardConfiguration({configuration:JSON.stringify(l),type:this.type}).subscribe(()=>{i&&this.toastr.success(this.translate.instant("CONFIGURATION_SAVE_SUCCESS"))})}removeWidget(i){this.dashboard.items.splice(this.dashboard.items.indexOf(i),1),this.saveChanges()}openWidgetDrawer(i={}){this.toastr.clear(),this.editWidget=Object.assign({},i),i.widget?(this.editWidget.isEdit=!0,this.current=1,["instantaneousValues","energyValues","powerQualityValues","customValues","gasWater","contractsTariffs","modValues"].includes(i.widget)&&(this.checkDeviceTypes(),this.deviceTypeChanged())):this.current=0,this.drawerService.showDrawer(this.addWidgetDrawer)}openDashboardDrawer(i={},s=null){this.toastr.clear(),this.editDashboard=Object.assign(Object.assign({},i),{index:s}),i.name?this.editDashboard.isEdit=!0:this.editDashboard.items=[],this.drawerService.showDrawer(this.addDashboardDrawer)}closeDrawer(){this.drawerService.hide()}selectWidget(i){"onlineEvents"===i?(this.editWidget={widget:"onlineEvents",nrOfEvents:5,display:"table",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y},this.checkTableColumns()):"instantaneousValues"===i?(this.editWidget={widget:"instantaneousValues",source:"local",display:"linear",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y,yAxis:"autoscalling"},this.checkDeviceTypes(),this.checkWidgetDevices()):"energyValues"===i?(this.editWidget={widget:"energyValues",source:"local",display:"donut",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y},this.checkDeviceTypes(),this.checkWidgetDevices()):"powerQualityValues"===i?(this.editWidget={widget:"powerQualityValues",source:"local",display:"linear",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y,yAxis:"autoscalling"},this.checkDeviceTypes(),this.checkWidgetDevices()):"customValues"===i?(this.editWidget={widget:"customValues",source:"local",display:"linear",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y,yAxis:"autoscalling"},this.checkDeviceTypes(),this.checkWidgetDevices()):"modValues"===i?(this.editWidget={widget:"modValues",source:"local",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y,device_type:"ModAriArh"},this.widgetDevices=this.devices.filter(s=>s.device_type===this.editWidget.device_type).map(s=>({id:s.object_id,name:s.name})),this.checkDeviceTypes()):"gasWater"===i?(this.editWidget={widget:"gasWater",source:"local",device_type:"Group",display:"donut",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y,yAxis:"autoscalling"},this.checkDeviceTypes()):"contractsTariffs"===i&&(this.editWidget={widget:"contractsTariffs",source:"local",isEdit:this.editWidget.isEdit,x:this.editWidget.x,y:this.editWidget.y}),this.editWidget.title=this.translate.instant(this.widgetsConfiguration.find(({widget:s})=>s===this.editWidget.widget).title),this.editWidget.cols=this.widgetsConfiguration.find(({widget:s})=>s===this.editWidget.widget).minSize[0],this.editWidget.rows=this.widgetsConfiguration.find(({widget:s})=>s===this.editWidget.widget).minSize[1],this.goToStep(1)}saveWidget(){if(this.editWidget.isEdit){const i=this.dashboard.items.findIndex(s=>s.x===this.editWidget.x&&s.y===this.editWidget.y);this.editWidget.data=null,this.dashboard.items[i]=this.editWidget,this.saveChanges()}else this.options.api.getNextPossiblePosition(this.editWidget)?(Array.isArray(this.dashboard.items)||(this.dashboard.items=[]),this.dashboard.items.push(this.editWidget),this.saveChanges()):this.toastr.warning(this.translate.instant("DASHBOARD_NO_SPACE_WIDGET"));this.closeDrawer()}saveDashboard(){this.editDashboard.isEdit?this.dashboards[this.editDashboard.index].name=this.editDashboard.name:(this.dashboards.push(this.editDashboard),this.setActiveDashboard(this.editDashboard)),this.saveChanges(),this.closeDrawer()}itemChanged(){this.itemsChanged||(this.itemsChanged=!0,setTimeout(()=>{this.saveChanges(),this.itemsChanged=!1},300))}itemResized(i){i.resizing=!0,setTimeout(()=>delete i.resizing,300)}goToStep(i){this.current=i}setActiveDashboard(i,s=!0){this.dashboards.forEach(l=>l.active=!1),i&&(i.active=!0,this.dashboard=i),s&&this.saveChanges(!1),this.clearCollectData()}clearCollectData(){this.webSocketService.setCollectData()}removeDashboard(i){this.modalService.showConfirm(this.translate.instant("DASHBOARD_REMOVE",{name:"<strong>"+i.name+"</strong>"}),()=>{this.modalService.hide();const s=i.active;this.dashboards.splice(this.dashboards.indexOf(i),1),s&&this.dashboards.length&&this.setActiveDashboard(this.dashboards[0]),this.saveChanges()},()=>{this.modalService.hide()})}checkDeviceTypes(){var i;if("instantaneousValues"===this.editWidget.widget)this.widgetDeviceTypes=this.deviceTypes.filter(s=>["CurrentSensor","IoModule","ThirdPartyRTU","ThirdPartyTCP","MeterWMbus","AuxiliaryContact","Group"].includes(s.id)),this.widgetDisplay=this.displays.filter(s=>["linear","table"].includes(s.id)),"AuxiliaryContact"===this.editWidget.device_type&&(this.widgetDisplay=this.displays.filter(s=>["table"].includes(s.id)));else if("energyValues"===this.editWidget.widget)this.widgetDeviceTypes=this.deviceTypes.filter(s=>["CurrentSensor","ThirdPartyRTU","ThirdPartyTCP","MeterWMbus","Group"].includes(s.id)),"MeterWMbus"!==this.editWidget.device_type?this.widgetDisplay=this.displays.filter(s=>["donut","column","table"].includes(s.id)):(this.widgetDisplay=this.displays.filter(s=>["table"].includes(s.id)),this.editWidget.display="table",Array.isArray(this.editWidget.value)||(this.editWidget.value=[this.editWidget.value]));else if("modValues"===this.editWidget.widget)this.widgetDeviceTypes=this.deviceTypes.filter(s=>["ModAriArh"].includes(s.id)),this.widgetDisplay=this.displays.filter(s=>["linear","table"].includes(s.id));else if("powerQualityValues"===this.editWidget.widget)this.widgetDeviceTypes=this.deviceTypes.filter(s=>["ThirdPartyRTU","ThirdPartyTCP"].includes(s.id)),this.widgetDisplay=this.displays.filter(s=>["linear","table"].includes(s.id));else if("customValues"===this.editWidget.widget){this.widgetDeviceTypes=this.deviceTypes.filter(A=>["ThirdPartyRTU","ThirdPartyTCP"].includes(A.id));const s=this.devices.find(A=>A.object_id===this.editWidget.object_id);let l;s?(l=s.variables.find(A=>this.editWidget.value===A.variable),l&&l.cumulative?(this.widgetDisplay=this.displays.filter(A=>["column","table"].includes(A.id)),"linear"===this.editWidget.display&&(this.editWidget.display="column")):(this.widgetDisplay=this.displays.filter(A=>["linear","table"].includes(A.id)),"column"===this.editWidget.display&&(this.editWidget.display="linear"))):this.widgetDisplay=this.displays.filter(A=>["linear","table"].includes(A.id));let p=this.devices.find(A=>A.object_id===this.editWidget.object_id),b=null==p?void 0:p.variables.filter(A=>"string"===A.dataType),w=!1;"string"==typeof this.editWidget.value?w=!!b.some(A=>A.variable===this.editWidget.value):null===(i=this.editWidget.value)||void 0===i||i.forEach(A=>{b.some(ct=>ct.variable===A)&&(w=!0)}),w&&(this.widgetDisplay=[...this.widgetDisplay.filter(A=>"table"===A.id)],this.editWidget.display="table")}else"gasWater"===this.editWidget.widget&&(this.widgetDeviceTypes=this.deviceTypes.filter(s=>["Group"].includes(s.id)),this.widgetDisplay=this.displays.filter(s=>["donut","column","table"].includes(s.id)));this.checkTableColumns()}checkTableColumns(){var i,s;"table"===this.editWidget.display&&("instantaneousValues"===this.editWidget.widget?"CurrentSensor"===this.editWidget.device_type?this.widgetColumns=[{id:"modbus_id",text:"MODBUS_ID"},{id:"name",text:"NAME"},{id:"ac",text:"AC"},{id:"dc",text:"DC"},{id:"trms",text:"TRMS"},{id:"active_power",text:"ACTIVE_POWER"}]:"IoModule"===this.editWidget.device_type?this.widgetColumns=[{id:"modbus_id",text:"MODBUS_ID"},{id:"port",text:"PORT"},{id:"port_name",text:"PORT_NAME"},{id:"device_type",text:"DEVICE_TYPE"},{id:"accessory_type",text:"ACCESSORY_TYPE"},{id:"status",text:"STATUS"},{id:"counter",text:"COUNTER"},{id:"pulse_value",text:"PULSE_VALUE"},{id:"pulse_unit",text:"PULSE_UNIT"}]:"AuxiliaryContact"===this.editWidget.device_type?this.widgetColumns=[{id:"value",text:"VALUE"},{id:"total",text:"TOTAL"}]:["ThirdPartyRTU","ThirdPartyTCP","Group"].includes(this.editWidget.device_type)?this.widgetColumns=[{id:"value",text:"VALUE"},{id:"l1",text:"L1"},{id:"l2",text:"L2"},{id:"l3",text:"L3"},{id:"n",text:"N"},{id:"total",text:"TOTAL"}]:["MeterWMbus"].includes(this.editWidget.device_type)&&(this.widgetColumns=[{id:"value",text:"VALUE"},{id:"l1",text:"L1"},{id:"l2",text:"L2"},{id:"l3",text:"L3"},{id:"total",text:"TOTAL"}]):"energyValues"===this.editWidget.widget?this.widgetColumns="CurrentSensor"===this.editWidget.device_type?[{id:"modbus_id",text:"MODBUS_ID"},{id:"name",text:"NAME"},{id:"energy",text:"ENERGY"}]:["MeterWMbus"].includes(this.editWidget.device_type)?[{id:"value",text:"VALUE"},{id:"total",text:"TOTAL"}]:[{id:"value",text:"VALUE"},{id:"l1",text:"L1"},{id:"l2",text:"L2"},{id:"l3",text:"L3"},{id:"total",text:"TOTAL"}]:"powerQualityValues"===this.editWidget.widget?this.widgetColumns=[{id:"value",text:"VALUE"},{id:"l1",text:"L1"},{id:"l2",text:"L2"},{id:"l3",text:"L3"},{id:"n",text:"N"},{id:"total",text:"TOTAL"}]:"customValues"===this.editWidget.widget?this.widgetColumns=[{id:"value",text:"VALUE"},{id:"total",text:"TOTAL"}]:"onlineEvents"===this.editWidget.widget?this.widgetColumns=[{id:"name",text:"NAME"},{id:"device",text:"DEVICE"},{id:"measure",text:"MEASURE"},{id:"type",text:"TYPE"},{id:"value",text:"VALUE"},{id:"date",text:"DATE_AND_TIME"}]:"gasWater"===this.editWidget.widget&&(this.widgetColumns=[{id:"id",text:"ID"},{id:"name",text:"NAME"},{id:"gasFlow",text:"GAS"},{id:"waterFlow",text:"WATER"}]),this.editWidget.columns=this.editWidget.columns?null===(s=this.editWidget)||void 0===s?void 0:s.columns.filter(l=>this.widgetColumns.some(p=>p.id===l)):null===(i=this.widgetColumns)||void 0===i?void 0:i.map(({id:l})=>l))}deviceTypeChanged(i=!1){i&&(delete this.editWidget.object_id,delete this.editWidget.value),this.checkWidgetDevices(),this.checkVariables(),this.checkTableColumns()}deviceChanged(){this.checkVariables()}displayChanged(){"table"===this.editWidget.display?this.editWidget.value&&(this.editWidget.value=[this.editWidget.value]):Array.isArray(this.editWidget.value)&&this.editWidget.value.length&&(this.editWidget.value=this.editWidget.value[0]),this.checkTableColumns()}checkWidgetDevices(){const i=[this.editWidget.device_type];"ThirdPartyRTU"===this.editWidget.device_type&&i.push("MeterABB"),this.widgetDevices=this.devices.filter(s=>i.includes(s.device_type)).map(s=>({id:s.object_id,name:s.name}))}checkVariables(){if("CurrentSensor"===this.editWidget.device_type)this.widgetValues="instantaneousValues"===this.editWidget.widget?[{id:"currentTrms",text:"TRMS"},{id:"currentAc",text:"AC"},{id:"currentDc",text:"DC"},{id:"activePowerTotal",text:"ACTIVE_POWER"}]:[];else if("IoModule"===this.editWidget.device_type)this.widgetValues=[],this.editWidget.display="table";else if("gasWater"===this.editWidget.widget)this.widgetValues=[{id:"gasFlow",text:"GAS"},{id:"waterFlow",text:"WATER"}];else if(["ThirdPartyRTU","ThirdPartyTCP","MeterWMbus","Group"].includes(this.editWidget.device_type)){this.widgetValues=[];const i=this.devices.find(s=>s.object_id===this.editWidget.object_id);i&&("customValues"===this.editWidget.widget&&"MeterABB"!==i.device_type?i.variables.forEach(s=>{["Energy Values","Instantaneous Values","Power Quality Values","Maximum Values","Unbalances"].includes(s.category)||this.widgetValues.push({id:s.variable,text:s.variable})}):z.dQ[{instantaneousValues:"Instantaneous Values",energyValues:"Energy Values",powerQualityValues:"Power Quality Values"}[this.editWidget.widget]].forEach(l=>{i.variables.find(b=>[l.l1,l.l2,l.l3,l.n,l.total].includes(b.variable))&&this.widgetValues.push({id:l.key,text:l.key})}))}else if("AuxiliaryContact"===this.editWidget.device_type){this.widgetDisplay=[{id:"table",text:"TABLE"}],this.editWidget.display="table",this.widgetValues=[];const i=this.devices.find(s=>s.object_id===this.editWidget.object_id);i&&"instantaneousValues"===this.editWidget.widget&&i.variables.forEach(s=>{this.widgetValues.push({id:s.variable,text:s.variable})})}else"ModAriArh"===this.editWidget.device_type&&(this.widgetDisplay=[{id:"table",text:"TABLE"}],this.editWidget.display="table",this.widgetValues=[]);"contractsTariffs"!==this.editWidget.widget&&("table"!==this.editWidget.display?this.widgetValues.some(s=>s.id===this.editWidget.value)||(this.editWidget.value=null):this.editWidget.value&&(this.editWidget.value=this.widgetValues.filter(i=>this.editWidget.value.includes(i.id)).map(i=>i.id)))}}return a.\u0275fac=function(i){return new(i||a)(t.Y36(R.sK),t.Y36(B),t.Y36(at.l),t.Y36(Ct.Z),t.Y36(ee.z),t.Y36(Ye._))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-dashboard"]],viewQuery:function(i,s){if(1&i&&(t.Gf(Fo,5),t.Gf(jo,5)),2&i){let l;t.iGM(l=t.CRH())&&(s.addDashboardDrawer=l.first),t.iGM(l=t.CRH())&&(s.addWidgetDrawer=l.first)}},hostVars:1,hostBindings:function(i,s){2&i&&t.uIk("class",s.cl)},inputs:{type:"type"},decls:8,vars:3,consts:[[1,"header-component"],["class","header",4,"ngIf"],[4,"ngIf"],["class","section-content",4,"ngIf"],["addWidgetDrawer",""],["addDashboardDrawer",""],[1,"header"],[1,"menu-header","text-line"],[1,"submenu-header"],["nz-dropdown","","id","dashboard_name","class","dashboard-name-dropdown","nzTrigger","click",3,"nzDropdownMenu",4,"ngIf"],["menu","nzDropdownMenu"],[1,"dashboard-select-dropdown"],[1,"title"],["nz-menu",""],["nz-menu-item","",3,"ngClass","click",4,"ngFor","ngForOf"],["nz-dropdown","","id","dashboard_name",4,"ngIf"],["nz-button","","nzType","primary","id","add_widget_button",1,"header-button",3,"click"],[1,"icon_abb_16","icon-abb_plus_16"],["type","button","class","red","id","create_new_dashboard_button","nz-button","",3,"click",4,"ngIf"],["nz-dropdown","","id","dashboard_name","nzTrigger","click",1,"dashboard-name-dropdown",3,"nzDropdownMenu"],[1,"icon_abb_24","icon-abb_background_24"],[1,"icon_abb_16","icon-abb_down_16"],["nz-menu-item","",3,"ngClass","click"],[1,"icon_abb_16","icon-abb_pin_16"],[1,"icons"],[1,"icon_abb_16","icon-abb_edit_16",3,"id","click"],["class","icon_abb_16 icon-abb_trash_16",3,"id","click",4,"ngIf"],[1,"icon_abb_16","icon-abb_trash_16",3,"id","click"],["nz-dropdown","","id","dashboard_name"],[1,"icon_abb_24","icon-abb_gauge_24"],["type","button","id","create_new_dashboard_button","nz-button","",1,"red",3,"click"],[1,"section-content"],[1,"gridster",3,"options"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[1,"gridster-content"],[1,"control-icons"],[1,"icon_abb_16","icon-abb_settings_16","gridster-item-content",3,"id","click"],[1,"icon_abb_16","icon-abb_trash_16","gridster-item-content",3,"id","click"],["class","widget-title",4,"ngIf"],[3,"item","id",4,"ngIf"],[3,"item","devices","widgetId","id",4,"ngIf"],[3,"item","devices","id",4,"ngIf"],[3,"item","contracts","tariffs","id",4,"ngIf"],[1,"widget-title"],[3,"item","id"],[3,"item","devices","widgetId","id"],[3,"item","devices","id"],[3,"item","contracts","tariffs","id"],["tabIndex","-1","nz-button","","id","add_widget_close_button",1,"drawer-button-close",3,"click"],[1,"icon_abb_16","icon-abb_close_16"],[1,"drawer-steps-container"],["class","drawer-steps-content",4,"ngIf"],[1,"drawer-steps-content"],[1,"drawer-title","text-line"],[1,"drawer-body","widgets"],["class","widget-box",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"widget-box",3,"id","ngClass","click"],[1,"widget-box-title"],[1,"widget-box-desc"],["id","previous_step",1,"drawer-step-go-back",3,"click"],[1,"icon_abb_16","icon-abb_left-arrow_16"],["id","widget_category",1,"drawer-title"],[1,"drawer-body"],["formAdd","ngForm"],[1,"form-group"],[1,"label-required"],[3,"field"],["type","text","maxlength","50","name","widgetTitle","id","widget_title_input","required","",1,"form-control","no-validate",3,"ngModel","ngModelChange"],["widgetTitle","ngModel"],["class","form-group",4,"ngIf"],["nz-button","","id","add_widget_drawer_button","nzType","primary",1,"drawer-step-next",3,"form","appFormButtonClick"],["inputId","widget_type_select",3,"model","options","validators","modelChange"],["inputId","widget_contract_select",3,"model","options","validators","modelChange"],["inputId","widget_tariffs_select",3,"model","options","validators","modelChange"],["name","widgetNoOfEvents","id","widget_no_of_events_input_wrapper","nzId","widget_no_of_events_input",1,"no-success",3,"ngModel","nzMin","nzMax","required","ngModelChange"],["widgetNoOfEventsInput","ngModel"],["inputId","widget_device_type_select",3,"model","options","validators","modelChange","callbackChange"],["inputId","widget_device_select",3,"model","multiple","options","validators","modelChange","callbackChange"],["inputId","widget_value_select",3,"model","multiple","options","validators","modelChange","callbackChange"],["inputId","widget_display_select",3,"model","options","validators","modelChange","callbackChange"],["inputId","widget_columns_select",3,"model","multiple","options","validators","modelChange"],["inputId","y_axis_select",3,"model","options","validators","modelChange"],["name","yAxisMin","id","y_axis_min_input_wrapper","nzId","y_axis_min_input",1,"no-success",3,"ngModel","nzMin","nzMax","required","ngModelChange"],["yAxisMin","ngModel"],["name","yAxisMax","id","y_axis_max_input_wrapper","nzId","y_axis_max_input",1,"no-success",3,"ngModel","nzMin","nzMax","required","ngModelChange"],["yAxisMax","ngModel"],["tabIndex","-1","nz-button","",1,"drawer-button-close",3,"click"],[1,"drawer-title"],["type","text","maxlength","50","name","dashboardName","id","dashboard_name_input","required","",1,"form-control","no-validate",3,"ngModel","ngModelChange"],["dashboardName","ngModel"],["nz-button","","id","add_dashboard_button","nzType","primary",1,"drawer-step-next",3,"form","appFormButtonClick"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.YNc(1,zo,21,14,"div",1),t.qZA(),t.YNc(2,ti,1,0,"app-loader",2),t.YNc(3,ga,3,2,"div",3),t.YNc(4,si,5,2,"ng-template",null,4,t.W1O),t.YNc(6,gr,20,12,"ng-template",null,5,t.W1O)),2&i&&(t.xp6(1),t.Q6J("ngIf",!s.loadingData),t.xp6(1),t.Q6J("ngIf",s.loadingData),t.xp6(1),t.Q6J("ngIf",!s.loadingData))},directives:[L.O5,zt.cm,zt.RR,K.wO,L.sg,K.r9,xt.w,L.mk,qa,Ua.ix,Bi.dQ,ft.R,ie.sm,ie.IM,nn,vi,dn,cl,hl,ps,Ss,Hs,Si,ho,He,To,Do,Po,jt._Y,jt.JL,jt.F,we.P,jt.Fj,jt.nD,jt.Q7,jt.JJ,jt.On,St.H,Qo._,Jo.b],pipes:[R.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding:0;overflow:hidden}#dashboard_name[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:42px}"]}),a})()},6531:(se,Dt,q)=>{q.d(Dt,{L:()=>t});var z=q(5e3);let t=(()=>{class R{transform(B){return B<1e3?"Wh":B<1e6?"kWh":B<1e9?"MWh":B<1e12?"GWh":B<1e15?"TWh":void 0}}return R.\u0275fac=function(B){return new(B||R)},R.\u0275pipe=z.Yjl({name:"calculateUnit",type:R,pure:!0}),R})()},9137:(se,Dt,q)=>{q.d(Dt,{_:()=>t});var z=q(5e3);let t=(()=>{class R{transform(B){return(B=Number(B))<1e3?B.toFixed(2):B<1e6?(B/1e3).toFixed(3):B<1e9?(B/1e6).toFixed(3):B<1e12?(B/1e9).toFixed(3):B<1e15?(B/1e12).toFixed(3):void 0}}return R.\u0275fac=function(B){return new(B||R)},R.\u0275pipe=z.Yjl({name:"rescaleEnergy",type:R,pure:!0}),R})()},1656:(se,Dt,q)=>{q.d(Dt,{z:()=>R});var z=q(5e3),t=q(2313);let R=(()=>{class pt{constructor(at){this.sanitized=at}transform(at){return this.sanitized.bypassSecurityTrustHtml(at)}}return pt.\u0275fac=function(at){return new(at||pt)(z.Y36(t.H7,16))},pt.\u0275pipe=z.Yjl({name:"safeHtml",type:pt,pure:!0}),pt})()},5893:(se,Dt,q)=>{q.d(Dt,{A:()=>t});var z=q(5e3);let t=(()=>{class R{transform(B,at){if(isNaN(B)||null===B||B>Number.MAX_SAFE_INTEGER)return"-";let Ct;return Ct=at?1===at?0:.1===at?1:.01===at?2:.001===at?3:2:2,B.toFixed(Ct)}}return R.\u0275fac=function(B){return new(B||R)},R.\u0275pipe=z.Yjl({name:"toFixed",type:R,pure:!0}),R})()},283:(se,Dt,q)=>{q.d(Dt,{U:()=>t});var z=q(5e3);let t=(()=>{class R{transform(B){return isNaN(B)||null===B?"-":new Date(1e3*B).toLocaleString()}}return R.\u0275fac=function(B){return new(B||R)},R.\u0275pipe=z.Yjl({name:"toLocaleString",type:R,pure:!0}),R})()},8520:(se,Dt,q)=>{q.d(Dt,{M:()=>R});var z=q(5e3),t=q(520);let R=(()=>{class pt{constructor(at){this.http=at}getTariff(at){return this.http.get("api/contracts/tariff",{params:{id:at}})}getContracts(){return this.http.get("api/contracts")}getContract(at){return this.http.get("api/contract",{params:{id:at}})}addContract(at){return this.http.post("api/contracts",{contract:at},{responseType:"text"})}saveContract(at){return this.http.put("api/contracts",{contract:at},{responseType:"text"})}removeContract(at){return this.http.post("api/contracts/remove",{contract:at},{responseType:"text"})}}return pt.\u0275fac=function(at){return new(at||pt)(z.LFG(t.eN))},pt.\u0275prov=z.Yz7({token:pt,factory:pt.\u0275fac,providedIn:"root"}),pt})()},7618:(se,Dt,q)=>{q.d(Dt,{a:()=>pt});var z=q(5e3),t=q(4521),R=q(9777);let pt=(()=>{class B{constructor(Ct,ee){this.router=Ct,this.appLoadService=ee}canActivate(Ct,ee){return!!this.appLoadService.user.logged||(this.router.navigate(["/login"],{queryParams:{returnUrl:ee.url}}),!1)}}return B.\u0275fac=function(Ct){return new(Ct||B)(z.LFG(t.F0),z.LFG(R.V))},B.\u0275prov=z.Yz7({token:B,factory:B.\u0275fac}),B})()}}]);