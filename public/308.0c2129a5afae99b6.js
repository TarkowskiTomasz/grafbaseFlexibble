"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[308],{2456:(W,R,d)=>{d.d(R,{u:()=>_});var M=d(3075),e=d(5e3);let _=(()=>{class u{validate(v){return this.takenPairs?this.takenPairs.find(Z=>Z.function===this.currentFunction.function&&Z.address===v.value)?{appInvalidValues:this.appInvalidValuesMsg}:null:this.appInvalidCheckFun?this.appInvalidValues(v.value)?{appInvalidValues:this.appInvalidValuesMsg}:null:this.takenPairs?this.takenPairs.some(Z=>Z.address===v.value&&Z.function===this.registerFunction)?{appInvalidValues:this.appInvalidValuesMsg}:null:this.appInvalidValues&&this.appInvalidValues.length&&this.appInvalidValues.includes(v.value)?{appInvalidValues:this.appInvalidValuesMsg}:null}}return u.\u0275fac=function(v){return new(v||u)},u.\u0275dir=e.lG2({type:u,selectors:[["","appInvalidValues",""]],inputs:{appInvalidValues:"appInvalidValues",registerFunction:"registerFunction",takenPairs:"takenPairs",currentFunction:"currentFunction",appInvalidValuesMsg:"appInvalidValuesMsg",appInvalidCheckFun:"appInvalidCheckFun"},features:[e._Bn([{provide:M.Cf,useExisting:u,multi:!0}])]}),u})()},1688:(W,R,d)=>{d.d(R,{M:()=>_});var M=d(3075),e=d(5e3);let _=(()=>{class u{validate(v){return v.value&&!/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)(\.(?!$)|$)){4}$/.test(v.value)?{appValidateIp:!0}:null}}return u.\u0275fac=function(v){return new(v||u)},u.\u0275dir=e.lG2({type:u,selectors:[["","appValidateIp",""]],features:[e._Bn([{provide:M.Cf,useExisting:u,multi:!0}])]}),u})()},2308:(W,R,d)=>{d.r(R),d.d(R,{MyPlantModule:()=>Vi});var M=d(4521),e=d(5e3),_=d(1062),u=d(2966),m=d(4063),v=d(520);let Z=(()=>{class o{constructor(t){this.http=t}getGroups(){return this.http.get("/api/groups")}setGroup(t){return this.http.post("api/groups",t,{responseType:"text"})}saveGroup(t){return this.http.put("api/groups",t,{responseType:"text"})}removeGroup(t){return this.http.post("api/groups/remove",{id:t},{responseType:"text"})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(v.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var A=d(408),b=d(6042),f=d(2643),T=d(2683),g=d(9808),D=d(8868),z=d(9767),l=d(2364),$=d(6093),C=d(6695);let I=(()=>{class o{constructor(t){this.webSocketService=t,this.cl="app-table-device-status",this.statuses={"-10":{class:"status-red",tooltip:"NOT_ASSIGNED"},"-3":{class:"status-red",tooltip:"WRONG_DECRYPTION_KEY"},"-2":{class:"status-gray",tooltip:"WAITING_FOR_DATA"},"-1":{class:"status-red",tooltip:"NOT_RESPONDING"},0:{class:"status-yellow",tooltip:"PARTIALLY_RESPONDING"},1:{class:"status-green",tooltip:"OK"}}}ngOnInit(){this.webSocketService.addCollectStatusesData(this.object_id),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(t=>{t.object_id&&t.object_id===this.object_id&&t.hasOwnProperty("status")&&(this.status=t.status)})}ngOnDestroy(){this.subscriptionSocket&&(this.webSocketService.removeCollectStatusesData(this.object_id),this.subscriptionSocket.unsubscribe())}}return o.\u0275fac=function(t){return new(t||o)(e.Y36($.l))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-table-device-status"]],hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("class",n.cl)},inputs:{assigned:"assigned",object_id:"object_id",id:"id",status:"status"},decls:2,vars:7,consts:[["nz-tooltip","",1,"status-cell",3,"id","nzTooltipTitle"]],template:function(t,n){1&t&&(e._UZ(0,"div",0),e.ALo(1,"translate")),2&t&&(e.Tol(n.statuses[n.status]?n.statuses[n.status].class:void 0),e.s9C("nzTooltipTitle",n.statuses[n.status]?e.lcZ(1,5,n.statuses[n.status].tooltip):void 0),e.Q6J("id",n.id))},directives:[C.SY],pipes:[_.X$],styles:[""]}),o})();var c=d(3075),O=d(2374),q=d(7003),S=d(7815);const ve=["groupDrawer"];function be(o,a){1&o&&e._UZ(0,"app-loader")}function fe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",25),e.TgZ(1,"span",26),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",27),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(2);return e.oxw().removeGroups(i)}),e._UZ(5,"i",28),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.qZA()}if(2&o){e.oxw();const t=e.MAs(2);e.xp6(2),e.AsE("",t.nrOfSelected," ",e.lcZ(3,3,"SELECTED"),""),e.xp6(4),e.hij("",e.lcZ(7,5,"REMOVE")," ")}}function Te(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",29),e.NdJ("nzCheckedChange",function(i){const r=e.CHM(t).$implicit;return e.oxw(),e.MAs(2).onItemSelected(r,i)}),e._UZ(2,"app-table-device-status",30),e.qZA(),e.TgZ(3,"td",20),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td",31),e.TgZ(12,"button",32),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).openGroupDrawer(s)}),e.ALo(13,"translate"),e._UZ(14,"i",33),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(2),s=e.oxw();e.xp6(1),e.MGl("id","table_item_checkbox_",n,""),e.Q6J("nzLeft",i.allowNzLeft)("nzChecked",t.selected),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.Oqu(t.object_id),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(s.getDevices(t.devices).join(", ")),e.xp6(2),e.MGl("id","edit_group_button_",n,""),e.s9C("nzTooltipTitle",e.lcZ(13,13,"EDIT"))}}const Ce=function(){return{key:"id",value:"ascend"}},Me=function(o,a){return{x:o,y:a}},K=function(){return["ascend","descend"]};function Ze(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"app-table",7,8),e.YNc(3,fe,8,7,"div",9),e.TgZ(4,"nz-table",10,11),e.ALo(6,"translate"),e.TgZ(7,"thead",12),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(2).sort(i)}),e.TgZ(8,"tr"),e.TgZ(9,"th",13),e.NdJ("nzCheckedChange",function(i){return e.CHM(t),e.MAs(2).onAllSelected(i)}),e.qZA(),e.TgZ(10,"th",14),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th",15),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th",16),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th",17),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"th",18),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.qZA(),e.TgZ(25,"tr",19),e._UZ(26,"th",20),e.TgZ(27,"th",21),e.TgZ(28,"input",22),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"object_id","contains")}),e.qZA(),e.qZA(),e.TgZ(29,"th",23),e.TgZ(30,"input",22),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"name","contains")}),e.qZA(),e.qZA(),e.TgZ(31,"th",23),e.TgZ(32,"input",22),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"description","contains")}),e.qZA(),e.qZA(),e._UZ(33,"th"),e._UZ(34,"th"),e.qZA(),e.qZA(),e.TgZ(35,"tbody"),e.YNc(36,Te,15,15,"tr",24),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(5),i=e.oxw();e.xp6(1),e.Q6J("initSort",e.DdM(44,Ce))("data",i.rows),e.xp6(2),e.Q6J("ngIf",t.nrOfSelected),e.xp6(1),e.Q6J("nzData",t.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(45,Me,t.tableWidth,t.tableHeight))("nzNoResult",e.lcZ(6,32,"NO_GROUPS")),e.xp6(5),e.Q6J("nzLeft",t.allowNzLeft)("nzChecked",t.selected)("nzIndeterminate",t.indeterminate),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft)("nzColumnKey","object_id")("nzSortFn",!0)("nzSortOrder","ascend")("nzSortDirections",e.DdM(48,K)),e.xp6(1),e.hij(" ",e.lcZ(12,34,"ID")," "),e.xp6(2),e.Q6J("nzLeft",t.allowNzLeft)("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(49,K)),e.xp6(1),e.hij(" ",e.lcZ(15,36,"NAME")," "),e.xp6(2),e.Q6J("nzColumnKey","description")("nzSortFn",!0)("nzSortDirections",e.DdM(50,K)),e.xp6(1),e.hij(" ",e.lcZ(18,38,"DESCRIPTION")," "),e.xp6(2),e.Q6J("nzColumnKey","description"),e.xp6(1),e.hij(" ",e.lcZ(21,40,"DEVICES")," "),e.xp6(3),e.Oqu(e.lcZ(24,42,"ACTION")),e.xp6(3),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(9),e.Q6J("ngForOf",n.data)("ngForTrackBy",i.trackByFun)}}const xe=function(){return{required:!0}};function Ae(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",34),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",35),e.TgZ(4,"button",36),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeGroupDrawer()}),e._UZ(5,"i",37),e.qZA(),e.TgZ(6,"form",null,38),e.TgZ(8,"div",39),e.TgZ(9,"label",40),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"app-validate",41),e.TgZ(13,"input",42,43),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editGroup.name=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"div",39),e.TgZ(16,"label",40),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"app-validate",41),e.TgZ(20,"input",44,45),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editGroup.description=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",39),e.TgZ(23,"label",40),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"app-select",46),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editGroup.device_ids=i}),e.qZA(),e.qZA(),e.TgZ(27,"div",39),e._UZ(28,"label"),e.TgZ(29,"button",47),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeGroupDrawer(!0)}),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"button",48),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw().saveGroup()}),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(7),n=e.MAs(14),i=e.MAs(21),s=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,20,s.editGroup.object_id?"EDIT_GROUP":"ADD_NEW_GROUP")," "),e.xp6(9),e.Oqu(e.lcZ(11,22,"GROUP_NAME")),e.xp6(2),e.Q6J("field",n),e.xp6(1),e.Q6J("ngModel",s.editGroup.name),e.xp6(4),e.Oqu(e.lcZ(18,24,"DESCRIPTION")),e.xp6(2),e.Q6J("field",i),e.xp6(1),e.Q6J("ngModel",s.editGroup.description),e.xp6(4),e.Oqu(e.lcZ(25,26,"DEVICES")),e.xp6(2),e.Q6J("model",s.editGroup.device_ids)("options",s.groupDevices)("multiple",!0)("clearable",!0)("validators",e.DdM(32,xe)),e.xp6(3),e.uIk("id","drawer_cancel_button"),e.xp6(1),e.hij(" ",e.lcZ(31,28,"CANCEL")," "),e.xp6(2),e.Q6J("nzLoading",s.saving)("disabled",s.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.hij(" ",e.lcZ(34,30,s.editGroup.object_id?"SAVE_GROUP":"ADD_GROUP")," ")}}let De=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.groupService=s,this.drawerService=r,this.id="my_plant_groups",this.loadingData=!0,this.saving=!1,this.devices=[],this.editMode=!1}ngOnInit(){this.getData()}getData(){this.loadingData=!0,this.groupService.getGroups().subscribe(t=>{this.rows=t.groups,this.devices=t.devices,this.loadingData=!1,this.checkGroupDevices()},t=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}removeGroups(t){const n=[];let i,s,r;t.tableData.forEach(p=>{p.selected&&n.push(p.object_id)}),n.length>1?(i=this.translate.instant("GROUP_REMOVE_ALL"),s=this.translate.instant("GROUP_REMOVE_ALL_SUCCESS")):(r=this.rows.findIndex(p=>p.object_id===n[0]),i=this.translate.instant("GROUP_REMOVE",{name:"<strong>"+this.rows[r].name+"</strong>"}),s=this.translate.instant("GROUP_REMOVE_SUCCESS",{name:"<strong>"+this.rows[r].name+"</strong>"})),this.modalService.showConfirm(i,()=>{this.modalService.setLoading(!0),this.groupService.removeGroup(n).subscribe(()=>{this.modalService.hide(),this.getData(),this.toastr.success(s)},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})})}openGroupDrawer(t){this.toastr.clear();let n=[];this.groupDevices.forEach(i=>{null==t||t.devices.forEach(s=>{s===i.id&&n.push(i.id)})}),this.editMode&&!t?this.editGroup=this.tempGroup:t?(t.device_ids=n,this.editGroup=Object.assign({},t)):(this.editGroup={object_id:0,name:"",description:"",device_ids:[]},this.tempGroup=this.editGroup),this.drawerService.showDrawer(this.groupDrawer).subscribe(i=>{this.editMode=!!this.tempGroup})}checkGroupDevices(){this.groupDevices=this.devices.map(t=>({id:t.object_id,name:t.name}))}saveGroup(){let t,n;this.saving=!0,this.editMode=!1,this.editGroup.object_id?(n="GROUP_EDIT_SUCCESS",t=this.groupService.saveGroup(this.editGroup)):(n="GROUP_ADD_SUCCESS",t=this.groupService.setGroup(this.editGroup)),t.subscribe(()=>{this.toastr.success(this.translate.instant(n,{name:"<strong>"+this.editGroup.name+"</strong>"})),this.getData(),this.drawerService.hide(),this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1}),this.tempGroup=null}closeGroupDrawer(t){this.drawerService.hide(),t?this.tempGroup={}:this.editMode=!!this.tempGroup}trackByFun(t,n){return n.object_id}getDevices(t){let n=[];return t.forEach(i=>{this.devices.forEach(s=>{s.object_id===i&&n.push(s.name)})}),n}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(Z),e.Y36(A.z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-groups"]],viewQuery:function(t,n){if(1&t&&e.Gf(ve,5),2&t){let i;e.iGM(i=e.CRH())&&(n.groupDrawer=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:9,vars:5,consts:[[1,"section-header"],["nz-button","","nzType","primary","id","add_new_group_button",3,"click"],[1,"icon_abb_16","icon-abb_plus_16"],[4,"ngIf"],["class","section-content",4,"ngIf"],["groupDrawer",""],[1,"section-content"],[3,"initSort","data"],["table",""],["class","table-selected-buttons",4,"ngIf"],["nzTableLayout","fixed",3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["id","table_all_selected","nzWidth","60px",3,"nzLeft","nzChecked","nzIndeterminate","nzCheckedChange"],["nzWidth","60px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortOrder","nzSortDirections"],["nzWidth","150px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","150px",3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","150px",3,"nzColumnKey"],["nzWidth","80px"],[1,"filters"],[3,"nzLeft"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-selected-buttons"],["id","table_nr_of_selected"],["nz-button","","nzType","primary","id","table_selected_remove_button",1,"black",3,"click"],[1,"icon_abb_16","icon-abb_trash_16"],[3,"id","nzLeft","nzChecked","nzCheckedChange"],[3,"id","status","object_id"],[1,"icons"],["nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_edit_16"],[1,"drawer-title","text-line"],[1,"drawer-body"],["tabIndex","-1","nz-button","",1,"drawer-button-close",3,"click"],[1,"icon_abb_16","icon-abb_close_16"],["formAdd","ngForm"],[1,"form-group"],[1,"label-required"],[3,"field"],["type","text","maxlength","255","id","group_name_input","name","groupName","required","",3,"ngModel","ngModelChange"],["groupName","ngModel"],["type","text","maxlength","255","id","group_description_input","name","groupDescription","required","",3,"ngModel","ngModelChange"],["description","ngModel"],["inputId","group_device_select",3,"model","options","multiple","clearable","validators","modelChange"],["type","button","nz-button","",3,"click"],["type","submit","nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return n.openGroupDrawer()}),e._UZ(2,"i",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.qZA(),e.YNc(5,be,1,0,"app-loader",3),e.YNc(6,Ze,37,51,"div",4),e.YNc(7,Ae,35,33,"ng-template",null,5,e.W1O)),2&t&&(e.xp6(3),e.hij("",e.lcZ(4,3,"ADD_GROUP_NEW")," "),e.xp6(2),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[b.ix,f.dQ,T.w,g.O5,D.R,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.g6,l.qD,l.p0,g.sg,l.h7,I,C.SY,c._Y,c.JL,c.F,O.P,c.Fj,c.nD,c.Q7,c.JJ,c.On,q.H,S.b],pipes:[_.X$],styles:[".section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}"]}),o})();var J=d(868);function Se(o,a){1&o&&(e.TgZ(0,"a",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"CURRENT_SENSORS")," "))}function ye(o,a){1&o&&(e.TgZ(0,"a",10),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"IO_MODULES")," "))}function Ee(o,a){1&o&&(e.TgZ(0,"a",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SSD")," "))}function Re(o,a){1&o&&(e.TgZ(0,"a",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"MOD")," "))}function ze(o,a){1&o&&(e.TgZ(0,"a",13),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"MODBUS_RTU_DEVICES")," "))}function Ie(o,a){1&o&&(e.TgZ(0,"a",14),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"MODBUS_TCP_DEVICES")," "))}function qe(o,a){1&o&&(e.TgZ(0,"a",15),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"WIRELESS_MBUS")," "))}let Ue=(()=>{class o{constructor(){this.id="devices"}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-devices"]],hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:16,vars:1,consts:[["nzType","card","nzLinkRouter","",3,"nzAnimated"],["id","menu_my_plant_devices_current_sensors","nz-tab-link","","routerLink","/my-plant/devices/current-sensors",4,"nzTabLink"],["id","menu_my_plant_devices_io_modules","nz-tab-link","","routerLink","/my-plant/devices/io-modules",4,"nzTabLink"],["id","menu_my_plant_devices_ssd","nz-tab-link","","routerLink","/my-plant/devices/ssd",4,"nzTabLink"],["id","menu_my_plant_devices_mod","nz-tab-link","","routerLink","/my-plant/devices/mod",4,"nzTabLink"],["id","menu_my_plant_devices_modbus_rtu_devices","nz-tab-link","","routerLink","/my-plant/devices/modbus-rtu-devices",4,"nzTabLink"],["id","menu_my_plant_devices_modbus_tcp_devices","nz-tab-link","","routerLink","/my-plant/devices/modbus-tcp-devices",4,"nzTabLink"],["id","menu_my_plant_devices_wireless_mbus_meters","nz-tab-link","","routerLink","/my-plant/devices/wireless-mbus",4,"nzTabLink"],[1,"router-outlet"],["id","menu_my_plant_devices_current_sensors","nz-tab-link","","routerLink","/my-plant/devices/current-sensors"],["id","menu_my_plant_devices_io_modules","nz-tab-link","","routerLink","/my-plant/devices/io-modules"],["id","menu_my_plant_devices_ssd","nz-tab-link","","routerLink","/my-plant/devices/ssd"],["id","menu_my_plant_devices_mod","nz-tab-link","","routerLink","/my-plant/devices/mod"],["id","menu_my_plant_devices_modbus_rtu_devices","nz-tab-link","","routerLink","/my-plant/devices/modbus-rtu-devices"],["id","menu_my_plant_devices_modbus_tcp_devices","nz-tab-link","","routerLink","/my-plant/devices/modbus-tcp-devices"],["id","menu_my_plant_devices_wireless_mbus_meters","nz-tab-link","","routerLink","/my-plant/devices/wireless-mbus"]],template:function(t,n){1&t&&(e.TgZ(0,"nz-tabset",0),e.TgZ(1,"nz-tab"),e.YNc(2,Se,3,3,"a",1),e.qZA(),e.TgZ(3,"nz-tab"),e.YNc(4,ye,3,3,"a",2),e.qZA(),e.TgZ(5,"nz-tab"),e.YNc(6,Ee,3,3,"a",3),e.qZA(),e.TgZ(7,"nz-tab"),e.YNc(8,Re,3,3,"a",4),e.qZA(),e.TgZ(9,"nz-tab"),e.YNc(10,ze,3,3,"a",5),e.qZA(),e.TgZ(11,"nz-tab"),e.YNc(12,Ie,3,3,"a",6),e.qZA(),e.TgZ(13,"nz-tab"),e.YNc(14,qe,3,3,"a",7),e.qZA(),e.qZA(),e._UZ(15,"router-outlet",8)),2&t&&e.Q6J("nzAnimated",!1)},directives:[J.xH,J.xw,J.Fx,J.Ao,M.yS,M.lC],pipes:[_.X$],styles:[""]}),o})();var Oe=d(9059),L=d(7420),k=d(4639),X=d(9010),re=d(493);const Le=["identifyTemplate"];function we(o,a){if(1&o&&(e._UZ(0,"app-loader",3),e.TgZ(1,"div",4),e.TgZ(2,"p"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e.TgZ(6,"button",6),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,3,t.translatedWidget.identify)),e.xp6(3),e.uIk("id","modal_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(8,5,"DONE"))}}let Q=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.cmmioconfService=s,this.webSocketService=r,this.cl="app-cmmioconf-identify",this.translatedWidget={identify:""}}ngOnInit(){this.getTypeTranslation(this.type)}ngOnDestroy(){this.subscriptionSocket&&(this.webSocketService.setCollectData(),this.subscriptionSocket.unsubscribe())}getTypeTranslation(t){this.translatedWidget=this.cmmioconfService.getTypeTranslation(t)}identifyModal(){this.toastr.clear(),this.modalService.showModal(this.identifyTemplate,()=>{this.cmmioconfService.stop().subscribe()}),this.identify()}identify(){this.cmmioconfService.identify(this.type).subscribe(t=>{this.initWatchProcess(t.pid)},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})}initWatchProcess(t){this.subscriptionSocket&&this.subscriptionSocket.unsubscribe(),this.webSocketService.setCollectData({process_id:t}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(n=>{n.disconnected?this.processStatus({status:"error"}):n.process_id&&n.process_id===t&&this.processStatus(n.data)})}processStatus(t){switch(this.modalService.visible&&this.toastr.clear(),t.status){case"ok":this.toastr.info(this.translate.instant("IDENTIFY_SUCCESS")+" "+t.modbus_id,!0);break;case"device not assigned":this.toastr.info(this.translate.instant("IDENTIFY_NOT_ASSIGNED"),!0);break;case"incompatible device type":this.toastr.error(this.translate.instant("ERROR_INCOMPATIBLE_DEVICE_TYPE"),!0),this.modalService.hide();break;case"timeout":this.toastr.error(this.translate.instant("IDENTIFY_TIMEOUT"),!0),this.modalService.hide();break;default:this.modalService.visible&&(this.toastr.error(this.translate.instant("REQUEST_ERROR"),!0),this.modalService.hide())}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(X.I),e.Y36($.l))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-cmmioconf-identify"]],viewQuery:function(t,n){if(1&t&&e.Gf(Le,5),2&t){let i;e.iGM(i=e.CRH())&&(n.identifyTemplate=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("class",n.cl)},inputs:{type:"type"},decls:6,vars:3,consts:[["nz-button","","id","identify_button",3,"click"],[1,"icon_abb_16","icon-abb_search_16"],["identifyTemplate",""],["type","modal"],[1,"p-dialog-body"],[1,"p-dialog-footer"],["nz-button","","appHideModal",""]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.identifyModal()}),e._UZ(1,"i",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,we,9,7,"ng-template",null,2,e.W1O)),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"IDENTIFY"),"\n"))},directives:[b.ix,f.dQ,T.w,D.R,re.u],pipes:[_.X$],styles:[".app-cmmioconf-change-modbus-id[_nghost-%COMP%], .app-cmmioconf-identify[_nghost-%COMP%], [_nghost-%COMP%]   .remove-all[_ngcontent-%COMP%]{margin-left:9px}"]}),o})();var w=d(656);let Ne=(()=>{class o{validate(t){return this.appValidValues.includes(t.value)?null:{appValidValues:this.appValidValuesMsg}}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","appValidValues",""]],inputs:{appValidValues:"appValidValues",appValidValuesMsg:"appValidValuesMsg"},features:[e._Bn([{provide:c.Cf,useExisting:o,multi:!0}])]}),o})();var ee=d(2456);const Pe=["changeModbusIdTemplate"];function Je(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeChangeDrawer()}),e._UZ(1,"i",4),e.qZA(),e.TgZ(2,"div",5),e._uU(3),e.qZA(),e.TgZ(4,"div",6),e.TgZ(5,"p"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"form",null,7),e.TgZ(10,"div",8),e.TgZ(11,"label"),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"app-validate",9),e.TgZ(15,"nz-input-number",10,11),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().changeDevice.oldId=i}),e.ALo(17,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"div",8),e.TgZ(19,"label"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"app-validate",9),e.TgZ(23,"nz-input-number",12,13),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().changeDevice.newId=i}),e.ALo(25,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"div",8),e._UZ(27,"label"),e.TgZ(28,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeChangeDrawer()}),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",15),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw().saveDeviceId()}),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(9),n=e.MAs(16),i=e.MAs(24),s=e.oxw();e.xp6(3),e.hij(" ","Change modbus ID"," "),e.xp6(3),e.Oqu(e.lcZ(7,25,"DEVICE_CHANGE_MODBUS_ID")),e.xp6(6),e.hij("",e.lcZ(13,27,"CURRENT_ID"),":"),e.xp6(2),e.Q6J("field",n),e.xp6(1),e.Q6J("ngModel",s.changeDevice.oldId)("nzMin",1)("nzMax",32)("required",!0)("appValidValues",s.takenModbusTypeDevicesIds)("appValidValuesMsg",e.lcZ(17,29,"ERROR_IS_NOT_ASSIGNED")),e.xp6(5),e.hij("",e.lcZ(21,31,"NEW_ID"),":"),e.xp6(2),e.Q6J("field",i),e.xp6(1),e.Q6J("ngModel",s.changeDevice.newId)("nzMin",1)("nzMax",32)("required",!0)("appInvalidValues",s.takenModbusDevicesIds)("appInvalidValuesMsg",e.lcZ(25,33,"ERROR_ALREADY_ASSIGNED")),e.xp6(5),e.uIk("id","drawer_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(30,35,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",s.saving)("disabled",s.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(33,37,"APPLY"))}}let F=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.cmmioconfService=s,this.drawerService=r,this.cl="app-cmmioconf-change-modbus-id",this.saving=!1,this.changeDevice={oldId:1,newId:1}}openChangeDrawer(){this.checkTakenIds(),this.drawerService.showDrawer(this.changeModbusIdTemplate)}closeChangeDrawer(){this.drawerService.hide()}saveDeviceId(){this.saving=!0,this.cmmioconfService.changeModbusId(this.changeDevice.oldId,this.changeDevice.newId,this.type).subscribe(t=>{switch(t.status){case"ok":this.toastr.success(this.translate.instant("DEVICE_CHANGE_MODBUS_ID_SAVE_SUCCESS")),this.callbackChange(),this.modalService.hide();break;case"old modbus_id not exists":this.toastr.error(this.translate.instant("ERROR_IS_NOT_ASSIGNED"));break;case"new modbus_id already assigned":this.toastr.error(this.translate.instant("ERROR_IS_ALREADY_ASSIGNED"));break;case"incompatible device type":this.toastr.error(this.translate.instant("ERROR_INCOMPATIBLE_DEVICE_TYPE")),this.modalService.hide();break;default:this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()}this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide(),this.saving=!1})}checkTakenIds(){this.takenModbusDevicesIds=this.existingDevices.map(({modbus_id:t})=>t),this.takenModbusTypeDevicesIds=this.existingDevices.filter(t=>t.device_type===this.type).map(({modbus_id:t})=>t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(X.I),e.Y36(A.z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-cmmioconf-change-modbus-id"]],viewQuery:function(t,n){if(1&t&&e.Gf(Pe,5),2&t){let i;e.iGM(i=e.CRH())&&(n.changeModbusIdTemplate=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("class",n.cl)},inputs:{type:"type",existingDevices:"existingDevices",callbackChange:"callbackChange"},decls:6,vars:3,consts:[["nz-button","","id","change_id_button",3,"click"],[1,"icon_abb_16","icon-abb_shuffle_16"],["changeModbusIdTemplate",""],["tabIndex","-1","nz-button","",1,"drawer-button-close",3,"click"],[1,"icon_abb_16","icon-abb_close_16"],[1,"drawer-title","text-line"],[1,"drawer-body"],["formChangeId","ngForm"],[1,"form-group"],[3,"field"],["name","changeDevicePreviousId","id","change_device_previous_id_input_wrapper","nzId","change_device_previous_id_input",1,"no-success",3,"ngModel","nzMin","nzMax","required","appValidValues","appValidValuesMsg","ngModelChange"],["changeDevicePreviousId","ngModel"],["name","changeDeviceNewId","id","change_device_new_id_input_wrapper","nzId","change_device_new_id_input",1,"no-success",3,"ngModel","nzMin","nzMax","required","appInvalidValues","appInvalidValuesMsg","ngModelChange"],["changeDeviceNewId","ngModel"],["nz-button","",3,"click"],["nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.openChangeDrawer()}),e._UZ(1,"i",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Je,34,39,"ng-template",null,2,e.W1O)),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"CHANGE_MODBUS_ID"),"\n"))},directives:[b.ix,f.dQ,T.w,c._Y,c.JL,c.F,O.P,w._,c.JJ,c.On,c.Q7,Ne,ee.u,S.b],pipes:[_.X$],styles:[".app-cmmioconf-change-modbus-id[_nghost-%COMP%], .app-cmmioconf-identify[_nghost-%COMP%], [_nghost-%COMP%]   .remove-all[_ngcontent-%COMP%]{margin-left:9px}"]}),o})();function ke(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().removeDevice()}),e._UZ(1,"i",3),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"REMOVE_ALL"),"\n"))}function Qe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){return e.CHM(t),e.oxw().removeDevice()}),e.ALo(1,"translate"),e._UZ(2,"i",5),e.qZA()}if(2&o){const t=e.oxw();e.s9C("nzTooltipTitle",e.lcZ(1,2,"REMOVE")),e.Q6J("id",t.id)}}let V=(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.modalService=i,this.cmmioconfService=s,this.saving=!1}ngOnInit(){}removeDevice(){let t,n;this.toastr.clear(),"CurrentSensor"===this.type?(t=0===this.object_id?"CURRENT_SENSORS_REMOVE_ALL":"CURRENT_SENSORS_REMOVE",n=0===this.object_id?"CURRENT_SENSORS_REMOVE_ALL_SUCCESS":"CURRENT_SENSORS_REMOVE_SUCCESS"):"ModAriArh"===this.type?(t=0===this.object_id?"MOD_REMOVE_ALL":"MOD_REMOVE",n=0===this.object_id?"MOD_REMOVE_ALL_SUCCESS":"MOD_REMOVE_SUCCESS"):"AuxiliaryContact"===this.type?(t=0===this.object_id?"SSD_REMOVE_ALL":"SSD_REMOVE",n=0===this.object_id?"SSD_REMOVE_ALL_SUCCESS":"SSD_REMOVE_SUCCESS"):(t=0===this.object_id?"IO_MODULES_REMOVE_ALL":"IO_MODULES_REMOVE",n=0===this.object_id?"IO_MODULES_REMOVE_ALL_SUCCESS":"IO_MODULES_REMOVE_SUCCESS"),this.modalService.showConfirm(this.translate.instant(t,{name:"<strong>"+this.name+"</strong>"}),()=>{this.cmmioconfService.remove(this.object_id,this.type).subscribe(()=>{this.toastr.success(this.translate.instant(n,{name:"<strong>"+this.name+"</strong>"})),this.modalService.hide(),this.callbackChange()},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})},()=>this.modalService.hide(),this.translate.instant(0===this.object_id?"DEVICE_REMOVE_WARNING_ALL":"DEVICE_REMOVE_WARNING"))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(X.I))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-cmmioconf-remove"]],inputs:{type:"type",id:"id",object_id:"object_id",name:"name",callbackChange:"callbackChange"},decls:2,vars:2,consts:[["type","button","id","remove_all_button","nz-button","","class","remove-all",3,"click",4,"ngIf"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click",4,"ngIf"],["type","button","id","remove_all_button","nz-button","",1,"remove-all",3,"click"],[1,"icon_abb_16","icon-abb_trash_16"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_close_16"]],template:function(t,n){1&t&&(e.YNc(0,ke,4,3,"button",0),e.YNc(1,Qe,3,4,"button",1)),2&t&&(e.Q6J("ngIf",0===n.object_id),e.xp6(1),e.Q6J("ngIf",0!==n.object_id))},directives:[g.O5,b.ix,f.dQ,T.w,C.SY],pipes:[_.X$],styles:[".app-cmmioconf-change-modbus-id[_nghost-%COMP%], .app-cmmioconf-identify[_nghost-%COMP%], [_nghost-%COMP%]   .remove-all[_ngcontent-%COMP%]{margin-left:9px}"]}),o})();var Y=d(8397);let Fe=(()=>{class o{constructor(t){this.http=t}setPowerStatus(t,n){return this.http.post("api/led-off",{ledoff_timeout:t,ledoff_timeout_copy:n},{responseType:"text"})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(v.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),j=(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.modalService=i,this.ledOffService=s}ngOnInit(){this.ledTimeoutOptions=[{id:30,text:"30",additional_text:"RESOLUTION_S"},{id:60,text:"60",additional_text:"RESOLUTION_S"},{id:90,text:"90",additional_text:"RESOLUTION_S"},{id:120,text:"2",additional_text:"RESOLUTION_MIN"},{id:180,text:"3",additional_text:"RESOLUTION_MIN"},{id:240,text:"4",additional_text:"RESOLUTION_MIN"},{id:300,text:"5",additional_text:"RESOLUTION_MIN"},{id:600,text:"10",additional_text:"RESOLUTION_MIN"},{id:900,text:"15",additional_text:"RESOLUTION_MIN"},{id:-1,text:this.translate.instant("ALWAYS_ON")}],this.ledoff_timeoutCopy=this.ledoff_timeout}setPowerStatus(){this.modalService.showConfirm(this.translate.instant("CONFIRM_LED_OFF"),()=>{this.ledOffService.setPowerStatus(this.ledoff_timeout,this.ledoff_timeoutCopy).subscribe(()=>{this.toastr.success(this.translate.instant("SAVE_LED_OFF")),this.ledoff_timeoutCopy=this.ledoff_timeout,this.modalService.hide()},()=>{this.modalService.hide(),this.toastr.error(this.translate.instant("REQUEST_ERROR"))})},()=>{this.ledoff_timeout=this.ledoff_timeoutCopy,this.modalService.hide()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(Fe))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-led-off"]],inputs:{ledoff_timeout:"ledoff_timeout"},decls:4,vars:5,consts:[[1,"led-timeout"],["inputClass","no-validate","inputId","led_timeout",3,"model","options","modelChange","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"app-select",1),e.NdJ("modelChange",function(s){return n.ledoff_timeout=s})("callbackChange",function(){return n.setPowerStatus()}),e.qZA(),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,3,"LED_OFF_TIMEOUT"),": "),e.xp6(2),e.Q6J("model",n.ledoff_timeout)("options",n.ledTimeoutOptions))},directives:[q.H],pipes:[_.X$],styles:[""]}),o})();var P=d(442);const Ve=["sourceTemplate"],Ye=["form"];function je(o,a){1&o&&e._UZ(0,"app-loader")}function Be(o,a){if(1&o&&(e.TgZ(0,"span",42),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.AsE(" ",e.lcZ(2,2,"VALUE"),": ",t.voltage_value," ")}}function Ge(o,a){if(1&o&&(e.TgZ(0,"span",43),e.ALo(1,"valueFromId"),e.ALo(2,"translate"),e._uU(3),e.ALo(4,"valueFromId"),e.ALo(5,"translate"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.hYB("title","",e.xi3(1,4,t.voltage_source_object_id,n.editSourceDevicesSelect),": ",e.lcZ(2,7,t.voltage_source_variable||"-"),""),e.xp6(3),e.AsE(" ",e.xi3(4,9,t.voltage_source_object_id,n.editSourceDevicesSelect),": ",e.lcZ(5,12,t.voltage_source_variable||"-")," ")}}function He(o,a){if(1&o&&(e.TgZ(0,"span",42),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.AsE(" ",e.lcZ(2,2,"VALUE"),": ",t.power_factor_value," ")}}function We(o,a){if(1&o&&(e.TgZ(0,"span",43),e.ALo(1,"valueFromId"),e.ALo(2,"translate"),e._uU(3),e.ALo(4,"valueFromId"),e.ALo(5,"translate"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.hYB("title","",e.xi3(1,4,t.power_factor_source_object_id,n.editSourceDevicesSelect),": ",e.lcZ(2,7,t.power_factor_source_variable||"-"),""),e.xp6(3),e.AsE(" ",e.xi3(4,9,t.power_factor_source_object_id,n.editSourceDevicesSelect),": ",e.lcZ(5,12,t.power_factor_source_variable||"-")," ")}}const $e=function(o){return{blink:o}};function Ke(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",29),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).blinkSensor(s)}),e.TgZ(1,"td",30),e._UZ(2,"app-table-device-status",31),e._uU(3),e.qZA(),e.TgZ(4,"td",22),e.TgZ(5,"input",32),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit.name=i}),e.ALo(6,"translate"),e.qZA(),e.qZA(),e.TgZ(7,"td",22),e.TgZ(8,"app-select",33),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.phase_id=i}),e.qZA(),e.qZA(),e.TgZ(9,"td",22),e.TgZ(10,"app-select",34),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.device_category=i}),e.qZA(),e.qZA(),e.TgZ(11,"td",35),e.YNc(12,Be,3,4,"span",36),e.YNc(13,Ge,6,14,"span",37),e.TgZ(14,"button",38),e.NdJ("click",function(){const s=e.CHM(t).$implicit;e.oxw();const r=e.MAs(4);return e.oxw().openEditSourceDrawer(s,"voltage",r.tableData)}),e.ALo(15,"translate"),e._UZ(16,"i",39),e.qZA(),e.qZA(),e.TgZ(17,"td",35),e.YNc(18,He,3,4,"span",36),e.YNc(19,We,6,14,"span",37),e.TgZ(20,"button",38),e.NdJ("click",function(){const s=e.CHM(t).$implicit;e.oxw();const r=e.MAs(4);return e.oxw().openEditSourceDrawer(s,"power_factor",r.tableData)}),e.ALo(21,"translate"),e._UZ(22,"i",39),e.qZA(),e.qZA(),e.TgZ(23,"td",40),e._UZ(24,"app-cmmioconf-remove",41),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(4),s=e.MAs(2),r=e.oxw();e.Q6J("ngClass",e.VKq(35,$e,t.blink)),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.Oqu(t.modbus_id||"-"),e.xp6(2),e.MGl("id","sensor_name_input_",n,""),e.MGl("name","sensorName",n,""),e.s9C("nzTooltipTitle",null!=s.controls["sensorName"+n]&&s.controls["sensorName"+n].errors?e.lcZ(6,29,"VALIDATE_REQUIRED"):""),e.Q6J("ngModel",t.name),e.xp6(3),e.MGl("inputId","sensor_phase_select_",n,""),e.Q6J("model",t.phase_id)("options",r.phases),e.xp6(2),e.MGl("inputId","sensor_device_category_select_",n,""),e.Q6J("model",t.device_category)("options",r.deviceCategories)("clearable",!0),e.xp6(2),e.Q6J("ngIf",0===t.voltage_source_type_id),e.xp6(1),e.Q6J("ngIf",1===t.voltage_source_type_id),e.xp6(1),e.MGl("id","sensor_voltage_source_button_",n,""),e.s9C("nzTooltipTitle",e.lcZ(15,31,"EDIT_VOLTAGE_SOURCE")),e.xp6(4),e.Q6J("ngIf",0===t.power_factor_source_type_id),e.xp6(1),e.Q6J("ngIf",1===t.power_factor_source_type_id),e.xp6(1),e.MGl("id","sensor_power_factor_source_button_",n,""),e.s9C("nzTooltipTitle",e.lcZ(21,33,"EDIT_POWER_FACTOR_SOURCE")),e.xp6(4),e.MGl("id","remove_device_button_",n,""),e.Q6J("object_id",t.object_id)("name",t.name)("callbackChange",r.getData.bind(r))}}const Xe=function(){return{key:"modbus_id",value:"ascend"}},et=function(o,a){return{x:o,y:a}},te=function(){return["ascend","descend"]};function tt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",7),e.TgZ(1,"form",8,9),e.TgZ(3,"app-table",10,11),e.TgZ(5,"nz-table",12,13),e.ALo(7,"translate"),e.TgZ(8,"thead",14),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(4).sort(i)}),e.TgZ(9,"tr"),e.TgZ(10,"th",15),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th",16),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th",17),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"th"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"th"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"th",18),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.qZA(),e.TgZ(31,"tr",19),e.TgZ(32,"th",20),e.TgZ(33,"input",21),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(34,"th",22),e.TgZ(35,"input",21),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"name","contains")}),e.qZA(),e.qZA(),e.TgZ(36,"th",22),e.TgZ(37,"app-select",23),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().phasesFilter=i})("callbackChange",function(){e.CHM(t);const i=e.MAs(4),s=e.oxw();return i.filter(s.phasesFilter,"phase_id","equals")}),e.qZA(),e.qZA(),e._UZ(38,"th"),e._UZ(39,"th"),e._UZ(40,"th"),e._UZ(41,"th"),e.qZA(),e.qZA(),e.TgZ(42,"tbody"),e.YNc(43,Ke,25,37,"tr",24),e.qZA(),e.qZA(),e.TgZ(44,"div",25),e._UZ(45,"app-led-off",26),e.TgZ(46,"div"),e.TgZ(47,"button",27),e.NdJ("click",function(){return e.CHM(t),e.oxw().getData()}),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"button",28),e.NdJ("appFormButtonClick",function(){e.CHM(t);const i=e.MAs(4);return e.oxw().saveSensors(i.tableData)}),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("appCanDeactivate",s.canDeactivate.bind(s)),e.xp6(2),e.Q6J("initSort",e.DdM(57,Xe))("data",s.rows),e.xp6(2),e.Q6J("nzData",n.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(58,et,n.tableWidth,n.tableHeight))("nzNoResult",e.lcZ(7,37,"NO_CURRENT_SENSORS")),e.xp6(5),e.Q6J("nzLeft",n.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(61,te))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(12,39,"MODBUS_ID")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(62,te)),e.xp6(1),e.Oqu(e.lcZ(15,41,"NAME")),e.xp6(2),e.Q6J("nzColumnKey","phase_id")("nzSortFn",!0)("nzSortDirections",e.DdM(63,te)),e.xp6(1),e.Oqu(e.lcZ(18,43,"PHASE")),e.xp6(3),e.Oqu(e.lcZ(21,45,"DEVICE_CATEGORY")),e.xp6(3),e.Oqu(e.lcZ(24,47,"VOLTAGE_SOURCE")),e.xp6(3),e.Oqu(e.lcZ(27,49,"POWER_FACTOR_SOURCE")),e.xp6(3),e.Oqu(e.lcZ(30,51,"ACTION")),e.xp6(3),e.Q6J("nzLeft",n.allowNzLeft),e.xp6(5),e.Q6J("options",s.phases)("clearable",!0)("model",s.phasesFilter),e.xp6(6),e.Q6J("ngForOf",i.data),e.xp6(2),e.Q6J("ledoff_timeout",s.ledoff_timeout),e.xp6(2),e.Q6J("disabled",s.savingTable||!s.formChanged()),e.xp6(1),e.Oqu(e.lcZ(49,53,"DISCARD")),e.xp6(2),e.Q6J("nzLoading",s.savingTable)("disabled",s.savingTable||!s.formChanged())("form",t),e.xp6(1),e.Oqu(e.lcZ(52,55,"SAVE"))}}function nt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"app-validate",56),e.TgZ(1,"nz-input-number",57,58),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(3).editSource.value=i}),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.oxw(3);e.Q6J("field",t),e.xp6(1),e.Q6J("ngModel",n.editSource.value)("id","source_value_input_wrapper")("nzStep",.01)("nzMin",0)("nzMax",2147483647)("required",!0)}}function it(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"app-validate",56),e.TgZ(1,"nz-input-number",59,58),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(3).editSource.value=i}),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.oxw(3);e.Q6J("field",t),e.xp6(1),e.Q6J("ngModel",n.editSource.value)("id","source_value_input_wrapper")("nzMin",.01)("nzMax",1)("nzStep",.01)("required",!0)}}function ot(o,a){if(1&o&&(e.TgZ(0,"div",49),e.TgZ(1,"label",54),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,nt,3,7,"app-validate",55),e.YNc(5,it,3,7,"app-validate",55),e.qZA()),2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,3,"VALUE"),":"),e.xp6(2),e.Q6J("ngIf","power_factor"!==t.editSource.type),e.xp6(1),e.Q6J("ngIf","voltage"!==t.editSource.type)}}const le=function(){return{required:!0}};function st(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",49),e.TgZ(1,"label",54),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",60),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editSource.source_object_id=i})("callbackChange",function(){return e.CHM(t),e.oxw(2).changeDevice()}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"DEVICE")),e.xp6(2),e.Q6J("model",t.editSource.source_object_id)("options",t.editSourceDevicesSelect)("validators",e.DdM(6,le))}}function at(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",49),e.TgZ(1,"label",54),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",61),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editSource.source_variable=i})("callbackChange",function(){return e.CHM(t),e.oxw(2).changeDevice()}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"REGISTER")),e.xp6(2),e.Q6J("model",t.editSource.source_variable)("options",t.editSourceVariableSelect)("validators",e.DdM(6,le))}}function rt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",44),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeEditSourceDrawer()}),e._UZ(1,"i",45),e.qZA(),e.TgZ(2,"div",46),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",47),e.TgZ(6,"p"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"form",null,48),e.TgZ(11,"div",49),e.TgZ(12,"label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"app-select",50),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editSource.source_type_id=i}),e.qZA(),e.qZA(),e.YNc(16,ot,6,5,"div",51),e.YNc(17,st,5,7,"div",51),e.YNc(18,at,5,7,"div",51),e.TgZ(19,"div",49),e._UZ(20,"label"),e.TgZ(21,"button",52),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeEditSourceDrawer()}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"button",53),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw().saveSource()}),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(10),n=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,16,"voltage"===n.editSource.type?"SET_VOLTAGE_SOURCE":"SET_POWER_FACTOR_SOURCE")," "),e.xp6(4),e.Oqu(e.lcZ(8,18,"voltage"===n.editSource.type?"CURRENT_SENSORS_SET_VOLTAGE_SOURCE_TEXT":"CURRENT_SENSORS_SET_POWER_FACTOR_SOURCE_TEXT")),e.xp6(6),e.hij("",e.lcZ(14,20,"TYPE"),":"),e.xp6(2),e.Q6J("model",n.editSource.source_type_id)("options",n.sourceTypesList)("showSearch",!1),e.xp6(1),e.Q6J("ngIf",0===n.editSource.source_type_id),e.xp6(1),e.Q6J("ngIf",1===n.editSource.source_type_id),e.xp6(1),e.Q6J("ngIf",1===n.editSource.source_type_id),e.xp6(3),e.uIk("id","modal_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(23,22,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",n.saving)("disabled",n.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(26,24,"SAVE"))}}let lt=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.currentSensorsService=i,this.drawerService=s,this.sharedService=r,this.id="my_plant_current_sensors",this.loadingData=!0,this.saving=!1,this.savingTable=!1,this.editSource={},this.deviceCategories=[{id:1,name:"sub-meter"},{id:2,name:"inverter"},{id:4,name:"heatpump"},{id:5,name:"evcharger"}],this.measurementTypes=[]}ngOnInit(){this.sharedService.stopBlinkAllLed().subscribe(),this.sourceTypesList=[{id:0,text:"CONSTANT_VALUE"},{id:1,text:"REGISTER"}],this.getData()}ngOnDestroy(){this.sharedService.stopBlinkAllLed().subscribe()}getData(){this.loadingData=!0,this.currentSensorsService.getCurrentSensors().subscribe(t=>{this.phases=t.phases,this.rows=t.currentSensors,this.ledoff_timeout=t.controlUnitConfiguration.ledoff_timeout,this.existingDevices=t.existingDevices,this.editSourceDevices=t.sourceDevices,this.editSourceDevicesSelect=t.sourceDevices.map(n=>({id:n.object_id,name:n.name})),this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}saveSensors(t){this.toastr.clear(),this.savingTable=!0;const n=t.map(({object_id:i,name:s,phase_id:r,device_category:p})=>({object_id:i,name:s,phase_id:r,device_category:p}));this.currentSensorsService.setCurrentSensors(n).subscribe(()=>{this.savingTable=!1,this.form.form.markAsPristine(),this.toastr.success(this.translate.instant("CURRENT_SENSORS_SAVE_TABLE_SUCCESS")),t.forEach(i=>{const s=this.existingDevices.find(r=>r.object_id===i.object_id);s&&(s.name=i.name)})},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.savingTable=!1})}closeThresholdDrawer(){this.drawerService.hide()}openEditSourceDrawer(t,n,i){this.toastr.clear(),this.editSource.type=n,this.editSource.object_id=t.object_id,this.editSource.tableData=i,"voltage"===n?(this.editSource.source_type_id=t.voltage_source_type_id,0===t.voltage_source_type_id?(this.editSource.value=t.voltage_value,this.editSource.source_object_id=void 0,this.editSource.source_variable=void 0):(this.editSource.source_object_id=t.voltage_source_object_id,this.editSource.source_variable=t.voltage_source_variable,this.editSource.value=230,this.changeDevice())):"power_factor"===n&&(this.editSource.source_type_id=t.power_factor_source_type_id,0===t.power_factor_source_type_id?(this.editSource.value=t.power_factor_value,this.editSource.source_object_id=void 0,this.editSource.source_variable=void 0):(this.editSource.source_object_id=t.power_factor_source_object_id,this.editSource.source_variable=t.power_factor_source_variable,this.editSource.value=1,this.changeDevice())),this.drawerService.showDrawer(this.sourceTemplate)}closeEditSourceDrawer(){this.drawerService.hide()}saveSource(){this.saving=!0;const t={object_id:this.editSource.object_id,type:this.editSource.type,source_type_id:this.editSource.source_type_id};0===t.source_type_id?t.value=this.editSource.value:(t.source_object_id=this.editSource.source_object_id,t.source_variable=this.editSource.source_variable),this.currentSensorsService.saveSource(t).subscribe(()=>{if(this.toastr.success(this.translate.instant("voltage"===this.editSource.type?"CURRENT_SENSORS_SAVE_VOLTAGE_SOURCE_SUCCESS":"CURRENT_SENSORS_SAVE_POWER_FACTOR_SOURCE_SUCCESS")),this.editSource.tableData){const n=this.editSource.tableData.find(i=>i.object_id===this.editSource.object_id);n&&("voltage"===this.editSource.type?(n.voltage_source_type_id=t.source_type_id,0===t.source_type_id?n.voltage_value=this.editSource.value:(n.voltage_source_object_id=this.editSource.source_object_id,n.voltage_source_variable=this.editSource.source_variable)):"power_factor"===this.editSource.type&&(n.power_factor_source_type_id=t.source_type_id,0===t.source_type_id?n.power_factor_value=this.editSource.value:(n.power_factor_source_object_id=this.editSource.source_object_id,n.power_factor_source_variable=this.editSource.source_variable)))}this.drawerService.hide(),this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.drawerService.hide(),this.saving=!1})}changeDevice(){const t=this.editSourceDevices.find(n=>n.object_id===this.editSource.source_object_id);if(t){const n=t.variables.map(s=>({id:s.variable,name:s.variable}));this.editSourceVariableSelect="voltage"===this.editSource.type?[...n.filter(s=>s.id.toLowerCase().includes("voltage")),...n.filter(s=>!s.id.toLowerCase().includes("voltage"))]:[...n.filter(s=>s.id.toLowerCase().includes("powerfactor")||s.id.toLowerCase().includes("power factor")),...n.filter(s=>!s.id.toLowerCase().includes("powerfactor")&&!s.id.toLowerCase().includes("power factor"))],this.editSourceVariableSelect.some(s=>s.id===this.editSource.source_variable)||(this.editSource.source_variable=void 0)}else this.editSource.source_object_id=void 0,this.editSource.source_variable=void 0}blinkSensor(t){!t.modbus_id||(t.blink=!0,setTimeout(()=>{t.blink=!1},1e3),this.sharedService.blinkLed(t.modbus_id).subscribe())}formChanged(){let t=!1;return this.rows&&this.form&&Object.keys(this.form.controls).forEach(n=>{"phase_filter"!==n&&"led_timeout"!==n&&this.form.controls[n].dirty&&(t=!0)}),t}canDeactivate(){return!this.formChanged()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(Oe.C),e.Y36(A.z),e.Y36(L.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-current-sensors"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Ve,5),e.Gf(Ye,5)),2&t){let i;e.iGM(i=e.CRH())&&(n.sourceTemplate=i.first),e.iGM(i=e.CRH())&&(n.form=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:9,vars:8,consts:[[1,"section-header"],["type","CurrentSensor",3,"existingDevices","callbackChange"],["type","CurrentSensor"],["type","CurrentSensor",3,"object_id","callbackChange"],[4,"ngIf"],["class","section-content",4,"ngIf"],["sourceTemplate",""],[1,"section-content"],[2,"height","calc(100% - 85px)",3,"appCanDeactivate"],["form","ngForm"],[3,"initSort","data"],["table",""],["nzTableLayout","fixed",1,"table-show-changes",3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],[3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","100px",3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","80px"],[1,"filters"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],["inputId","phase_filter","inputClass","no-validate",3,"options","clearable","model","modelChange","callbackChange"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"table-buttons"],[3,"ledoff_timeout"],["type","button","nz-button","","id","table_discard_button",3,"disabled","click"],["type","button","nz-button","","id","table_save_button","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],[3,"ngClass","click"],[3,"nzLeft"],[3,"id","status","object_id"],["type","text","maxlength","255","nz-tooltip","","nzTooltipOverlayClassName","tooltip-error","required","",3,"id","name","ngModel","nzTooltipTitle","ngModelChange"],[3,"model","options","inputId","modelChange"],[3,"model","options","clearable","inputId","modelChange"],["nzEllipsis","",1,"with-button"],["class","source-text",4,"ngIf"],["class","source-text",3,"title",4,"ngIf"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",1,"ml-5",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_edit_16"],[1,"icons"],["type","CurrentSensor",3,"object_id","name","id","callbackChange"],[1,"source-text"],[1,"source-text",3,"title"],["tabIndex","-1","nz-button","",1,"drawer-button-close",3,"click"],[1,"icon_abb_16","icon-abb_close_16"],[1,"drawer-title","text-line"],[1,"drawer-body"],["formSource","ngForm"],[1,"form-group"],["inputClass","no-validate","inputId","source_select",3,"model","options","showSearch","modelChange"],["class","form-group",4,"ngIf"],["type","button","nz-button","",3,"click"],["type","submit","nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],[1,"label-required"],[3,"field",4,"ngIf"],[3,"field"],["name","sourceValue","nzId","source_value_input",1,"no-success",3,"ngModel","id","nzStep","nzMin","nzMax","required","ngModelChange"],["sourceValue","ngModel"],["name","sourceValue","nzId","source_value_input",1,"no-success",3,"ngModel","id","nzMin","nzMax","nzStep","required","ngModelChange"],["inputId","device_select",3,"model","options","validators","modelChange","callbackChange"],["inputId","variable_select",3,"model","options","validators","modelChange","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-cmmioconf-add",1),e._UZ(2,"app-cmmioconf-identify",2),e._UZ(3,"app-cmmioconf-change-modbus-id",1),e._UZ(4,"app-cmmioconf-remove",3),e.qZA(),e.YNc(5,je,1,0,"app-loader",4),e.YNc(6,tt,53,64,"div",5),e.YNc(7,rt,27,26,"ng-template",null,6,e.W1O)),2&t&&(e.xp6(1),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(2),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("object_id",0)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[k.Y,Q,F,V,g.O5,D.R,c._Y,c.JL,c.F,Y.z,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,q.H,l.p0,g.sg,g.mk,I,c.Fj,c.nD,C.SY,c.Q7,c.JJ,c.On,l.ky,b.ix,f.dQ,T.w,j,S.b,O.P,w._],pipes:[_.X$,P.h],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}#change_threshold_button[_ngcontent-%COMP%]{margin-left:8px}.source-text[_ngcontent-%COMP%]{display:inline-block;max-width:calc(100% - 40px);overflow:hidden;text-overflow:ellipsis;vertical-align:middle}"]}),o})();var ct=d(6625);const dt=["form"];function _t(o,a){1&o&&e._UZ(0,"app-loader")}function pt(o,a){1&o&&e._UZ(0,"tbody")}function ut(o,a){if(1&o&&(e.TgZ(0,"td",41),e._UZ(1,"app-table-device-status",42),e._uU(2),e.qZA()),2&o){const t=e.oxw(2),n=t.index,i=t.$implicit;e.oxw();const s=e.MAs(4);e.Q6J("nzLeft",s.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",i.status)("object_id",i.object_id),e.xp6(1),e.Oqu(i.modbus_id||"-")}}function mt(o,a){if(1&o&&(e.TgZ(0,"td",43),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(0===t.type_id?e.lcZ(2,1,"INPUT"):1===t.type_id?e.lcZ(3,3,"OUTPUT"):e.lcZ(4,5,"INPUT_OUTPUT"))}}function gt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"td",44),e.TgZ(1,"input",38),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).$implicit.name=i}),e.ALo(2,"translate"),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2),n=t.index,i=t.$implicit;e.oxw();const s=e.MAs(2);e.xp6(1),e.MGl("id","io_module_name_input_",n,""),e.MGl("name","ioModuleName",n,""),e.s9C("nzTooltipTitle",null!=s.controls["ioModuleName"+n]&&s.controls["ioModuleName"+n].errors?e.lcZ(2,4,"VALIDATE_REQUIRED"):""),e.Q6J("ngModel",i.name)}}function ht(o,a){if(1&o&&(e.TgZ(0,"td",45),e._UZ(1,"app-cmmioconf-remove",46),e.qZA()),2&o){const t=e.oxw(2),n=t.index,i=t.$implicit,s=e.oxw(2);e.xp6(1),e.MGl("id","remove_device_button_",n,""),e.Q6J("object_id",i.object_id)("name",i.name)("callbackChange",s.getData.bind(s))}}const vt=function(o){return{blink:o}};function bt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",32),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit;return e.oxw(2).blinkIoModule(i)}),e.YNc(1,ut,3,5,"td",33),e.YNc(2,mt,5,7,"td",34),e.YNc(3,gt,3,6,"td",35),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td",25),e.TgZ(7,"app-select",36),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.connected_device_type=i})("callbackChange",function(){const i=e.CHM(t),s=i.$implicit,r=i.index,p=e.oxw().index;return e.oxw(2).deviceTypeChange(s,"io_module_accessory_type_select_"+p+"_"+r)}),e.qZA(),e.qZA(),e.TgZ(8,"td",25),e.TgZ(9,"app-select",37),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.device_category=i}),e.qZA(),e.qZA(),e.TgZ(10,"td",25),e.TgZ(11,"app-select",37),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.connected_accessory_type=i}),e.qZA(),e.qZA(),e.TgZ(12,"td",25),e.TgZ(13,"app-select",37),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.tag=i}),e.qZA(),e.qZA(),e.TgZ(14,"td",25),e.TgZ(15,"input",38),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit.name=i}),e.ALo(16,"translate"),e.qZA(),e.qZA(),e.TgZ(17,"td",25),e.TgZ(18,"nz-input-number",39),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit.pulse_weight=i}),e.qZA(),e.qZA(),e.TgZ(19,"td",25),e.TgZ(20,"app-select",37),e.NdJ("modelChange",function(i){return e.CHM(t).$implicit.pulse_unit_id=i}),e.qZA(),e.qZA(),e.YNc(21,ht,2,4,"td",40),e.qZA()}if(2&o){const t=a.$implicit,n=a.index,i=e.oxw(),s=i.$implicit,r=i.index;e.oxw();const p=e.MAs(2),E=e.oxw();e.Q6J("ngClass",e.VKq(53,vt,s.blink)),e.xp6(1),e.Q6J("ngIf",0===n),e.xp6(1),e.Q6J("ngIf",0===n),e.xp6(1),e.Q6J("ngIf",0===n),e.xp6(2),e.Oqu(t.port),e.xp6(2),e.hYB("inputId","io_module_signal_type_select_",r,"_",n,""),e.Q6J("model",t.connected_device_type)("options",0===s.type_id||2===s.type_id&&(3===t.port||4===t.port)?E.deviceTypesInput:E.deviceTypesOutput)("clearable",!0),e.xp6(2),e.hYB("inputId","io_module_device_category_select_",r,"_",n,""),e.Q6J("model",t.device_category)("options",E.deviceCategories)("clearable",!0)("disabled",5!==t.connected_device_type),e.xp6(2),e.hYB("inputId","io_module_device_type_select_",r,"_",n,""),e.Q6J("model",t.connected_accessory_type)("options",E.getAccessoryTypes(t))("clearable",!0)("disabled",null===t.connected_device_type),e.xp6(2),e.hYB("inputId","io_module_tag_select_",r,"_",n,""),e.Q6J("model",t.tag)("options",E.tags)("clearable",!0)("disabled",5!==t.connected_device_type),e.xp6(2),e.hYB("id","io_module_port_name_input_",r,"_",n,""),e.hYB("name","portName",r,"_",n,""),e.s9C("nzTooltipTitle",null!=p.controls["portName"+r+"_"+n]&&p.controls["portName"+r+"_"+n].errors?e.lcZ(16,51,"VALIDATE_REQUIRED"):""),e.Q6J("ngModel",t.name),e.xp6(3),e.hYB("id","io_module_port_pulse_weight_input_wrapper_",r,"_",n,""),e.hYB("nzId","port_pulse_weight_input_",r,"_",n,""),e.hYB("name","portPulseWeight",r,"_",n,""),e.Q6J("ngModel",t.pulse_weight)("nzMin",-9999)("nzMax",9999)("disabled",5!==t.connected_device_type),e.xp6(2),e.hYB("inputId","io_module_port_pulse_unit_",r,"_",n,""),e.Q6J("model",t.pulse_unit_id)("options",E.pulseUnits)("clearable",!0)("disabled",5!==t.connected_device_type),e.xp6(1),e.Q6J("ngIf",0===n)}}function ft(o,a){if(1&o&&(e.TgZ(0,"tbody"),e.YNc(1,bt,22,55,"tr",31),e.qZA()),2&o){const t=a.$implicit;e.xp6(1),e.Q6J("ngForOf",t.ports)}}const Tt=function(){return{key:"modbus_id",value:"ascend"}},Ct=function(o,a){return{x:o,y:a}},ce=function(){return["ascend","descend"]};function Mt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",7),e.TgZ(1,"form",8,9),e.TgZ(3,"app-table",10,11),e.TgZ(5,"nz-table",12,13),e.ALo(7,"translate"),e.TgZ(8,"thead",14),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(4).sort(i)}),e.TgZ(9,"tr"),e.TgZ(10,"th",15),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th",16),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th",17),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th",18),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"th",19),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"th",19),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"th",19),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"th",19),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.TgZ(34,"th",19),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"th",20),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.TgZ(40,"th",20),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"th",18),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.qZA(),e.TgZ(46,"tr",21),e.TgZ(47,"th",22),e.TgZ(48,"input",23),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(49,"th"),e.TgZ(50,"app-select",24),e.NdJ("modelChange",function(i){return e.CHM(t),e.MAs(4).filtersModel.type_id=i})("callbackChange",function(){e.CHM(t);const i=e.MAs(4);return i.filter(i.filtersModel.type_id,"type_id","equals")}),e.qZA(),e.qZA(),e.TgZ(51,"th",25),e.TgZ(52,"input",23),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"name","contains")}),e.qZA(),e.qZA(),e._UZ(53,"th"),e._UZ(54,"th"),e._UZ(55,"th"),e._UZ(56,"th"),e._UZ(57,"th"),e._UZ(58,"th"),e._UZ(59,"th"),e._UZ(60,"th"),e._UZ(61,"th"),e.qZA(),e.qZA(),e.YNc(62,pt,1,0,"tbody",5),e.YNc(63,ft,2,1,"tbody",26),e.qZA(),e.TgZ(64,"div",27),e._UZ(65,"app-led-off",28),e.TgZ(66,"div"),e.TgZ(67,"button",29),e.NdJ("click",function(){return e.CHM(t),e.oxw().getData()}),e._uU(68),e.ALo(69,"translate"),e.qZA(),e.TgZ(70,"button",30),e.NdJ("appFormButtonClick",function(){e.CHM(t);const i=e.MAs(4);return e.oxw().saveIoModules(i.tableData)}),e._uU(71),e.ALo(72,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("appCanDeactivate",s.canDeactivate.bind(s)),e.xp6(2),e.Q6J("initSort",e.DdM(71,Tt))("data",s.rows),e.xp6(2),e.Q6J("nzData",n.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(72,Ct,n.tableWidth,n.tableHeight))("nzNoResult",e.lcZ(7,41,"NO_IO_MODULES")),e.xp6(5),e.Q6J("nzLeft",n.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(75,ce))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(12,43,"MODBUS_ID")),e.xp6(3),e.Oqu(e.lcZ(15,45,"IO_MODULE_TYPE")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(76,ce)),e.xp6(1),e.Oqu(e.lcZ(18,47,"IO_MODULE_NAME")),e.xp6(3),e.Oqu(e.lcZ(21,49,"PORT")),e.xp6(3),e.Oqu(e.lcZ(24,51,"SIGNAL_TYPE")),e.xp6(3),e.Oqu(e.lcZ(27,53,"DEVICE_CATEGORY")),e.xp6(3),e.Oqu(e.lcZ(30,55,"DEVICE_TYPE")),e.xp6(3),e.Oqu(e.lcZ(33,57,"TAG")),e.xp6(3),e.Oqu(e.lcZ(36,59,"PORT_NAME")),e.xp6(3),e.Oqu(e.lcZ(39,61,"IO_MODULES_PULSE_WEIGHT")),e.xp6(3),e.Oqu(e.lcZ(42,63,"PULSE_UNIT")),e.xp6(3),e.Oqu(e.lcZ(45,65,"ACTION")),e.xp6(3),e.Q6J("nzLeft",n.allowNzLeft),e.xp6(3),e.Q6J("options",s.ioModulesTypes)("showSearch",!1)("clearable",!0)("model",n.filtersModel.type_id),e.xp6(12),e.Q6J("ngIf",0===i.data.length),e.xp6(1),e.Q6J("ngForOf",i.data),e.xp6(2),e.Q6J("ledoff_timeout",s.ledoff_timeout),e.xp6(2),e.Q6J("disabled",s.savingTable||!s.formChanged()),e.xp6(1),e.Oqu(e.lcZ(69,67,"DISCARD")),e.xp6(2),e.Q6J("nzLoading",s.savingTable)("disabled",s.savingTable||!s.formChanged())("form",t),e.xp6(1),e.Oqu(e.lcZ(72,69,"SAVE"))}}let Zt=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.ioModulesService=s,this.sharedService=r,this.id="my_plant_io_modules",this.loadingData=!0,this.saving=!1,this.savingTable=!1,this.deviceCategories=[{id:1,name:"sub-meter"},{id:6,name:"water-meter"},{id:7,name:"gas-meter"}]}ngOnInit(){this.sharedService.stopBlinkAllLed().subscribe(),this.getData()}ngOnDestroy(){this.sharedService.stopBlinkAllLed().subscribe()}getData(){this.loadingData=!0,this.ioModulesService.getIoModules().subscribe(t=>{this.rows=t.ioModules,this.ioModulesTypes=t.ioModulesTypes,this.pulseUnits=t.pulseUnits,this.deviceTypes=t.deviceTypes,this.accessoryTypes=t.accessoryTypes,this.ledoff_timeout=t.controlUnitConfiguration.ledoff_timeout,this.existingDevices=t.existingDevices,this.tags=t.tags,this.deviceTypesInput=this.deviceTypes.filter(n=>2!==n.id&&3!==n.id&&4!==n.id),this.deviceTypesOutput=this.deviceTypes.filter(n=>0!==n.id&&1!==n.id&&5!==n.id),this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}saveIoModules(t){this.toastr.clear(),this.savingTable=!0;const n=t.map(({ports:i,object_id:s,name:r})=>({ports:i,object_id:s,name:r}));this.ioModulesService.setIoModules(n).subscribe(()=>{this.savingTable=!1,this.form.form.markAsPristine(),this.toastr.success(this.translate.instant("IO_MODULES_SAVE_TABLE_SUCCESS")),t.forEach(i=>{const s=this.existingDevices.find(r=>r.object_id===i.object_id);s&&(s.name=i.name)})},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.savingTable=!1})}blinkIoModule(t){!t.modbus_id||(t.blink=!0,setTimeout(()=>{t.blink=!1},1e3),this.sharedService.blinkLed(t.modbus_id).subscribe())}getAccessoryTypes(t){return this.accessoryTypes.filter(n=>n.device_type===t.connected_device_type)}deviceTypeChange(t,n){null!==t.connected_accessory_type&&(t.connected_accessory_type=null,this.form.controls[n].markAsDirty()),5!==t.connected_device_type?(null!==t.pulse_weight&&(t.pulse_weight=null),null!==t.pulse_unit_id&&(t.pulse_unit_id=null),null!==t.tag&&(t.tag=null),null!==t.device_category&&(t.device_category=null)):null===t.pulse_weight&&(t.pulse_weight=1)}formChanged(){let t=!1;return this.rows&&this.form&&Object.keys(this.form.controls).forEach(n=>{"led_timeout"!==n&&this.form.controls[n].dirty&&(t=!0)}),t}canDeactivate(){return!this.formChanged()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(ct.W),e.Y36(L.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-io-modules"]],viewQuery:function(t,n){if(1&t&&e.Gf(dt,5),2&t){let i;e.iGM(i=e.CRH())&&(n.form=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:7,vars:9,consts:[[1,"section-header"],["type","IoModule",3,"existingDevices","ioModulesTypes","callbackChange"],["type","IoModule"],["type","IoModule",3,"existingDevices","callbackChange"],["type","IoModule",3,"object_id","callbackChange"],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"section-content"],[2,"height","calc(100% - 85px)",3,"appCanDeactivate"],["form","ngForm"],[3,"initSort","data"],["table",""],["nzTableLayout","fixed",1,"table-show-changes","table-with-rowspan",3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],["nzWidth","110px"],["nzWidth","150px",3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","80px"],["nzWidth","150px"],["nzWidth","100px"],[1,"filters"],[1,"input",3,"nzLeft"],["type","text",3,"input"],["inputId","status_filter","inputClass","no-validate",3,"options","showSearch","clearable","model","modelChange","callbackChange"],[1,"input"],[4,"ngFor","ngForOf"],[1,"table-buttons"],[3,"ledoff_timeout"],["type","button","id","table_discard_button","nz-button","",3,"disabled","click"],["type","button","id","table_save_button","nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],["rowSpan","4",3,"nzLeft",4,"ngIf"],["rowSpan","4",4,"ngIf"],["rowSpan","4","class","input",4,"ngIf"],[3,"model","options","clearable","inputId","modelChange","callbackChange"],[3,"model","options","clearable","inputId","disabled","modelChange"],["type","text","maxlength","255","nz-tooltip","","nzTooltipOverlayClassName","tooltip-error","required","",3,"id","name","ngModel","nzTooltipTitle","ngModelChange"],[1,"no-success",3,"id","nzId","ngModel","name","nzMin","nzMax","disabled","ngModelChange"],["rowSpan","4","class","icons rowspan",4,"ngIf"],["rowSpan","4",3,"nzLeft"],[3,"id","status","object_id"],["rowSpan","4"],["rowSpan","4",1,"input"],["rowSpan","4",1,"icons","rowspan"],["type","IoModule",3,"object_id","name","id","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-cmmioconf-add",1),e._UZ(2,"app-cmmioconf-identify",2),e._UZ(3,"app-cmmioconf-change-modbus-id",3),e._UZ(4,"app-cmmioconf-remove",4),e.qZA(),e.YNc(5,_t,1,0,"app-loader",5),e.YNc(6,Mt,73,77,"div",6)),2&t&&(e.xp6(1),e.Q6J("existingDevices",n.existingDevices)("ioModulesTypes",n.ioModulesTypes)("callbackChange",n.getData.bind(n)),e.xp6(2),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("object_id",0)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[k.Y,Q,F,V,g.O5,D.R,c._Y,c.JL,c.F,Y.z,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,q.H,l.p0,g.sg,g.mk,I,c.Fj,c.nD,C.SY,c.Q7,c.JJ,c.On,w._,j,b.ix,f.dQ,T.w,S.b],pipes:[_.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}"]}),o})();var h=d(5724),xt=d(8494),N=d(5268),At=d(1688);const Dt=["addDeviceTemplate"];function St(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){return e.CHM(t),e.oxw().addDeviceDrawer()}),e._UZ(1,"i",4),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"ADD"),"\n"))}function yt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().addDeviceDrawer()}),e.ALo(1,"translate"),e._UZ(2,"i",6),e.qZA()}if(2&o){const t=e.oxw();e.s9C("nzTooltipTitle",e.lcZ(1,2,"EDIT")),e.Q6J("id",t.id)}}function Et(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",21),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.meter_model=i})("callbackChange",function(){e.CHM(t),e.oxw();const i=e.MAs(7);return e.oxw().meterModelChanged(i)}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,5,"DEVICE_MODEL"),":"),e.xp6(2),e.Q6J("model",t.editDevice.meter_model)("options",t.meterModelSelect)("disabled",!!t.editDevice.object_id)("clearable",!0)}}function Rt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-validate",15),e.TgZ(5,"input",22,23),e.NdJ("change",function(){e.CHM(t),e.oxw();const i=e.MAs(7);return e.oxw().checkModbusId(i)})("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.ip_address=i}),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(6),n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,3,"IP_ADDRESS"),":"),e.xp6(2),e.Q6J("field",t),e.xp6(1),e.Q6J("ngModel",n.editDevice.ip_address)}}function zt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-validate",15),e.TgZ(5,"nz-input-number",24,25),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.modbus_id=i})("ngModelChange",function(){e.CHM(t),e.oxw();const i=e.MAs(7);return e.oxw().generateMeterName(i)}),e.ALo(7,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(6),n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,9,"MODBUS_ID"),":"),e.xp6(2),e.Q6J("field",t),e.xp6(1),e.Q6J("ngModel",n.editDevice.modbus_id)("id","modbus_id_input_wrapper")("nzMin",33)("nzMax",48)("required",!0)("appInvalidValues",n.takenModbusDevicesIds)("appInvalidValuesMsg",e.lcZ(7,11,"MODBUS_ID_ALREADY_ASSIGNED"))}}function It(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-validate",15),e.TgZ(5,"nz-input-number",24,25),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.modbus_id=i}),e.ALo(7,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(6),n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,9,"MODBUS_ID"),":"),e.xp6(2),e.Q6J("field",t),e.xp6(1),e.Q6J("ngModel",n.editDevice.modbus_id)("id","modbus_id_input_wrapper")("nzMin",0)("nzMax",65535)("required",!0)("appInvalidValues",n.getTakenModbusIds())("appInvalidValuesMsg",e.lcZ(7,11,"MODBUS_TCP_DEVICES_UNIQUE_ERROR"))}}function qt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-validate",15),e.TgZ(5,"nz-input-number",26,27),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.port=i}),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(6),n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,6,"PORT"),":"),e.xp6(2),e.Q6J("field",t),e.xp6(1),e.Q6J("ngModel",n.editDevice.port)("nzMin",1)("nzMax",65535)("required",!0)}}const B=function(){return{required:!0}};function Ut(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",28),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.baudrate=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"BAUDRATE"),":"),e.xp6(2),e.Q6J("model",t.editDevice.baudrate)("options",t.baudrates)("validators",e.DdM(6,B))}}function Ot(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",29),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.databit=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"BYTESIZE"),":"),e.xp6(2),e.Q6J("model",t.editDevice.databit)("options",t.databits)("validators",e.DdM(6,B))}}function Lt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",30),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.parity=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"PARITY"),":"),e.xp6(2),e.Q6J("model",t.editDevice.parity)("options",t.parities)("validators",e.DdM(6,B))}}function wt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",31),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editDevice.stopbit=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"STOP_BITS"),":"),e.xp6(2),e.Q6J("model",t.editDevice.stopbit)("options",t.stopbits)("validators",e.DdM(6,B))}}function Nt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"input",32),e.NdJ("value",function(){return e.CHM(t),e.oxw(2).editDevice.serial_number}),e.qZA(),e.qZA()}2&o&&(e.xp6(2),e.hij("",e.lcZ(3,2,"SERIAL_NUMBER"),":"),e.xp6(2),e.uIk("readonly",!0))}function Pt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeDeviceDrawer()}),e._UZ(1,"i",8),e.qZA(),e.TgZ(2,"div",9),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",10),e.TgZ(6,"form",null,11),e.YNc(8,Et,5,7,"div",12),e.YNc(9,Rt,7,5,"div",12),e.YNc(10,zt,8,13,"div",12),e.YNc(11,It,8,13,"div",12),e.TgZ(12,"div",13),e.TgZ(13,"label",14),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"app-validate",15),e.TgZ(17,"input",16,17),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editDevice.name=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"div",13),e.TgZ(20,"label"),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"app-select",18),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editDevice.device_category=i}),e.qZA(),e.qZA(),e.YNc(24,qt,7,8,"div",12),e.YNc(25,Ut,5,7,"div",12),e.YNc(26,Ot,5,7,"div",12),e.YNc(27,Lt,5,7,"div",12),e.YNc(28,wt,5,7,"div",12),e.YNc(29,Nt,5,4,"div",12),e.TgZ(30,"div",13),e._UZ(31,"label"),e.TgZ(32,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeDeviceDrawer(!0)}),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"button",20),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw().saveDevice()}),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(7),n=e.MAs(18),i=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,25,i.editDevice.object_id?i.translations[i.type].edit:i.translations[i.type].addNew)," "),e.xp6(5),e.Q6J("ngIf","ThirdPartyRTU"===i.type&&!i.editDevice.object_id||i.editDevice.object_id&&"MeterABB"===i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"===i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"!==i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"===i.type),e.xp6(3),e.hij("",e.lcZ(15,27,"NAME"),":"),e.xp6(2),e.Q6J("field",n),e.xp6(1),e.Q6J("ngModel",i.editDevice.name),e.xp6(4),e.hij("",e.lcZ(22,29,"DEVICE_CATEGORY"),":"),e.xp6(2),e.Q6J("model",i.editDevice.device_category)("options",i.deviceCategories)("clearable",!0),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"===i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"!==i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"!==i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"!==i.type),e.xp6(1),e.Q6J("ngIf","ThirdPartyTCP"!==i.type),e.xp6(1),e.Q6J("ngIf","MeterABB"===i.type),e.xp6(3),e.uIk("id","drawer_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(34,31,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",i.saving)("disabled",i.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(37,33,i.editDevice.object_id?i.translations[i.type].save:i.translations[i.type].add))}}let de=(()=>{class o{constructor(t,n,i,s,r,p){this.translate=t,this.toastr=n,this.modalService=i,this.modbusDeviceService=s,this.webSocketService=r,this.drawerService=p,this.cl="app-modbus-device-add",this.saving=!1,this.editMode=!1,this.parities=[{id:0,text:"NONE"},{id:1,text:"ODD"},{id:2,text:"EVEN"}],this.databits=[{id:5,text:"5"},{id:6,text:"6"},{id:7,text:"7"},{id:8,text:"8"}],this.stopbits=[{id:1,text:"1"},{id:2,text:"2"}],this.baudratesAll=[{id:1200,text:"1200"},{id:2400,text:"2400"},{id:4800,text:"4800"},{id:9600,text:"9600"},{id:19200,text:"19200"},{id:38400,text:"38400"},{id:57600,text:"57600"},{id:115200,text:"115200"}],this.meterModelSelect=[{id:1,name:"M2M"},{id:2,name:"EQ meter"},{id:3,name:"M4M/M1M"},{id:4,name:"DMTME"},{id:5,name:"IM300"},{id:6,name:"EV meter"}],this.deviceCategories=[{id:0,name:"main-meter"},{id:1,name:"sub-meter"},{id:2,name:"inverter"},{id:3,name:"battery"},{id:4,name:"heatpump"},{id:5,name:"evcharger"},{id:6,name:"water-meter"},{id:7,name:"gas-meter"}],this.translations={MeterABB:{addNew:"ADD_NEW_MODBUS_RTU_DEVICE",edit:"EDIT_MODBUS_RTU_DEVICE",add:"ADD_MODBUS_RTU_DEVICE",save:"SAVE_MODBUS_RTU_DEVICE",addSuccess:"MODBUS_RTU_DEVICE_ADD_SUCCESS",editSuccess:"MODBUS_RTU_DEVICE_EDIT_SUCCESS"},ThirdPartyRTU:{addNew:"ADD_NEW_MODBUS_RTU_DEVICE",edit:"EDIT_MODBUS_RTU_DEVICE",add:"ADD_MODBUS_RTU_DEVICE",save:"SAVE_MODBUS_RTU_DEVICE",addSuccess:"MODBUS_RTU_DEVICE_ADD_SUCCESS",editSuccess:"MODBUS_RTU_DEVICE_EDIT_SUCCESS"},ThirdPartyTCP:{addNew:"ADD_NEW_MODBUS_TCP_DEVICE",edit:"EDIT_MODBUS_TCP_DEVICE",add:"ADD_MODBUS_TCP_DEVICE",save:"SAVE_MODBUS_TCP_DEVICE",addSuccess:"MODBUS_TCP_DEVICE_ADD_SUCCESS",editSuccess:"MODBUS_TCP_DEVICE_EDIT_SUCCESS"}}}closeDeviceDrawer(t){this.drawerService.hide(),t&&(this.tempDevice=null)}addDeviceDrawer(){if(this.toastr.clear(),this.baudrates=this.baudratesAll,this.editMode&&!this.device)this.editDevice=this.tempDevice;else if(this.device)this.editDevice=Object.assign({},this.device);else{if(this.editDevice={},this.existingDevices.length>=16)return void this.modalService.showInfo(this.translate.instant("ThirdPartyTCP"!==this.type?"ADD_DEVICES_RTU_DEVICES_FULL":"ADD_DEVICES_TCP_DEVICES_FULL"),()=>{this.modalService.hide()});if("ThirdPartyTCP"!==this.type){for(let t=33;t<=49;t++)if(!this.existingDevices.some(n=>n.modbus_id===t)){this.editDevice.modbus_id=t;break}this.lastDevice&&(this.editDevice.baudrate=this.lastDevice.baudrate,this.editDevice.databit=this.lastDevice.databit,this.editDevice.parity=this.lastDevice.parity,this.editDevice.stopbit=this.lastDevice.stopbit,this.editDevice.device_category=this.lastDevice.device_category)}else this.editDevice.port=502,this.editDevice.modbus_id=1}"ThirdPartyTCP"!==this.type&&(this.takenModbusDevicesIds=this.existingDevices.filter(t=>t.object_id!==this.editDevice.object_id).map(({modbus_id:t})=>t)),"MeterABB"===this.type&&this.checkBaudRate(),this.drawerService.showDrawer(this.addDeviceTemplate).subscribe(t=>{this.editMode=!!this.tempDevice}),this.tempDevice=this.editDevice}saveDevice(){let t,n;this.saving=!0,this.editMode=!1,this.editDevice.object_id?(n=this.translations[this.type].editSuccess,t=this.modbusDeviceService.saveDevice(this.editDevice,this.type)):(n=this.translations[this.type].addSuccess,t=this.modbusDeviceService.addDevice(this.editDevice,this.type)),t.subscribe(i=>{this.drawerService.hide(),this.tempDevice=null,this.callbackChange(),i.pid?(this.modalService.showLoader(this.translate.instant("MODBUS_RTU_DEVICE_SCANNING")),this.initWatchProcess(i.pid,this.editDevice.name),this.editDevice.object_id||(this.editDevice.object_id=i.object_id)):(this.toastr.success(this.translate.instant(n,{name:"<strong>"+this.editDevice.name+"</strong>"})),this.modalService.hide()),this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1,this.drawerService.hide(),this.tempDevice=null})}meterModelChanged(t){this.generateMeterName(t),this.checkBaudRate()}generateMeterName(t){var n;if(!this.editDevice.object_id&&t.controls.name.pristine)if(this.editDevice.meter_model){const i=null===(n=this.meterModelSelect.find(s=>s.id===this.editDevice.meter_model))||void 0===n?void 0:n.name;this.editDevice.name=i+" "+this.editDevice.modbus_id}else this.editDevice.name=""}checkBaudRate(){if(this.editDevice.meter_model){const t={1:[4800,9600,19200],2:[2400,4800,9600,19200,38400,57600,115200],3:[9600,19200,38400,57600,115200],4:[2400,4800,9600,19200],5:[2400,4800,9600,19200],6:[9600,19200,38400]};this.baudrates=t[this.editDevice.meter_model].map(n=>({id:n,text:n})),t[this.editDevice.meter_model].includes(this.editDevice.baudrate)||(this.editDevice.baudrate=t[this.editDevice.meter_model][0])}else{const t=[...this.baudratesAll];t.shift(),this.baudrates=t}}checkModbusId(t){t.controls.modbusIdInput.markAsTouched(),t.controls.modbusIdInput.updateValueAndValidity()}getTakenModbusIds(){return this.existingDevices.filter(t=>{var n;return t.ip_address===this.editDevice.ip_address&&t.object_id!==(null===(n=this.device)||void 0===n?void 0:n.object_id)}).map(t=>t.modbus_id)}initWatchProcess(t,n){this.webSocketService.setCollectData({process_id:t}),this.subscriptionSocket=this.webSocketService.socket$Observable.subscribe(i=>{i.disconnected?(this.subscriptionSocket.unsubscribe(),this.toastr.error(this.translate.instant("REQUEST_ERROR"),!0),this.modalService.hide()):i.process_id&&i.process_id===t&&(0===i.data.variables?this.modalService.showConfirm(this.translate.instant("MODBUS_RTU_DEVICE_ADD_SUCCESS_NO_REGISTERS",{name:"<strong>"+n+"</strong>"}),()=>{this.saving=!1,this.modalService.setLoading(!1),this.drawerService.showDrawer(this.addDeviceTemplate),this.modalService.hide(),this.editMode=!1},()=>{this.modalService.hide()}):(this.toastr.success(this.translate.instant("MODBUS_RTU_DEVICE_ADD_SUCCESS",{name:"<strong>"+n+"</strong>"})),this.modalService.hide()),this.subscriptionSocket.unsubscribe())})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(N.D),e.Y36($.l),e.Y36(A.z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-modbus-device-add"]],viewQuery:function(t,n){if(1&t&&e.Gf(Dt,5),2&t){let i;e.iGM(i=e.CRH())&&(n.addDeviceTemplate=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("class",n.cl)},inputs:{type:"type",existingDevices:"existingDevices",callbackChange:"callbackChange",device:"device",lastDevice:"lastDevice",id:"id"},decls:4,vars:2,consts:[["type","button","nzType","primary","nz-button","","id","add_device_button",3,"click",4,"ngIf"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click",4,"ngIf"],["addDeviceTemplate",""],["type","button","nzType","primary","nz-button","","id","add_device_button",3,"click"],[1,"icon_abb_16","icon-abb_plus_16"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_edit_16"],["tabIndex","-1","nz-button","","id","close_device_button",1,"drawer-button-close",3,"click"],[1,"icon_abb_16","icon-abb_close_16"],[1,"drawer-title","text-line"],[1,"drawer-body"],["formAdd","ngForm"],["class","form-group",4,"ngIf"],[1,"form-group"],[1,"label-required"],[3,"field"],["maxlength","255","type","text","id","name_input","name","name","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","ngModel"],["inputId","device_category_select",3,"model","options","clearable","modelChange"],["type","button","nz-button","",3,"click"],["type","submit","nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],["inputId","device_model_select",3,"model","options","disabled","clearable","modelChange","callbackChange"],["maxlength","255","type","text","id","ip_address_input","name","ipAddress","required","","appValidateIp","",1,"form-control",3,"ngModel","change","ngModelChange"],["ipAddress","ngModel"],["nzId","modbus_id_input","name","modbusIdInput",3,"ngModel","id","nzMin","nzMax","required","appInvalidValues","appInvalidValuesMsg","ngModelChange"],["modbusIdInput","ngModel"],["id","port_input_wrapper","nzId","port_input","name","port",3,"ngModel","nzMin","nzMax","required","ngModelChange"],["port","ngModel"],["inputId","baudrate_select",3,"model","options","validators","modelChange"],["inputId","databit_select",3,"model","options","validators","modelChange"],["inputId","parity_select",3,"model","options","validators","modelChange"],["inputId","stopbit_select",3,"model","options","validators","modelChange"],["type","text","id","serial_number","name","serialNumber",1,"form-control",2,"width","100%",3,"value"]],template:function(t,n){1&t&&(e.YNc(0,St,4,3,"button",0),e.YNc(1,yt,3,4,"button",1),e.YNc(2,Pt,38,35,"ng-template",null,2,e.W1O)),2&t&&(e.Q6J("ngIf",!n.device),e.xp6(1),e.Q6J("ngIf",n.device))},directives:[g.O5,b.ix,f.dQ,T.w,C.SY,c._Y,c.JL,c.F,q.H,O.P,c.Fj,c.nD,c.Q7,At.M,c.JJ,c.On,w._,ee.u,S.b],pipes:[_.X$],styles:[""]}),o})();var Jt=d(4327);let ne=(()=>{class o{constructor(t,n,i){this.translate=t,this.toastr=n,this.modbusDeviceService=i,this.saving=!1}downloadDescriptor(){!this.objectId||this.modbusDeviceService.downloadDescriptor(this.objectId).subscribe(t=>{let n="";const i=t.headers.get("Content-Disposition");i&&(n=i.split("filename=")[1].replace(/"/g,""));const s=new Blob([t.body]);(0,Jt.saveAs)(s,n)},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(N.D))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-modbus-device-download-descriptor"]],inputs:{type:"type",id:"id",objectId:"objectId"},decls:3,vars:4,consts:[["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_download_16"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.downloadDescriptor()}),e.ALo(1,"translate"),e._UZ(2,"i",1),e.qZA()),2&t&&(e.s9C("nzTooltipTitle",e.lcZ(1,2,"DOWNLOAD_DESCRIPTOR")),e.Q6J("id",n.id))},directives:[b.ix,f.dQ,T.w,C.SY],pipes:[_.X$],styles:[""]}),o})();var _e=d(2334);const kt=["uploadDescriptorTemplate"];function Qt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",3),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",4),e.TgZ(4,"app-file-upload",5),e.NdJ("fileChange",function(i){return e.CHM(t),e.oxw().file=i})("callbackChange",function(){return e.CHM(t),e.oxw().hideToast()}),e.qZA(),e.qZA(),e.TgZ(5,"div",6),e.TgZ(6,"button",7),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().uploadDescriptor()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,8,"UPLOAD_DESCRIPTOR")," "),e.xp6(3),e.Q6J("file",t.file),e.xp6(2),e.uIk("id","modal_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(8,10,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",t.saving)("disabled",t.saving),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(11,12,"SAVE"))}}let ie=(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.modbusDeviceService=i,this.modalService=s,this.saving=!1}uploadDescriptorModal(){this.modalService.showModal(this.uploadDescriptorTemplate)}uploadDescriptor(){if(!this.objectId)return;if(!this.file)return void this.toastr.warning(this.translate.instant("PLEASE_SELECT_FILE"));this.saving=!0;const t=new FileReader;t.onload=()=>{let n=t.result;try{n=JSON.parse(n)}catch(i){return this.toastr.warning(this.translate.instant("NOT_VALID_JSON")),void(this.saving=!1)}this.modbusDeviceService.uploadDescriptor(n,this.type,this.objectId).subscribe(()=>{this.toastr.success(this.translate.instant("DESCRIPTOR_UPLOAD_SUCCESS",{name:"<strong>"+this.name+"</strong>"})),this.callbackChange(),this.modalService.hide(),this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1})},t.onerror=()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))},t.readAsText(this.file)}hideToast(){this.toastr.clear()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(N.D),e.Y36(m.Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-modbus-device-upload-descriptor"]],viewQuery:function(t,n){if(1&t&&e.Gf(kt,5),2&t){let i;e.iGM(i=e.CRH())&&(n.uploadDescriptorTemplate=i.first)}},inputs:{type:"type",id:"id",name:"name",objectId:"objectId",callbackChange:"callbackChange"},decls:5,vars:4,consts:[["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_upload_16"],["uploadDescriptorTemplate",""],[1,"p-dialog-header"],[1,"p-dialog-body"],["inputId","selected_file","accept",".json",3,"file","fileChange","callbackChange"],[1,"p-dialog-footer"],["nz-button","","appHideModal",""],["nz-button","","nzType","primary",3,"nzLoading","disabled","click"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.uploadDescriptorModal()}),e.ALo(1,"translate"),e._UZ(2,"i",1),e.qZA(),e.YNc(3,Qt,12,14,"ng-template",null,2,e.W1O)),2&t&&(e.s9C("nzTooltipTitle",e.lcZ(1,2,"UPLOAD_DESCRIPTOR")),e.Q6J("id",n.id))},directives:[b.ix,f.dQ,T.w,C.SY,_e.Y,re.u],pipes:[_.X$],styles:[""]}),o})(),pe=(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.modalService=i,this.modbusDeviceService=s,this.saving=!1,this.translations={MeterABB:{remove:"MODBUS_RTU_DEVICE_REMOVE",removeSuccess:"MODBUS_RTU_DEVICE_REMOVE_SUCCESS"},ThirdPartyRTU:{remove:"MODBUS_RTU_DEVICE_REMOVE",removeSuccess:"MODBUS_RTU_DEVICE_REMOVE_SUCCESS"},ThirdPartyTCP:{remove:"MODBUS_TCP_DEVICE_REMOVE",removeSuccess:"MODBUS_TCP_DEVICE_REMOVE_SUCCESS"}}}removeDevice(){this.toastr.clear(),this.modalService.showConfirm(this.translate.instant(this.translations[this.type].remove,{name:"<strong>"+this.name+"</strong>"}),()=>{this.modalService.setLoading(!0),this.modbusDeviceService.removeDevice(this.objectId,this.type).subscribe(()=>{this.toastr.success(this.translate.instant(this.translations[this.type].removeSuccess,{name:"<strong>"+this.name+"</strong>"})),this.modalService.hide(),this.callbackChange()},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})},()=>this.modalService.hide(),this.translate.instant("DEVICE_REMOVE_WARNING"))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(N.D))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-modbus-device-remove"]],inputs:{type:"type",id:"id",objectId:"objectId",name:"name",callbackChange:"callbackChange"},decls:3,vars:4,consts:[["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_close_16"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.removeDevice()}),e.ALo(1,"translate"),e._UZ(2,"i",1),e.qZA()),2&t&&(e.s9C("nzTooltipTitle",e.lcZ(1,2,"REMOVE")),e.Q6J("id",n.id))},directives:[b.ix,f.dQ,T.w,C.SY],pipes:[_.X$],styles:[""]}),o})();const Ft=["addRegisterTemplate"];function Vt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){return e.CHM(t),e.oxw().openAddRegisterDrawer()}),e._UZ(1,"i",4),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"ADD_REGISTER"),"\n"))}function Yt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().openAddRegisterDrawer()}),e.ALo(1,"translate"),e._UZ(2,"i",6),e.qZA()}if(2&o){const t=e.oxw();e.s9C("nzTooltipTitle",e.lcZ(1,2,"EDIT")),e.Q6J("id",t.id)}}const x=function(){return{required:!0}};function jt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label",13),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",31),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.modbusDataType=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"SIGNEDNESS"),":"),e.xp6(2),e.Q6J("model",t.editRegister.modbusDataType)("options",t.signednesses)("validators",e.DdM(6,x))}}function Bt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label",13),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",32),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.multiplier=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"MULTIPLIER"),":"),e.xp6(2),e.Q6J("model",t.editRegister.multiplier)("options",t.multipliers)("validators",e.DdM(6,x))}}function Gt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label",13),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",33),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.precision=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"PRECISION"),":"),e.xp6(2),e.Q6J("model",t.editRegister.precision)("options",t.multipliers)("validators",e.DdM(6,x))}}function Ht(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label",13),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",34),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.endianness=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"WORD_BYTE_ORDER"),":"),e.xp6(2),e.Q6J("model",t.editRegister.endianness)("options",t.byteOrders)("validators",e.DdM(6,x))}}const oe=function(o){return{"label-required":o}};function Wt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label",26),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",35),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.readable=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(8,oe,!t.isPredefinedRegister)),e.xp6(1),e.hij("",e.lcZ(3,6,"READABLE"),":"),e.xp6(2),e.Q6J("model",t.editRegister.readable)("options",t.yesNoBoolean)("validators",e.DdM(10,x))("disabled",t.isPredefinedRegister)}}function $t(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label",26),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",36),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.cumulative=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(8,oe,!t.isPredefinedRegister)),e.xp6(1),e.hij("",e.lcZ(3,6,"CUMULATIVE"),":"),e.xp6(2),e.Q6J("model",t.editRegister.cumulative)("options",t.yesNo)("validators",e.DdM(10,x))("disabled",t.isPredefinedRegister)}}function Kt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",37),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editRegister.dbWriteInterval=i}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,4,"STORAGE_INTERVAL"),":"),e.xp6(2),e.Q6J("model",t.editRegister.dbWriteInterval)("options",t.dbWriteIntervals)("clearable",!0)}}const Xt=function(o,a){return{required:!0,invalidValues:o,invalidValuesMsg:a}},en=function(){return["Energy Values","Instantaneous Values","Power Quality Values","Harmonics","Maximum Values","Unbalances"]},tn=function(o,a){return{invalidValues:o,invalidValuesMsg:a}};function nn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeAddRegisterDrawer()}),e._UZ(1,"i",8),e.qZA(),e.TgZ(2,"div",9),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",10),e.TgZ(6,"form",null,11),e.TgZ(8,"div",12),e.TgZ(9,"label",13),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"app-validate",14),e.TgZ(13,"nz-input-number",15,16),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editRegister.address=i}),e.ALo(15,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(16,"div",12),e.TgZ(17,"label",13),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"app-select",17),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.category=i})("callbackChange",function(){return e.CHM(t),e.oxw().categoryChanged()}),e.qZA(),e.qZA(),e.TgZ(21,"div",12),e.TgZ(22,"label",13),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"app-select",18),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.variable=i})("callbackChange",function(){return e.CHM(t),e.oxw().registerChanged()}),e.ALo(26,"translate"),e.qZA(),e.qZA(),e.TgZ(27,"div",12),e.TgZ(28,"label"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"app-select",19),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.tag=i}),e.ALo(32,"translate"),e.qZA(),e.qZA(),e.TgZ(33,"div",12),e.TgZ(34,"label",13),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"app-select",20),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.function=i})("callbackChange",function(){e.CHM(t);const i=e.MAs(7);return e.oxw().functionChanged(i)}),e.qZA(),e.qZA(),e.TgZ(38,"div",12),e.TgZ(39,"label",13),e._uU(40),e.ALo(41,"translate"),e.qZA(),e.TgZ(42,"app-select",21),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.dataType=i})("callbackChange",function(){return e.CHM(t),e.oxw().dataTypeChanged()}),e.qZA(),e.qZA(),e.YNc(43,jt,5,7,"div",22),e.YNc(44,Bt,5,7,"div",22),e.YNc(45,Gt,5,7,"div",22),e.TgZ(46,"div",12),e.TgZ(47,"label",13),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"app-validate",14),e.TgZ(51,"nz-input-number",23,24),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editRegister.size=i}),e.qZA(),e.qZA(),e.qZA(),e.YNc(53,Ht,5,7,"div",22),e.TgZ(54,"div",12),e.TgZ(55,"label"),e._uU(56),e.ALo(57,"translate"),e.qZA(),e.TgZ(58,"app-select",25),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.unit=i}),e.qZA(),e.qZA(),e.TgZ(59,"div",12),e.TgZ(60,"label",26),e._uU(61),e.ALo(62,"translate"),e.qZA(),e.TgZ(63,"app-select",27),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.writable=i})("callbackChange",function(){return e.CHM(t),e.oxw().writableChanged()}),e.qZA(),e.qZA(),e.YNc(64,Wt,5,11,"div",22),e.YNc(65,$t,5,11,"div",22),e.TgZ(66,"div",12),e.TgZ(67,"label",13),e._uU(68),e.ALo(69,"translate"),e.qZA(),e.TgZ(70,"app-select",28),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editRegister.readInterval=i}),e.qZA(),e.qZA(),e.YNc(71,Kt,5,6,"div",22),e.TgZ(72,"div",12),e._UZ(73,"label"),e.TgZ(74,"button",29),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeAddRegisterDrawer(!0)}),e._uU(75),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"button",30),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw().saveRegister()}),e._uU(78),e.ALo(79,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(7),n=e.MAs(14),i=e.MAs(52),s=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,71,s.editVariableName?"EDIT_REGISTER":"ADD_NEW_REGISTER")," "),e.xp6(7),e.hij("",e.lcZ(11,73,"ADDRESS"),":"),e.xp6(2),e.Q6J("field",n),e.xp6(1),e.Q6J("ngModel",s.editRegister.address)("nzMin",0)("nzMax",65535)("required",!0)("takenPairs",s.takenPairs)("currentFunction",s.editRegister)("appInvalidValues",s.takenAddresses)("appInvalidValuesMsg",e.lcZ(15,75,"SAME_PAIR")),e.xp6(5),e.hij("",e.lcZ(19,77,"CATEGORY"),":"),e.xp6(2),e.Q6J("model",s.editRegister.category)("options",s.categories)("validators",e.DdM(103,x))("add",!0),e.xp6(3),e.hij("",e.lcZ(24,79,"REGISTER"),":"),e.xp6(2),e.Q6J("model",s.editRegister.variable)("options",s.registers)("validators",e.WLB(104,Xt,s.takenVariables,e.lcZ(26,81,"VARIABLE_ALREADY_ASSIGNED")))("add",!e.DdM(107,en).includes(s.editRegister.category||"")),e.xp6(4),e.hij("",e.lcZ(30,83,"TAG"),":"),e.xp6(2),e.Q6J("model",s.editRegister.tag)("options",s.tags)("validators",e.WLB(108,tn,s.takenTags,e.lcZ(32,85,"TAG_ALREADY_ASSIGNED")))("clearable",!0),e.xp6(4),e.hij("",e.lcZ(36,87,"FUNCTION"),":"),e.xp6(2),e.Q6J("model",s.editRegister.function)("options",s.functions)("validators",e.DdM(111,x)),e.xp6(3),e.hij("",e.lcZ(41,89,"DATA_TYPE"),":"),e.xp6(2),e.Q6J("model",s.editRegister.dataType)("options",s.dataTypes)("validators",e.DdM(112,x))("disabled",1===s.editRegister.function||2===s.editRegister.function),e.xp6(1),e.Q6J("ngIf","integer"===s.editRegister.dataType),e.xp6(1),e.Q6J("ngIf","float"!==s.editRegister.dataType&&1!==s.editRegister.function&&2!==s.editRegister.function&&"string"!==s.editRegister.dataType&&"boolean"!==s.editRegister.dataType),e.xp6(1),e.Q6J("ngIf","float"===s.editRegister.dataType),e.xp6(3),e.hij("",e.lcZ(49,91,"NR_OF_REGISTERS"),":"),e.xp6(2),e.Q6J("field",i),e.xp6(1),e.Q6J("ngModel",s.editRegister.size)("required",!0)("nzMin",1)("nzMax",65535)("disabled",1===s.editRegister.function||2===s.editRegister.function||"boolean"===s.editRegister.dataType||"float"===s.editRegister.dataType),e.xp6(2),e.Q6J("ngIf",1!==s.editRegister.function&&2!==s.editRegister.function),e.xp6(3),e.hij("",e.lcZ(57,93,"UNIT"),":"),e.xp6(2),e.Q6J("model",s.editRegister.unit)("options",s.units)("add",!0)("clearable",!0),e.xp6(2),e.Q6J("ngClass",e.VKq(113,oe,!s.isPredefinedRegister)),e.xp6(1),e.hij("",e.lcZ(62,95,"WRITABLE"),":"),e.xp6(2),e.Q6J("model",s.editRegister.writable)("options",s.yesNoBoolean)("validators",e.DdM(115,x))("disabled",s.isPredefinedRegister),e.xp6(1),e.Q6J("ngIf",s.editRegister.writable),e.xp6(1),e.Q6J("ngIf","string"!==s.editRegister.dataType&&"boolean"!==s.editRegister.dataType),e.xp6(3),e.hij("",e.lcZ(69,97,"READ_INTERVAL"),":"),e.xp6(2),e.Q6J("model",s.editRegister.readInterval)("options",s.readIntervals)("validators",e.DdM(116,x)),e.xp6(1),e.Q6J("ngIf","string"!==s.editRegister.dataType),e.xp6(3),e.uIk("id","drawer_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(76,99,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",s.saving)("disabled",s.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(79,101,s.editVariableName?"SAVE_REGISTER":"ADD_REGISTER"))}}let ue=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.modbusDeviceService=s,this.drawerService=r,this.cl="app-modbus-device-add-register",this.takenAddresses=[],this.takenPairs=[],this.takenVariables=[],this.takenTags=[],this.saving=!1,this.dataTypes=h.DJ,this.byteOrders=h.tc,this.functions=h.wk,this.units=h.Dl,this.isPredefinedRegister=!1,this.isDefaultRegister=!1,this.multipliers=[{id:1,text:"1"},{id:.1,text:"0.1"},{id:.01,text:"0.01"},{id:.001,text:"0.001"}],this.stopbits=[{id:1,text:"1"},{id:2,text:"2"}],this.readIntervals=[{id:10,name:"10"},{id:30,name:"30"},{id:900,name:"900"}],this.dbWriteIntervals=[{id:30,name:"30"},{id:900,name:"900"}],this.signednesses=[{id:"Unsigned integer",name:"Unsigned integer"},{id:"Signed integer",name:"Signed integer"}],this.yesNo=h.ij,this.yesNoBoolean=h.Vs}ngOnInit(){this.defaultRegister={function:3,dataType:"integer",modbusDataType:"Unsigned integer",multiplier:1,size:2,readInterval:30,dbWriteInterval:900,cumulative:0,writable:!1,readable:!0,endianness:"ABCD"},this.editRegister=Object.assign({},this.defaultRegister),this.isDefaultRegister=!0}closeAddRegisterDrawer(t=!1){t&&(this.editRegister=Object.assign({},this.defaultRegister),this.isDefaultRegister=!0),this.drawerService.hide()}openAddRegisterDrawer(){this.takenPairs=[],this.takenVariables=[],this.toastr.clear(),this.checkPredefined(),this.isPredefinedRegister&&(this.dataTypes=[...this.dataTypes.filter(n=>"string"!==n.id)],this.editRegister.dataType="integer");const t=this.device.variables[this.device.variables.length-1];if(this.editVariableName){const n=this.device.variables.find(i=>i.variable===this.editVariableName);this.editRegister=Object.assign({},n)}else{if(this.device.variables&&this.device.variables.length>=128)return void this.modalService.showInfo(this.translate.instant("ADD_DEVICES_VARIABLES_FULL"),()=>{this.modalService.hide()});t&&this.isDefaultRegister&&(this.editRegister=Object.assign(Object.assign({},t),{address:t.address+t.size,variable:null,tag:null}))}this.device.variables.forEach(n=>{if(n.variable!==this.editVariableName){this.takenAddresses.push(n.address),this.takenPairs.push({address:n.address,function:n.function}),this.takenPairs.push({address:n.address,function:n.function});let i=this.translate.instant(n.variable);i!==n.variable&&this.takenVariables.push(i),this.takenVariables.push(n.variable),n.tag&&this.takenTags.push(n.tag)}}),this.drawerService.showDrawer(this.addRegisterTemplate).subscribe(),this.checkCategories(),this.checkRegisters(),this.isDefaultRegister=!1}saveRegister(){let t;this.saving=!0,t=this.editVariableName?"REGISTER_EDIT_SUCCESS":"REGISTER_ADD_SUCCESS";const n=this.device.variables.map(i=>Object.assign({},i));if(this.editVariableName){let i=n.find(s=>s.variable===this.editVariableName);i.dataType=this.editRegister.dataType,i.modbusDataType=this.editRegister.modbusDataType,i.address=this.editRegister.address,i.size=this.editRegister.size,i.function=this.editRegister.function,i.multiplier=this.editRegister.multiplier,i.precision=this.editRegister.precision,i.endianness=this.editRegister.endianness,i.readInterval=this.editRegister.readInterval,i.dbWriteInterval=this.editRegister.dbWriteInterval,i.cumulative=this.editRegister.cumulative,i.writable=this.editRegister.writable,i.readable=this.editRegister.readable,i.variable=this.editRegister.variable,i.category=this.editRegister.category,i.tag=this.editRegister.tag,i.unit=this.editRegister.unit}else n.push(Object.assign({},this.editRegister));n.forEach(i=>{null===i.tag&&delete i.tag,null===i.unit&&delete i.unit,null===i.dbWriteInterval&&delete i.dbWriteInterval}),this.modbusDeviceService.saveDescriptor(n,this.type,this.device.object_id).subscribe(()=>{const i=this.translate.instant(String(this.editRegister.variable));this.toastr.success(this.translate.instant(t,{name:"<strong>"+i+"</strong>"})),this.modalService.hide(),this.closeAddRegisterDrawer(!0),this.saving=!1,this.device.variables=[...n.sort((s,r)=>s.address-r.addres)]},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1})}checkCategories(){this.categories=[],Object.keys(h.dQ).forEach(t=>{this.categories.push({id:t,text:t})}),this.device.variables.forEach(t=>{!this.categories.some(i=>i.id===t.category)&&t.category&&this.categories.unshift({id:t.category,text:t.category})}),this.isPredefinedRegister||!this.categories.some(n=>n.id===this.editRegister.category)&&this.editRegister.category&&this.categories.unshift({id:this.editRegister.category,text:this.editRegister.category}),this.isPredefinedRegister&&(this.dataTypes=[...this.dataTypes.filter(t=>"string"!==t.id)])}checkRegisters(){this.registers=[],this.editRegister.category&&(h.dQ.hasOwnProperty(this.editRegister.category)&&h.dQ[this.editRegister.category].forEach(t=>{Object.keys(t).forEach(n=>{["l1","l2","l3","n","total"].includes(n)&&(this.device.variables.some(s=>s.variable===t[n]&&s.variable!==this.editVariableName)||this.registers.push({id:t[n],text:t[n]}))})}),["Energy Values","Instantaneous Values","Power Quality Values","Maximum Values","Unbalances"].includes(this.editRegister.category||"")&&(this.registers.find(n=>n.id===this.editRegister.variable)||(this.registers?(this.editRegister.variable=this.registers[0].id,this.checkTag()):this.editRegister.variable=void 0)),this.editRegister.variable&&(this.editVariableName?this.registers.some(n=>n.id===this.editVariableName)||this.registers.unshift({id:this.editVariableName,text:this.editVariableName}):this.registers.some(n=>n.id===this.editRegister.variable)||this.registers.push({id:this.editRegister.variable,text:this.editRegister.variable})),this.isPredefinedRegister||this.device.variables.filter(n=>n.category===this.editRegister.category).forEach(n=>{this.registers.some(s=>s.id===n.variable)||this.registers.push({id:n.variable,text:n.variable})}))}categoryChanged(){this.dataTypes=h.DJ,this.editRegister.variable=void 0,this.checkPredefined(),this.checkRegisters(),this.isPredefinedRegister&&(this.checkTag(),this.editRegister.cumulative=Number("Energy Values"===this.editRegister.category),this.editRegister.writable=!1,this.editRegister.readable=!0,this.dataTypes=[...this.dataTypes.filter(t=>"string"!==t.id)],"string"===this.editRegister.dataType&&(this.editRegister.dataType="integer",this.editRegister.modbusDataType="Unsigned integer"))}registerChanged(){this.isPredefinedRegister&&this.checkTag()}checkTag(){const t=this.tags.find(n=>n.id===this.editRegister.variable);t&&(this.editRegister.tag=String(t.id))}checkPredefined(){var t;this.isPredefinedRegister=["Energy Values","Instantaneous Values","Power Quality Values","Maximum Values","Unbalances"].includes((null===(t=this.editRegister)||void 0===t?void 0:t.category)||"")}functionChanged(t){(1===this.editRegister.function||2===this.editRegister.function)&&(this.editRegister.size=1,this.editRegister.multiplier=void 0,this.editRegister.precision=void 0,this.editRegister.endianness="ABCD",this.editRegister.dataType="boolean"),t.controls.addressInput.markAsTouched(),t.controls.addressInput.updateValueAndValidity()}dataTypeChanged(){"boolean"===this.editRegister.dataType?(this.editRegister.size=1,this.editRegister.dbWriteInterval=30,this.editRegister.cumulative=void 0,this.editRegister.multiplier=void 0,this.editRegister.precision=void 0,this.editRegister.modbusDataType=void 0):"string"===this.editRegister.dataType?(this.editRegister.dbWriteInterval=void 0,this.editRegister.cumulative=void 0,this.editRegister.multiplier=void 0,this.editRegister.precision=void 0,this.editRegister.modbusDataType=void 0):"float"===this.editRegister.dataType?(this.editRegister.size=2,this.editRegister.dbWriteInterval=30,this.editRegister.multiplier=void 0,this.editRegister.modbusDataType=void 0,this.editRegister.precision=1,this.editRegister.cumulative=0):"integer"===this.editRegister.dataType&&(this.editRegister.dbWriteInterval=30,this.editRegister.modbusDataType="Unsigned integer",this.editRegister.precision=void 0,this.editRegister.multiplier=1,this.editRegister.cumulative=0)}writableChanged(){this.editRegister.writable||(this.editRegister.readable=!0)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(N.D),e.Y36(A.z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-modbus-device-add-register"]],viewQuery:function(t,n){if(1&t&&e.Gf(Ft,5),2&t){let i;e.iGM(i=e.CRH())&&(n.addRegisterTemplate=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("class",n.cl)},inputs:{type:"type",id:"id",editVariableName:"editVariableName",device:"device",tags:"tags",existingDevices:"existingDevices"},decls:4,vars:2,consts:[["type","button","nzType","primary","nz-button","","id","add_register_button",3,"click",4,"ngIf"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click",4,"ngIf"],["addRegisterTemplate",""],["type","button","nzType","primary","nz-button","","id","add_register_button",3,"click"],[1,"icon_abb_16","icon-abb_plus_16"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_edit_16"],["tabIndex","-1","nz-button","",1,"drawer-button-close",3,"click"],[1,"icon_abb_16","icon-abb_close_16"],[1,"drawer-title","text-line"],[1,"drawer-body"],["formAdd","ngForm"],[1,"form-group"],[1,"label-required"],[3,"field"],["id","address_input_wrapper","nzId","address_input","name","addressInput",3,"ngModel","nzMin","nzMax","required","takenPairs","currentFunction","appInvalidValues","appInvalidValuesMsg","ngModelChange"],["addressInput","ngModel"],["inputId","category_select",3,"model","options","validators","add","modelChange","callbackChange"],["inputId","register_select",3,"model","options","validators","add","modelChange","callbackChange"],["inputId","tag_select",3,"model","options","validators","clearable","modelChange"],["inputId","function_select",3,"model","options","validators","modelChange","callbackChange"],["inputId","data_type_select",3,"model","options","validators","disabled","modelChange","callbackChange"],["class","form-group",4,"ngIf"],["id","size_input_wrapper","nzId","size_input","name","sizeInput",3,"ngModel","required","nzMin","nzMax","disabled","ngModelChange"],["sizeInput","ngModel"],["inputId","unit_select",3,"model","options","add","clearable","modelChange"],[3,"ngClass"],["inputId","writable_select",3,"model","options","validators","disabled","modelChange","callbackChange"],["inputId","read_interval_select",3,"model","options","validators","modelChange"],["type","button","nz-button","",3,"click"],["type","submit","nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],["inputId","signedness_select",3,"model","options","validators","modelChange"],["inputId","multiplier_select",3,"model","options","validators","modelChange"],["inputId","precision_select",3,"model","options","validators","modelChange"],["inputId","byte_order_select",3,"model","options","validators","modelChange"],["inputId","readable_select",3,"model","options","validators","disabled","modelChange"],["inputId","cumulative_select",3,"model","options","validators","disabled","modelChange"],["inputId","db_write_interval_select",3,"model","options","clearable","modelChange"]],template:function(t,n){1&t&&(e.YNc(0,Vt,4,3,"button",0),e.YNc(1,Yt,3,4,"button",1),e.YNc(2,nn,80,117,"ng-template",null,2,e.W1O)),2&t&&(e.Q6J("ngIf",!n.editVariableName),e.xp6(1),e.Q6J("ngIf",n.editVariableName))},directives:[g.O5,b.ix,f.dQ,T.w,C.SY,c._Y,c.JL,c.F,O.P,w._,c.JJ,c.On,c.Q7,ee.u,q.H,g.mk,S.b],pipes:[_.X$],styles:[""]}),o})(),me=(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.modalService=i,this.modbusDeviceService=s,this.callbackChange=new e.vpe,this.saving=!1}removeDevice(){this.toastr.clear();const t=this.translate.instant(String(this.removeVariableName));this.modalService.showConfirm(this.translate.instant("REGISTER_REMOVE",{name:"<strong>"+t+"</strong>"}),()=>{this.modalService.setLoading(!0);const n=this.device.variables.filter(i=>i.variable!==this.removeVariableName);this.modbusDeviceService.saveDescriptor(n,this.type,this.device.object_id).subscribe(()=>{this.toastr.success(this.translate.instant("REGISTER_REMOVE_SUCCESS",{name:"<strong>"+t+"</strong>"})),this.callbackChange.emit({object_id:this.device.object_id,registers:n}),this.modalService.hide(),this.saving=!1,this.device.variables=[...n]},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(N.D))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-modbus-device-remove-register"]],inputs:{type:"type",id:"id",removeVariableName:"removeVariableName",device:"device"},outputs:{callbackChange:"callbackChange"},decls:3,vars:4,consts:[["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_close_16"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.removeDevice()}),e.ALo(1,"translate"),e._UZ(2,"i",1),e.qZA()),2&t&&(e.s9C("nzTooltipTitle",e.lcZ(1,2,"REMOVE")),e.Q6J("id",n.id))},directives:[b.ix,f.dQ,T.w,C.SY],pipes:[_.X$],styles:[""]}),o})();function on(o,a){1&o&&e._UZ(0,"app-loader")}function sn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"td",30),e.NdJ("nzExpandChange",function(i){return e.CHM(t),e.oxw().$implicit.expand=i}),e.qZA()}if(2&o){const t=e.oxw(),n=t.index,i=t.$implicit;e.oxw();const s=e.MAs(2);e.MGl("id","expand_registers_button_",n,""),e.Q6J("nzLeft",s.allowNzLeft)("nzExpand",i.expand)}}function an(o,a){if(1&o&&e._UZ(0,"td",15),2&o){e.oxw(2);const t=e.MAs(2);e.Q6J("nzLeft",t.allowNzLeft)}}function rn(o,a){if(1&o&&e._UZ(0,"app-modbus-device-download-descriptor",31),2&o){const t=e.oxw(),i=t.$implicit;e.MGl("id","download_descriptor_button_",t.index,""),e.Q6J("objectId",i.object_id)}}function ln(o,a){if(1&o&&e._UZ(0,"app-modbus-device-upload-descriptor",32),2&o){const t=e.oxw(),n=t.index,i=t.$implicit,s=e.oxw(2);e.MGl("id","upload_descriptor_button_",n,""),e.Q6J("objectId",i.object_id)("name",i.name)("callbackChange",s.getData.bind(s))}}function cn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.multiplier)}}function dn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.precision)}}function _n(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"valueFromId"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(4);e.xp6(1),e.Oqu(e.lcZ(2,1,e.Dn7(3,3,t.endianness,n.byteOrders,"text")))}}function pn(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function un(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"valueFromId"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(4);e.xp6(1),e.hij(" ",e.lcZ(2,1,e.xi3(3,3,t.cumulative,n.yesNo)),"")}}function mn(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function gn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.dbWriteInterval)}}function hn(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function vn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"translate"),e.ALo(9,"valueFromId"),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.ALo(12,"translate"),e.ALo(13,"valueFromId"),e.qZA(),e.TgZ(14,"td"),e.YNc(15,cn,2,1,"span",2),e.YNc(16,dn,2,1,"span",2),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e.YNc(20,_n,4,7,"span",2),e.YNc(21,pn,2,0,"span",2),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.qZA(),e.TgZ(24,"td"),e.YNc(25,un,4,6,"span",2),e.YNc(26,mn,2,0,"span",2),e.qZA(),e.TgZ(27,"td"),e._uU(28),e.qZA(),e.TgZ(29,"td"),e.YNc(30,gn,2,1,"span",2),e.YNc(31,hn,2,0,"span",2),e.qZA(),e.TgZ(32,"td"),e._UZ(33,"app-modbus-device-add-register",40),e.TgZ(34,"app-modbus-device-remove-register",41),e.NdJ("callbackChange",function(i){return e.CHM(t),e.oxw(4).updateRegisters(i)}),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index,i=e.oxw(2),s=i.index,r=i.$implicit,p=e.oxw(2);e.xp6(2),e.Oqu(t.address),e.xp6(2),e.Oqu(e.lcZ(5,24,t.variable)),e.xp6(3),e.Oqu(e.lcZ(8,26,e.Dn7(9,28,t.function,p.functions,"text"))),e.xp6(4),e.Oqu(e.lcZ(12,32,e.Dn7(13,34,t.dataType,p.dataTypes,"text"))),e.xp6(4),e.Q6J("ngIf","integer"===t.dataType),e.xp6(1),e.Q6J("ngIf","float"===t.dataType),e.xp6(2),e.Oqu(t.size),e.xp6(2),e.Q6J("ngIf",1!==t.function&&2!==t.function),e.xp6(1),e.Q6J("ngIf",1===t.function||2===t.function),e.xp6(2),e.Oqu(t.unit),e.xp6(2),e.Q6J("ngIf","integer"===t.dataType||"float"===t.dataType),e.xp6(1),e.Q6J("ngIf","integer"!==t.dataType&&"float"!==t.dataType),e.xp6(2),e.Oqu(t.readInterval),e.xp6(2),e.Q6J("ngIf","string"!==t.dataType),e.xp6(1),e.Q6J("ngIf","string"===t.dataType),e.xp6(2),e.hYB("id","edit_register_button_",s,"_",n,""),e.Q6J("device",r)("editVariableName",t.variable)("tags",p.tags),e.xp6(1),e.hYB("id","remove_register_button_",s,"_",n,""),e.Q6J("device",r)("removeVariableName",t.variable)}}const bn=function(){return["0"]},fn=function(o){return{x:o}};function Tn(o,a){if(1&o&&(e.TgZ(0,"tr",33),e.TgZ(1,"nz-table",34),e.TgZ(2,"thead"),e.TgZ(3,"tr"),e.TgZ(4,"th",35),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"th"),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"th"),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"th",36),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"th",36),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"th"),e._uU(33),e.ALo(34,"translate"),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"th"),e._uU(37),e.ALo(38,"translate"),e.ALo(39,"translate"),e.qZA(),e.TgZ(40,"th",37),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(43,"tbody"),e.YNc(44,vn,35,38,"tr",20),e.TgZ(45,"tr"),e.TgZ(46,"td",38),e._UZ(47,"app-modbus-device-add-register",39),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o){const t=e.oxw(),n=t.$implicit,i=t.index;e.oxw();const s=e.MAs(2),r=e.oxw();e.Q6J("nzExpand",n.expand||!1),e.xp6(1),e.MGl("id","registers_table_",i,""),e.Q6J("nzData",e.DdM(54,bn))("nzScroll",e.VKq(55,fn,s.tableWidth))("nzFrontPagination",!1),e.xp6(4),e.Oqu(e.lcZ(6,24,"ADDRESS")),e.xp6(3),e.Oqu(e.lcZ(9,26,"REGISTER")),e.xp6(3),e.Oqu(e.lcZ(12,28,"FUNCTION")),e.xp6(3),e.Oqu(e.lcZ(15,30,"DATAPOINT_TYPE")),e.xp6(3),e.AsE("",e.lcZ(18,32,"MULTIPLIER"),"/",e.lcZ(19,34,"PRECISION"),""),e.xp6(4),e.Oqu(e.lcZ(22,36,"NR_OF_REGISTERS")),e.xp6(3),e.Oqu(e.lcZ(25,38,"WORD_BYTE_ORDER")),e.xp6(3),e.Oqu(e.lcZ(28,40,"UNIT")),e.xp6(3),e.Oqu(e.lcZ(31,42,"CUMULATIVE")),e.xp6(3),e.AsE("",e.lcZ(34,44,"READ_INTERVAL")," [",e.lcZ(35,46,"RESOLUTION_S"),"]"),e.xp6(4),e.AsE("",e.lcZ(38,48,"STORAGE_INTERVAL")," [",e.lcZ(39,50,"RESOLUTION_S"),"]"),e.xp6(4),e.Oqu(e.lcZ(42,52,"ACTION")),e.xp6(3),e.Q6J("ngForOf",n.variables),e.xp6(3),e.MGl("id","add_register_button_",i,""),e.Q6J("device",n)("tags",r.tags)}}function Cn(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"tr"),e.YNc(2,sn,1,3,"td",21),e.YNc(3,an,1,1,"td",22),e.TgZ(4,"td",15),e._UZ(5,"app-table-device-status",23),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td",24),e.YNc(12,rn,1,2,"app-modbus-device-download-descriptor",25),e.YNc(13,ln,1,4,"app-modbus-device-upload-descriptor",26),e._UZ(14,"app-modbus-device-add",27),e._UZ(15,"app-modbus-device-remove",28),e.qZA(),e.qZA(),e.YNc(16,Tn,48,57,"tr",29),e.BQk()),2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(2),s=e.oxw();e.xp6(2),e.Q6J("ngIf","ThirdPartyRTU"===t.device_type_name),e.xp6(1),e.Q6J("ngIf","MeterABB"===t.device_type_name),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.hij(" ",t.modbus_id,""),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.baudrate),e.xp6(2),e.Q6J("ngIf","ThirdPartyRTU"===t.device_type_name),e.xp6(1),e.Q6J("ngIf","ThirdPartyRTU"===t.device_type_name),e.xp6(1),e.MGl("id","edit_device_button_",n,""),e.Q6J("type",t.device_type_name)("device",t)("existingDevices",s.existingDevices)("callbackChange",s.getData.bind(s)),e.xp6(1),e.MGl("id","remove_device_button_",n,""),e.Q6J("type",t.device_type_name)("objectId",t.object_id)("name",t.name)("callbackChange",s.getData.bind(s)),e.xp6(1),e.Q6J("ngIf","ThirdPartyRTU"===t.device_type_name)}}const Mn=function(){return{key:"modbus_id",value:"ascend"}},Zn=function(o,a){return{x:o,y:a}},se=function(){return["ascend","descend"]};function xn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"app-table",5,6),e.TgZ(3,"nz-table",7,8),e.ALo(5,"translate"),e.TgZ(6,"thead",9),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(2).sort(i)}),e.TgZ(7,"tr"),e._UZ(8,"th",10),e.TgZ(9,"th",11),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"th",12),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th",12),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"th",13),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.qZA(),e.TgZ(21,"tr",14),e._UZ(22,"th",15),e.TgZ(23,"th",16),e.TgZ(24,"input",17),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(25,"th",18),e.TgZ(26,"input",17),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"name","contains")}),e.qZA(),e.qZA(),e.TgZ(27,"th"),e.TgZ(28,"app-select",19),e.NdJ("modelChange",function(i){return e.CHM(t),e.MAs(2).filtersModel.baudrate=i})("callbackChange",function(){e.CHM(t);const i=e.MAs(2);return i.filter(i.filtersModel.baudrate,"baudrate","equals")}),e.qZA(),e.qZA(),e._UZ(29,"th"),e.qZA(),e.qZA(),e.TgZ(30,"tbody"),e.YNc(31,Cn,17,22,"ng-container",20),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.oxw();e.xp6(1),e.Q6J("initSort",e.DdM(39,Mn))("data",i.rows),e.xp6(2),e.Q6J("nzData",t.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(40,Zn,t.tableWidth,t.tableHeight))("nzNoResult",e.lcZ(5,29,"NO_MODBUS_RTU_DEVICES")),e.xp6(5),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(43,se))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(11,31,"MODBUS_ID")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(44,se)),e.xp6(1),e.Oqu(e.lcZ(14,33,"NAME")),e.xp6(2),e.Q6J("nzColumnKey","baudrate")("nzSortFn",!0)("nzSortDirections",e.DdM(45,se)),e.xp6(1),e.Oqu(e.lcZ(17,35,"BAUD_RATE")),e.xp6(3),e.Oqu(e.lcZ(20,37,"ACTION")),e.xp6(3),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(5),e.Q6J("options",i.baudratesAll)("showSearch",!1)("clearable",!0)("model",t.filtersModel.baudrate),e.xp6(3),e.Q6J("ngForOf",n.data)}}let An=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.modbusRtuDevicesService=s,this.sharedService=r,this.id="my_plant_modbus_rtu_devices",this.loadingData=!0,this.dataTypes=h.DJ,this.byteOrders=h.tc,this.functions=h.wk,this.yesNo=h.ij,this.baudratesAll=[{id:1200,text:"1200"},{id:2400,text:"2400"},{id:4800,text:"4800"},{id:9600,text:"9600"},{id:19200,text:"19200"},{id:38400,text:"38400"},{id:57600,text:"57600"},{id:115200,text:"115200"}]}ngOnInit(){this.getData()}updateRegisters(t){const n=this.rows.findIndex(i=>t.object_id===i.object_id);this.rows[n].variables=[...t.registers]}getData(){this.loadingData=!0,this.modbusRtuDevicesService.getMeters().subscribe(t=>{this.rows=t.devices,this.rows.forEach(n=>n.expand=!1),this.existingDevices=t.existingDevices,this.tags=t.tags,this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(xt.r),e.Y36(L.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-modbus-rtu-devices"]],hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:4,vars:5,consts:[[1,"section-header"],["type","ThirdPartyRTU",3,"existingDevices","callbackChange","lastDevice"],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"section-content"],[3,"initSort","data"],["table",""],[3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","50px",3,"nzLeft"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],[3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","165px"],[1,"filters"],[3,"nzLeft"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],["inputId","status_filter","inputClass","no-validate",3,"options","showSearch","clearable","model","modelChange","callbackChange"],[4,"ngFor","ngForOf"],[3,"id","nzLeft","nzExpand","nzExpandChange",4,"ngIf"],[3,"nzLeft",4,"ngIf"],[3,"id","status","object_id"],[1,"icons","text-right"],["type","ThirdPartyRTU",3,"objectId","id",4,"ngIf"],["type","ThirdPartyRTU",3,"objectId","name","id","callbackChange",4,"ngIf"],[3,"type","device","existingDevices","id","callbackChange"],[3,"type","objectId","name","id","callbackChange"],[3,"nzExpand",4,"ngIf"],[3,"id","nzLeft","nzExpand","nzExpandChange"],["type","ThirdPartyRTU",3,"objectId","id"],["type","ThirdPartyRTU",3,"objectId","name","id","callbackChange"],[3,"nzExpand"],[3,"nzData","nzScroll","nzFrontPagination","id"],["nzWidth","100px"],["nzWidth","80px"],["nzWidth","120px"],["colspan","12",1,"table-registers-button"],["type","ThirdPartyRTU",3,"id","device","tags"],["type","ThirdPartyRTU",3,"device","editVariableName","id","tags"],["type","ThirdPartyRTU",3,"device","removeVariableName","id","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-modbus-device-add",1),e.qZA(),e.YNc(2,on,1,0,"app-loader",2),e.YNc(3,xn,32,46,"div",3)),2&t&&(e.xp6(1),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n))("lastDevice",n.rows&&n.rows[n.rows.length-1]),e.xp6(1),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[de,g.O5,D.R,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,q.H,l.p0,g.sg,l.h7,I,ne,ie,pe,l.d3,l.Vk,ue,me],pipes:[_.X$,P.h],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:20px;overflow:hidden}"]}),o})(),Dn=(()=>{class o{constructor(t){this.http=t}getMeters(){return this.http.get("api/modbus-tcp-devices")}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(v.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function Sn(o,a){1&o&&e._UZ(0,"app-loader")}function yn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.multiplier)}}function En(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.precision)}}function Rn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"valueFromId"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.xp6(1),e.Oqu(e.lcZ(2,1,e.Dn7(3,3,t.endianness,n.byteOrders,"text")))}}function zn(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function In(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"valueFromId"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.xp6(1),e.hij(" ",e.lcZ(2,1,e.xi3(3,3,t.cumulative,n.yesNo)),"")}}function qn(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function Un(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.dbWriteInterval||"-")}}function On(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function Ln(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"translate"),e.ALo(9,"valueFromId"),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.ALo(12,"translate"),e.ALo(13,"valueFromId"),e.qZA(),e.TgZ(14,"td"),e.YNc(15,yn,2,1,"span",2),e.YNc(16,En,2,1,"span",2),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e.YNc(20,Rn,4,7,"span",2),e.YNc(21,zn,2,0,"span",2),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.qZA(),e.TgZ(24,"td"),e.YNc(25,In,4,6,"span",2),e.YNc(26,qn,2,0,"span",2),e.qZA(),e.TgZ(27,"td"),e._uU(28),e.qZA(),e.TgZ(29,"td"),e.YNc(30,Un,2,1,"span",2),e.YNc(31,On,2,0,"span",2),e.qZA(),e.TgZ(32,"td"),e._UZ(33,"app-modbus-device-add-register",34),e.TgZ(34,"app-modbus-device-remove-register",35),e.NdJ("callbackChange",function(i){return e.CHM(t),e.oxw(3).updateRegisters(i)}),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index,i=e.oxw(),s=i.index,r=i.$implicit,p=e.oxw(2);e.xp6(2),e.Oqu(t.address),e.xp6(2),e.Oqu(e.lcZ(5,25,t.variable)),e.xp6(3),e.Oqu(e.lcZ(8,27,e.Dn7(9,29,t.function,p.functions,"text"))),e.xp6(4),e.Oqu(e.lcZ(12,33,e.Dn7(13,35,t.dataType,p.dataTypes,"text"))),e.xp6(4),e.Q6J("ngIf","integer"===t.dataType),e.xp6(1),e.Q6J("ngIf","float"===t.dataType),e.xp6(2),e.Oqu(t.size),e.xp6(2),e.Q6J("ngIf",1!==t.function&&2!==t.function),e.xp6(1),e.Q6J("ngIf",1===t.function||2===t.function),e.xp6(2),e.Oqu(t.unit),e.xp6(2),e.Q6J("ngIf","integer"===t.dataType||"float"===t.dataType),e.xp6(1),e.Q6J("ngIf","integer"!==t.dataType&&"float"!==t.dataType),e.xp6(2),e.Oqu(t.readInterval),e.xp6(2),e.Q6J("ngIf","string"!==t.dataType),e.xp6(1),e.Q6J("ngIf","string"===t.dataType),e.xp6(2),e.hYB("id","edit_register_button_",s,"_",n,""),e.Q6J("existingDevices",p.rows)("device",r)("editVariableName",t.variable)("tags",p.tags),e.xp6(1),e.hYB("id","remove_register_button_",s,"_",n,""),e.Q6J("device",r)("removeVariableName",t.variable)}}const wn=function(){return["0"]},Nn=function(o){return{x:o}};function Pn(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr"),e.TgZ(2,"td",21),e.NdJ("nzExpandChange",function(i){return e.CHM(t).$implicit.expand=i}),e.qZA(),e.TgZ(3,"td",16),e._UZ(4,"app-table-device-status",22),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td",23),e._UZ(13,"app-modbus-device-add",24),e._UZ(14,"app-modbus-device-download-descriptor",25),e._UZ(15,"app-modbus-device-upload-descriptor",26),e._UZ(16,"app-modbus-device-remove",26),e.qZA(),e.qZA(),e.TgZ(17,"tr",27),e.TgZ(18,"nz-table",28),e.TgZ(19,"thead"),e.TgZ(20,"tr"),e.TgZ(21,"th",29),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"th"),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"th"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"th"),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"th"),e._uU(34),e.ALo(35,"translate"),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"th"),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.TgZ(40,"th"),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"th",30),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"th",30),e._uU(47),e.ALo(48,"translate"),e.qZA(),e.TgZ(49,"th"),e._uU(50),e.ALo(51,"translate"),e.ALo(52,"translate"),e.qZA(),e.TgZ(53,"th"),e._uU(54),e.ALo(55,"translate"),e.ALo(56,"translate"),e.qZA(),e.TgZ(57,"th",31),e._uU(58),e.ALo(59,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(60,"tbody"),e.YNc(61,Ln,35,39,"tr",20),e.TgZ(62,"tr"),e.TgZ(63,"td",32),e._UZ(64,"app-modbus-device-add-register",33),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(2),s=e.oxw();e.xp6(2),e.MGl("id","expand_registers_button_",n,""),e.Q6J("nzLeft",i.allowNzLeft)("nzExpand",t.expand),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.hij(" ",t.ip_address,""),e.xp6(2),e.hij(" ",t.modbus_id,""),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.port),e.xp6(2),e.MGl("id","edit_device_button_",n,""),e.Q6J("device",t)("existingDevices",s.existingDevices)("callbackChange",s.getData.bind(s)),e.xp6(1),e.MGl("id","download_descriptor_button_",n,""),e.Q6J("objectId",t.object_id),e.xp6(1),e.MGl("id","upload_descriptor_button_",n,""),e.Q6J("objectId",t.object_id)("name",t.name)("callbackChange",s.getData.bind(s)),e.xp6(1),e.MGl("id","remove_device_button_",n,""),e.Q6J("objectId",t.object_id)("name",t.name)("callbackChange",s.getData.bind(s)),e.xp6(1),e.Q6J("nzExpand",t.expand||!1),e.xp6(1),e.MGl("id","registers_table_",n,""),e.Q6J("nzData",e.DdM(80,wn))("nzScroll",e.VKq(81,Nn,i.tableWidth))("nzFrontPagination",!1),e.xp6(4),e.Oqu(e.lcZ(23,50,"ADDRESS")),e.xp6(3),e.Oqu(e.lcZ(26,52,"REGISTER")),e.xp6(3),e.Oqu(e.lcZ(29,54,"FUNCTION")),e.xp6(3),e.Oqu(e.lcZ(32,56,"DATAPOINT_TYPE")),e.xp6(3),e.AsE("",e.lcZ(35,58,"MULTIPLIER"),"/",e.lcZ(36,60,"PRECISION"),""),e.xp6(4),e.Oqu(e.lcZ(39,62,"NR_OF_REGISTERS")),e.xp6(3),e.Oqu(e.lcZ(42,64,"WORD_BYTE_ORDER")),e.xp6(3),e.Oqu(e.lcZ(45,66,"UNIT")),e.xp6(3),e.Oqu(e.lcZ(48,68,"CUMULATIVE")),e.xp6(3),e.AsE("",e.lcZ(51,70,"READ_INTERVAL")," [",e.lcZ(52,72,"RESOLUTION_S"),"]"),e.xp6(4),e.AsE("",e.lcZ(55,74,"STORAGE_INTERVAL")," [",e.lcZ(56,76,"RESOLUTION_S"),"]"),e.xp6(4),e.Oqu(e.lcZ(59,78,"ACTION")),e.xp6(3),e.Q6J("ngForOf",t.variables),e.xp6(3),e.MGl("id","add_register_button_",n,""),e.Q6J("existingDevices",s.rows)("device",t)("tags",s.tags)}}const Jn=function(){return{key:"ip_address",value:"ascend"}},kn=function(o,a){return{x:o,y:a}},G=function(){return["ascend","descend"]};function Qn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"app-table",5,6),e.TgZ(3,"nz-table",7,8),e.ALo(5,"translate"),e.TgZ(6,"thead",9),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(2).sort(i)}),e.TgZ(7,"tr"),e._UZ(8,"th",10),e.TgZ(9,"th",11),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"th",12),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th",13),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"th",13),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th",14),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.qZA(),e.TgZ(24,"tr",15),e._UZ(25,"th",16),e.TgZ(26,"th",17),e.TgZ(27,"input",18),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"ip_address","contains")}),e.qZA(),e.qZA(),e.TgZ(28,"th",19),e.TgZ(29,"input",18),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(30,"th",19),e.TgZ(31,"input",18),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"name","contains")}),e.qZA(),e.qZA(),e.TgZ(32,"th"),e.TgZ(33,"input",18),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"port","contains")}),e.qZA(),e.qZA(),e._UZ(34,"th"),e.qZA(),e.qZA(),e.TgZ(35,"tbody"),e.YNc(36,Pn,65,83,"ng-container",20),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.oxw();e.xp6(1),e.Q6J("initSort",e.DdM(42,Jn))("data",i.rows),e.xp6(2),e.Q6J("nzData",t.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(43,kn,t.tableWidth,t.tableHeight))("nzNoResult",e.lcZ(5,30,"NO_MODBUS_TCP_DEVICES")),e.xp6(5),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft)("nzLeft",t.allowNzLeft)("nzColumnKey","ip_address")("nzSortFn",!0)("nzSortDirections",e.DdM(46,G))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(11,32,"IP_ADDRESS")),e.xp6(2),e.Q6J("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(47,G)),e.xp6(1),e.Oqu(e.lcZ(14,34,"MODBUS_ID")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(48,G)),e.xp6(1),e.Oqu(e.lcZ(17,36,"NAME")),e.xp6(2),e.Q6J("nzColumnKey","port")("nzSortFn",!0)("nzSortDirections",e.DdM(49,G)),e.xp6(1),e.Oqu(e.lcZ(20,38,"PORT")),e.xp6(3),e.Oqu(e.lcZ(23,40,"ACTION")),e.xp6(3),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(10),e.Q6J("ngForOf",n.data)}}let Fn=(()=>{class o{constructor(t,n,i,s,r){this.translate=t,this.toastr=n,this.modalService=i,this.modbusTcpDevicesService=s,this.sharedService=r,this.id="my_plant_modbus_tcp_devices",this.loadingData=!0,this.dataTypes=h.DJ,this.byteOrders=h.tc,this.functions=h.wk,this.yesNo=h.ij}ngOnInit(){this.getData()}updateRegisters(t){const n=this.rows.findIndex(i=>t.object_id===i.object_id);this.rows[n].variables=[...t.registers]}getData(){this.loadingData=!0,this.modbusTcpDevicesService.getMeters().subscribe(t=>{this.rows=t.devices,this.rows.forEach(n=>n.expand=!1),this.existingDevices=t.devices.map(n=>({object_id:n.object_id||0,modbus_id:n.modbus_id||0,device_type:"",ip_address:n.ip_address,name:n.name||""})),this.tags=t.tags,this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(Dn),e.Y36(L.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-modbus-tcp-devices"]],hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:4,vars:5,consts:[[1,"section-header"],["type","ThirdPartyTCP",3,"existingDevices","callbackChange","lastDevice"],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"section-content"],[3,"initSort","data"],["table",""],[1,"table-show-changes",3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","50px",3,"nzLeft"],["nzWidth","150px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],["nzWidth","120px",3,"nzColumnKey","nzSortFn","nzSortDirections"],[3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","165px"],[1,"filters"],[3,"nzLeft"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],[4,"ngFor","ngForOf"],[3,"id","nzLeft","nzExpand","nzExpandChange"],[3,"id","status","object_id"],[1,"icons"],["type","ThirdPartyTCP",3,"device","existingDevices","id","callbackChange"],["type","ThirdPartyTCP",3,"objectId","id"],["type","ThirdPartyTCP",3,"objectId","name","id","callbackChange"],[3,"nzExpand"],[3,"nzData","nzScroll","nzFrontPagination","id"],["nzWidth","100px"],["nzWidth","80px"],["nzWidth","120px"],["colspan","12",1,"table-registers-button"],["type","ThirdPartyTCP",3,"existingDevices","id","device","tags"],["type","ThirdPartyTCP",3,"existingDevices","device","editVariableName","id","tags"],["type","ThirdPartyTCP",3,"device","removeVariableName","id","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-modbus-device-add",1),e.qZA(),e.YNc(2,Sn,1,0,"app-loader",2),e.YNc(3,Qn,37,50,"div",3)),2&t&&(e.xp6(1),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n))("lastDevice",n.rows&&n.rows[n.rows.length-1]),e.xp6(1),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[de,g.O5,D.R,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,l.p0,g.sg,l.h7,I,ne,ie,pe,l.d3,l.Vk,ue,me],pipes:[_.X$,P.h],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}"]}),o})();var Vn=d(3429);const Yn=["form"];function jn(o,a){1&o&&e._UZ(0,"app-loader")}const Bn=function(o){return{blink:o}};function Gn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",26),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).blinkSsd(s)}),e.TgZ(1,"td",27),e._UZ(2,"app-table-device-status",28),e._uU(3),e.qZA(),e.TgZ(4,"td",20),e.TgZ(5,"input",29),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit.name=i}),e.ALo(6,"translate"),e.qZA(),e.qZA(),e.TgZ(7,"td",30),e._UZ(8,"app-cmmioconf-remove",31),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(4),s=e.MAs(2),r=e.oxw();e.Q6J("ngClass",e.VKq(16,Bn,t.blink)),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.Oqu(t.modbus_id||"-"),e.xp6(2),e.MGl("id","ssd_name_input_",n,""),e.MGl("name","ssdName",n,""),e.s9C("nzTooltipTitle",null!=s.controls["ssdName"+n]&&s.controls["ssdName"+n].errors?e.lcZ(6,14,"VALIDATE_REQUIRED"):""),e.Q6J("ngModel",t.name),e.xp6(3),e.MGl("id","remove_device_button_",n,""),e.Q6J("object_id",t.object_id)("name",t.name)("callbackChange",r.getData.bind(r))}}const Hn=function(){return{key:"modbus_id",value:"ascend"}},Wn=function(o,a){return{x:o,y:a}},ge=function(){return["ascend","descend"]};function $n(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"form",7,8),e.TgZ(3,"app-table",9,10),e.TgZ(5,"nz-table",11,12),e.ALo(7,"translate"),e.TgZ(8,"thead",13),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(4).sort(i)}),e.TgZ(9,"tr"),e.TgZ(10,"th",14),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th",15),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th",16),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.qZA(),e.TgZ(19,"tr",17),e.TgZ(20,"th",18),e.TgZ(21,"input",19),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(22,"th",20),e.TgZ(23,"input",19),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"name","contains")}),e.qZA(),e.qZA(),e._UZ(24,"th"),e.qZA(),e.qZA(),e.TgZ(25,"tbody"),e.YNc(26,Gn,9,18,"tr",21),e.qZA(),e.qZA(),e.TgZ(27,"div",22),e._UZ(28,"app-led-off",23),e.TgZ(29,"div"),e.TgZ(30,"button",24),e.NdJ("click",function(){return e.CHM(t),e.oxw().getData()}),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"button",25),e.NdJ("appFormButtonClick",function(){e.CHM(t);const i=e.MAs(4);return e.oxw().saveSsd(i.tableData)}),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("appCanDeactivate",s.canDeactivate.bind(s)),e.xp6(2),e.Q6J("initSort",e.DdM(39,Hn))("data",s.rows),e.xp6(2),e.Q6J("nzData",n.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(40,Wn,n.tableWidth,n.tableHeight))("nzNoResult",e.lcZ(7,27,"NO_SSD")),e.xp6(5),e.Q6J("nzLeft",n.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(43,ge))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(12,29,"MODBUS_ID")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(44,ge)),e.xp6(1),e.Oqu(e.lcZ(15,31,"NAME")),e.xp6(3),e.Oqu(e.lcZ(18,33,"ACTION")),e.xp6(3),e.Q6J("nzLeft",n.allowNzLeft),e.xp6(6),e.Q6J("ngForOf",i.data),e.xp6(2),e.Q6J("ledoff_timeout",s.ledoff_timeout),e.xp6(2),e.Q6J("disabled",s.savingTable||!s.formChanged()),e.xp6(1),e.Oqu(e.lcZ(32,35,"DISCARD")),e.xp6(2),e.Q6J("nzLoading",s.savingTable)("disabled",s.savingTable||!s.formChanged())("form",t),e.xp6(1),e.Oqu(e.lcZ(35,37,"SAVE"))}}let Kn=(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.ssdService=i,this.sharedService=s,this.id="my_plant_modbus_ssd_devices",this.loadingData=!0,this.savingTable=!1,this.saving=!1}ngOnInit(){this.sharedService.stopBlinkAllLed().subscribe(),this.getData()}ngOnDestroy(){this.sharedService.stopBlinkAllLed().subscribe()}getData(){this.loadingData=!0,this.ssdService.getMeters().subscribe(t=>{this.existingDevices=t.devices.map(n=>({object_id:n.object_id||0,modbus_id:n.modbus_id||0,device_type:n.device_type,name:n.name||"",status:n.status})),this.rows=t.devices.filter(n=>"AuxiliaryContact"===n.device_type),this.ledoff_timeout=t.controlUnitConfiguration.ledoff_timeout,this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}canDeactivate(){return!this.form||!this.form.dirty}saveSsd(t){this.toastr.clear(),this.savingTable=!0,this.ssdService.setSsd(t).subscribe(()=>{this.savingTable=!1,this.form.form.markAsPristine(),this.toastr.success(this.translate.instant("SSD_SAVE_TABLE_SUCCESS")),t.forEach(i=>{const s=this.existingDevices.find(r=>r.object_id===i.object_id);s&&(s.name=i.name)})},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.savingTable=!1})}blinkSsd(t){!t.modbus_id||(t.blink=!0,setTimeout(()=>{t.blink=!1},1e3),this.sharedService.blinkLed(t.modbus_id).subscribe())}formChanged(){let t=!1;return this.rows&&this.form&&Object.keys(this.form.controls).forEach(n=>{"led_timeout"!==n&&this.form.controls[n].dirty&&(t=!0)}),t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(Vn.E),e.Y36(L.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-ssd"]],viewQuery:function(t,n){if(1&t&&e.Gf(Yn,5),2&t){let i;e.iGM(i=e.CRH())&&(n.form=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:7,vars:8,consts:[[1,"section-header"],["type","AuxiliaryContact",3,"existingDevices","callbackChange"],["type","AuxiliaryContact"],["type","AuxiliaryContact",3,"object_id","callbackChange"],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"section-content"],[2,"height","calc(100% - 85px)",3,"appCanDeactivate"],["form","ngForm"],[3,"initSort","data"],["table",""],["nzTableLayout","fixed",1,"table-show-changes",3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],["nzWidth","200px",3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","30px"],[1,"filters"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"table-buttons"],[3,"ledoff_timeout"],["type","button","nz-button","","id","table_discard_button",3,"disabled","click"],["type","button","nz-button","","id","table_save_button","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],[3,"ngClass","click"],[3,"nzLeft"],[3,"id","status","object_id"],["type","text","maxlength","255","nz-tooltip","","nzTooltipOverlayClassName","tooltip-error","required","",3,"id","name","ngModel","nzTooltipTitle","ngModelChange"],[1,"icons","remove"],["type","AuxiliaryContact",3,"object_id","name","id","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-cmmioconf-add",1),e._UZ(2,"app-cmmioconf-identify",2),e._UZ(3,"app-cmmioconf-change-modbus-id",1),e._UZ(4,"app-cmmioconf-remove",3),e.qZA(),e.YNc(5,jn,1,0,"app-loader",4),e.YNc(6,$n,36,45,"div",5)),2&t&&(e.xp6(1),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(2),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("object_id",0)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[k.Y,Q,F,V,g.O5,D.R,c._Y,c.JL,c.F,Y.z,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,l.p0,g.sg,g.mk,I,c.Fj,c.nD,C.SY,c.Q7,c.JJ,c.On,j,b.ix,f.dQ,T.w,S.b],pipes:[_.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}.remove[_ngcontent-%COMP%]{text-align:left!important}"]}),o})();var Xn=d(5963),ei=d(2529),ti=d(6129),ni=d(262),ii=d(515);let oi=(()=>{class o{constructor(t){this.http=t}getMeters(){return this.http.get("api/wireless-mbus")}clearDevices(){return this.http.post("api/wireless-mbus/modules/clear",{},{responseType:"text"})}saveDevice(t){return this.http.put("api/wireless-mbus/modules",{device:t},{responseType:"text"})}removeDevice(t){return this.http.post("api/wireless-mbus/modules/remove",{objectIds:t},{responseType:"text"})}addMeter(t){return this.http.post("api/wireless-mbus/meters",{device:t},{responseType:"text"})}saveMeter(t){return this.http.put("api/wireless-mbus/meters",{device:t},{responseType:"text"})}removeMeter(t){return this.http.post("api/wireless-mbus/meters/remove",{objectId:t},{responseType:"text"})}getScannedMeters(t){return this.http.get("api/wireless-mbus/modules/scanned-meters",{params:{objectId:t}})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(v.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var si=d(5115),ai=d(97),ri=d(3256),li=d(161),he=d(3868);const ci=["addDeviceTemplate"],di=["addMeterTemplate"];function _i(o,a){1&o&&e._UZ(0,"app-loader")}function pi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e._UZ(2,"app-table-device-status",25),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e.TgZ(11,"button",27),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw().$implicit;return e.oxw(2).addMeterDrawer(r.object_id,s)}),e.ALo(12,"translate"),e._UZ(13,"i",28),e.qZA(),e._UZ(14,"app-modbus-device-download-descriptor",35),e._UZ(15,"app-modbus-device-upload-descriptor",36),e.TgZ(16,"button",27),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(3).removeMeter(s)}),e.ALo(17,"translate"),e._UZ(18,"i",29),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index,i=e.oxw(),s=i.index,r=i.$implicit,p=e.oxw(2);e.xp6(2),e.hYB("id","device_status_",s,"_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.hij(" ",t.id," "),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.manufacturer),e.xp6(2),e.Oqu(t.key),e.xp6(2),e.hYB("id","edit_meter_button_",s,"_",n,""),e.s9C("nzTooltipTitle",e.lcZ(12,22,"EDIT")),e.xp6(3),e.hYB("id","download_descriptor_button_",s,"_",n,""),e.Q6J("objectId",t.object_id),e.xp6(1),e.hYB("id","upload_descriptor_button_",s,"_",n,""),e.Q6J("objectId",t.object_id)("name",r.name)("callbackChange",p.getData.bind(p)),e.xp6(1),e.hYB("id","remove_meter_button_",s,"_",n,""),e.s9C("nzTooltipTitle",e.lcZ(17,24,"REMOVE"))}}const ui=function(){return["0"]},mi=function(o){return{x:o}};function gi(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr"),e.TgZ(2,"td",24),e.NdJ("nzExpandChange",function(i){return e.CHM(t).$implicit.expand=i}),e.qZA(),e.TgZ(3,"td",17),e._UZ(4,"app-table-device-status",25),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.ALo(12,"valueFromId"),e.qZA(),e.TgZ(13,"td",26),e.TgZ(14,"button",27),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).addDeviceDrawer(s)}),e.ALo(15,"translate"),e._UZ(16,"i",28),e.qZA(),e.TgZ(17,"button",27),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).removeDevice(s)}),e.ALo(18,"translate"),e._UZ(19,"i",29),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"tr",30),e.TgZ(21,"nz-table",31),e.TgZ(22,"thead"),e.TgZ(23,"tr"),e.TgZ(24,"th"),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"th"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"th"),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"th"),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"th",15),e._uU(37),e.ALo(38,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(39,"tbody"),e.YNc(40,pi,19,26,"tr",23),e.TgZ(41,"tr"),e.TgZ(42,"td",32),e.TgZ(43,"button",33),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).addMeterDrawer(s.object_id)}),e._UZ(44,"i",34),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(2),s=e.oxw();e.xp6(2),e.MGl("id","expand_meters_button_",n,""),e.Q6J("nzLeft",i.allowNzLeft)("nzExpand",t.expand),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.hij(" ",t.modbus_id," "),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.mode),e.xp6(2),e.Oqu(e.Dn7(12,28,t.antenna,s.antennas,"text")),e.xp6(3),e.MGl("id","edit_device_button_",n,""),e.s9C("nzTooltipTitle",e.lcZ(15,32,"EDIT")),e.xp6(3),e.MGl("id","remove_device_button_",n,""),e.s9C("nzTooltipTitle",e.lcZ(18,34,"REMOVE")),e.xp6(3),e.Q6J("nzExpand",t.expand||!1),e.xp6(1),e.MGl("id","meter_table_",n,""),e.Q6J("nzData",e.DdM(48,ui))("nzScroll",e.VKq(49,mi,i.tableWidth))("nzFrontPagination",!1),e.xp6(4),e.Oqu(e.lcZ(26,36,"ID")),e.xp6(3),e.Oqu(e.lcZ(29,38,"NAME")),e.xp6(3),e.Oqu(e.lcZ(32,40,"MANUFACTURER")),e.xp6(3),e.Oqu(e.lcZ(35,42,"KEY")),e.xp6(3),e.Oqu(e.lcZ(38,44,"ACTION")),e.xp6(3),e.Q6J("ngForOf",t.meters),e.xp6(3),e.MGl("id","add_meter_button_",n,""),e.xp6(2),e.hij(" ",e.lcZ(46,46,"ADD_WIRELESS_MBUS_METER")," ")}}const hi=function(){return{key:"modbus_id",value:"ascend"}},vi=function(o,a){return{x:o,y:a}},H=function(){return["ascend","descend"]};function bi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"app-table",7,8),e.TgZ(3,"nz-table",9,10),e.ALo(5,"translate"),e.TgZ(6,"thead",11),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(2).sort(i)}),e.TgZ(7,"tr"),e._UZ(8,"th",12),e.TgZ(9,"th",13),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"th",14),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th",14),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"th",14),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th",15),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.qZA(),e.TgZ(24,"tr",16),e._UZ(25,"th",17),e.TgZ(26,"th",18),e.TgZ(27,"input",19),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(28,"th",20),e.TgZ(29,"input",19),e.NdJ("input",function(i){return e.CHM(t),e.MAs(2).filter(i,"name","contains")}),e.qZA(),e.qZA(),e.TgZ(30,"th"),e.TgZ(31,"app-select",21),e.NdJ("modelChange",function(i){return e.CHM(t),e.MAs(2).filtersModel.mode=i})("callbackChange",function(){e.CHM(t);const i=e.MAs(2);return i.filter(i.filtersModel.mode,"mode","equals")}),e.qZA(),e.qZA(),e.TgZ(32,"th"),e.TgZ(33,"app-select",22),e.NdJ("modelChange",function(i){return e.CHM(t),e.MAs(2).filtersModel.antenna=i})("callbackChange",function(){e.CHM(t);const i=e.MAs(2);return i.filter(i.filtersModel.antenna,"antenna","equals")}),e.qZA(),e.qZA(),e._UZ(34,"th"),e.qZA(),e.qZA(),e.TgZ(35,"tbody"),e.YNc(36,gi,47,51,"ng-container",23),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.oxw();e.xp6(1),e.Q6J("initSort",e.DdM(49,hi))("data",i.rows),e.xp6(2),e.Q6J("nzData",t.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(50,vi,t.tableWidth,t.tableHeight))("nzNoResult",e.lcZ(5,37,"NO_WIRELESS_MBUS_MODULES")),e.xp6(5),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(53,H))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(11,39,"MODBUS_ID")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(54,H)),e.xp6(1),e.Oqu(e.lcZ(14,41,"NAME")),e.xp6(2),e.Q6J("nzColumnKey","mode")("nzSortFn",!0)("nzSortDirections",e.DdM(55,H)),e.xp6(1),e.Oqu(e.lcZ(17,43,"MODE")),e.xp6(2),e.Q6J("nzColumnKey","antenna")("nzSortFn",!0)("nzSortDirections",e.DdM(56,H)),e.xp6(1),e.Oqu(e.lcZ(20,45,"ANTENNA")),e.xp6(3),e.Oqu(e.lcZ(23,47,"ACTION")),e.xp6(3),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(1),e.Q6J("nzLeft",t.allowNzLeft),e.xp6(5),e.Q6J("options",i.modes)("showSearch",!1)("clearable",!0)("model",t.filtersModel.mode),e.xp6(2),e.Q6J("options",i.antennas)("showSearch",!1)("clearable",!0)("model",t.filtersModel.antenna),e.xp6(3),e.Q6J("ngForOf",n.data)}}const ae=function(){return{required:!0}};function fi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeDeviceDrawer()}),e._UZ(1,"i",29),e.qZA(),e.TgZ(2,"div",38),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",39),e.TgZ(6,"form",null,40),e.TgZ(8,"div",41),e.TgZ(9,"label",42),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"app-validate",43),e.TgZ(13,"nz-input-number",44,45),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editDevice.modbus_id=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"div",41),e.TgZ(16,"label",42),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"app-validate",43),e.TgZ(20,"input",46,47),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().editDevice.name=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",41),e.TgZ(23,"label",42),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"app-select",48),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editDevice.mode=i}),e.qZA(),e.qZA(),e.TgZ(27,"div",41),e.TgZ(28,"label",42),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"app-select",49),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw().editDevice.antenna=i}),e.qZA(),e.qZA(),e.TgZ(32,"div",41),e._UZ(33,"label"),e.TgZ(34,"button",50),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeDeviceDrawer()}),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"button",51),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw().saveDevice()}),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(7),n=e.MAs(14),i=e.MAs(21),s=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,24,"EDIT_WIRELESS_MBUS_MODULE")," "),e.xp6(7),e.Oqu(e.lcZ(11,26,"MODBUS_ID")),e.xp6(2),e.Q6J("field",n),e.xp6(1),e.Q6J("ngModel",s.editDevice.modbus_id)("id","modbus_id_input_wrapper")("nzDisabled",!0),e.xp6(4),e.Oqu(e.lcZ(18,28,"NAME")),e.xp6(2),e.Q6J("field",i),e.xp6(1),e.Q6J("ngModel",s.editDevice.name),e.xp6(4),e.Oqu(e.lcZ(25,30,"MODE")),e.xp6(2),e.Q6J("model",s.editDevice.mode)("options",s.modes)("validators",e.DdM(38,ae)),e.xp6(3),e.Oqu(e.lcZ(30,32,"ANTENNA")),e.xp6(2),e.Q6J("model",s.editDevice.antenna)("options",s.antennas)("validators",e.DdM(39,ae)),e.xp6(3),e.uIk("id","drawer_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(36,34,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",s.saving)("disabled",s.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(39,36,"SAVE_WIRELESS_MBUS_MODULE"))}}function Ti(o,a){1&o&&e._UZ(0,"app-loader")}function Ci(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",41),e.TgZ(1,"label",42),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-select",59),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(3).editMeter.id=i})("callbackChange",function(){return e.CHM(t),e.oxw(3).detectedMeterChange()}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,4,"DETECTED_METER")),e.xp6(2),e.Q6J("model",t.editMeter.id)("options",t.detectedMetersSelect)("validators",e.DdM(6,ae))}}function Mi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",41),e.TgZ(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"nz-radio-group",60),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(3).editMeter.predefined=i}),e.TgZ(5,"label",61),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"label",62),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,6,"USE_PREDEFINED_DESCRIPTOR")),e.xp6(2),e.Q6J("ngModel",t.editMeter.predefined),e.xp6(1),e.Q6J("nzValue",!0),e.xp6(1),e.Oqu(e.lcZ(7,8,"YES")),e.xp6(2),e.Q6J("nzValue",!1),e.xp6(1),e.Oqu(e.lcZ(10,10,"NO"))}}function Zi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",41),e.TgZ(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"app-file-upload",63),e.NdJ("fileChange",function(i){return e.CHM(t),e.oxw(3).file=i})("callbackChange",function(){return e.CHM(t),e.oxw(3).hideToast()}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,3,"SELECT_DESCRIPTOR_FILE")),e.xp6(2),e.Q6J("smallUploader",!0)("file",t.file)}}function xi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"form",null,40),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.YNc(5,Ci,5,7,"div",53),e.TgZ(6,"div",41),e.TgZ(7,"label"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"input",54),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editMeter.id=i}),e.qZA(),e.qZA(),e.TgZ(11,"div",41),e.TgZ(12,"label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"input",55),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editMeter.manufacturer=i}),e.qZA(),e.qZA(),e.TgZ(16,"div",41),e.TgZ(17,"label",42),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"app-validate",43),e.TgZ(21,"input",46,47),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editMeter.name=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(23,"div",41),e.TgZ(24,"label"),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"app-select",56),e.NdJ("modelChange",function(i){return e.CHM(t),e.oxw(2).editMeter.device_category=i}),e.qZA(),e.qZA(),e.TgZ(28,"div",41),e.TgZ(29,"label",42),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"app-validate",43),e.TgZ(33,"input",57,58),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).editMeter.key=i}),e.qZA(),e.qZA(),e.qZA(),e.YNc(35,Mi,11,12,"div",53),e.YNc(36,Zi,5,5,"div",53),e.TgZ(37,"div",41),e._UZ(38,"label"),e.TgZ(39,"button",50),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).closeMeterDrawer(!0)}),e._uU(40),e.ALo(41,"translate"),e.qZA(),e.TgZ(42,"button",51),e.NdJ("appFormButtonClick",function(){return e.CHM(t),e.oxw(2).saveMeter()}),e._uU(43),e.ALo(44,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(1),n=e.MAs(22),i=e.MAs(34),s=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,28,"WIRELESS_MBUS_METERS_APPEAR")),e.xp6(2),e.Q6J("ngIf",!s.editMeter.object_id),e.xp6(3),e.Oqu(e.lcZ(9,30,"ID")),e.xp6(2),e.Q6J("ngModel",s.editMeter.id),e.uIk("readonly",!0),e.xp6(3),e.Oqu(e.lcZ(14,32,"MANUFACTURER")),e.xp6(2),e.Q6J("ngModel",s.editMeter.manufacturer),e.uIk("readonly",!0),e.xp6(3),e.Oqu(e.lcZ(19,34,"NAME")),e.xp6(2),e.Q6J("field",n),e.xp6(1),e.Q6J("ngModel",s.editMeter.name),e.xp6(4),e.Oqu(e.lcZ(26,36,"DEVICE_CATEGORY")),e.xp6(2),e.Q6J("model",s.editMeter.device_category)("options",s.deviceCategories)("clearable",!0),e.xp6(3),e.Oqu(e.lcZ(31,38,"KEY")),e.xp6(2),e.Q6J("field",i),e.xp6(1),e.Q6J("ngModel",s.editMeter.key)("validLength",32),e.xp6(2),e.Q6J("ngIf",!s.editMeter.object_id),e.xp6(1),e.Q6J("ngIf",!s.editMeter.object_id&&!s.editMeter.predefined),e.xp6(3),e.uIk("id","drawer_cancel_button"),e.xp6(1),e.Oqu(e.lcZ(41,40,"CANCEL")),e.xp6(2),e.Q6J("nzLoading",s.saving)("disabled",s.saving)("form",t),e.uIk("id","modal_ok_button"),e.xp6(1),e.Oqu(e.lcZ(44,42,s.editMeter.object_id?"SAVE_WIRELESS_MBUS_METER":"ADD_WIRELESS_MBUS_METER"))}}function Ai(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",52),e.NdJ("click",function(){return e.CHM(t),e.oxw().closeMeterDrawer()}),e._UZ(1,"i",29),e.qZA(),e.TgZ(2,"div",38),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",39),e.YNc(6,Ti,1,0,"app-loader",2),e.YNc(7,xi,45,44,"form",2),e.qZA()}if(2&o){const t=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,3,t.editMeter.object_id?"EDIT_WIRELESS_MBUS_METER":"ADD_NEW_WIRELESS_MBUS_METER")," "),e.xp6(3),e.Q6J("ngIf",t.loadingMeters),e.xp6(1),e.Q6J("ngIf",!t.loadingMeters)}}let Di=(()=>{class o{constructor(t,n,i,s,r,p,E){this.translate=t,this.toastr=n,this.modalService=i,this.wirelessMbusService=s,this.drawerService=r,this.sessionService=p,this.settingsGeneralSystemService=E,this.id="my_plant_wireless_mbus_meters",this.loadingData=!0,this.modes=h.Sw,this.antennas=h.KS,this.saving=!1,this.editModeDevice=!1,this.editModeMeter=!1,this.loadingMeters=!1,this.deviceCategories=[{id:0,name:"main-meter"},{id:1,name:"sub-meter"},{id:2,name:"inverter"},{id:3,name:"battery"},{id:4,name:"heatpump"},{id:5,name:"evcharger"},{id:6,name:"water-meter"},{id:7,name:"gas-meter"}],this.aliveRestart=!0}ngOnInit(){this.getData()}getData(){this.loadingData=!0,this.wirelessMbusService.getMeters().subscribe(t=>{this.rows=t.devices,this.rows.forEach(n=>n.expand=!1),this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}addDeviceDrawer(t){this.toastr.clear(),this.editDevice=Object.assign({},t),this.drawerService.showDrawer(this.addDeviceTemplate).subscribe()}saveDevice(){this.saving=!0,this.wirelessMbusService.saveDevice(this.editDevice).subscribe(()=>{this.drawerService.hide(),this.getData(),this.toastr.success(this.translate.instant("WIRELESS_MBUS_MODULE_EDIT_SUCCESS",{name:"<strong>"+this.editDevice.name+"</strong>"})),this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1,this.drawerService.hide()})}clearDevices(){this.toastr.clear(),this.modalService.showConfirm(this.translate.instant("WIRELESS_MBUS_MODULE_CLEAR"),()=>{this.modalService.setLoading(!0),this.wirelessMbusService.clearDevices().subscribe(()=>{this.toastr.success(this.translate.instant("WIRELESS_MBUS_MODULE_CLEAR_SUCCESS"),!0),this.modalService.setLoading(!1),this.modalService.showConfirm(this.translate.instant("WIRELESS_MBUS_MODULE_CLEAR_RESTART"),()=>{this.toastr.clear(),this.modalService.setLoading(!0),this.sessionService.removeSessionExpiration(),this.modalService.showLoader(this.translate.instant("SYSTEM_RESET_PREP")),this.restart()},()=>{this.modalService.hide(),this.getData()})},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})})}removeDevice(t){this.toastr.clear(),this.modalService.showConfirm(this.translate.instant("WIRELESS_MBUS_MODULE_REMOVE",{name:"<strong>"+t.name+"</strong>"}),()=>{this.modalService.setLoading(!0),this.wirelessMbusService.removeDevice([t.object_id,...(t.meters||[]).map(n=>n.object_id)]).subscribe(()=>{this.toastr.success(this.translate.instant("WIRELESS_MBUS_MODULE_REMOVE_SUCCESS",{name:"<strong>"+t.name+"</strong>"})),this.modalService.hide(),this.getData()},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})})}closeDeviceDrawer(){this.drawerService.hide()}addMeterDrawer(t,n){this.toastr.clear(),this.editMeter=this.editModeMeter&&!n?this.tempMeter:n?Object.assign({},n):{predefined:!0},this.editMeter.module_id=t,n||(this.loadingMeters=!0,this.wirelessMbusService.getScannedMeters(t).subscribe(i=>{this.detectedMeters=i,this.detectedMetersSelect=i.map(s=>({id:s.id,name:s.type})),this.loadingMeters=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})),this.drawerService.showDrawer(this.addMeterTemplate).subscribe(i=>{this.editModeMeter=!!this.tempMeter}),this.tempMeter=this.editMeter}saveMeter(){if(this.editMeter.predefined||this.editMeter.object_id)this.saveMeterRequest();else{if(!this.file)return void this.toastr.warning(this.translate.instant("WIRELESS_MBUS_UPDATE_SELECT_FILE"));const t=new FileReader;t.onload=()=>{this.editMeter.descriptor=t.result;try{this.editMeter.descriptor=JSON.parse(this.editMeter.descriptor)}catch(n){return this.toastr.warning(this.translate.instant("NOT_VALID_JSON")),void(this.saving=!1)}this.saveMeterRequest()},t.onerror=()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))},t.readAsText(this.file)}}saveMeterRequest(){let t,n;this.saving=!0,this.editMeter.object_id?(n="WIRELESS_MBUS_METER_EDIT_SUCCESS",t=this.wirelessMbusService.saveMeter(this.editMeter)):(n="WIRELESS_MBUS_METER_ADD_SUCCESS",t=this.wirelessMbusService.addMeter(this.editMeter)),t.subscribe(()=>{this.drawerService.hide(),this.tempMeter=null,this.getData(),this.toastr.success(this.translate.instant(n,{name:"<strong>"+this.editMeter.name+"</strong>"})),this.saving=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.saving=!1,this.drawerService.hide(),this.tempMeter=null})}removeMeter(t){this.toastr.clear(),this.modalService.showConfirm(this.translate.instant("WIRELESS_MBUS_METER_REMOVE",{name:"<strong>"+t.name+"</strong>"}),()=>{this.modalService.setLoading(!0),this.wirelessMbusService.removeMeter(t.object_id).subscribe(()=>{this.toastr.success(this.translate.instant("WIRELESS_MBUS_METER_REMOVE_SUCCESS",{name:"<strong>"+t.name+"</strong>"})),this.modalService.hide(),this.getData()},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})},()=>this.modalService.hide(),this.translate.instant("DEVICE_REMOVE_WARNING"))}closeMeterDrawer(t){this.drawerService.hide(),t&&(this.tempMeter=null)}detectedMeterChange(){const t=this.detectedMeters.find(n=>n.id===this.editMeter.id);t&&(this.editMeter.manufacturer=t.manufacturer,this.editMeter.name=`${t.type} ${t.id}`)}hideToast(){this.toastr.clear()}restart(){this.aliveRestart=!0,this.settingsGeneralSystemService.restart().subscribe(()=>{(0,Xn.H)(25e3,5e3).pipe((0,ei.o)(()=>this.aliveRestart),(0,ti.z)(()=>this.settingsGeneralSystemService.serverStatus().pipe((0,ni.K)(()=>ii.E)))).subscribe(()=>{this.aliveRestart=!1,this.modalService.showInfo(this.translate.instant("FIRMWARE_UPDATE_OK"),()=>{this.modalService.hide(),this.getData()})})})}ngOnDestroy(){this.aliveRestart=!1}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(m.Z),e.Y36(oi),e.Y36(A.z),e.Y36(si.m),e.Y36(ai.p))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-wireless-mbus-meters"]],viewQuery:function(t,n){if(1&t&&(e.Gf(ci,5),e.Gf(di,5)),2&t){let i;e.iGM(i=e.CRH())&&(n.addDeviceTemplate=i.first),e.iGM(i=e.CRH())&&(n.addMeterTemplate=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:10,vars:5,consts:[[1,"section-header"],["type","button","nzType","primary","nz-button","","id","clear_device_button",3,"click"],[4,"ngIf"],["class","section-content",4,"ngIf"],["addDeviceTemplate",""],["addMeterTemplate",""],[1,"section-content"],[3,"initSort","data"],["table",""],[3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","50px",3,"nzLeft"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],[3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","165px"],[1,"filters"],[3,"nzLeft"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],["inputId","modes_filter","inputClass","no-validate",3,"options","showSearch","clearable","model","modelChange","callbackChange"],["inputId","antenna_filter","inputClass","no-validate",3,"options","showSearch","clearable","model","modelChange","callbackChange"],[4,"ngFor","ngForOf"],[3,"id","nzLeft","nzExpand","nzExpandChange"],[3,"id","status","object_id"],[1,"icons"],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_edit_16"],[1,"icon_abb_16","icon-abb_close_16"],[3,"nzExpand"],[3,"nzData","nzScroll","nzFrontPagination","id"],["colspan","5",1,"table-registers-button"],["type","button","nzType","primary","nz-button","",3,"id","click"],[1,"icon_abb_16","icon-abb_plus_16"],["type","MeterWMbus",3,"objectId","id"],["type","MeterWMbus",3,"objectId","name","id","callbackChange"],["tabIndex","-1","nz-button","","id","close_device_button",1,"drawer-button-close",3,"click"],[1,"drawer-title","text-line"],[1,"drawer-body"],["formAdd","ngForm"],[1,"form-group"],[1,"label-required"],[3,"field"],["nzId","modbus_id_input","name","modbusIdInput",3,"ngModel","id","nzDisabled","ngModelChange"],["modbusIdInput","ngModel"],["type","text","maxlength","255","id","name_input","name","name","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","ngModel"],["inputId","mode_select",3,"model","options","validators","modelChange"],["inputId","antenna_select",3,"model","options","validators","modelChange"],["type","button","nz-button","",3,"click"],["type","submit","nz-button","","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],["tabIndex","-1","nz-button","","id","close_meter_button",1,"drawer-button-close",3,"click"],["class","form-group",4,"ngIf"],["type","text","id","id_input","name","idInput",1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],["type","text","id","manufacturer_input","name","manufacturerInput",1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],["inputId","device_category_select",3,"model","options","clearable","modelChange"],["type","text","maxlength","32","id","key_input","name","key","appValidateHex","","appValidateEqualLength","","required","",1,"form-control",3,"ngModel","validLength","ngModelChange"],["key","ngModel"],["inputId","detected_meter_select",3,"model","options","validators","modelChange","callbackChange"],["name","predefinedSelect",3,"ngModel","ngModelChange"],["nz-radio","","id","predefined_radio_no",3,"nzValue"],["nz-radio","","id","predefined_radio_yes",3,"nzValue"],["inputId","selected_file","accept",".json",3,"smallUploader","file","fileChange","callbackChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return n.clearDevices()}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.qZA(),e.YNc(4,_i,1,0,"app-loader",2),e.YNc(5,bi,37,57,"div",3),e.YNc(6,fi,40,40,"ng-template",null,4,e.W1O),e.YNc(8,Ai,8,5,"ng-template",null,5,e.W1O)),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,3,"CLEAR_MODBUS_IDS")," "),e.xp6(2),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[b.ix,f.dQ,T.w,g.O5,D.R,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,q.H,l.p0,g.sg,l.h7,I,C.SY,l.d3,l.Vk,ne,ie,c._Y,c.JL,c.F,O.P,w._,c.JJ,c.On,c.Fj,c.nD,c.Q7,S.b,ri.v,li.a,he.Dg,he.Of,_e.Y],pipes:[_.X$,P.h],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}"]}),o})();var y=d(7618),Si=d(8410),yi=d(6462);const Ei=["form"];function Ri(o,a){1&o&&e._UZ(0,"app-loader")}function zi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"nz-switch",35,36),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().$implicit.enableRemoteInputCommands=i})("click",function(){e.CHM(t);const i=e.oxw(),s=i.$implicit,r=i.index;return e.oxw(2).toggleStatus(s,"enableRemoteInputCommands",r)}),e.qZA(),e._uU(3),e.ALo(4,"valueFromId"),e.qZA()}if(2&o){const t=e.oxw(),n=t.index,i=t.$implicit,s=e.oxw(2);e.xp6(1),e.MGl("id","mod_enable_remote_input_commands_",n,""),e.MGl("name","enableRemoteInputCommands_",n,""),e.Q6J("nzDisabled",-1===i.status)("nzControl",!0)("ngModel",i.enableRemoteInputCommands),e.xp6(2),e.hij(" ",e.Dn7(4,6,i.enableRemoteInputCommands,s.enableDisable,"text")," ")}}function Ii(o,a){1&o&&(e.TgZ(0,"div",37),e._uU(1,"-"),e.qZA())}function qi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"nz-switch",35,38),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().$implicit.enableCommunicationCommands=i})("click",function(){e.CHM(t);const i=e.oxw(),s=i.$implicit,r=i.index;return e.oxw(2).toggleStatus(s,"enableCommunicationCommands",r)}),e.qZA(),e._uU(3),e.ALo(4,"valueFromId"),e.qZA()}if(2&o){const t=e.oxw(),n=t.index,i=t.$implicit,s=e.oxw(2);e.xp6(1),e.MGl("id","mod_enable_communication_commands_",n,""),e.MGl("name","enableCommunicationCommands_",n,""),e.Q6J("nzDisabled",-1===i.status)("nzControl",!0)("ngModel",i.enableCommunicationCommands),e.xp6(2),e.hij(" ",e.Dn7(4,6,i.enableCommunicationCommands,s.enableDisable,"text")," ")}}function Ui(o,a){1&o&&(e.TgZ(0,"div",37),e._uU(1,"-"),e.qZA())}const Oi=function(o){return{blink:o}};function Li(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",28),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).blinkMod(s)}),e.TgZ(1,"td",29),e._UZ(2,"app-table-device-status",30),e._uU(3),e.qZA(),e.TgZ(4,"td",22),e.TgZ(5,"input",31),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit.name=i}),e.ALo(6,"translate"),e.qZA(),e.qZA(),e.TgZ(7,"td"),e.YNc(8,zi,5,10,"div",4),e.YNc(9,Ii,2,0,"div",32),e.qZA(),e.TgZ(10,"td"),e.YNc(11,qi,5,10,"div",4),e.YNc(12,Ui,2,0,"div",32),e.qZA(),e.TgZ(13,"td"),e.TgZ(14,"div"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.qZA(),e.TgZ(17,"td"),e.TgZ(18,"div"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.qZA(),e.TgZ(21,"td"),e.TgZ(22,"div"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.qZA(),e.TgZ(25,"td",33),e._UZ(26,"app-cmmioconf-remove",34),e.qZA(),e.qZA()}if(2&o){const t=a.$implicit,n=a.index;e.oxw();const i=e.MAs(4),s=e.MAs(2),r=e.oxw();e.Q6J("ngClass",e.VKq(29,Oi,t.blink)),e.xp6(1),e.Q6J("nzLeft",i.allowNzLeft),e.xp6(1),e.MGl("id","device_status_",n,""),e.Q6J("status",t.status)("object_id",t.object_id),e.xp6(1),e.Oqu(t.modbus_id||"-"),e.xp6(2),e.MGl("id","mod_name_input_",n,""),e.MGl("name","modName",n,""),e.s9C("nzTooltipTitle",null!=s.controls["modName"+n]&&s.controls["modName"+n].errors?e.lcZ(6,21,"VALIDATE_REQUIRED"):""),e.Q6J("ngModel",t.name),e.xp6(3),e.Q6J("ngIf",t.modbus_id),e.xp6(1),e.Q6J("ngIf",!t.modbus_id),e.xp6(2),e.Q6J("ngIf",t.modbus_id),e.xp6(1),e.Q6J("ngIf",!t.modbus_id),e.xp6(3),e.Oqu(e.lcZ(16,23,"NOT_SUPPORTED")),e.xp6(4),e.Oqu(e.lcZ(20,25,"NOT_SUPPORTED")),e.xp6(4),e.Oqu(e.lcZ(24,27,"NOT_SUPPORTED")),e.xp6(3),e.MGl("id","remove_device_button_",n,""),e.Q6J("object_id",t.object_id)("name",t.name)("callbackChange",r.getData.bind(r))}}const wi=function(){return{key:"modbus_id",value:"ascend"}},Ni=function(o,a){return{x:o,y:a}},U=function(){return["ascend","descend"]};function Pi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"form",7,8),e.TgZ(3,"app-table",9,10),e.TgZ(5,"nz-table",11,12),e.ALo(7,"translate"),e.TgZ(8,"thead",13),e.NdJ("nzSortOrderChange",function(i){return e.CHM(t),e.MAs(4).sort(i)}),e.TgZ(9,"tr"),e.TgZ(10,"th",14),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th",15),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th",16),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th",16),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"th",17),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"th",17),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"th",17),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"th",18),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.qZA(),e.TgZ(34,"tr",19),e.TgZ(35,"th",20),e.TgZ(36,"input",21),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"modbus_id","contains")}),e.qZA(),e.qZA(),e.TgZ(37,"th",22),e.TgZ(38,"input",21),e.NdJ("input",function(i){return e.CHM(t),e.MAs(4).filter(i,"name","contains")}),e.qZA(),e.qZA(),e._UZ(39,"th"),e._UZ(40,"th"),e._UZ(41,"th"),e._UZ(42,"th"),e._UZ(43,"th"),e._UZ(44,"th"),e.qZA(),e.qZA(),e.TgZ(45,"tbody"),e.YNc(46,Li,27,31,"tr",23),e.qZA(),e.qZA(),e.TgZ(47,"div",24),e._UZ(48,"app-led-off",25),e.TgZ(49,"div"),e.TgZ(50,"button",26),e.NdJ("click",function(){return e.CHM(t),e.oxw().getData()}),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.TgZ(53,"button",27),e.NdJ("appFormButtonClick",function(){e.CHM(t);const i=e.MAs(4);return e.oxw().saveMod(i.tableData)}),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(2),n=e.MAs(4),i=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("appCanDeactivate",s.canDeactivate.bind(s)),e.xp6(2),e.Q6J("initSort",e.DdM(67,wi))("data",s.rows),e.xp6(2),e.Q6J("nzData",n.tableData)("nzFrontPagination",!1)("nzScroll",e.WLB(68,Ni,n.tableWidth,n.tableHeight))("nzNoResult",e.lcZ(7,45,"NO_MOD")),e.xp6(5),e.Q6J("nzLeft",n.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",e.DdM(71,U))("nzSortOrder","ascend"),e.xp6(1),e.Oqu(e.lcZ(12,47,"MODBUS_ID")),e.xp6(2),e.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",e.DdM(72,U)),e.xp6(1),e.Oqu(e.lcZ(15,49,"NAME")),e.xp6(2),e.Q6J("nzColumnKey","remote_input")("nzSortDirections",e.DdM(73,U)),e.xp6(1),e.Oqu(e.lcZ(18,51,"REMOTE_INPUT")),e.xp6(2),e.Q6J("nzColumnKey","enable_communication")("nzSortDirections",e.DdM(74,U)),e.xp6(1),e.Oqu(e.lcZ(21,53,"REMOTE_OUTPUT")),e.xp6(2),e.Q6J("nzColumnKey","reclosing_attempts")("nzSortFn",!1)("nzSortDirections",e.DdM(75,U)),e.xp6(1),e.Oqu(e.lcZ(24,55,"RECLOSING_ATTEMPTS")),e.xp6(2),e.Q6J("nzColumnKey","reclosing_delay")("nzSortFn",!1)("nzSortDirections",e.DdM(76,U)),e.xp6(1),e.Oqu(e.lcZ(27,57,"RECLOSING_DELAY")),e.xp6(2),e.Q6J("nzColumnKey","neutralization_time")("nzSortFn",!1)("nzSortDirections",e.DdM(77,U)),e.xp6(1),e.Oqu(e.lcZ(30,59,"NEUTRALIZATION_TIME")),e.xp6(3),e.Oqu(e.lcZ(33,61,"ACTION")),e.xp6(3),e.Q6J("nzLeft",n.allowNzLeft),e.xp6(11),e.Q6J("ngForOf",i.data),e.xp6(2),e.Q6J("ledoff_timeout",s.ledoff_timeout),e.xp6(2),e.Q6J("disabled",s.savingTable||!s.formChanged()),e.xp6(1),e.Oqu(e.lcZ(52,63,"DISCARD")),e.xp6(2),e.Q6J("nzLoading",s.savingTable)("disabled",s.savingTable||!s.formChanged())("form",t),e.xp6(1),e.Oqu(e.lcZ(55,65,"SAVE"))}}const ki=[{path:"",redirectTo:"devices"},{path:"devices",redirectTo:"devices/current-sensors"},{path:"groups",component:De,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"GROUPS",icon:"icon_abb_24 icon-abb_devices_24"}},{path:"devices",component:Ue,children:[{path:"current-sensors",component:lt,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"CURRENT_SENSORS"}},{path:"io-modules",component:Zt,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"IO_MODULES"}},{path:"modbus-rtu-devices",component:An,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"MODBUS_RTU_DEVICES"}},{path:"modbus-tcp-devices",component:Fn,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"MODBUS_TCP_DEVICES"}},{path:"ssd",component:Kn,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"SSD"}},{path:"wireless-mbus",component:Di,canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"WIRELESS_MBUS_METERS"}},{path:"mod",component:(()=>{class o{constructor(t,n,i,s){this.translate=t,this.toastr=n,this.modService=i,this.sharedService=s,this.id="my_plant_mod",this.loadingData=!0,this.savingTable=!1,this.saving=!1,this.reclosingAttempts=[{id:1,name:"1"},{id:2,name:"2"},{id:3,name:"3"},{id:4,name:"4"},{id:5,name:"5"},{id:6,name:"6"},{id:7,name:"7"},{id:8,name:"8"},{id:9,name:"9"},{id:10,name:"10"}]}ngOnInit(){this.sharedService.stopBlinkAllLed().subscribe(),this.getData(),this.enableDisable=[{id:0,text:"DISABLED"},{id:"-",text:"DISABLED"},{id:1,text:"ENABLED"}]}ngOnDestroy(){this.sharedService.stopBlinkAllLed().subscribe()}toggleStatus(t,n,i){if(-1===t.status)return;this.form.controls[`${n}_${i}`]&&this.form.controls[`${n}_${i}`].markAsDirty();const s=[...this.rows],r=this.rows.findIndex(p=>p.modbus_id===t.modbus_id);s[r][n]=s[r][n]=Number(!s[r][n]),t[n]=Number(!t[n])}getData(){this.loadingData=!0,this.modService.getDevices().subscribe(t=>{this.existingDevices=t.devices.map(n=>({object_id:n.object_id||0,modbus_id:n.modbus_id||0,device_type:n.device_type,name:n.name||"",status:n.status,enableRemoteInputCommands:n.enableRemoteInputCommands,enableCommunicationCommands:n.enableCommunicationCommands,delayBetweenReclosing:n.delayBetweenReclosing,neutralizationTime:n.neutralizationTime})),this.rows=t.devices.filter(n=>"ModAriArh"===n.device_type),this.ledoff_timeout=t.controlUnitConfiguration.ledoff_timeout,this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}canDeactivate(){return!this.form||!this.form.dirty}statusConverter(t){return 65280===t}changePort(t){t.forEach(n=>{Object.keys(n).forEach(i=>{["enableCommunicationCommands","enableRemoteInputCommands"].includes(i)&&n.modbus_id&&this.modService.changeStatus({modbus_id:n.modbus_id,address:this.getPortAddress(i),status:this.getStatus(n[i],i)}).subscribe()})})}getStatus(t,n){let i;switch(n){case"enableCommunicationCommands":case"enableRemoteInputCommands":i=0===t?65535:65280;break;case"reclosingAttempts":i=t}return i}getPortAddress(t){let n;switch(t){case"enableRemoteInputCommands":n=32770;break;case"enableCommunicationCommands":n=32771;break;case"reclosingAttempts":n=32772;break;case"delayBetweenReclosing":n=32773;break;case"neutralizationTime":n=32774}return n}saveMod(t){this.toastr.clear(),this.savingTable=!0;const n=t;this.changePort(t),this.modService.setMod(n).subscribe(()=>{this.savingTable=!1,this.form.form.markAsPristine(),this.toastr.success(this.translate.instant("MOD_SAVE_TABLE_SUCCESS")),t.forEach(i=>{const s=this.existingDevices.find(r=>r.object_id===i.object_id);s&&(s.name=i.name)})},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.savingTable=!1})}blinkMod(t){!t.modbus_id||(t.blink=!0,setTimeout(()=>{t.blink=!1},1e3),this.sharedService.blinkLed(t.modbus_id).subscribe())}formChanged(){let t=!1;return this.rows&&this.form&&Object.keys(this.form.controls).forEach(n=>{"led_timeout"!==n&&this.form.controls[n].dirty&&(t=!0)}),t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.sK),e.Y36(u._),e.Y36(Si.A),e.Y36(L.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-my-plant-mod"]],viewQuery:function(t,n){if(1&t&&e.Gf(Ei,5),2&t){let i;e.iGM(i=e.CRH())&&(n.form=i.first)}},hostVars:1,hostBindings:function(t,n){2&t&&e.uIk("id",n.id)},decls:7,vars:8,consts:[[1,"section-header"],["type","ModAriArh",3,"existingDevices","callbackChange"],["type","ModAriArh"],["type","ModAriArh",3,"object_id","callbackChange"],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"section-content"],[2,"height","calc(100% - 85px)",3,"appCanDeactivate"],["form","ngForm"],[3,"initSort","data"],["table",""],["nzTableLayout","fixed",1,"table-show-changes",3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],["nzWidth","150px",3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","120px",3,"nzColumnKey","nzSortDirections"],["nzWidth","120px",3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","80px"],[1,"filters"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"table-buttons"],[3,"ledoff_timeout"],["type","button","nz-button","","id","table_discard_button",3,"disabled","click"],["type","button","nz-button","","id","table_save_button","nzType","primary",3,"nzLoading","disabled","form","appFormButtonClick"],[3,"ngClass","click"],[3,"nzLeft"],[3,"id","status","object_id"],["maxlength","255","type","text","nz-tooltip","","nzTooltipOverlayClassName","tooltip-error","required","",3,"id","name","ngModel","nzTooltipTitle","ngModelChange"],["class","center",4,"ngIf"],[1,"icons","remove"],["type","ModAriArh",3,"object_id","name","id","callbackChange"],["nzSize","small",3,"nzDisabled","id","name","nzControl","ngModel","ngModelChange","click"],["enableRemoteInputCommands","ngModel"],[1,"center"],["enableCommunicationCommands","ngModel"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-cmmioconf-add",1),e._UZ(2,"app-cmmioconf-identify",2),e._UZ(3,"app-cmmioconf-change-modbus-id",1),e._UZ(4,"app-cmmioconf-remove",3),e.qZA(),e.YNc(5,Ri,1,0,"app-loader",4),e.YNc(6,Pi,56,78,"div",5)),2&t&&(e.xp6(1),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(2),e.Q6J("existingDevices",n.existingDevices)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("object_id",0)("callbackChange",n.getData.bind(n)),e.xp6(1),e.Q6J("ngIf",n.loadingData),e.xp6(1),e.Q6J("ngIf",!n.loadingData))},directives:[k.Y,Q,F,V,g.O5,D.R,c._Y,c.JL,c.F,Y.z,z.a,l.N8,l.Om,l.$Z,l.Uo,l._C,l.qn,l.qD,l.p0,g.sg,g.mk,I,c.Fj,c.nD,C.SY,c.Q7,c.JJ,c.On,yi.i,j,b.ix,f.dQ,T.w,S.b],pipes:[_.X$,P.h],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{padding-bottom:0;overflow:hidden}.remove[_ngcontent-%COMP%]{text-align:left!important}.center[_ngcontent-%COMP%]{text-align:center}"]}),o})(),canActivate:[y.a],data:{activeMenu:"MY_PLANT",activeSubMenu:"DEVICES",icon:"icon_abb_24 icon-abb_devices_24",activeTab:"MOD"}}]}];let Qi=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[y.a],imports:[[M.Bz.forChild(ki)],M.Bz]}),o})();var Fi=d(5084);let Vi=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[Fi.m,Qi]]}),o})()},7618:(W,R,d)=>{d.d(R,{a:()=>u});var M=d(5e3),e=d(4521),_=d(9777);let u=(()=>{class m{constructor(Z,A){this.router=Z,this.appLoadService=A}canActivate(Z,A){return!!this.appLoadService.user.logged||(this.router.navigate(["/login"],{queryParams:{returnUrl:A.url}}),!1)}}return m.\u0275fac=function(Z){return new(Z||m)(M.LFG(e.F0),M.LFG(_.V))},m.\u0275prov=M.Yz7({token:m,factory:m.\u0275fac}),m})()}}]);