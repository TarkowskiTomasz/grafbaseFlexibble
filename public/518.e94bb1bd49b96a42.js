"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[518],{9332:(ut,k,d)=>{d.d(k,{o:()=>tt});var T=d(3075),t=d(5e3);let tt=(()=>{class V{validate(C){if("port"===this.appValidateUniqueType)return C.value&&this.appValidateUnique.find(u=>u.ports.find(h=>h.port_name.toLowerCase()===C.value.toLowerCase()&&this.itemId!==h.port_id))?{appValidateUnique:!0}:null;if("name"===this.appValidateUniqueType)return C.value&&this.appValidateUnique.find(u=>u.name.toLowerCase()===C.value.toLowerCase())&&this.initValue!==C.value?{appValidateUnique:!0}:null;if("tableProperty"===this.appValidateUniqueType)return C.value&&this.appValidateUnique.find(u=>u.toLowerCase()===C.value.toLowerCase())&&this.initValue!==C.value?{appValidateUnique:!0}:null;if("ipAddress"===this.appValidateUniqueType)return C.value&&this.appValidateUnique.find(u=>u.ip_address.toLowerCase()===C.value.toLowerCase())&&this.initValue!==C.value?{appValidateUnique:!0}:null;if("registerName"===this.appValidateUniqueType){const u=this.appValidateUnique.find(h=>h.id===this.itemId);return C.value&&u.registers.find(h=>(h.register_name||h.register_description).toLowerCase()===C.value.toLowerCase())&&this.initValue!==C.value?{appValidateUnique:!0}:null}return C.value&&this.appValidateUnique.find(u=>u.username.toLowerCase()===C.value.toLowerCase())&&this.initValue!==C.value?{appValidateUnique:!0}:null}}return V.\u0275fac=function(C){return new(C||V)},V.\u0275dir=t.lG2({type:V,selectors:[["","appValidateUnique",""]],inputs:{appValidateUnique:"appValidateUnique",initValue:"initValue",appValidateUniqueType:"appValidateUniqueType",itemId:"itemId"},features:[t._Bn([{provide:T.Cf,useExisting:V,multi:!0}])]}),V})()},1006:(ut,k,d)=>{d.r(k),d.d(k,{EnergyMonitoringModule:()=>Li});var T=d(4521),t=d(5e3),tt=d(1562);let V=(()=>{class i{constructor(){this.id="energy_monitoring_asset_overview"}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-asset-overview"]],hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},decls:1,vars:0,consts:[["type","asset-overview"]],template:function(e,n){1&e&&t._UZ(0,"app-dashboard",0)},directives:[tt.M],styles:[""]}),i})();var b=d(9808),C=d(5724),u=d(8938),h=d(7579),E=d(8372),Z=d(9059),x=d(2966),v=d(1062),H=d(7420),q=d(7003),J=d(6801),et=d(6042),it=d(2643),nt=d(2683),lt=d(6695),G=d(8868),ct=d(9767),y=d(2364),r=d(7454);const K={en:{dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},fr:{dateTime:"%A, le %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"],shortMonths:["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."]},it:{dateTime:"%A %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domenica","Luned\xec","Marted\xec","Mercoled\xec","Gioved\xec","Venerd\xec","Sabato"],shortDays:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],shortMonths:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"]},de:{dateTime:"%A, der %e. %B %Y, %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]},es:{dateTime:"%A, %e de %B de %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["domingo","lunes","martes","mi\xe9rcoles","jueves","viernes","s\xe1bado"],shortDays:["dom","lun","mar","mi\xe9","jue","vie","s\xe1b"],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],shortMonths:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"]}};var ht=d(1656);function Zt(i,s){if(1&i&&(t._UZ(0,"div",4),t.ALo(1,"safeHtml")),2&i){const e=t.oxw();t.Udp("left",e.tooltipData?e.tooltipData.left:0,"px")("top",e.tooltipData?e.tooltipData.top:0,"px"),t.Q6J("innerHTML",e.tooltipData?t.lcZ(1,5,e.tooltipData.html):"",t.oJD)}}const Mt=function(i){return{backgroundColor:i}};function At(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"span",7),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).hide(a)})("mouseenter",function(){const a=t.CHM(e).$implicit;return t.oxw(2).highlight(a)})("mouseleave",function(){const a=t.CHM(e).$implicit;return t.oxw(2).highlight(a,!1)}),t._UZ(1,"span",8),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"translate"),t.ALo(5,"translate"),t.qZA()}if(2&i){const e=s.$implicit;t.xp6(1),t.Q6J("ngStyle",t.VKq(8,Mt,e.visible?e.color:null)),t.xp6(1),t.Oqu(t.lcZ(3,2,e.label).length<=30?t.lcZ(4,4,e.label):t.lcZ(5,6,e.label).substr(0,30)+"...")}}function Et(i,s){if(1&i&&(t.TgZ(0,"div",5),t.YNc(1,At,6,10,"span",6),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.chartData)}}function Dt(i,s){1&i&&(t.TgZ(0,"p",9),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_DATA_TO_DISPLAY")))}function wt(i,s){1&i&&(t.O4$(),t._UZ(0,"svg"))}let _t=(()=>{class i{constructor(e,n){this.el=e,this.translate=n,this.chartTooltip=!0,this.noData=!1,this.hideLegend=!1,this.makeXAxis=()=>r.Z.axisBottom(this.x).ticks(this.x.ticks().length).tickSize(-this.height).tickFormat(()=>""),this.makeYaxis=()=>r.Z.axisLeft(this.y).ticks(this.y.ticks().length).tickSize(-this.width).tickFormat(()=>""),this.brushed=o=>{if(!o||!o.sourceEvent)return;o.selection||this.bottomChartContainer.select(".brush").call(this.brush.move,this.x.range());const a=o.selection||this.x2.range();this.x.domain(a.map(this.x2.invert,this.x2)),this.lineChart.selectAll(".line").attr("d",l=>this.line(l.data)),this.chartContainer.select(".axis-x").call(this.xAxis),this.chartContainer.select(".grid-x").call(this.makeXAxis()),this.chartContainer.select(".zoom").call(this.zoom.transform,r.Z.zoomIdentity.scale(this.width/(a[1]-a[0])).translate(-a[0],0))},this.zoomed=o=>{if(!o||!o.sourceEvent)return;let a;if(a=o.sourceEvent?o.sourceEvent.deltaY:0,a<0&&this.x.domain()[1].getTime()-this.x.domain()[0].getTime()<3*this.onePointTimeRange)this.zoom.scaleExtent([1,this.zoomLevel]);else{this.zoomLevel=o.transform.k,this.zoom.scaleExtent([1,1/0]);const l=o.transform;this.x.domain(l.rescaleX(this.x2).domain()),this.lineChart.selectAll(".line").attr("d",m=>this.line(m.data)),this.chartContainer.select(".axis-x").call(this.xAxis),this.chartContainer.select(".grid-x").call(this.makeXAxis()),this.bottomChartContainer.select(".brush").call(this.brush.move,this.x.range().map(l.invertX,l))}}}ngOnInit(){setTimeout(()=>{this.drawChart()})}drawChart(){let e=this.translate.currentLang;K[e]||(e="en"),r.Z.time.timeFormatDefaultLocale(K[e]),r.Z.selection.select(this.el.nativeElement).selectAll("svg > *").remove(),this.chartData[0]&&this.chartData[0].data[0]&&this.chartData[0].data[1]&&(this.onePointTimeRange=this.chartData[0].data[1].timestamp-this.chartData[0].data[0].timestamp);const n=r.Z.time.timeFormat("%H:%M:%S"),o=r.Z.time.timeFormat("%H:%M:%S"),a=r.Z.time.timeFormat("%H:%M"),l=r.Z.time.timeFormat("%H:%M"),m=r.Z.time.timeFormat("%a %d"),_=r.Z.time.timeFormat("%b %d"),M=r.Z.time.timeFormat("%B"),D=r.Z.time.timeFormat("%Y"),O=c=>(r.Z.timeSecond(c)<c?n:r.Z.timeMinute(c)<c?o:r.Z.timeHour(c)<c?a:r.Z.timeDay(c)<c?l:r.Z.timeMonth(c)<c?r.Z.timeWeek(c)<c?m:_:r.Z.timeYear(c)<c?M:D)(c);this.svg=r.Z.selection.select(this.el.nativeElement).select("svg");this.width=parseInt(this.svg.style("width"),10)-80-20,this.height=parseInt(this.svg.style("height"),10)-5-110;const L_top=this.height+35;this.height2=parseInt(this.svg.style("height"),10)-L_top-20,this.x=r.Z.scaleTime().range([0,this.width]),this.x2=r.Z.scaleTime().range([0,this.width]),this.y=r.Z.scaleLinear().range([this.height,0]);const S=r.Z.scaleLinear().range([this.height2,0]),F=this.width<500?Math.floor(this.width/30):null;this.xAxis=r.Z.axisBottom(this.x).ticks(F).tickFormat(O);const R=r.Z.axisBottom(this.x2).ticks(F).tickFormat(O),z=r.Z.axisLeft(this.y);this.brush=r.Z.brushX().extent([[0,0],[this.width,this.height2]]).on("brush end",this.brushed),this.zoom=r.Z.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[this.width,this.height]]).extent([[0,0],[this.width,this.height]]).on("zoom",this.zoomed),this.line=r.Z.line().defined(c=>null!==c.value).curve(r.Z.curveMonotoneX).x(c=>this.x(c.timestamp)).y(c=>this.y(c.value));const g=r.Z.line().defined(c=>null!==c.value).curve(r.Z.curveMonotoneX).x(c=>this.x2(c.timestamp)).y(c=>S(c.value));this.svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.width).attr("height",this.height),this.svg.append("defs").append("clipPath").attr("id","bottomClip").append("rect").attr("width",this.width).attr("height",this.height2+20),this.lineChart=this.svg.append("g").attr("class","chart").attr("transform","translate(80,5)").attr("clip-path","url("+window.location.href+"#clip)"),this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate(80,5)"),this.bottomChartContainer=this.svg.append("g").attr("class","bottomChartContainer").attr("transform","translate(80,"+L_top+")").attr("clip-path","url("+window.location.href+"#bottomClip)");const A={x:{},y:{}};if(A.x.min=r.Z.min(this.chartData,c=>r.Z.min(c.data,p=>p.timestamp)),A.x.max=r.Z.max(this.chartData,c=>r.Z.max(c.data,p=>p.timestamp)),A.y.min=r.Z.min(this.chartData.filter(c=>c.visible),c=>r.Z.min(c.data,p=>p.value)),A.y.max=r.Z.max(this.chartData.filter(c=>c.visible),c=>r.Z.max(c.data,p=>p.value)),!A.x.min&&!A.x.max)return void(this.noData=!0);this.x.domain([A.x.min,A.x.max]),this.y.domain([A.y.min,A.y.max]),this.x2.domain(this.x.domain()),S.domain(this.y.domain()),this.chartContainer.append("g").attr("class","grid grid-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxis()),this.chartContainer.append("g").attr("class","grid grid-y").call(this.makeYaxis()),this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.chartContainer.append("g").attr("class","axis axis-y").call(z),this.chartContainer.append("rect").attr("class","zoom").attr("width",this.width).attr("height",this.height).call(this.zoom),this.chartContainer.append("rect").attr("class","chart-tooltip-line").attr("height",this.height),this.chartContainer.append("text").attr("class","axis-label").attr("id","chartYLabel").attr("text-anchor","middle").attr("transform","translate(-60,"+this.height/2+")rotate(-90)").text(this.labelY);const Y=r.Z.selection.select(".chart-tooltip");this.lineChart.selectAll(".line").data(this.chartData).enter().append("path").attr("class","line").attr("select",c=>"line_"+c.color).attr("d",c=>this.line(c.data)).style("stroke",c=>c.color).style("opacity",c=>+c.visible),this.bottomChartContainer.selectAll(".line").data(this.chartData).enter().append("path").attr("class","line").attr("select",c=>"line_"+c.color).attr("d",c=>g(c.data)).style("stroke",c=>c.color).style("opacity",c=>+c.visible),this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+(L_top+this.height2-5)+")").call(R),this.bottomChartContainer.append("g").attr("class","brush").attr("width",this.width).attr("height",this.height).call(this.brush).call(this.brush.move,this.x.range()),this.chartContainer.select(".zoom").on("mouseover",()=>{this.chartData.filter(c=>c.visible).forEach(c=>{this.chartContainer.append("circle").attr("select",p=>"circle_"+c.color).style("fill",c.color).style("stroke",c.color).attr("r",4).style("opacity",0)})}),this.chartContainer.on("mousemove",c=>{let p="",N=0,Q=0;const j=this.x.invert(r.Z.selection.pointer(c)[0]),ot=r.Z.bisector(w=>w.timestamp).left;this.chartData.filter(w=>w.visible).forEach((w,P)=>{const U=ot(w.data,j,1),W=w.data[U-1],X=w.data[U];let I;I=X?this.x(W.timestamp)<0?X:this.x(X.timestamp)>this.width?W:new Date(j).valueOf()-new Date(W.timestamp).valueOf()>new Date(X.timestamp).valueOf()-new Date(j).valueOf()?X:W:W,Y.style("opacity",1),I&&(null!==I.value?this.chartContainer.selectAll('[select="circle_'+w.color+'"]').attr("transform","translate("+this.x(I.timestamp)+","+this.y(I.value)+")").style("opacity",1):this.chartContainer.selectAll('[select="circle_'+w.color+'"]').style("opacity",0),this.chartContainer.select(".chart-tooltip-line").attr("width","1").attr("x",this.x(I.timestamp)),0===P&&(N=80+this.x(I.timestamp)+10,Q=c.offsetY+5+10,p+='<div class="title">'+new Date(I.timestamp).toLocaleString()+"</div>"),P<5?p+='<div class="value"><span class="label" style="color:'+w.color+'">'+(w.label.length<=30?w.label:w.label.substr(0,30)+"...")+":</span>"+(null!==I.value?I.value:"-")+" ["+w.unit+"]</div>":5===P&&(p+='<div class="value"><span class="label">...</div>'))});const gt=parseInt(Y.style("width"),10);N+gt>this.width+80+10&&(N=this.width+80+10-gt);const at=parseInt(Y.style("height"),10);Q+at>this.height+5+10&&(Q=this.height+5+10-at),this.tooltipData={html:p,left:N,top:Q}}),this.chartContainer.on("mouseleave",()=>{Y.style("opacity",0),this.chartContainer.select(".chart-tooltip-line").attr("width","0"),this.chartContainer.selectAll("circle").remove()})}hide(e){(!e.visible||e.visible&&this.chartData.filter(n=>n.visible).length>1)&&(e.visible=!e.visible,this.lineChart.select('[select="line_'+e.color+'"]').interrupt().transition().duration(200).style("opacity",+e.visible),this.bottomChartContainer.select('[select="line_'+e.color+'"]').interrupt().transition().duration(200).style("opacity",+e.visible))}highlight(e,n=!0){e.visible&&this.lineChart.select('[select="line_'+e.color+'"]').transition().duration(200).style("stroke-width",n?2.5:1.5).style("opacity",+e.visible)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.SBq),t.Y36(v.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-line-chart"]],inputs:{isDashboard:"isDashboard",hideLegend:"hideLegend",chartData:"chartData",labelY:"labelY"},decls:4,vars:4,consts:[["class","chart-tooltip nowrap",3,"left","top","innerHTML",4,"ngIf"],["class","chart-legend",4,"ngIf"],["class","empty-text",4,"ngIf"],[4,"ngIf"],[1,"chart-tooltip","nowrap",3,"innerHTML"],[1,"chart-legend"],[3,"click","mouseenter","mouseleave",4,"ngFor","ngForOf"],[3,"click","mouseenter","mouseleave"],[3,"ngStyle"],[1,"empty-text"]],template:function(e,n){1&e&&(t.YNc(0,Zt,2,7,"div",0),t.YNc(1,Et,2,1,"div",1),t.YNc(2,Dt,3,3,"p",2),t.YNc(3,wt,1,0,"svg",3)),2&e&&(t.Q6J("ngIf",n.chartTooltip),t.xp6(1),t.Q6J("ngIf",!n.isDashboard&&!n.hideLegend&&!n.noData),t.xp6(1),t.Q6J("ngIf",n.noData),t.xp6(1),t.Q6J("ngIf",!n.noData))},directives:[b.O5,b.sg,b.PC],pipes:[ht.z,v.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),i})();var mt=d(8862),ft=d(83);const Ot=["pickRange"];function Lt(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div"),t.TgZ(2,"span",5),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"app-select",7),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw(2).view=o})("callbackChange",function(){t.CHM(e);const o=t.MAs(8);return t.oxw(2).changeView(),o.applyRefresh()}),t.qZA(),t.qZA(),t._UZ(6,"div",8),t._UZ(7,"app-pick-range",9,10),t.TgZ(9,"div"),t.TgZ(10,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).exportToCsv()}),t.ALo(11,"translate"),t._UZ(12,"i",12),t.qZA(),t.qZA(),t.BQk()}if(2&i){const e=t.oxw(2);t.xp6(3),t.Oqu(t.lcZ(4,6,"VIEW")),t.xp6(2),t.Q6J("options",e.viewList)("model",e.view),t.xp6(2),t.Q6J("showResolutions",!0)("callbackChange",e.getHistoricalSamples.bind(e)),t.xp6(3),t.s9C("nzTooltipTitle",t.lcZ(11,8,"DOWNLOAD_CSV"))}}function St(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",4),t.TgZ(1,"div"),t.TgZ(2,"span",5),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"app-select",6),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw().category=o})("callbackChange",function(){return t.CHM(e),t.oxw().changeCategory()}),t.qZA(),t.qZA(),t.YNc(6,Lt,13,10,"ng-container",2),t.qZA()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,4,"CATEGORY")),t.xp6(2),t.Q6J("options",e.categoriesList)("model",e.category),t.xp6(1),t.Q6J("ngIf",null==e.rows?null:e.rows.length)}}function It(i,s){1&i&&t._UZ(0,"app-loader")}function Ht(i,s){1&i&&(t.TgZ(0,"p",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"CURRENT_SENSORS_NO_SENSORS")))}const vt=function(i){return{selected:i}};function Ut(i,s){if(1&i&&t._UZ(0,"i",38),2&i){const e=t.oxw().$implicit,n=t.oxw(3);t.Q6J("ngClass",t.VKq(1,vt,n.checkSelected(e.object_id)))}}const qt=function(i){return{"background-color":i}};function zt(i,s){if(1&i&&t._UZ(0,"span",39),2&i){const e=t.oxw().$implicit,n=t.oxw(3);t.Q6J("ngStyle",t.VKq(1,qt,n.getSensorColor(e.object_id)))}}const Nt=function(i,s){return{selected:i,selectable:s}};function Vt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",33),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(3).selectRow(a)}),t.TgZ(1,"td",34),t.YNc(2,Ut,1,3,"i",35),t.qZA(),t.TgZ(3,"td",36),t._uU(4),t.YNc(5,zt,1,3,"span",37),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.qZA()}if(2&i){const e=s.$implicit;t.oxw();const n=t.MAs(2),o=t.oxw(2);t.Q6J("ngClass",t.WLB(8,Nt,o.checkSelected(e.object_id),e.modbus_id)),t.xp6(1),t.Q6J("nzLeft",n.allowNzLeft),t.xp6(1),t.Q6J("ngIf",e.modbus_id),t.xp6(1),t.Q6J("nzLeft",n.allowNzLeft),t.xp6(1),t.Oqu(e.modbus_id||"-"),t.xp6(1),t.Q6J("ngIf",e.modbus_id),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.phase_name)}}const Jt=function(){return{key:"modbus_id",value:"ascend"}},Rt=function(i,s){return{x:i,y:s}},pt=function(){return["ascend","descend"]};function Yt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"app-table",17,18),t.TgZ(3,"nz-table",19,20),t.ALo(5,"translate"),t.TgZ(6,"thead",21),t.NdJ("nzSortOrderChange",function(o){return t.CHM(e),t.MAs(2).sort(o)}),t.TgZ(7,"tr"),t.TgZ(8,"th",22),t.TgZ(9,"i",23),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).selectRow()}),t.qZA(),t.qZA(),t.TgZ(10,"th",24),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"th",25),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"th",25),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.qZA(),t.TgZ(19,"tr",26),t._UZ(20,"th",27),t.TgZ(21,"th",28),t.TgZ(22,"input",29),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"modbus_id","contains")}),t.qZA(),t.qZA(),t.TgZ(23,"th",30),t.TgZ(24,"input",29),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"name","contains")}),t.qZA(),t.qZA(),t.TgZ(25,"th",30),t.TgZ(26,"app-select",31),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw(2).phasesFilter=o})("callbackChange",function(){t.CHM(e);const o=t.MAs(2),a=t.oxw(2);return o.filter(a.phasesFilter,"phase_id","equals")}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(27,"tbody"),t.YNc(28,Vt,10,11,"tr",32),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.MAs(2),n=t.MAs(4),o=t.oxw(2);t.xp6(1),t.Q6J("initSort",t.DdM(36,Jt))("data",o.rows),t.xp6(2),t.Q6J("nzData",e.tableData)("nzFrontPagination",!1)("nzScroll",t.WLB(37,Rt,e.tableWidth,e.tableHeight))("nzNoResult",t.lcZ(5,28,"NO_CURRENT_SENSORS")),t.xp6(5),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(1),t.Q6J("ngClass",t.VKq(40,vt,o.checkSelected())),t.xp6(1),t.Q6J("nzLeft",e.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",t.DdM(42,pt))("nzSortOrder","ascend"),t.xp6(1),t.Oqu(t.lcZ(12,30,"MODBUS_ID")),t.xp6(2),t.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",t.DdM(43,pt)),t.xp6(1),t.Oqu(t.lcZ(15,32,"NAME")),t.xp6(2),t.Q6J("nzColumnKey","phase_id")("nzSortFn",!0)("nzSortDirections",t.DdM(44,pt)),t.xp6(1),t.Oqu(t.lcZ(18,34,"PHASE")),t.xp6(3),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(1),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(5),t.Q6J("options",o.phases)("clearable",!0)("model",o.phasesFilter),t.xp6(2),t.Q6J("ngForOf",n.data)}}function Ft(i,s){1&i&&t._UZ(0,"app-loader")}function Qt(i,s){if(1&i&&(t._UZ(0,"app-line-chart",43),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&i){const e=t.oxw(3);t.Q6J("hideLegend",!0)("chartData",e.chartData)("labelY",t.lcZ(1,3,e.labelY.text)+" "+t.lcZ(2,5,e.labelY.unit))}}function Pt(i,s){if(1&i&&(t._UZ(0,"app-column-chart",44),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&i){const e=t.oxw(3);t.Q6J("labelY",t.lcZ(1,2,e.labelY.text)+" "+t.lcZ(2,4,e.labelY.unit))("chartData",e.chartData)}}function kt(i,s){if(1&i&&(t.TgZ(0,"div",40),t.YNc(1,Ft,1,0,"app-loader",2),t.YNc(2,Qt,3,7,"app-line-chart",41),t.YNc(3,Pt,3,6,"app-column-chart",42),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.loadingChart),t.xp6(1),t.Q6J("ngIf",!e.loadingChart&&"activeEnergyImportTotal"!==e.view),t.xp6(1),t.Q6J("ngIf",!e.loadingChart&&"activeEnergyImportTotal"===e.view)}}function Bt(i,s){if(1&i&&(t.TgZ(0,"div",13),t.YNc(1,Ht,3,3,"p",14),t.YNc(2,Yt,29,45,"div",2),t.YNc(3,kt,4,3,"div",15),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.rows&&0===e.rows.length),t.xp6(1),t.Q6J("ngIf",e.rows&&e.rows.length>0),t.xp6(1),t.Q6J("ngIf",e.rows&&e.rows.length)}}let jt=(()=>{class i{constructor(e,n,o,a,l){this.currentSensorsService=e,this.toastr=n,this.translate=o,this.sharedService=a,this.datePipe=l,this.id="energy_monitoring_historical_values_current_sensors",this.loadingData=!0,this.loadingChart=!0,this.chartData=[],this.selected=[],this.categoryListChange=new t.vpe,this.changeVisible=new h.x}ngOnInit(){this.viewList=[{id:"currentAc",text:"AC",unit:"A"},{id:"currentDc",text:"DC",unit:"A"},{id:"currentTrms",text:"TRMS",unit:"A"},{id:"activePowerTotal",text:"ACTIVE_POWER",unit:"W"},{id:"activeEnergyImportTotal",text:"ENERGY",unit:"kWh"}],this.view=localStorage.getItem("CurrentSensorsHistoryViewNew")||"currentAc",this.selected=JSON.parse(localStorage.getItem("CurrentSensorsHistorySelected")||"[]"),this.getData(),this.changeVisible.pipe((0,E.b)(500)).subscribe(()=>{this.pickRange.applyRefresh()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.subscriptionConfiguration&&this.subscriptionConfiguration.unsubscribe()}getData(){this.loadingData=!0,this.subscriptionConfiguration=this.currentSensorsService.getCurrentSensorsConfiguration().subscribe(e=>{this.phases=e.phases,this.rows=e.currentSensors,this.rows.length||(this.loadingData=!1),this.selected.length||(this.selected=this.rows.filter(n=>n.modbus_id).slice(0,5).map(n=>n.object_id))},()=>{})}changeCategory(){localStorage.setItem("AnalyticsHistoricalValuesCategory",this.category),this.categoryListChange.next(this.category)}getHistoricalSamples(e,n,o){this.subscription&&this.subscription.unsubscribe(),localStorage.setItem("CurrentSensorsHistoryViewNew",this.view);const a=this.viewList.find(({id:m})=>m===this.view);a&&(this.labelY=a),this.chartData=[],this.loadingChart=!0;const l={resolution:o,view:this.view,startDate:Math.floor(new Date(e).getTime()/1e3),endDate:Math.floor(new Date(n).getTime()/1e3),objectIds:this.selected};this.subscription=this.currentSensorsService.getHistoricalValues(l).subscribe(m=>{m.forEach(_=>{const M=this.rows.find(D=>D.object_id===_.object_id);if(M&&M.modbus_id)if("activeEnergyImportTotal"!==this.view)this.chartData.push({label:M.name,color:C.vK[M.modbus_id-1],object_id:M.object_id,visible:!0,unit:null==a?void 0:a.unit,data:Object.keys(_.samples).map(D=>({timestamp:1e3*Number(D),value:"-"!==_.samples[D]?Number(Number(_.samples[D]).toFixed(2)):null}))});else{const D=[];let O;Object.keys(_.samples).forEach(f=>{isNaN(_.samples[f])||D.push(_.samples[f])}),O=D.length>=2?Number((D[D.length-1]-D[0]).toFixed(3)):null,this.chartData.push({label:M.name,color:C.vK[M.modbus_id-1],object_id:M.object_id,unit:null==a?void 0:a.unit,value:O,data:Object.keys(_.samples).map(f=>({timestamp:1e3*Number(f),value:"-"!==_.samples[f]?Number(Number(_.samples[f]).toFixed(3)):null}))})}}),this.loadingData=!1,this.loadingChart=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}changeView(){localStorage.setItem("CurrentSensorsHistoryViewNew",this.view)}selectRow(e){e&&!e.modbus_id||(e?this.selected.includes(e.object_id)?this.selected=this.selected.filter(n=>n!==e.object_id):this.selected.push(e.object_id):this.selected=this.checkSelected()?[]:this.rows.filter(n=>n.modbus_id).map(n=>n.object_id),localStorage.setItem("CurrentSensorsHistorySelected",JSON.stringify(this.selected)),this.changeVisible.next(""))}checkSelected(e){return e?this.selected.includes(e):this.rows.filter(n=>n.modbus_id).length>0&&!this.rows.filter(n=>n.modbus_id).some(n=>!this.selected.includes(n.object_id))}getSensorColor(e){const n=this.rows.find(o=>o.object_id===e);return n&&n.modbus_id?C.vK[n.modbus_id-1]:""}exportToCsv(){const e=this.viewList.find(m=>m.id===this.view),n=["TIMESTAMP_UTC ["+this.translate.instant("RESOLUTION_S")+"]","DATE_UTC"],o=this.translate.instant("CURRENT_SENSORS")+"_"+this.translate.instant((null==e?void 0:e.text)||"")+"_"+this.datePipe.transform(Date.now(),"yyyy-MM-dd_HH-mm-ss");let a=[];this.chartData.forEach(m=>{n.push(m.label+" "+this.translate.instant(this.view)+" "+m.unit),m.data.forEach((_,M)=>{a[M]||(a[M]=[Math.floor(_.timestamp/1e3),this.datePipe.transform(_.timestamp,"yyyy-MM-dd HH:mm:ss","UTC")]),a[M].push((_.value||"-").toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))})}),new u.Sv(a,o,{fieldSeparator:";",headers:n})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Z.C),t.Y36(x._),t.Y36(v.sK),t.Y36(H.F),t.Y36(b.uU))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-historical-values-current-sensors"]],viewQuery:function(e,n){if(1&e&&t.Gf(Ot,5),2&e){let o;t.iGM(o=t.CRH())&&(n.pickRange=o.first)}},hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},inputs:{categoriesList:"categoriesList",category:"category"},outputs:{categoryListChange:"categoryListChange"},features:[t._Bn([b.uU])],decls:4,vars:3,consts:[[1,"section-header"],["class","controls",4,"ngIf"],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"controls"],[1,"label"],["inputClass","no-validate","inputId","category_select",3,"options","model","modelChange","callbackChange"],["inputClass","no-validate","inputId","view_select",3,"options","model","modelChange","callbackChange"],[1,"divider"],["datesStorageKey","CurrentSensorsHistoryDates",2,"float","left",3,"showResolutions","callbackChange"],["pickRange",""],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_download_16"],[1,"section-content"],["class","empty-text",4,"ngIf"],["class","chart-container chart-with-table",4,"ngIf"],[1,"empty-text"],[3,"initSort","data"],["table",""],[3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","56px",3,"nzLeft"],[1,"icon_abb_24","icon-abb_view_24","view-icon",3,"ngClass","click"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],[3,"nzColumnKey","nzSortFn","nzSortDirections"],[1,"filters"],[3,"nzLeft"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],["inputId","phase_filter","inputClass","no-validate",3,"options","clearable","model","modelChange","callbackChange"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[2,"width","56px","max-width","56px",3,"nzLeft"],["class","icon_abb_24 icon-abb_view_24 view-icon",3,"ngClass",4,"ngIf"],[2,"width","120px","max-width","120px",3,"nzLeft"],["class","color-box",3,"ngStyle",4,"ngIf"],[1,"icon_abb_24","icon-abb_view_24","view-icon",3,"ngClass"],[1,"color-box",3,"ngStyle"],[1,"chart-container","chart-with-table"],[3,"hideLegend","chartData","labelY",4,"ngIf"],[3,"labelY","chartData",4,"ngIf"],[3,"hideLegend","chartData","labelY"],[3,"labelY","chartData"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,St,7,6,"div",1),t.qZA(),t.YNc(2,It,1,0,"app-loader",2),t.YNc(3,Bt,4,3,"div",3)),2&e&&(t.xp6(1),t.Q6J("ngIf",n.rows),t.xp6(1),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("ngIf",!n.loadingData))},directives:[b.O5,q.H,J.P,et.ix,it.dQ,nt.w,lt.SY,G.R,ct.a,y.N8,y.Om,y.$Z,y.Uo,y._C,y.qn,b.mk,y.qD,y.p0,b.sg,b.PC,_t,mt.t],pipes:[v.X$,ft.Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:auto;padding-bottom:20px}"]}),i})();var dt=d(5893),Wt=d(6625),Xt=d(9137),Gt=d(6531);const Kt=function(){return{backgroundColor:"rgb(230, 230, 230)"}},$t=function(){return{backgroundColor:"rgb(0, 136, 204)"}};function te(i,s){1&i&&(t.TgZ(0,"div",4),t.TgZ(1,"span",5),t._UZ(2,"span",6),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"span",5),t._UZ(6,"span",6),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.qZA()),2&i&&(t.xp6(2),t.Q6J("ngStyle",t.DdM(8,Kt)),t.xp6(1),t.hij("",t.lcZ(4,4,"OPEN")," "),t.xp6(3),t.Q6J("ngStyle",t.DdM(9,$t)),t.xp6(1),t.hij("",t.lcZ(8,6,"CLOSE")," "))}function ee(i,s){1&i&&(t.TgZ(0,"p",7),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_DATA_TO_DISPLAY")))}function ie(i,s){1&i&&(t.O4$(),t._UZ(0,"svg"))}let Ct=(()=>{class i{constructor(e,n){this.el=e,this.translate=n,this.chartTooltip=!0,this.withCounter=!1,this.noData=!1,this.makeXAxis=()=>r.Z.axisBottom(this.x).ticks(this.x.ticks().length).tickSize(-this.height).tickFormat(()=>"")}set domain(e){this.axisDomain=e,this.svg&&this.drawChart()}ngOnInit(){setTimeout(()=>{this.drawChart()})}drawChart(){r.Z.selection.select(this.el.nativeElement).selectAll("svg > *").remove();const e=Array.from(new Set(this.chartData.map(g=>g.label))).reverse();if(!e.length)return void(this.noData=!0);const n=[];this.svg=r.Z.selection.select(this.el.nativeElement).select("svg");const o={top:5,right:20,bottom:20,left:120};this.withCounter&&(o.right=80,e.forEach(g=>{n.push(r.Z.max(this.chartData.filter(A=>A.label===g&&A.start<=new Date(this.axisDomain.x.max).valueOf()),A=>A.counter))})),this.width=parseInt(this.svg.style("width"),10)-o.left-o.right,this.height=parseInt(this.svg.style("height"),10)-o.top-o.bottom,100*e.length<this.height&&(this.height=100*e.length),20*e.length>this.height&&(this.height=20*e.length,this.svg.style("height",this.height+50));const a=r.Z.time.timeFormat("%H:%M:%S"),l=r.Z.time.timeFormat("%H:%M:%S"),m=r.Z.time.timeFormat("%H:%M"),_=r.Z.time.timeFormat("%H:%M"),M=r.Z.time.timeFormat("%a %d"),D=r.Z.time.timeFormat("%b %d"),O=r.Z.time.timeFormat("%B"),f=r.Z.time.timeFormat("%Y");this.x=r.Z.scaleTime().range([0,this.width]),this.y=r.Z.scaleBand().range([this.height,0]),this.xAxis=r.Z.axisBottom(this.x).tickFormat(g=>(r.Z.timeSecond(g)<g?a:r.Z.timeMinute(g)<g?l:r.Z.timeHour(g)<g?m:r.Z.timeDay(g)<g?_:r.Z.timeMonth(g)<g?r.Z.timeWeek(g)<g?M:D:r.Z.timeYear(g)<g?O:f)(g)),this.yAxis=r.Z.axisLeft(this.y),this.x.domain([new Date(this.axisDomain.x.min).valueOf(),new Date(this.axisDomain.x.max).valueOf()]),this.y.domain(e).padding(.1),this.withCounter&&n.length&&(this.y2=r.Z.scaleBand().range([this.height,0]),this.yAxis2=r.Z.axisRight(this.y2),this.y2.domain(n).padding(.1));const S=Date.now();this.svg.append("defs").append("clipPath").attr("id","clip"+S).append("rect").attr("width",this.width-1).attr("height",this.height+5).attr("y",-5),this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate("+o.left+","+o.top+")"),this.chartContainer.append("g").attr("class","grid grid-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxis());const F=this.svg.append("g").attr("class","chartContainer").attr("transform","translate("+(o.left+1)+","+o.top+")").attr("clip-path","url("+window.location.href+"#clip"+S+")");this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.chartContainer.append("g").attr("class","axis axis-y").call(this.yAxis),this.chartContainer.selectAll(".axis-y .tick").append("svg:title").text(g=>g),this.withCounter&&e.length&&(this.chartContainer.append("g").attr("class","axis axis-y-counter").attr("transform","translate("+this.width+",0)").call(this.yAxis2),this.chartContainer.append("text").attr("text-anchor","end").attr("transform","translate("+(this.width+60)+",5)").text(this.translate.instant("COUNTER"))),F.append("g").selectAll("g").data(this.chartData).enter().append("rect").attr("x",g=>this.x(g.start)+2).attr("y",g=>this.y(g.label)).attr("width",g=>this.x(g.stop)-this.x(g.start)).attr("height",()=>this.y.bandwidth()).attr("fill","#0088cc").attr("class",g=>0===g.status?"bar bar-gray":1===g.status?"bar":"bar bar-white"),r.Z.selection.selectAll(".chart-tooltip").remove();const R=r.Z.selection.select(".chart-container").append("div").attr("class","chart-tooltip text-shadow").style("position","absolute").style("z-index","10").style("opacity","0"),z=this;F.selectAll(".bar").on("mousemove",(g,A)=>{r.Z.selection.select(g.currentTarget).style("fill-opacity",".6"),R.html('<div class="value fs-14"><span class="label">'+A.label+"</span><br>"+new Date(A.start).toLocaleString()+" - "+new Date(A.stop).toLocaleString()+"<br>"+z.translate.instant("STATUS")+": "+(0===A.status?z.translate.instant("OPEN"):1===A.status?z.translate.instant("CLOSE"):"-")+"</div>");let Y=g.layerX+10,c=g.layerY+10;const p=parseInt(R.style("width"),10);Y+p>z.width+o.left+10&&(Y=z.width+o.left+10-p);const N=parseInt(R.style("height"),10);c+N>z.height+o.top+10&&(c=z.height+o.top+10-N),R.style("left",Y+"px").style("top",c+"px"),R.transition().duration(100).style("opacity",.8)}),F.selectAll(".bar").on("mouseout",(g,A)=>{r.Z.selection.select(g.currentTarget).style("fill-opacity","1"),R.interrupt().transition().style("opacity",0).on("end",function(){r.Z.selection.select(g.currentTarget).html("")})})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.SBq),t.Y36(v.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-status-chart"]],inputs:{chartData:"chartData",withCounter:"withCounter",domain:"domain"},features:[t._Bn([Xt._,Gt.L])],decls:5,vars:10,consts:[[1,"chart-tooltip","nowrap",3,"innerHTML"],["class","chart-legend",4,"ngIf"],["class","empty-text",4,"ngIf"],[4,"ngIf"],[1,"chart-legend"],[1,"no-checkbox"],[3,"ngStyle"],[1,"empty-text"]],template:function(e,n){1&e&&(t._UZ(0,"div",0),t.ALo(1,"safeHtml"),t.YNc(2,te,9,10,"div",1),t.YNc(3,ee,3,3,"p",2),t.YNc(4,ie,1,0,"svg",3)),2&e&&(t.Udp("left",n.tooltipData?n.tooltipData.left:0,"px")("top",n.tooltipData?n.tooltipData.top:0,"px"),t.Q6J("innerHTML",n.tooltipData?t.lcZ(1,8,n.tooltipData.html):"",t.oJD),t.xp6(2),t.Q6J("ngIf",!n.noData),t.xp6(1),t.Q6J("ngIf",n.noData),t.xp6(1),t.Q6J("ngIf",!n.noData))},directives:[b.O5,b.PC],pipes:[ht.z,v.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),i})();function ne(i,s){1&i&&t._UZ(0,"app-loader")}function oe(i,s){1&i&&(t.TgZ(0,"p",14),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"IO_MODULES_NO_MODULES")))}function ae(i,s){1&i&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"COUNTER")))}function se(i,s){1&i&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"PULSE_VALUE")))}function re(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"th"),t.TgZ(1,"input",24),t.NdJ("input",function(o){return t.CHM(e),t.oxw(),t.MAs(2).filter(o,"counter","contains")}),t.qZA(),t.qZA()}}function le(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"th"),t.TgZ(1,"input",24),t.NdJ("input",function(o){return t.CHM(e),t.oxw(),t.MAs(2).filter(o,"pulse_value","contains")}),t.qZA(),t.qZA()}}function ce(i,s){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"toFixed"),t.qZA(),t.qZA()),2&i){const e=s.$implicit,n=t.oxw(3);t.xp6(2),t.Oqu(e.modbus_id||"-"),t.xp6(2),t.Oqu(e.port||"-"),t.xp6(2),t.Oqu(e.port_name),t.xp6(2),t.AsE("","Pulse"===n.view?t.lcZ(9,5,e.pulse_value):e.counter," ","Pulse"===n.view?e.pulse_unit_name:"","")}}const he=function(){return{key:"modbus_id",value:"ascend"}},pe=function(i,s){return{x:i,y:s}},de=function(){return["ascend","descend"]};function ge(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"app-table",15,16),t.TgZ(3,"nz-table",17,18),t.ALo(5,"translate"),t.TgZ(6,"thead",19),t.NdJ("nzSortOrderChange",function(o){return t.CHM(e),t.MAs(2).sort(o)}),t.TgZ(7,"tr"),t.TgZ(8,"th",20),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"th",21),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"th"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.YNc(17,ae,3,3,"th",9),t.YNc(18,se,3,3,"th",9),t.qZA(),t.TgZ(19,"tr",22),t.TgZ(20,"th",23),t.TgZ(21,"input",24),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"modbus_id","contains")}),t.qZA(),t.qZA(),t.TgZ(22,"th"),t.TgZ(23,"input",24),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"port","contains")}),t.qZA(),t.qZA(),t.TgZ(24,"th"),t.TgZ(25,"input",24),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"port_name","contains")}),t.qZA(),t.qZA(),t.YNc(26,re,2,0,"th",9),t.YNc(27,le,2,0,"th",9),t.qZA(),t.qZA(),t.TgZ(28,"tbody"),t.YNc(29,ce,10,7,"tr",25),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.MAs(2),n=t.MAs(4),o=t.oxw(2);t.xp6(1),t.Q6J("initSort",t.DdM(29,he))("data",o.rows),t.xp6(2),t.Q6J("nzData",e.tableData)("nzFrontPagination",!1)("nzScroll",t.WLB(30,pe,e.tableWidth,e.tableHeight))("nzNoResult",t.lcZ(5,21,"NO_IO_MODULES")),t.xp6(5),t.Q6J("nzLeft",e.allowNzLeft)("nzColumnKey","modbus_id")("nzSortFn",!0)("nzSortDirections",t.DdM(33,de))("nzSortOrder","ascend"),t.xp6(1),t.Oqu(t.lcZ(10,23,"MODBUS_ID")),t.xp6(2),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(1),t.Oqu(t.lcZ(13,25,"PORT")),t.xp6(3),t.Oqu(t.lcZ(16,27,"PORT_NAME")),t.xp6(2),t.Q6J("ngIf","Pulse"!==o.view),t.xp6(1),t.Q6J("ngIf","Pulse"===o.view),t.xp6(2),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(6),t.Q6J("ngIf","Pulse"!==o.view),t.xp6(1),t.Q6J("ngIf","Pulse"===o.view),t.xp6(2),t.Q6J("ngForOf",n.data)}}function ue(i,s){1&i&&t._UZ(0,"app-loader")}function _e(i,s){if(1&i&&(t._UZ(0,"app-column-chart",29),t.ALo(1,"translate")),2&i){const e=t.oxw(3);t.Q6J("chartData",e.chartData)("labelY",t.lcZ(1,2,e.labelY))}}function me(i,s){if(1&i&&t._UZ(0,"app-status-chart",30),2&i){const e=t.oxw(3);t.Q6J("chartData",e.chartData)("domain",e.domain)}}function fe(i,s){if(1&i&&(t.TgZ(0,"div",26),t.YNc(1,ue,1,0,"app-loader",9),t.YNc(2,_e,2,4,"app-column-chart",27),t.YNc(3,me,1,2,"app-status-chart",28),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.loadingChart),t.xp6(1),t.Q6J("ngIf","Pulse"===e.view||"Counter"===e.type&&!e.loadingChart),t.xp6(1),t.Q6J("ngIf","Pulse"!==e.view&&"Status"===e.type&&!e.loadingChart)}}function ve(i,s){if(1&i&&(t.TgZ(0,"div",11),t.YNc(1,oe,3,3,"p",12),t.YNc(2,ge,30,34,"div",9),t.YNc(3,fe,4,3,"div",13),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.rows&&0===e.rows.length),t.xp6(1),t.Q6J("ngIf",e.rows&&e.rows.length>0&&"Status"!==e.type),t.xp6(1),t.Q6J("ngIf",e.rows&&e.rows.length)}}let Ce=(()=>{class i{constructor(e,n,o,a,l){this.ioService=e,this.toastr=n,this.translate=o,this.sharedService=a,this.toFixedPipe=l,this.loadingData=!0,this.loadingChart=!0,this.chartData=[],this.pulseUnits=[],this.dates={startDate:void 0,endDate:void 0,minDate:void 0,maxDate:void 0},this.categoryListChange=new t.vpe}ngOnInit(){this.view=localStorage.getItem("IOModulesHistoryView")||"Input",this.type=localStorage.getItem("IOModulesHistoryType")||"Counter",this.getData(),this.viewList=[{id:"Input",text:"INPUT"},{id:"Output",text:"OUTPUT"},{id:"Pulse",text:"PULSE"}],this.typeList=[{id:"Counter",text:"COUNTER"},{id:"Status",text:"STATUS"}]}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.subscriptionConfiguration&&this.subscriptionConfiguration.unsubscribe()}getData(){this.loadingData=!0,"Pulse"===this.view&&(this.type="Counter"),localStorage.setItem("IOModulesHistoryView",this.view),localStorage.setItem("IOModulesHistoryType",this.type),this.subscriptionConfiguration=this.ioService.getIoModulesConfiguration().subscribe(e=>{this.pulseUnits=e.pulseUnits,this.getSelected(e.ioModules)},()=>{})}getSelected(e){let n=[];e.filter(o=>o.modbus_id).forEach(o=>{o.ports.forEach(a=>{const l={counter:a.counter,object_id:o.object_id,port:a.port,status:a.status,modbus_id:o.modbus_id,port_id:`${o.object_id}.${a.port}`,port_name:a.name,module_type_id:o.type_id,pulse:5===a.connected_device_type,pulse_weight:a.pulse_weight,pulse_value:a.pulse_value,pulse_unit_id:a.pulse_unit_id,pulse_unit_name:a.pulse_unit_id?this.pulseUnits.find(m=>m.id===a.pulse_unit_id).name:""};n.push(l)})}),this.allRows=n,this.changeView()}changeCategory(){localStorage.setItem("AnalyticsHistoricalValuesCategory",this.category),this.categoryListChange.next(this.category)}changeView(){"Pulse"===this.view&&(this.type="Counter"),localStorage.setItem("IOModulesHistoryView",this.view),this.rows=this.allRows.filter("Input"===this.view?e=>0===e.module_type_id||2===e.module_type_id&&(3===e.port||4===e.port)&&!1===e.pulse:"Output"===this.view?e=>1===e.module_type_id||2===e.module_type_id&&(1===e.port||2===e.port):e=>!0===e.pulse),this.rows=this.rows.concat(this.rows),this.loadingData=!1,this.getHistoricalSamples()}changeType(){localStorage.setItem("IOModulesHistoryType",this.type),"Counter"===this.type&&this.getData()}getHistoricalSamples(e,n){if(!this.loadingData)if(this.subscription&&this.subscription.unsubscribe(),this.labelY=this.translate.instant("Pulse"===this.view?"PULSE_VALUE":"COUNTER"),this.chartData=[],this.loadingChart=!0,"Status"===this.type){const o=JSON.parse(localStorage.getItem("IOModulessHistoryDates")||"[]"),a=new Date(Date.now()-864e5);this.dates.startDate=o[0]?new Date(o[0]):a,this.dates.endDate=o[1]?new Date(o[1]):new Date,this.domain={x:{min:this.dates.startDate,max:this.dates.endDate}};const l={resolution:"",startDate:Math.floor(new Date(e||this.dates.startDate.getTime()).getTime()/1e3),endDate:Math.floor(new Date(n||this.dates.endDate).getTime()/1e3),objectIds:this.rows.map(m=>m.port_id)};this.subscription=this.ioService.getHistoricalValues(l).subscribe(m=>{m.forEach((_,M)=>{const D=this.rows.find(O=>O.port_id===`${_.object_id}.${_.port}`);_.samples.forEach((O,f)=>{D&&D.modbus_id&&this.chartData.push({label:D.port_name,status:O.status,start:1e3*O.timestamp,stop:f<_.samples.length-1?1e3*_.samples[f+1].timestamp:(new Date).getTime()})})}),this.loadingData=!1,this.loadingChart=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}else this.rows.forEach(o=>{this.chartData.push({label:o.port_name,object_id:o.object_id,unit:"Pulse"===this.view?o.pulse_unit_name:"["+this.labelY+"]",visible:!0,value:"Pulse"===this.view?this.toFixedPipe.transform(("-"===o.counter.toString()?0:o.counter)*(void 0===o.pulse_weight?1:o.pulse_weight),3):"-"===o.counter.toString()?0:o.counter})}),this.loadingData=!1,this.loadingChart=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Wt.W),t.Y36(x._),t.Y36(v.sK),t.Y36(H.F),t.Y36(dt.A))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-historical-values-io-modules"]],inputs:{categoriesList:"categoriesList",category:"category"},outputs:{categoryListChange:"categoryListChange"},features:[t._Bn([dt.A])],decls:22,vars:24,consts:[[1,"section-header"],[1,"controls",3,"hidden"],[1,"label"],["inputClass","no-validate","inputId","category_select",3,"options","model","modelChange","callbackChange"],["inputClass","no-validate","inputId","view_select",3,"options","model","modelChange","callbackChange"],["inputClass","no-validate","inputId","type_select",3,"options","model","disabled","modelChange","callbackChange"],[1,"divider"],["datesStorageKey","IOModulessHistoryDates",3,"callbackChange"],["pickRange",""],[4,"ngIf"],["class","section-content",4,"ngIf"],[1,"section-content"],["class","empty-text",4,"ngIf"],["class","chart-container chart-with-table",4,"ngIf"],[1,"empty-text"],[3,"initSort","data"],["table",""],[3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],["nzWidth","100px",3,"nzLeft"],[1,"filters"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[4,"ngFor","ngForOf"],[1,"chart-container","chart-with-table"],[3,"chartData","labelY",4,"ngIf"],[3,"chartData","domain",4,"ngIf"],[3,"chartData","labelY"],[3,"chartData","domain"]],template:function(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div"),t.TgZ(3,"span",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"app-select",3),t.NdJ("modelChange",function(l){return n.category=l})("callbackChange",function(){return n.changeCategory()}),t.qZA(),t.qZA(),t.TgZ(7,"div"),t.TgZ(8,"span",2),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"app-select",4),t.NdJ("modelChange",function(l){return n.view=l})("callbackChange",function(){t.CHM(o);const l=t.MAs(19);return n.getData(),l.applyRefresh()}),t.qZA(),t.qZA(),t.TgZ(12,"div"),t.TgZ(13,"span",2),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"app-select",5),t.NdJ("modelChange",function(l){return n.type=l})("callbackChange",function(){t.CHM(o);const l=t.MAs(19);return n.changeType(),l.applyRefresh()}),t.qZA(),t.qZA(),t._UZ(17,"div",6),t._UZ(18,"app-pick-range",7,8),t.qZA(),t.qZA(),t.YNc(20,ne,1,0,"app-loader",9),t.YNc(21,ve,4,3,"div",10)}2&e&&(t.xp6(1),t.Q6J("hidden",!n.rows),t.xp6(3),t.Oqu(t.lcZ(5,18,"CATEGORY")),t.xp6(2),t.Q6J("options",n.categoriesList)("model",n.category),t.xp6(3),t.Oqu(t.lcZ(10,20,"VIEW")),t.xp6(2),t.Q6J("options",n.viewList)("model",n.view),t.xp6(3),t.Oqu(t.lcZ(15,22,"TYPE")),t.xp6(2),t.Q6J("options",n.typeList)("model",n.type)("disabled","Pulse"===n.view),t.xp6(1),t.Udp("display","Counter"===n.type?"none":"flex"),t.xp6(1),t.Udp("display","Counter"===n.type?"none":"flex"),t.Q6J("callbackChange",n.getHistoricalSamples.bind(n)),t.xp6(2),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("ngIf",!n.loadingData))},directives:[q.H,J.P,b.O5,G.R,ct.a,y.N8,y.Om,y.$Z,y.Uo,y._C,y.qn,y.qD,y.p0,b.sg,mt.t,Ct],pipes:[v.X$,dt.A],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto}.section-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),i})();var xe=d(3429);function ye(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div"),t.TgZ(2,"span",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"app-select",6),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw().type=o}),t.qZA(),t.qZA(),t._UZ(6,"div",7),t._UZ(7,"app-pick-range",8,9),t.BQk()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,4,"TYPE")),t.xp6(2),t.Q6J("options",e.typeList)("model",e.type),t.xp6(2),t.Q6J("callbackChange",e.getHistoricalSamples.bind(e))}}function Te(i,s){1&i&&t._UZ(0,"app-loader")}function be(i,s){1&i&&(t.TgZ(0,"p",13),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_SSD")))}function Ze(i,s){1&i&&t._UZ(0,"app-loader")}function Me(i,s){if(1&i&&t._UZ(0,"app-status-chart",16),2&i){const e=t.oxw(3);t.Q6J("chartData",e.chartData)("domain",e.domain)}}function Ae(i,s){if(1&i&&(t.TgZ(0,"div",14),t.YNc(1,Ze,1,0,"app-loader",4),t.YNc(2,Me,1,2,"app-status-chart",15),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.loadingChart),t.xp6(1),t.Q6J("ngIf",!e.loadingChart)}}function Ee(i,s){if(1&i&&(t.TgZ(0,"div",10),t.YNc(1,be,3,3,"p",11),t.YNc(2,Ae,3,2,"div",12),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.rows&&0===e.rows.length),t.xp6(1),t.Q6J("ngIf",e.rows&&e.rows.length)}}let De=(()=>{class i{constructor(e,n,o,a){this.ssdService=e,this.toastr=n,this.translate=o,this.sharedService=a,this.loadingData=!0,this.loadingChart=!0,this.chartData=[],this.categoryListChange=new t.vpe}ngOnInit(){this.type="Status",this.getData(),this.typeList=[{id:"Status",text:"STATUS"}]}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.subscriptionConfiguration&&this.subscriptionConfiguration.unsubscribe()}getData(){this.loadingData=!0,this.subscriptionConfiguration=this.ssdService.getMeters().subscribe(e=>{this.rows=e.devices.filter(n=>"AuxiliaryContact"===n.device_type),this.loadingData=!1},()=>{})}changeCategory(){localStorage.setItem("AnalyticsHistoricalValuesCategory",this.category),this.categoryListChange.next(this.category)}getHistoricalSamples(e,n){this.subscription&&this.subscription.unsubscribe(),this.chartData=[],this.loadingChart=!0,this.domain={x:{min:e,max:n}};const o={startDate:Math.floor(new Date(e).getTime()/1e3),endDate:Math.floor(new Date(n).getTime()/1e3),objectIds:this.rows.map(a=>a.object_id)};this.subscription=this.ssdService.getHistoricalValues(o).subscribe(a=>{a.forEach(l=>{const m=this.rows.find(_=>_.object_id===l.object_id);l.samples.forEach((_,M)=>{m&&m.modbus_id&&this.chartData.push({label:`${m.name} ${this.translate.instant("SWITCH")} ${"switch1"===l.variable?1:2}`,status:0===_.status?1:0,start:1e3*_.timestamp,stop:M<l.samples.length-1?1e3*l.samples[M+1].timestamp:(new Date).getTime()})})}),this.loadingData=!1,this.loadingChart=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(xe.E),t.Y36(x._),t.Y36(v.sK),t.Y36(H.F))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-historical-values-ssd"]],inputs:{categoriesList:"categoriesList",category:"category"},outputs:{categoryListChange:"categoryListChange"},decls:10,vars:9,consts:[[1,"section-header"],[1,"controls",3,"hidden"],[1,"label"],["inputClass","no-validate","inputId","category_select",3,"options","model","modelChange","callbackChange"],[4,"ngIf"],["class","section-content",4,"ngIf"],["inputClass","no-validate","inputId","type_select",3,"options","model","modelChange"],[1,"divider"],["datesStorageKey","SsdHistoryDates",3,"callbackChange"],["pickRange",""],[1,"section-content"],["class","empty-text",4,"ngIf"],["class","chart-container chart-with-table",4,"ngIf"],[1,"empty-text"],[1,"chart-container","chart-with-table"],[3,"chartData","domain",4,"ngIf"],[3,"chartData","domain"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div"),t.TgZ(3,"span",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"app-select",3),t.NdJ("modelChange",function(a){return n.category=a})("callbackChange",function(){return n.changeCategory()}),t.qZA(),t.qZA(),t.YNc(7,ye,9,6,"ng-container",4),t.qZA(),t.qZA(),t.YNc(8,Te,1,0,"app-loader",4),t.YNc(9,Ee,3,2,"div",5)),2&e&&(t.xp6(1),t.Q6J("hidden",!n.rows),t.xp6(3),t.Oqu(t.lcZ(5,7,"CATEGORY")),t.xp6(2),t.Q6J("options",n.categoriesList)("model",n.category),t.xp6(1),t.Q6J("ngIf",null==n.rows?null:n.rows.length),t.xp6(1),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("ngIf",!n.loadingData))},directives:[q.H,b.O5,J.P,G.R,Ct],pipes:[v.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto}.section-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),i})();var we=d(5268),xt=d(9777);function Oe(i,s){if(1&i&&(t._UZ(0,"div",3),t.ALo(1,"safeHtml")),2&i){const e=t.oxw();t.Udp("left",e.tooltipData?e.tooltipData.left:0,"px")("top",e.tooltipData?e.tooltipData.top:0,"px"),t.Q6J("innerHTML",e.tooltipData?t.lcZ(1,5,e.tooltipData.html):"",t.oJD)}}function Le(i,s){1&i&&(t.TgZ(0,"p",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_DATA_TO_DISPLAY")))}function Se(i,s){1&i&&(t.O4$(),t._UZ(0,"svg"))}let Ie=(()=>{class i{constructor(e,n){this.el=e,this.translate=n,this.chartTooltip=!0,this.noData=!1,this.hideLegend=!0,this.resolution=9e5,this.makeXAxis=()=>r.Z.axisBottom(this.x).ticks(this.x.ticks().length).tickSize(-this.height).tickFormat(()=>""),this.makeYaxis=()=>r.Z.axisLeft(this.y).ticks(this.y.ticks().length).tickSize(-this.width).tickFormat(()=>""),this.brushed=o=>{if(!o||!o.sourceEvent)return;o.selection||this.bottomChartContainer.select(".brush").call(this.brush.move,this.x.range());const a=o.selection||this.x2.range();this.x.domain(a.map(this.x2.invert,this.x2)),this.chartContainer.select(".axis-x").call(this.xAxis),this.chartContainer.select(".grid-x").call(this.makeXAxis()),this.chartContainer.select(".zoom").call(this.zoom.transform,r.Z.zoomIdentity.scale(this.width/(a[1]-a[0])).translate(-a[0],0)),this.createBars(this.chartData.data.filter(l=>l.timestamp<=this.x.domain()[1].getTime()&&l.timestamp>=this.x.domain()[0].getTime()))},this.zoomed=o=>{if(!o||!o.sourceEvent)return;let a;if(a=o.sourceEvent?o.sourceEvent.deltaY:0,a<0&&this.x.domain()[1].getTime()-this.x.domain()[0].getTime()<3*this.resolution)this.zoom.scaleExtent([1,this.zoomLevel]);else{this.zoomLevel=o.transform.k,this.zoom.scaleExtent([1,1/0]);const l=o.transform;this.x.domain(l.rescaleX(this.x2).domain()),this.chartContainer.select(".axis-x").call(this.xAxis),this.chartContainer.select(".grid-x").call(this.makeXAxis()),this.bottomChartContainer.select(".brush").call(this.brush.move,this.x.range().map(l.invertX,l)),this.createBars(this.chartData.data.filter(m=>m.timestamp<=this.x.domain()[1].getTime()&&m.timestamp>=this.x.domain()[0].getTime()))}}}set labelY(e){setTimeout(()=>{this.initLabelY=e,r.Z.selection.select(".axis-label").text(e)})}ngOnInit(){setTimeout(()=>{this.drawChart()})}drawChart(){let e=this.translate.currentLang;K[e]||(e="en"),r.Z.time.timeFormatDefaultLocale(K[e]),r.Z.selection.select(this.el.nativeElement).selectAll("svg > *").remove();const n=r.Z.time.timeFormat("%H:%M:%S"),o=r.Z.time.timeFormat("%H:%M:%S"),a=r.Z.time.timeFormat("%H:%M"),l=r.Z.time.timeFormat("%H:%M"),m=r.Z.time.timeFormat("%a %d"),_=r.Z.time.timeFormat("%b %d"),M=r.Z.time.timeFormat("%B"),D=r.Z.time.timeFormat("%Y"),O=p=>(r.Z.timeSecond(p)<p?n:r.Z.timeMinute(p)<p?o:r.Z.timeHour(p)<p?a:r.Z.timeDay(p)<p?l:r.Z.timeMonth(p)<p?r.Z.timeWeek(p)<p?m:_:r.Z.timeYear(p)<p?M:D)(p);this.svg=r.Z.selection.select(this.el.nativeElement).select("svg");this.width=parseInt(this.svg.style("width"),10)-80-20,this.height=parseInt(this.svg.style("height"),10)-5-110;const L_top=this.height+35;this.height2=parseInt(this.svg.style("height"),10)-L_top-20,this.x=r.Z.scaleTime().range([0,this.width]),this.x2=r.Z.scaleTime().range([0,this.width]),this.y=r.Z.scaleLinear().range([this.height,0]);const S=r.Z.scaleLinear().range([this.height2,0]),F=this.width<500?Math.floor(this.width/30):null;this.xAxis=r.Z.axisBottom(this.x).ticks(F).tickFormat(O);const R=r.Z.axisBottom(this.x2).ticks(F).tickFormat(O),z=r.Z.axisLeft(this.y);this.brush=r.Z.brushX().extent([[0,0],[this.width,this.height2]]).on("brush end",this.brushed),this.zoom=r.Z.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[this.width,this.height]]).extent([[0,0],[this.width,this.height]]).on("zoom",this.zoomed),this.svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.width).attr("height",this.height),this.svg.append("defs").append("clipPath").attr("id","bottomClip").append("rect").attr("width",this.width).attr("height",this.height2+20),this.columnChart=this.svg.append("g").attr("class","chart").attr("transform","translate(80,5)").attr("clip-path","url("+window.location.href+"#clip)"),this.chartContainer=this.svg.append("g").attr("class","chartContainer").attr("transform","translate(80,5)"),this.bottomChartContainer=this.svg.append("g").attr("class","bottomChartContainer").attr("transform","translate(80,"+L_top+")").attr("clip-path","url("+window.location.href+"#bottomClip)");const g={x:{},y:{}};if(g.x.min=r.Z.min(this.chartData.data,p=>p.timestamp),g.x.max=r.Z.max(this.chartData.data,p=>p.timestamp),g.y.min=r.Z.min(this.chartData.data,p=>p.value),g.y.max=r.Z.max(this.chartData.data,p=>p.value),!g.x.min&&!g.x.max)return void(this.noData=!0);this.x.domain([g.x.min,g.x.max]),this.y.domain([g.y.min,g.y.max]),this.x2.domain(this.x.domain()),S.domain(this.y.domain()),this.chartContainer.append("g").attr("class","grid grid-x").attr("transform","translate(0,"+this.height+")").call(this.makeXAxis()),this.chartContainer.append("g").attr("class","grid grid-y").call(this.makeYaxis()),this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.chartContainer.append("g").attr("class","axis axis-y").call(z),this.chartContainer.append("rect").attr("class","zoom").attr("width",this.width).attr("height",this.height).call(this.zoom),this.chartContainer.append("rect").attr("class","chart-tooltip-line").attr("height",this.height),this.chartContainer.append("text").attr("class","axis-label").attr("id","chartYLabel").attr("text-anchor","middle").attr("transform","translate(-60,"+this.height/2+")rotate(-90)").text(this.initLabelY);const A=r.Z.selection.select(this.el.nativeElement).select(".chart-tooltip"),Y=this.x2.domain()[1].valueOf()-this.x2.domain()[0].valueOf()+this.resolution,c=Math.floor(this.width/(Y/this.resolution))||1;this.bottomChartContainer.selectAll(".bar").data(this.chartData.data).enter().append("rect").attr("class","bar").attr("fill",p=>p.color?p.color:"#0c74da").attr("x",p=>this.x2(p.timestamp)-c/2||0).attr("width",c).attr("y",p=>null!==p.value?S(p.value)<=S(0)?S(p.value):S(0):null).attr("height",p=>null!==p.value?Math.abs(this.height2-S(0)>0?this.height2-(this.height2-S(0))-S(p.value):this.height2-S(p.value)):null),this.chartContainer.append("g").attr("class","axis axis-x").attr("transform","translate(0,"+(L_top+this.height2-5)+")").call(R),this.bottomChartContainer.append("g").attr("class","brush").attr("width",this.width).attr("height",this.height).call(this.brush).call(this.brush.move,this.x.range()),this.chartContainer.on("mousemove",p=>{let N="",Q=0,j=0;const ot=this.x.invert(r.Z.selection.pointer(p)[0]),at=r.Z.bisector(I=>I.timestamp).left(this.chartData.data,ot,1),w=this.chartData.data[at-1],P=this.chartData.data[at];let U;U=P?this.x(w.timestamp)<0?P:this.x(P.timestamp)>this.width?w:new Date(ot).valueOf()-new Date(w.timestamp).valueOf()>new Date(P.timestamp).valueOf()-new Date(ot).valueOf()?P:w:w,A.style("opacity",1),U&&(this.chartContainer.select(".chart-tooltip-line").attr("width","1").attr("x",this.x(U.timestamp)),Q=80+this.x(U.timestamp)+10,j=p.offsetY+5+10,N+='<div class="title">'+new Date(U.timestamp).toLocaleString()+"</div>",N+='<div class="value"><span class="label" style="color:#0c74da">'+this.translate.instant(this.chartData.label)+":</span>"+(null!==U.value?U.value:"-")+" ["+this.chartData.unit+"]</div>");const W=parseInt(A.style("width"),10);Q+W>this.width+80+10&&(Q=this.width+80+10-W);const X=parseInt(A.style("height"),10);j+X>this.height+5+10&&(j=this.height+5+10-X),this.tooltipData={html:N,left:Q,top:j}}),this.chartContainer.on("mouseleave",()=>{A.style("opacity",0),this.chartContainer.select(".chart-tooltip-line").attr("width","0")}),this.createBars(this.chartData.data)}createBars(e){if(this.columnChart.selectAll(".bar").remove(),e&&e.length){const n=this.x.domain()[1].valueOf()-this.x.domain()[0].valueOf()+this.resolution,o=Math.floor(this.width/(n/this.resolution))||1;this.columnChart.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("fill",a=>a.color?a.color:"#0c74da").attr("x",a=>this.x(a.timestamp)-o/2||0).attr("width",o).attr("y",a=>null!==a.value?this.y(a.value)<=this.y(0)?this.y(a.value):this.y(0):null).attr("height",a=>null!==a.value?Math.abs(this.height-this.y(0)>0?this.height-(this.height-this.y(0))-this.y(a.value):this.height-this.y(a.value)):null)}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.SBq),t.Y36(v.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-column-timeline-chart"]],inputs:{isDashboard:"isDashboard",hideLegend:"hideLegend",resolution:"resolution",chartData:"chartData",labelY:"labelY"},decls:3,vars:3,consts:[["class","chart-tooltip nowrap",3,"left","top","innerHTML",4,"ngIf"],["class","empty-text",4,"ngIf"],[4,"ngIf"],[1,"chart-tooltip","nowrap",3,"innerHTML"],[1,"empty-text"]],template:function(e,n){1&e&&(t.YNc(0,Oe,2,7,"div",0),t.YNc(1,Le,3,3,"p",1),t.YNc(2,Se,1,0,"svg",2)),2&e&&(t.Q6J("ngIf",n.chartTooltip&&!n.noData),t.xp6(1),t.Q6J("ngIf",n.noData),t.xp6(1),t.Q6J("ngIf",!n.noData))},directives:[b.O5],pipes:[ht.z,v.X$],styles:["[_nghost-%COMP%]{display:flex;flex:1 0 auto;width:100%;flex-direction:column}.dashboard[_nghost-%COMP%]{height:auto}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{display:flex;flex:1 1 auto}.scroll-chart[_ngcontent-%COMP%]{overflow-x:auto;height:20px;position:absolute;bottom:0;overflow-y:hidden}.scroll-chart[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:20px}"]}),i})();function He(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"span",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",6),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw().device=o})("callbackChange",function(){return t.CHM(e),t.oxw().changeDevice()}),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"DEVICE")),t.xp6(2),t.Q6J("model",e.device)("options",e.devicesList)}}function Ue(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div"),t.TgZ(2,"span",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"app-select",7),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw().view=o})("callbackChange",function(){t.CHM(e);const o=t.MAs(8);return t.oxw().changeView(),o.applyRefresh()}),t.qZA(),t.qZA(),t._UZ(6,"div",8),t._UZ(7,"app-pick-range",9,10),t.TgZ(9,"div"),t.TgZ(10,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().exportToCsv()}),t.ALo(11,"translate"),t._UZ(12,"i",12),t.qZA(),t.qZA(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,7,"VIEW")),t.xp6(2),t.Q6J("options",e.viewList)("model",e.view),t.xp6(2),t.MGl("datesStorageKey","",e.type,"HistoryDates"),t.Q6J("callbackChange",e.getHistoricalSamples.bind(e))("showResolutions",!0),t.xp6(3),t.s9C("nzTooltipTitle",t.lcZ(11,9,"DOWNLOAD_CSV"))}}function qe(i,s){1&i&&t._UZ(0,"app-loader")}function ze(i,s){1&i&&(t.TgZ(0,"p",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"NO_DEVICES")))}function Ne(i,s){1&i&&(t.TgZ(0,"p",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DEVICE_NO_DATA")))}function Ve(i,s){if(1&i&&(t._UZ(0,"app-line-chart",20),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&i){const e=t.oxw(3);t.Q6J("chartData",e.chartData)("labelY",t.lcZ(1,2,e.labelY.text)+" "+t.lcZ(2,4,e.labelY.unit))}}function Je(i,s){if(1&i&&(t._UZ(0,"app-column-timeline-chart",21),t.ALo(1,"translate"),t.ALo(2,"toUnit")),2&i){const e=t.oxw(3);t.Q6J("chartData",e.chartData)("labelY",t.lcZ(1,3,e.labelY.text)+" "+t.lcZ(2,5,e.labelY.unit))("resolution",e.selectedResolution)}}function Re(i,s){if(1&i&&(t.TgZ(0,"div",17),t.YNc(1,Ve,3,6,"app-line-chart",18),t.YNc(2,Je,3,7,"app-column-timeline-chart",19),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf","linear"===e.chartType),t.xp6(1),t.Q6J("ngIf","column"===e.chartType)}}function Ye(i,s){if(1&i&&(t.TgZ(0,"div",13),t.YNc(1,ze,3,3,"p",14),t.YNc(2,Ne,3,3,"p",14),t.YNc(3,Re,3,2,"div",15),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.devicesList&&0===e.devicesList.length),t.xp6(1),t.Q6J("ngIf",(null==e.devicesList?null:e.devicesList.length)&&0===(null==e.viewList?null:e.viewList.length)),t.xp6(1),t.Q6J("ngIf",(null==e.devicesList?null:e.devicesList.length)&&(null==e.viewList?null:e.viewList.length))}}let Fe=(()=>{class i{constructor(e,n,o,a,l,m){this.modbusDeviceService=e,this.toastr=n,this.translate=o,this.sharedService=a,this.datePipe=l,this.appLoadService=m,this.id="modbus_device_historical_values",this.categoryListChange=new t.vpe,this.loadingData=!0,this.chartColors=["rgb(12, 116, 218)","rgb(203, 103, 69)","rgb(85, 55, 134)","rgb(50, 154, 93)"]}ngOnInit(){this.selected=localStorage.getItem(`ModbusDevice${this.type}Selected`)||"",this.device=Number(localStorage.getItem(`ModbusDevice${this.type}`)),this.view=localStorage.getItem(`${this.type}HistoricalView`)||"",this.currency=this.appLoadService.currency.value,this.getData()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.subscriptionConfiguration&&this.subscriptionConfiguration.unsubscribe()}getData(){this.subscriptionConfiguration=this.modbusDeviceService.getDevicesConfiguration(this.type).subscribe(e=>{this.devices=e,this.devicesList=e.map(a=>({id:a.object_id,text:a.name})),this.devices.length||(this.loadingData=!1),!this.devicesList.find(a=>a.id===this.device)&&this.devicesList.length&&(this.device=this.devicesList[0].id);const o=this.devices.find(a=>a.object_id===this.device);o&&(this.devicesTypeName=o.device_type_name),this.getDeviceDescriptor()},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}getDeviceDescriptor(){this.subscriptionDescriptor&&this.subscriptionDescriptor.unsubscribe(),this.subscription&&this.subscription.unsubscribe();const e=this.devices.find(n=>n.object_id===this.device);!e||(this.subscription=this.modbusDeviceService.getDeviceDescriptor(e.device_descriptor,this.type,"historical").subscribe(n=>{this.generateViews(n)},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))}))}changeCategory(){localStorage.setItem("AnalyticsHistoricalValuesCategory",this.category),this.categoryListChange.next(this.category)}generateViews(e){this.viewList=[],this.existingVariables=[],Object.keys(e).forEach(o=>{const a=C.OC.find(m=>m.variable===o);let l={};l=a?Object.assign({},a):{variable:o},this.existingVariables.push(Object.assign(Object.assign({},l),{unit:"Currency"===e[o].unit?this.currency.symbol:e[o].unit,cumulative:"Energies Ph/Tarriff"===e[o].category||"Energy Values"===e[o].category||e[o].cumulative,dbWriteInterval:e[o].dbWriteInterval}))}),this.existingVariables.forEach(o=>{e[o.variable]&&(this.viewList.find(l=>l.id===(o.group?o.group:o.variable))||this.viewList.push({id:o.group?o.group:o.variable,text:o.group?o.group:o.variable,unit:o.unit}))}),!this.viewList.find(o=>o.id===this.view)&&this.viewList.length&&(this.view=this.viewList[0].id),0===this.viewList.length&&(this.loadingData=!1)}changeDevice(){this.viewList=[],localStorage.setItem(`ModbusDevice${this.type}`,String(this.device)),this.loadingData=!0,this.getDeviceDescriptor()}getHistoricalSamples(e,n,o){this.subscriptionDescriptor&&this.subscriptionDescriptor.unsubscribe(),this.subscription&&this.subscription.unsubscribe(),this.loadingData=!0;const a={resolution:o,variables:this.existingVariables.filter(l=>l.group?l.group===this.view:l.variable===this.view).map(l=>l.variable),startDate:Math.floor(new Date(e).getTime()/1e3),endDate:Math.floor(new Date(n).getTime()/1e3),objectId:this.device};this.selectedResolution="MeterABB"===this.devicesTypeName&&"30s"===o?C.tW["15min"]:C.tW[o],this.subscription=this.modbusDeviceService.getHistoricalValues(a).subscribe(l=>{this.createChartData(l)},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}createChartData(e){this.chartData=[],e.forEach((n,o)=>{const a=this.existingVariables.find(l=>l.variable===n.variable);this.chartData.push({label:a.phase?a.phase:a.variable,color:this.chartColors[o],visible:!0,data:Object.keys(n.samples).map(l=>({timestamp:1e3*Number(l),value:"-"!==n.samples[l]?Number(Number(n.samples[l]).toFixed(2)):null})),unit:a.unit}),this.chartType=a.cumulative?"column":"linear",this.labelY={text:a.group?a.group:a.variable,unit:a.unit}}),"column"===this.chartType&&(this.chartData=this.chartData[0]),this.loadingData=!1}changeView(){localStorage.setItem(`${this.type}HistoricalView`,String(this.view))}exportToCsv(){const e=this.viewList.find(_=>_.id===this.view),n=this.devicesList.find(_=>_.id===this.device),o=["TIMESTAMP_UTC ["+this.translate.instant("RESOLUTION_S")+"]","DATE_UTC"],a=(null==n?void 0:n.text)+"_"+this.translate.instant((null==e?void 0:e.text)||"")+"_"+this.datePipe.transform(Date.now(),"yyyy-MM-dd_HH-mm-ss");let l=[];("linear"===this.chartType?this.chartData:[this.chartData]).forEach(_=>{o.push(_.label+" ["+_.unit+"]"),_.data.forEach((M,D)=>{l[D]||(l[D]=[Math.floor(M.timestamp/1e3),this.datePipe.transform(M.timestamp,"yyyy-MM-dd HH:mm:ss","UTC")]),l[D].push(null!==M.value?M.value.toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}):"-")})}),new u.Sv(l,a,{fieldSeparator:";",headers:o})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(we.D),t.Y36(x._),t.Y36(v.sK),t.Y36(H.F),t.Y36(b.uU),t.Y36(xt.V))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-modbus-device-historical-values"]],hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},inputs:{type:"type",categoriesList:"categoriesList",category:"category"},outputs:{categoryListChange:"categoryListChange"},features:[t._Bn([b.uU])],decls:11,vars:9,consts:[[1,"section-header"],[1,"controls"],[1,"label"],["inputClass","no-validate","inputId","category_select",3,"options","model","modelChange","callbackChange"],[4,"ngIf"],["class","section-content",4,"ngIf"],["inputClass","no-validate","inputId","device_select",3,"model","options","modelChange","callbackChange"],["inputClass","no-validate","inputId","view_select",3,"options","model","modelChange","callbackChange"],[1,"divider"],[2,"float","left",3,"callbackChange","showResolutions","datesStorageKey"],["pickRange",""],["type","button","nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_download_16"],[1,"section-content"],["class","empty-text",4,"ngIf"],["class","chart-container",4,"ngIf"],[1,"empty-text"],[1,"chart-container"],[3,"chartData","labelY",4,"ngIf"],[3,"chartData","labelY","resolution",4,"ngIf"],[3,"chartData","labelY"],[3,"chartData","labelY","resolution"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div"),t.TgZ(3,"span",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"app-select",3),t.NdJ("modelChange",function(a){return n.category=a})("callbackChange",function(){return n.changeCategory()}),t.qZA(),t.qZA(),t.YNc(7,He,5,5,"div",4),t.YNc(8,Ue,13,11,"ng-container",4),t.qZA(),t.qZA(),t.YNc(9,qe,1,0,"app-loader",4),t.YNc(10,Ye,4,3,"div",5)),2&e&&(t.xp6(4),t.Oqu(t.lcZ(5,7,"CATEGORY")),t.xp6(2),t.Q6J("options",n.categoriesList)("model",n.category),t.xp6(1),t.Q6J("ngIf",n.devices),t.xp6(1),t.Q6J("ngIf",null==n.viewList?null:n.viewList.length),t.xp6(1),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("ngIf",!n.loadingData))},directives:[q.H,b.O5,J.P,et.ix,it.dQ,nt.w,lt.SY,G.R,_t,Ie],pipes:[v.X$,ft.Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.section-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:auto;padding-bottom:20px}"]}),i})();function Qe(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-energy-monitoring-historical-values-current-sensors",5),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}function Pe(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-energy-monitoring-historical-values-io-modules",5),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}function ke(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-energy-monitoring-historical-values-ssd",5),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}function Be(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-modbus-device-historical-values",6),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}function je(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-modbus-device-historical-values",7),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}function We(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-modbus-device-historical-values",8),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}function Xe(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-modbus-device-historical-values",9),t.NdJ("categoryListChange",function(o){return t.CHM(e),t.oxw().changeCategory(o)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("category",e.category)("categoriesList",e.categoriesList)}}let Ge=(()=>{class i{constructor(){this.id="energy_monitoring_historical_values"}ngOnInit(){this.categoriesList=[{id:"CurrentSensors",text:"CURRENT_SENSORS"},{id:"IOModules",text:"IO_MODULES"},{id:"SSD",text:"SSD"},{id:"ModbusRtuDevices",text:"MODBUS_RTU_DEVICES"},{id:"ModbusTcpDevices",text:"MODBUS_TCP_DEVICES"},{id:"MeterWMbus",text:"WIRELESS_MBUS_METERS"},{id:"Groups",text:"GROUPS"}],this.category=localStorage.getItem("AnalyticsHistoricalValuesCategory")||"CurrentSensors"}changeCategory(e){this.category=e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-historical-values"]],hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},decls:7,vars:7,consts:[[3,"category","categoriesList","categoryListChange",4,"ngIf"],["type","ThirdPartyRTU",3,"category","categoriesList","categoryListChange",4,"ngIf"],["type","ThirdPartyTCP",3,"category","categoriesList","categoryListChange",4,"ngIf"],["type","MeterWMbus",3,"category","categoriesList","categoryListChange",4,"ngIf"],["type","Group",3,"category","categoriesList","categoryListChange",4,"ngIf"],[3,"category","categoriesList","categoryListChange"],["type","ThirdPartyRTU",3,"category","categoriesList","categoryListChange"],["type","ThirdPartyTCP",3,"category","categoriesList","categoryListChange"],["type","MeterWMbus",3,"category","categoriesList","categoryListChange"],["type","Group",3,"category","categoriesList","categoryListChange"]],template:function(e,n){1&e&&(t.YNc(0,Qe,1,2,"app-energy-monitoring-historical-values-current-sensors",0),t.YNc(1,Pe,1,2,"app-energy-monitoring-historical-values-io-modules",0),t.YNc(2,ke,1,2,"app-energy-monitoring-historical-values-ssd",0),t.YNc(3,Be,1,2,"app-modbus-device-historical-values",1),t.YNc(4,je,1,2,"app-modbus-device-historical-values",2),t.YNc(5,We,1,2,"app-modbus-device-historical-values",3),t.YNc(6,Xe,1,2,"app-modbus-device-historical-values",4)),2&e&&(t.Q6J("ngIf","CurrentSensors"===n.category),t.xp6(1),t.Q6J("ngIf","IOModules"===n.category),t.xp6(1),t.Q6J("ngIf","SSD"===n.category),t.xp6(1),t.Q6J("ngIf","ModbusRtuDevices"===n.category),t.xp6(1),t.Q6J("ngIf","ModbusTcpDevices"===n.category),t.xp6(1),t.Q6J("ngIf","MeterWMbus"===n.category),t.xp6(1),t.Q6J("ngIf","Groups"===n.category))},directives:[b.O5,jt,Ce,De,Fe],styles:[""]}),i})();var st=d(868);function Ke(i,s){1&i&&(t.TgZ(0,"a",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"IMPORT")," "))}function $e(i,s){1&i&&(t.TgZ(0,"a",5),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"EXPORT")," "))}let ti=(()=>{class i{constructor(){this.id="energy_monitoring_import_export"}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-import-export"]],hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},decls:6,vars:1,consts:[["nzType","card","nzLinkRouter","",3,"nzAnimated"],["id","energy_monitoring_export_import_import","nz-tab-link","","routerLink","/energy-monitoring/import-export/import",4,"nzTabLink"],["id","energy_monitoring_export_import_export","nz-tab-link","","routerLink","/energy-monitoring/import-export/export",4,"nzTabLink"],[1,"router-outlet"],["id","energy_monitoring_export_import_import","nz-tab-link","","routerLink","/energy-monitoring/import-export/import"],["id","energy_monitoring_export_import_export","nz-tab-link","","routerLink","/energy-monitoring/import-export/export"]],template:function(e,n){1&e&&(t.TgZ(0,"nz-tabset",0),t.TgZ(1,"nz-tab"),t.YNc(2,Ke,3,3,"a",1),t.qZA(),t.TgZ(3,"nz-tab"),t.YNc(4,$e,3,3,"a",2),t.qZA(),t.qZA(),t._UZ(5,"router-outlet",3)),2&e&&t.Q6J("nzAnimated",!1)},directives:[st.xH,st.xw,st.Fx,st.Ao,T.yS,T.lC],pipes:[v.X$],styles:[""]}),i})();var B=d(3075),yt=d(8397),ei=d(2334),Tt=d(9228);const ii=["form"];function ni(i,s){1&i&&t._UZ(0,"app-loader")}let oi=(()=>{class i{constructor(){this.id="energy_monitoring_import",this.loadingData=!1,this.saving=!1,this.options=[{id:"Current sensors",text:"CURRENT_SENSORS"},{id:"I/O Modules",text:"IO_MODULES"},{id:"Modbus RTU Devices",text:"MODBUS_RTU_DEVICES"},{id:"Modbus TCP Devices",text:"MODBUS_TCP_DEVICES"}],this.options2=[{id:"values",text:"ALL_HISTORICAL_VALUES"},{id:"values2",text:"SETTINGS"}],this.testModel="Current sensors",this.testModel2="values",this.date1=null,this.date2=null}ngOnInit(){}canDeactivate(){return!this.form||!this.form.dirty}hideToast(){}onChangeDate(){}handleUpload(e){"uploading"!==e.file.status&&console.log(e.file,e.fileList)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-import"]],viewQuery:function(e,n){if(1&e&&t.Gf(ii,5),2&e){let o;t.iGM(o=t.CRH())&&(n.form=o.first)}},hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},decls:38,vars:29,consts:[[1,"section-content"],[4,"ngIf"],[3,"appCanDeactivate"],["formAdd","ngForm"],[1,"form-group-item"],["inputClass","no-validate","inputId","import_by_select",3,"model","options","modelChange"],["inputClass","no-validate","inputId","information_to_import_select",3,"model","options","modelChange"],["inputId","selected_file",3,"smallUploader","file","fileChange","callbackChange"],["inputClass","no-validate"],["nz-button","","nzType","primary","id","add_button"],["header","WHAT_IS_IMPORT","text","IMPORT_DESCRIPTION"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,ni,1,0,"app-loader",1),t.TgZ(2,"form",2,3),t.TgZ(4,"div",4),t.TgZ(5,"strong"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"div",4),t.TgZ(9,"label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"app-select",5),t.NdJ("modelChange",function(a){return n.testModel=a}),t.qZA(),t.qZA(),t.TgZ(13,"div",4),t.TgZ(14,"label"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"app-select",6),t.NdJ("modelChange",function(a){return n.testModel2=a}),t.qZA(),t.qZA(),t.TgZ(18,"div",4),t.TgZ(19,"label"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"app-file-upload",7),t.NdJ("fileChange",function(a){return n.file=a})("callbackChange",function(){return n.hideToast()}),t.qZA(),t.qZA(),t.TgZ(23,"div",4),t.TgZ(24,"label"),t._uU(25),t.ALo(26,"translate"),t.qZA(),t._UZ(27,"textarea",8),t.qZA(),t.TgZ(28,"div",4),t.TgZ(29,"label"),t._uU(30),t.ALo(31,"translate"),t.qZA(),t._UZ(32,"textarea",8),t.qZA(),t.TgZ(33,"div",4),t.TgZ(34,"button",9),t._uU(35),t.ALo(36,"translate"),t.qZA(),t.qZA(),t.qZA(),t._UZ(37,"app-description-box",10),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("appCanDeactivate",n.canDeactivate.bind(n)),t.xp6(4),t.Oqu(t.lcZ(7,15,"IMPORT_OPTIONS")),t.xp6(4),t.Oqu(t.lcZ(11,17,"IMPORT_BY")),t.xp6(2),t.Q6J("model",n.testModel)("options",n.options),t.xp6(3),t.Oqu(t.lcZ(16,19,"INFORMATION_TO_IMPORT")),t.xp6(2),t.Q6J("model",n.testModel2)("options",n.options2),t.xp6(3),t.Oqu(t.lcZ(21,21,"UPLOAD_FILE")),t.xp6(2),t.Q6J("smallUploader",!0)("file",n.file),t.xp6(3),t.Oqu(t.lcZ(26,23,"PUBLIC_KEY")),t.xp6(5),t.Oqu(t.lcZ(31,25,"SYMMETRIC_KEY")),t.xp6(5),t.hij(" ",t.lcZ(36,27,"IMPORT")," "))},directives:[b.O5,G.R,B._Y,B.JL,B.F,yt.z,q.H,ei.Y,et.ix,it.dQ,nt.w,Tt.i],pipes:[v.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto}.section-content[_ngcontent-%COMP%]{display:flex}.dates[_ngcontent-%COMP%]{justify-content:space-between}.dates[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   nz-date-picker[_ngcontent-%COMP%]{width:190px}textarea[_ngcontent-%COMP%]{height:70px;width:400px;resize:none;padding:0 5px}"]}),i})();var bt=d(3868),ai=d(2905);const si=["form"];function ri(i,s){1&i&&t._UZ(0,"app-loader")}function li(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",4),t.TgZ(1,"label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-select",17),t.NdJ("modelChange",function(o){return t.CHM(e),t.oxw().testModel3=o}),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"PERIOD")),t.xp6(2),t.Q6J("model",e.testModel3)("options",e.options3)}}let ci=(()=>{class i{constructor(){this.id="energy_monitoring_export",this.loadingData=!1,this.options=[{id:"Current sensors",text:"CURRENT_SENSORS"},{id:"I/O Modules",text:"IO_MODULES"},{id:"Modbus RTU Devices",text:"MODBUS_RTU_DEVICES"},{id:"Modbus TCP Devices",text:"MODBUS_TCP_DEVICES"}],this.options2=[{id:"values",text:"ALL_HISTORICAL_VALUES"},{id:"values2",text:"SETTINGS"}],this.options3=[{id:"Every day",text:"EVERY_DAY"},{id:"First day of every week",text:"FIRST_DAY_OF_EVERY_WEEK"},{id:"First day of every month",text:"FIRST_DAY_OF_EVERY_MONTH"},{id:"First day of every year",text:"FIRST_DAY_OF_EVERY_YEAR"}],this.testModel="Current sensors",this.testModel2="values",this.testModel3="Every day",this.date1=null,this.date2=null,this.periodicExport=0}ngOnInit(){}canDeactivate(){return!this.form||!this.form.dirty}onChangeDate(){}hideToast(){}handleUpload(e){"uploading"!==e.file.status&&console.log(e.file,e.fileList)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-export"]],viewQuery:function(e,n){if(1&e&&t.Gf(si,5),2&e){let o;t.iGM(o=t.CRH())&&(n.form=o.first)}},hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},decls:61,vars:45,consts:[[1,"section-content"],[4,"ngIf"],[3,"appCanDeactivate"],["formAdd","ngForm"],[1,"form-group-item"],["name","statusSelect",3,"ngModel","ngModelChange"],["nz-radio","","id","status_radio_no",3,"nzValue"],["nz-radio","","id","status_radio_yes",3,"nzValue"],["class","form-group-item",4,"ngIf"],["inputClass","no-validate","inputId","export_by_select",3,"model","options","modelChange"],["inputClass","no-validate","inputId","information_to_export_select",3,"model","options","modelChange"],[1,"two-in-row","dates"],["nzShowTime","true","name","dateFrom",3,"ngModel","ngModelChange"],["nzShowTime","true","name","dateTo",3,"ngModel","ngModelChange"],["inputClass","no-validate"],["nz-button","","nzType","primary","id","add_button"],["header","WHAT_IS_EXPORT","text","EXPORT_DESCRIPTION"],["inputClass","no-validate","inputId","export_by_select3",3,"model","options","modelChange"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,ri,1,0,"app-loader",1),t.TgZ(2,"form",2,3),t.TgZ(4,"div",4),t.TgZ(5,"strong"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"div",4),t._UZ(9,"label"),t.TgZ(10,"nz-radio-group",5),t.NdJ("ngModelChange",function(a){return n.periodicExport=a}),t.TgZ(11,"label",6),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"label",7),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.qZA(),t.qZA(),t.YNc(17,li,5,5,"div",8),t.TgZ(18,"div",4),t.TgZ(19,"strong"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.qZA(),t.TgZ(22,"div",4),t.TgZ(23,"label"),t._uU(24),t.ALo(25,"translate"),t.qZA(),t.TgZ(26,"app-select",9),t.NdJ("modelChange",function(a){return n.testModel=a}),t.qZA(),t.qZA(),t.TgZ(27,"div",4),t.TgZ(28,"label"),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"app-select",10),t.NdJ("modelChange",function(a){return n.testModel2=a}),t.qZA(),t.qZA(),t.TgZ(32,"div",4),t.TgZ(33,"div",11),t.TgZ(34,"div"),t.TgZ(35,"label"),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"nz-date-picker",12),t.NdJ("ngModelChange",function(a){return n.date1=a})("ngModelChange",function(){return n.onChangeDate()}),t.qZA(),t.qZA(),t.TgZ(39,"div"),t.TgZ(40,"label"),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"nz-date-picker",13),t.NdJ("ngModelChange",function(a){return n.date2=a})("ngModelChange",function(){return n.onChangeDate()}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(44,"div",4),t.TgZ(45,"label"),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.TgZ(48,"textarea",14),t._uU(49,"-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAn9+zQgCNg33hpp+r8CrM\nm5PEu4WddSKvb7D7UiWndLkBTZ2Xa6iT8c7CHS0UPRTyQatoAzzYEsiQmnISKmts\n6B218AC+sbUJ3W+cJ9HdsaEIKMsMojqyS6l/r4/Mx2xan8+8zNfCxbLp2viNKTlh\n6sqXeB4V8Q4EomkL2gp/9k7VdD6/YVlin1NswTf/c6gkHWZqo0BuiX/TjWU+j0LR\ndEvDr8XyGiM18uhM0SbbdCt1vpKuFu1vGY6/GikgCgJSWc0JXlTOGPq9wkJ6a/gR\n76/CoNgZw5YSw6Ib5FdVtwNtO472NAPJwiRQsEK7vE6oi8+jWGCiWKbRj/S3IZjS\nFwIDAQAB\n-----END PUBLIC KEY-----"),t.qZA(),t.qZA(),t.TgZ(50,"div",4),t.TgZ(51,"label"),t._uU(52),t.ALo(53,"translate"),t.qZA(),t.TgZ(54,"textarea",14),t._uU(55,"GKaZq2CO1d24V55vz9bhdcm9LobSJBEez+mJAhvoOB58QwqAC/3\n3iYvFrWrX+l3+ST65w4w=="),t.qZA(),t.qZA(),t.TgZ(56,"div",4),t.TgZ(57,"button",15),t._uU(58),t.ALo(59,"translate"),t.qZA(),t.qZA(),t.qZA(),t._UZ(60,"app-description-box",16),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("appCanDeactivate",n.canDeactivate.bind(n)),t.xp6(4),t.Oqu(t.lcZ(7,23,"PERIODIC_EXPORT")),t.xp6(4),t.Q6J("ngModel",n.periodicExport),t.xp6(1),t.Q6J("nzValue",1),t.xp6(1),t.Oqu(t.lcZ(13,25,"YES")),t.xp6(2),t.Q6J("nzValue",0),t.xp6(1),t.Oqu(t.lcZ(16,27,"NO")),t.xp6(2),t.Q6J("ngIf",n.periodicExport),t.xp6(3),t.Oqu(t.lcZ(21,29,"EXPORT_OPTIONS")),t.xp6(4),t.Oqu(t.lcZ(25,31,"EXPORT_BY")),t.xp6(2),t.Q6J("model",n.testModel)("options",n.options),t.xp6(3),t.Oqu(t.lcZ(30,33,"INFORMATION_TO_EXPORT")),t.xp6(2),t.Q6J("model",n.testModel2)("options",n.options2),t.xp6(5),t.Oqu(t.lcZ(37,35,"FROM")),t.xp6(2),t.Q6J("ngModel",n.date1),t.xp6(3),t.Oqu(t.lcZ(42,37,"TO")),t.xp6(2),t.Q6J("ngModel",n.date2),t.xp6(3),t.Oqu(t.lcZ(47,39,"PUBLIC_KEY")),t.xp6(6),t.Oqu(t.lcZ(53,41,"SYMMETRIC_KEY")),t.xp6(6),t.hij(" ",t.lcZ(59,43,"EXPORT")," "))},directives:[b.O5,G.R,B._Y,B.JL,B.F,yt.z,bt.Dg,B.JJ,B.On,bt.Of,q.H,ai.uw,et.ix,it.dQ,nt.w,Tt.i],pipes:[v.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto}.section-content[_ngcontent-%COMP%]{display:flex}.dates[_ngcontent-%COMP%]{justify-content:space-between}.dates[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   nz-date-picker[_ngcontent-%COMP%]{width:190px}textarea[_ngcontent-%COMP%]{height:70px;width:400px;resize:none;padding:0 5px}"]}),i})();var $=d(7618),hi=d(8520),pi=d(4063),di=d(408),gi=d(2980);const ui=["addContractTemplate"],_i=["formAdd"];function mi(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().addContractDrawer()}),t._UZ(1,"i",6),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"ADD_NEW_CONTRACT")))}function fi(i,s){1&i&&t._UZ(0,"app-loader")}function vi(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",25),t.TgZ(1,"span",26),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",27),t.NdJ("click",function(){t.CHM(e),t.oxw();const o=t.MAs(2);return t.oxw().removeSelectedTarifs(o)}),t._UZ(5,"i",28),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA()}if(2&i){t.oxw();const e=t.MAs(2);t.xp6(2),t.AsE("",e.nrOfSelected," ",t.lcZ(3,3,"SELECTED"),""),t.xp6(4),t.Oqu(t.lcZ(7,5,"REMOVE"))}}function Ci(i,s){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.qZA()),2&i){const e=s.$implicit,n=t.oxw(3);t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(n.translateTags(e.tags)),t.xp6(2),t.AsE("",e.cost," ",n.currency.symbol,"")}}const xi=function(){return["0"]},yi=function(i){return{x:i}};function Ti(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr"),t.TgZ(2,"td",29),t.NdJ("nzExpandChange",function(o){return t.CHM(e).$implicit.expand=o}),t.qZA(),t.TgZ(3,"td",30),t.NdJ("nzCheckedChange",function(o){const l=t.CHM(e).$implicit;return t.oxw(),t.MAs(2).onItemSelected(l,o)}),t.qZA(),t.TgZ(4,"td",20),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"td",31),t.TgZ(14,"button",32),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).addContractDrawer(a)}),t.ALo(15,"translate"),t._UZ(16,"i",33),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"tr",34),t.TgZ(18,"nz-table",35),t.TgZ(19,"thead"),t.TgZ(20,"tr"),t.TgZ(21,"th"),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"th"),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"th"),t._uU(28),t.ALo(29,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(30,"tbody"),t.YNc(31,Ci,7,4,"tr",24),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&i){const e=s.$implicit,n=s.index;t.oxw();const o=t.MAs(2);t.xp6(2),t.MGl("id","expand_contracts_button_",n,""),t.Q6J("nzLeft",o.allowNzLeft)("nzLeft",o.allowNzLeft)("nzExpand",e.expand),t.xp6(1),t.MGl("id","table_item_checkbox_",n,""),t.Q6J("nzLeft",o.allowNzLeft)("nzChecked",e.selected),t.xp6(1),t.Q6J("nzLeft",o.allowNzLeft),t.xp6(1),t.Oqu(e.id),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.devices),t.xp6(2),t.Oqu(t.lcZ(12,23,0===e.type?"VIRTUAL_TARIFF":"METER_MANAGED_TARIFF")),t.xp6(3),t.MGl("id","edit_contract_button_",n,""),t.s9C("nzTooltipTitle",t.lcZ(15,25,"EDIT")),t.xp6(3),t.Q6J("nzExpand",e.expand||!1),t.xp6(1),t.MGl("id","tariffs_table_",n,""),t.Q6J("nzData",t.DdM(33,xi))("nzScroll",t.VKq(34,yi,o.tableWidth))("nzFrontPagination",!1),t.xp6(4),t.Oqu(t.lcZ(23,27,"NAME")),t.xp6(3),t.Oqu(t.lcZ(26,29,"TAGS")),t.xp6(3),t.Oqu(t.lcZ(29,31,"COST")),t.xp6(3),t.Q6J("ngForOf",e.tariffs)}}const bi=function(){return{key:"modbus_id",value:"ascend"}},Zi=function(i,s){return{x:i,y:s}},rt=function(){return["ascend","descend"]};function Mi(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",7),t.TgZ(1,"app-table",8,9),t.YNc(3,vi,8,7,"div",10),t.TgZ(4,"nz-table",11,12),t.ALo(6,"translate"),t.TgZ(7,"thead",13),t.NdJ("nzSortOrderChange",function(o){return t.CHM(e),t.MAs(2).sort(o)}),t.TgZ(8,"tr"),t._UZ(9,"th",14),t.TgZ(10,"th",15),t.NdJ("nzCheckedChange",function(o){return t.CHM(e),t.MAs(2).onAllSelected(o)}),t.qZA(),t.TgZ(11,"th",16),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"th",17),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"th",17),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"th",17),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.TgZ(23,"th",18),t._uU(24),t.ALo(25,"translate"),t.qZA(),t.qZA(),t.TgZ(26,"tr",19),t._UZ(27,"th",20),t._UZ(28,"th",20),t.TgZ(29,"th",21),t.TgZ(30,"input",22),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"id","contains")}),t.qZA(),t.qZA(),t.TgZ(31,"th",23),t.TgZ(32,"input",22),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"name","contains")}),t.qZA(),t.qZA(),t.TgZ(33,"th",23),t.TgZ(34,"input",22),t.NdJ("input",function(o){return t.CHM(e),t.MAs(2).filter(o,"devices","contains")}),t.qZA(),t.qZA(),t._UZ(35,"th"),t._UZ(36,"th"),t._UZ(37,"th"),t.qZA(),t.qZA(),t.TgZ(38,"tbody"),t.YNc(39,Ti,32,36,"ng-container",24),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.MAs(2),n=t.MAs(5),o=t.oxw();t.xp6(1),t.Q6J("initSort",t.DdM(46,bi))("data",o.rows),t.xp6(2),t.Q6J("ngIf",e.nrOfSelected),t.xp6(1),t.Q6J("nzData",e.tableData)("nzFrontPagination",!1)("nzScroll",t.WLB(47,Zi,e.tableWidth,e.tableHeight))("nzNoResult",t.lcZ(6,34,"NO_TARIFF_CONTRACTS")),t.xp6(5),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(1),t.Q6J("nzLeft",e.allowNzLeft)("nzChecked",e.selected)("nzIndeterminate",e.indeterminate),t.xp6(1),t.Q6J("nzLeft",e.allowNzLeft)("nzColumnKey","id")("nzSortFn",!0)("nzSortDirections",t.DdM(50,rt))("nzSortOrder","ascend"),t.xp6(1),t.Oqu(t.lcZ(13,36,"ID")),t.xp6(2),t.Q6J("nzColumnKey","name")("nzSortFn",!0)("nzSortDirections",t.DdM(51,rt)),t.xp6(1),t.Oqu(t.lcZ(16,38,"NAME")),t.xp6(2),t.Q6J("nzColumnKey","devices")("nzSortFn",!0)("nzSortDirections",t.DdM(52,rt)),t.xp6(1),t.Oqu(t.lcZ(19,40,"DEVICES")),t.xp6(2),t.Q6J("nzColumnKey","contract_type")("nzSortFn",!0)("nzSortDirections",t.DdM(53,rt)),t.xp6(1),t.Oqu(t.lcZ(22,42,"CONTRACT_TYPE")),t.xp6(3),t.Oqu(t.lcZ(25,44,"ACTION")),t.xp6(3),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(1),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(1),t.Q6J("nzLeft",e.allowNzLeft),t.xp6(10),t.Q6J("ngForOf",n.data)}}function Ai(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-energy-monitoring-contracts-configuration",36),t.NdJ("callback",function(){return t.CHM(e),t.oxw().getData()}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("contracts",e.rows)("editContract",e.editContract)("devices",e.devices)}}const Di=[{path:"",redirectTo:"asset-overview"},{path:"import-export",redirectTo:"import-export/import"},{path:"asset-overview",component:V,canActivate:[$.a],data:{activeMenu:"ENERGY_MONITORING",activeSubMenu:"ASSET_OVERVIEW",hideHeader:!0}},{path:"historical-values",component:Ge,canActivate:[$.a],data:{activeMenu:"ENERGY_MONITORING",activeSubMenu:"HISTORICAL_VALUES",icon:"icon_abb_24 icon-abb_gauge_24"}},{path:"contracts",component:(()=>{class i{constructor(e,n,o,a,l,m,_){this.translate=e,this.toastr=n,this.tarifsService=o,this.modalService=a,this.drawerService=l,this.sharedService=m,this.appLoadService=_,this.id="energy_monitoring_tariffs",this.loadingData=!0}ngOnInit(){this.currency=this.appLoadService.currency.value,this.getData()}getData(){this.loadingData=!0,this.tarifsService.getContracts().subscribe(e=>{this.contractTypes=e.contractTypes,this.getDevices(e.devices),this.rows=e.contracts,this.rows.forEach(n=>{n.expand=!1,n.tariffs.forEach(o=>{o.scheduler&&(o.scheduler[0].fromDate=new Date(o.scheduler[0].fromDate),o.scheduler[0].toDate=new Date(o.scheduler[0].toDate),o.scheduler[0].fromTime=new Date(o.scheduler[0].fromTime),o.scheduler[0].toTime=new Date(o.scheduler[0].toTime)),o.tags.length&&(o.type="WaterGasWater"===o.tags[0]||"WaterGasGas"===o.tags[0]?"waterGas":o.tags[0].includes("Export")?"export":"import")})}),this.loadingData=!1},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR"))})}getDevices(e){this.devices=e.map(n=>({id:n.object_id,text:n.name}))}translateTags(e){return e.map(n=>this.translate.instant(n))}removeSelectedTarifs(e){const n=[];let a,l,m,o=[];e.tableData.forEach(_=>{_.selected&&n.push({id:_.id,name:_.name})}),o=n.map(_=>_.id),n.length>1?(a=this.translate.instant("REMOVE_ALL_CONTRACT_WARNING"),l=this.translate.instant("REMOVE_ALL_CONTRACT_SUCCESS")):(m=n[0],a=this.translate.instant("REMOVE_CONTRACT_WARNING",{name:"<strong>"+n[0].name+"</strong>"}),l=this.translate.instant("REMOVE_CONTRACT_SUCCESS",{name:"<strong>"+n[0].name+"</strong>"})),this.modalService.showConfirm(a,()=>{this.modalService.setLoading(!0),this.tarifsService.removeContract(o).subscribe(()=>{this.modalService.hide(),this.getData(),this.toastr.success(l)},()=>{this.toastr.error(this.translate.instant("REQUEST_ERROR")),this.modalService.hide()})})}addContractDrawer(e){this.toastr.clear(),this.editContract=e?Object.assign(Object.assign({},e),{tariffs:e.tariffs.map(n=>Object.assign({},n))}):{type:1,tariffs:[],deviceIds:[]},this.drawerService.showDrawer(this.addContractTemplate).subscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(v.sK),t.Y36(x._),t.Y36(hi.M),t.Y36(pi.Z),t.Y36(di.z),t.Y36(H.F),t.Y36(xt.V))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-energy-monitoring-tarifs"]],viewQuery:function(e,n){if(1&e&&(t.Gf(ui,5),t.Gf(_i,5)),2&e){let o;t.iGM(o=t.CRH())&&(n.addContractTemplate=o.first),t.iGM(o=t.CRH())&&(n.form=o.first)}},hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.id)},inputs:{configuration:"configuration"},decls:6,vars:3,consts:[[1,"section-header"],["nz-button","","nzType","primary","id","add_new_event_button",3,"click",4,"ngIf"],[4,"ngIf"],["class","section-content",4,"ngIf"],["addContractTemplate",""],["nz-button","","nzType","primary","id","add_new_event_button",3,"click"],[1,"icon_abb_16","icon-abb_plus_16"],[1,"section-content"],[3,"initSort","data"],["table",""],["class","table-selected-buttons",4,"ngIf"],[3,"nzData","nzFrontPagination","nzScroll","nzNoResult"],["nzTable",""],[3,"nzSortOrderChange"],["nzWidth","40px",3,"nzLeft"],["nzWidth","50px","id","table_all_selected",3,"nzLeft","nzChecked","nzIndeterminate","nzCheckedChange"],["nzWidth","120px",3,"nzLeft","nzColumnKey","nzSortFn","nzSortDirections","nzSortOrder"],[3,"nzColumnKey","nzSortFn","nzSortDirections"],["nzWidth","120px"],[1,"filters"],[3,"nzLeft"],[1,"input",3,"nzLeft"],["type","text",3,"input"],[1,"input"],[4,"ngFor","ngForOf"],[1,"table-selected-buttons"],["id","table_nr_of_selected"],["nz-button","","nzType","primary","id","table_selected_remove_button",1,"black",3,"click"],[1,"icon_abb_16","icon-abb_trash_16"],[3,"nzLeft","id","nzExpand","nzExpandChange"],[3,"nzLeft","id","nzChecked","nzCheckedChange"],[1,"icons"],["nz-button","","nzTooltipPlacement","left","nz-tooltip","",3,"id","nzTooltipTitle","click"],[1,"icon_abb_16","icon-abb_edit_16"],[3,"nzExpand"],[3,"nzData","nzScroll","nzFrontPagination","id"],[3,"contracts","editContract","devices","callback"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,mi,4,3,"button",1),t.qZA(),t.YNc(2,fi,1,0,"app-loader",2),t.YNc(3,Mi,40,54,"div",3),t.YNc(4,Ai,1,3,"ng-template",null,4,t.W1O)),2&e&&(t.xp6(1),t.Q6J("ngIf",!n.loadingData),t.xp6(1),t.Q6J("ngIf",n.loadingData),t.xp6(1),t.Q6J("ngIf",!n.loadingData))},directives:[b.O5,et.ix,it.dQ,nt.w,G.R,ct.a,y.N8,y.Om,y.$Z,y.Uo,y._C,y.qn,y.g6,y.qD,y.p0,b.sg,y.h7,lt.SY,y.d3,y.Vk,gi.Z],pipes:[v.X$],styles:[""]}),i})(),canActivate:[$.a],data:{activeMenu:"ENERGY_MONITORING",activeSubMenu:"CONTRACTS",icon:"icon_abb_24 icon-abb_gauge_24"}},{path:"import-export",component:ti,children:[{path:"import",component:oi,canActivate:[$.a],data:{activeMenu:"ENERGY_MONITORING",activeSubMenu:"IMPORT_EXPORT",icon:"icon_abb_24 icon-abb_gauge_24",activeTab:"IMPORT"}},{path:"export",component:ci,canActivate:[$.a],data:{activeMenu:"ENERGY_MONITORING",activeSubMenu:"IMPORT_EXPORT",icon:"icon_abb_24 icon-abb_gauge_24",activeTab:"EXPORT"}}]}];let wi=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[$.a],imports:[[T.Bz.forChild(Di)],T.Bz]}),i})();var Oi=d(5084);let Li=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[Oi.m,wi]]}),i})()},8938:(ut,k)=>{var T=function(){function u(){}return u.EOL="\r\n",u.BOM="\ufeff",u.DEFAULT_FIELD_SEPARATOR=",",u.DEFAULT_DECIMAL_SEPARATOR=".",u.DEFAULT_QUOTE='"',u.DEFAULT_SHOW_TITLE=!1,u.DEFAULT_TITLE="My Report",u.DEFAULT_FILENAME="mycsv.csv",u.DEFAULT_SHOW_LABELS=!1,u.DEFAULT_USE_BOM=!0,u.DEFAULT_HEADER=[],u.DEFAULT_OBJ_HEADER={},u.DEFAULT_USE_OBJ_HEADER=!1,u.DEFAULT_USE_HEADER=!1,u.DEFAULT_NO_DOWNLOAD=!1,u.DEFAULT_NULL_TO_EMPTY_STRING=!1,u}();k.hd={filename:T.DEFAULT_FILENAME,fieldSeparator:T.DEFAULT_FIELD_SEPARATOR,quoteStrings:T.DEFAULT_QUOTE,decimalseparator:T.DEFAULT_DECIMAL_SEPARATOR,showLabels:T.DEFAULT_SHOW_LABELS,showTitle:T.DEFAULT_SHOW_TITLE,title:T.DEFAULT_TITLE,useBom:T.DEFAULT_USE_BOM,headers:T.DEFAULT_HEADER,objHeader:T.DEFAULT_OBJ_HEADER,useObjHeader:T.DEFAULT_USE_OBJ_HEADER,useHeader:T.DEFAULT_USE_HEADER,noDownload:T.DEFAULT_NO_DOWNLOAD,nullToEmptyString:T.DEFAULT_NULL_TO_EMPTY_STRING};var t=function(){function u(h,E,Z){this.csv="";var x=Z||{};this.data="object"!=typeof h?JSON.parse(h):h,this._options=function C(u){for(var h=[],E=1;E<arguments.length;E++)h[E-1]=arguments[E];for(var Z,v,x=b(u),H=1;H<arguments.length;H++){for(var q in Z=Object(arguments[H]))tt.call(Z,q)&&(x[q]=Z[q]);if(Object.getOwnPropertySymbols){v=Object.getOwnPropertySymbols(Z);for(var J=0;J<v.length;J++)V.call(Z,v[J])&&(x[v[J]]=Z[v[J]])}}return x}({},k.hd,x),this._options.filename&&(this._options.filename=E),this.generateCsv()}return u.prototype.generateCsv=function(){if(this._options.useBom&&(this.csv+=T.BOM),this._options.showTitle&&(this.csv+=this._options.title+"\r\n\n"),this._options.useObjHeader&&Object.keys(this._options.objHeader).length>0?(this.getHeaderFromObj(),this.getBodyAccordingHeader()):(this.getHeaders(),this.getBody()),""!=this.csv){if(this._options.noDownload)return this.csv;var h=new Blob([this.csv],{type:"text/csv;charset=utf8;"});if(navigator.msSaveBlob){var E=this._options.filename.replace(/ /g,"_")+".csv";navigator.msSaveBlob(h,E)}else{encodeURI(this.csv);var x=document.createElement("a");x.href=URL.createObjectURL(h),x.setAttribute("target","_blank"),x.setAttribute("visibility","hidden"),x.download=this._options.filename.replace(/ /g,"_")+".csv",document.body.appendChild(x),x.click(),document.body.removeChild(x)}}else console.log("Invalid data")},u.prototype.getHeaders=function(){var h=this;if(this._options.headers.length>0){var Z=this._options.headers.reduce(function(x,v){return x+v+h._options.fieldSeparator},"");Z=Z.slice(0,-1),this.csv+=Z+T.EOL}},u.prototype.getHeaderFromObj=function(){var h=this;if(Object.keys(this._options.objHeader).length>0){var E="";Object.keys(this._options.objHeader).forEach(function(Z){E+=h._options.objHeader[Z]+h._options.fieldSeparator}),E=E.slice(0,-1),this.csv+=E+T.EOL}},u.prototype.getBodyAccordingHeader=function(){for(var h=this,E=function(v){var H="";Z._options.useObjHeader&&Object.keys(Z._options.objHeader).length>0&&Object.keys(Z._options.objHeader).forEach(function(q){H+=h.formatData(h.data[v][q])+h._options.fieldSeparator}),H=H.slice(0,-1),Z.csv+=H+T.EOL},Z=this,x=0;x<this.data.length;x++)E(x)},u.prototype.getBody=function(){for(var h=0;h<this.data.length;h++){var E="";if(this._options.useHeader&&this._options.headers.length>0)for(var Z=0,x=this._options.headers;Z<x.length;Z++)E+=this.formatData(this.data[h][v=x[Z]])+this._options.fieldSeparator;else for(var v in this.data[h])E+=this.formatData(this.data[h][v])+this._options.fieldSeparator;E=E.slice(0,-1),this.csv+=E+T.EOL}},u.prototype.formatData=function(h){return"locale"===this._options.decimalseparator&&u.isFloat(h)?h.toLocaleString():"."!==this._options.decimalseparator&&u.isFloat(h)?h.toString().replace(".",this._options.decimalseparator):"string"==typeof h?(h=h.replace(/"/g,'""'),(this._options.quoteStrings||h.indexOf(",")>-1||h.indexOf("\n")>-1||h.indexOf("\r")>-1)&&(h=this._options.quoteStrings+h+this._options.quoteStrings),h):this._options.nullToEmptyString?h||(h=""):"boolean"==typeof h?h?"TRUE":"FALSE":h},u.prototype.getCsvData=function(){return this.csv},u.isFloat=function(h){return+h===h&&(!isFinite(h)||Boolean(h%1))},u}();k.Sv=t;var tt=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;function b(u){if(null==u)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(u)}}}]);